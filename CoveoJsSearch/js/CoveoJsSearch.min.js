var secretFeatureVariable1309=!1,Coveo;!function(e){e.version={lib : "0.9.967.18",product:"0.9.1228.0"}}(Coveo||(Coveo={}));var Coveo;!function(e){var t;!function(t){function i(){for(var t=[],i=0;i<arguments.length;i++)t[i-0]=arguments[i];return e.L10N.format.apply(this,arguments)}t.l=i}(t=e.Ui||(e.Ui={}))}(Coveo||(Coveo={})),function(){var e={Unknown:"Unknown",And:"AND",Authenticating:"Authenticating {0}...",Clear:"Clear {0}",CompleteQuery:"Complete Query",Exclude:"Exclude {0}",EnterTag:"Add Tag",Next:"Next",Last:"Last",Link:"Link",Or:"OR",Previous:"Previous",QueryDidntMatchAnyDocuments:"Your query did not match any documents.",QueryException:"Your query has an error: {0}.",Me:"Me",Remove:"Remove",Search:"Search",SearchFor:"Search for {0}",ShareQuery:"Share Query",Preferences:"Preferences",LinkOpeningSettings:"Link Opening Settings",Reauthenticate:"Reauthenticate {0}",ResultsFilteringExpression:"Results Filtering Expressions",FiltersInYourPreferences:"Filters in your preferences",Create:"Create",SearchIn:"Search in {0}",Seconds:"in {0} second<pl>s</pl>",ShowingResultsOf:"Result<pl>s</pl> {0}<pl>-{1} </pl>of {2}",SwitchTo:"Switch to {0}",Unexclude:"Unexclude {0}",ClearAllFilters:"Clear All Filters",SkipLogin:"Skip login",LoginInProgress:"Login in progress, please wait ...",Login:"Log In",GetStarted:"Get Started",More:"More",Less:"Fewer",Settings:"Settings",Score:"Score",ScoreDescription:"The score is computed from the number of occurrences as well as from the position in the result set.",Occurrences:"Occurrences",OccurrencesDescription:"Sort by number of occurrences, with values having the highest number appearing first.",Label:"Label",Of:"of",LabelDescription:"Sort alphabetically on the field values.",Value:"Value",ValueDescription:"Sort on the values of the first computed field",AlphaAscending:"Value Ascending",AlphaDescending:"Value Descending",ChiSquare:"Chi Square",Nosort:"No Sort",RelativeFrequency:"Relative Frequency",RelativeFrequencyDescription:"Sort based on the relative frequency of values. Less common values will appear higher",Custom:"Custom",CustomDescription:"Sort based on a custom order",ComputedField:"Computed Field",Ascending:"Ascending",Descending:"Descending",noResultFor:"No results for {0}",autoCorrectedQueryTo:"Query was automatically corrected to {0}",didYouMean:"Did you mean: {0}",SuggestedResults:"Suggested Results",SuggestedQueries:"Suggested Queries",MostRelevantItems:"Most relevant items:",AllItems:"All items:",ShowLess:"Show less",ShowMore:"Show more",HideFacet:"Hide Facet",ShowFacet:"Show Facet",AndOthers:"and {0} other<pl>s</pl>",MostRelevantPosts:"Most Relevant Posts:",CompleteThread:"Complete Thread:",ShowCompleteThread:"Show Complete Thread",ShowOnlyTopMatchingPosts:"Show Only Top Matching Posts",MostRelevantReplies:"Most Relevant Replies:",AllConversation:"All Conversation:",ShowAllConversation:"Show All Conversation",ShowAllReplies:"Show All Replies",ShowOnlyMostRelevantReplies:"Show Only Most Relevant Replies",Close:"Close",Open:"Open",OpenInOutlookWhenPossible:"Open in Outlook (when possible)",AlwaysOpenInNewWindow:"Always open results in new window",QuickView:"Quick View",ErrorReport:"Error Report",OopsError:"Oops! Something went wrong on the server.",ProblemPersists:"If the problem persists contact the administrator.",GoBack:"Go Back",Reset:"Reset",Retry:"Retry",MoreInfo:"More Information",Username:"Username",Password:"Password",CannotConnect:"Cannot connect to the server address.",BadUserPass:"Password does not match with user name.",PleaseEnterYourCredentials:"Please enter your credentials for {0}.",PleaseEnterYourSearchPage:"Please enter your search page URL",Collapse:"Collapse",Expand:"Expand",Today:"Today",Yesterday:"Yesterday",Tomorrow:"Tomorrow",Duration:"Duration: {0}",IndexDuration:"Index Duration: {0}",ProxyDuration:"Proxy Duration: {0}",ClientDuration:"Client Duration: {0}",Unavailable:"Unavailable",Reply:"Reply",ReplyAll:"Reply All",Forward:"Forward",From:"From",Caption:"Caption",Expression:"Expression",Tab:"Tab",Tabs:"Tabs",EnterExpressionName:"Enter Expression Name",EnterExpressionToFilterWith:"Enter Expression To Filter Results With",SelectTab:"Select Tab",SelectAll:"Select All",PageUrl:"Search page URL",ErrorSavingToDevice:"Error while saving the information to your device",ErrorReadingFromDevice:"Error while reading the information from your device",AppIntro:"Speak with a product specialist who can answer your questions about Coveo and help your decide which Coveo solution is right for you. Or, try a live demo !",TryDemo:"Try the demo",ContactUs:"Contact us",NewToCoveo:"New to Coveo ?",LetUsHelpGetStarted:"Let us help you get started",CannotConnectSearchPage:"Cannot connect to your search page",AreYouSureDeleteFilter:"Are you sure you want to delete the filter {0} with the expression {1}",OnlineHelp:"Online Help",Done:"Done",SaveFacetState:"Save this facet state",ClearFacetState:"Clear facet state",DisplayingTheOnlyMessage:"Displaying the only message in this conversation",NoNetworkConnection:"No network connection",UnknownConnection:"Unknown connection",EthernetConnection:"Ethernet connection",WiFi:"WiFi connection",CELL:"Cellular connection",CELL_2G:"Cellular 2G connection",CELL_3G:"Cellular 3G connection",CELL_4G:"Cellular 4G connection",QueryExceptionNoException:"No exception",QueryExceptionInvalidSyntax:"Invalid syntax",QueryExceptionInvalidCustomField:"Invalid custom field",QueryExceptionInvalidDate:"Invalid date",QueryExceptionInvalidExactPhrase:"Invalid exact phrase",QueryExceptionInvalidDateOp:"Invalid date operator",QueryExceptionInvalidNear:"Invalid Near",QueryExceptionInvalidWeightedNear:"Invalid weighted near",QueryExceptionInvalidTerm:"Invalid term",QueryExceptionTooManyTerms:"Too many terms",QueryExceptionWildcardTooGeneral:"Wildcard too general",QueryExceptionInvalidSortField:"Invalid sort field",QueryExceptionInvalidSmallStringOp:"Invalid small string operator",QueryExceptionRequestedResultsMax:"Requested results maximum",QueryExceptionAggregatedMirrorDead:"Aggregated mirror dead",QueryExceptionAggregatedMirrorQueryTimeOut:"Aggregated mirror query timeout",QueryExceptionAggregatedMirrorInvalidBuildNumber:"Aggregated mirror invalid build number",QueryExceptionAggregatedMirrorCannotConnect:"Aggregated mirror cannot connect",QueryExceptionNotEnoughLeadingCharsWildcard:"Not enough leading character wildcard",QueryExceptionSecurityInverterNotFound:"Security inverter not found",QueryExceptionSecurityInverterAccessDenied:"Security inverter access denied",QueryExceptionAggregatedMirrorCannotImpersonate:"Aggregated mirror cannot impersonate",QueryExceptionUnexpected:"Unexpected",QueryExceptionAccessDenied:"Access denied",QueryExceptionSuperUserTokenInvalid:"Super user token invalid",QueryExceptionSuperUserTokenExpired:"Super user token is expired",QueryExceptionLicenseQueriesExpired:"Queries license expired",QueryExceptionLicenseSuperUserTokenNotSupported:"License super user token not supported",QueryExceptionInvalidSession:"Invalid session",QueryExceptionInvalidDocument:"Invalid document",QueryExceptionSearchDisabled:"Search disabled",objecttype_people:"People",objecttype_message:"Message",objecttype_feed:"RSS Feed",objecttype_thread:"Thread",objecttype_board:"",objecttype_category:"",objecttype_account:"Account",objecttype_campaign:"Campaign",objecttype_case:"Case",objecttype_contact:"Contact",objecttype_contract:"Contract",objecttype_event:"Event",objecttype_lead:"Lead",objecttype_solution:"Solution",objecttype_task:"Task",objecttype_user:"User",objecttype_attachment:"Attachment",objecttype_casecomment:"Case Comment",objecttype_opportunity:"Opportunity",objecttype_note:"Note",objecttype_product:"Product",objecttype_partner:"Partner",objecttype_kbdocumentation:"Documentation",objecttype_kbsolution:"Solution",objecttype_kbknowledgearticle:"Knowledge Article",objecttype_kbattachment:"Attachment",sysfiletype_html:"HTML File",sysfiletype_image:"Image",sysfiletype_folder:"Folder",sysfiletype_txt:"Text",sysfiletype_zip:"Zip File",sysfiletype_pdf:"PDF File",sysfiletype_xml:"XML File",sysfiletype_doc:"Word Document",sysfiletype_xls:"Excel Document",sysfiletype_ppt:"PowerPoint Document",sysfiletype_video:"Video",sysfiletype_exchangemessage:"Message",sysfiletype_exchangeappointment:"Appointment",sysfiletype_exchangenote:"Note",sysfiletype_exchangetask:"Task",sysfiletype_exchangeperson:"Exchange user",sysfiletype_activedirperson:"Active Directory user",sysfiletype_exchangeactivity:"Activity",sysfiletype_exchangecalendarmessage:"Calendar message",sysfiletype_exchangedocument:"Exchange document",sysfiletype_exchangerssfeed:"RSS Feed",sysfiletype_exchangejunkmessage:"Junk email",sysfiletype_exchangeofficecom:"Communications",sysfiletype_spportal:"Portal",sysfiletype_spsite:"Site",sysfiletype_spuserprofile:"SharePoint User",sysfiletype_sparea:"Area",sysfiletype_spannouncement:"Announcement",sysfiletype_spannouncementlist:"Announcements",sysfiletype_spcontact:"Contact",sysfiletype_spcontactlist:"Contacts",sysfiletype_spcustomlist:"Custom Lists",sysfiletype_spdiscussionboard:"Discussion Board",sysfiletype_spdiscussionboardlist:"Discussion Boards",sysfiletype_spdocumentlibrarylist:"Document Library",sysfiletype_spevent:"Event",sysfiletype_speventlist:"Events",sysfiletype_spformlibrarylist:"Form Library",sysfiletype_spissue:"Issue",sysfiletype_spissuelist:"Issues",sysfiletype_splink:"Link",sysfiletype_splinklist:"Links",sysfiletype_sppicturelibrarylist:"Picture Library",sysfiletype_spsurvey:"Survey",sysfiletype_spsurveylist:"Surveys",sysfiletype_sptask:"Task",sysfiletype_sptasklist:"Tasks",sysfiletype_spagenda:"Agenda",sysfiletype_spagendalist:"Agendas",sysfiletype_spattendee:"Attendee",sysfiletype_spattendeelist:"Attendees",sysfiletype_spcustomgridlist:"Custom Grids",sysfiletype_spdecision:"Decision",sysfiletype_spdecisionlist:"Decisions",sysfiletype_spobjective:"Objective",sysfiletype_spobjectivelist:"Objectives",sysfiletype_sptextbox:"Textbox",sysfiletype_sptextboxlist:"Textbox list",sysfiletype_spthingstobring:"Thing To Bring",sysfiletype_spthingstobringlist:"Things To Bring",sysfiletype_sparealisting:"Area Listing",sysfiletype_spmeetingserie:"Meeting series",sysfiletype_spmeetingserielist:"Meeting Series List",sysfiletype_spsitedirectory:"Site Directory Item",sysfiletype_spsitedirectorylist:"Site Directory",sysfiletype_spdatasource:"Data Source",sysfiletype_spdatasourcelist:"Data Source List",sysfiletype_splisttemplatecataloglist:"List Template Catalog List",sysfiletype_spwebpartcataloglist:"WebPart catalog list",sysfiletype_spwebtemplatecataloglist:"Web Template Catalog List",sysfiletype_spworkspacepagelist:"Workspace Page List",sysfiletype_spunknownlist:"Custom List",sysfiletype_spadministratortask:"Administrator Task",sysfiletype_spadministratortasklist:"Administrator Tasks",sysfiletype_spareadocumentlibrarylist:"Area Document Library",sysfiletype_spblogcategory:"Blog Category",sysfiletype_spblogcategorylist:"Blog Category",sysfiletype_spblogcomment:"Blog Comment",sysfiletype_spblogcommentlist:"Blog Comments",sysfiletype_spblogpost:"Blog Post",sysfiletype_spblogpostlist:"Blog Posts",sysfiletype_spdataconnectionlibrarylist:"Data Connection Library",sysfiletype_spdistributiongroup:"Distribution Group",sysfiletype_spdistributiongrouplist:"Distribution Groups",sysfiletype_spipfslist:"InfoPath Form Servers",sysfiletype_spkeyperformanceindicator:"Key Performance Indicator",sysfiletype_spkeyperformanceindicatorlist:"Key Performance Indicators",sysfiletype_splanguagesandtranslator:"Languages and Translator",sysfiletype_splanguagesandtranslatorlist:"Languages and Translators",sysfiletype_spmasterpagescataloglist:"Master Pages Library",sysfiletype_spnocodeworkflowlibrarylist:"No Code Workflow Library",sysfiletype_spprojecttask:"Project Task",sysfiletype_spprojecttasklist:"Project Tasks",sysfiletype_sppublishingpageslibrarylist:"Page Library",sysfiletype_spreportdocumentlibrarylist:"Report Document Library",sysfiletype_spreportlibrarylist:"Report Library",sysfiletype_spslidelibrarylist:"Slide Library",sysfiletype_sptab:"Tabs",sysfiletype_sptablist:"Tabs List",sysfiletype_sptranslationmanagementlibrarylist:"Translation Management Library",sysfiletype_spuserinformation:"User Information",sysfiletype_spuserinformationlist:"User Information List",sysfiletype_spwikipagelibrarylist:"Wiki Page Library",sysfiletype_spworkflowhistory:"Workflow History",sysfiletype_spworkflowhistorylist:"Workflow Histories",sysfiletype_spworkflowprocess:"Custom Workflow Process",sysfiletype_spworkflowprocesslist:"Custom Workflow Processes",sysfiletype_sppublishingimageslibrarylist:"Publishing Image Library",sysfiletype_spcirculation:"Circulation",sysfiletype_spcirculationlist:"Circulations",sysfiletype_spdashboardslibrarylist:"Dashboard Library",sysfiletype_spdataconnectionforperformancepointlibrarylist:"Data Connection for Performance Point Library",sysfiletype_sphealthreport:"Health Report",sysfiletype_sphealthreportlist:"Health Reports",sysfiletype_sphealthrule:"Health Rule",sysfiletype_sphealthrulelist:"Health Rules",sysfiletype_spimedictionary:"IME Dictionary",sysfiletype_spimedictionarylist:"IME Dictionaries",sysfiletype_spperformancepointcontent:"Performance Point Content",sysfiletype_spperformancepointcontentlist:"Performance Point Contents",sysfiletype_spphonecallmemo:"Phone Call Memo",sysfiletype_spphonecallmemolist:"Phone Call Memos",sysfiletype_sprecordlibrarylist:"Record Library",sysfiletype_spresource:"Resource",sysfiletype_spresourcelist:"Resources",sysfiletype_spprocessdiagramslibrarylist:"Process Diagram Library",sysfiletype_spsitethemeslibrarylist:"Site Theme Library",sysfiletype_spsolutionslibrarylist:"Solution Library",sysfiletype_spwfpublibrarylist:"WFPUB Library",sysfiletype_spwhereabout:"Whereabout",sysfiletype_spwhereaboutlist:"Whereabouts",sysfiletype_spdocumentlink:"Link to a Document",sysfiletype_spdocumentset:"Document Set",sysfiletype_spmicrofeedpost:"Microfeed Post",sysfiletype_spmicrofeedlist:"Microfeed",sysfiletype_splistfolder:"List Folder"},t=String.locales||(String.locales={});t.en=e,String.toLocaleString.call(this,{en:e}),String.locale="en",String.defaultLocale="en"}(),function(e){var t;t="undefined"!=typeof e.require&&"undefined"!=typeof e.exports&&"undefined"!=typeof e.module?e.require("globalize"):e.Globalize,t.addCultureInfo("en-US","default",{name:"en-US",englishName:"English (United States)"})}(this);var Coveo;!function(e){var t=/<pl>(((?!<\/pl>).)*)<\/pl>/g,i=/<sn>(((?!<\/sn>).)*)<\/sn>/g;e.L10N={format:function(t){for(var i=[],n=1;n<arguments.length;n++)i[n-1]=arguments[n];var o=t.toLocaleString();if(i.length>0){var s=e._.last(i);e._.isNumber(s)&&(i.pop(),o=e.L10N.formatPlSn(o,s));for(var r in i)o=o.replace("{"+r+"}",i[r])}return o},formatPlSn:function(e,n){return e=n>1?e.replace(t,"$1").replace(i,""):e.replace(t,"").replace(i,"$1")}}}(Coveo||(Coveo={}));var Coveo;!function(e){var t=function(){function e(e){this.owner=e}return e.prototype.trace=function(){for(var t=[],i=0;i<arguments.length;i++)t[i-0]=arguments[i];e.level<=e.TRACE&&this.log("TRACE",t)},e.prototype.debug=function(){for(var t=[],i=0;i<arguments.length;i++)t[i-0]=arguments[i];e.level<=e.DEBUG&&this.log("DEBUG",t)},e.prototype.info=function(){for(var t=[],i=0;i<arguments.length;i++)t[i-0]=arguments[i];e.level<=e.INFO&&this.log("INFO",t)},e.prototype.warn=function(){for(var t=[],i=0;i<arguments.length;i++)t[i-0]=arguments[i];e.level<=e.WARN&&this.log("WARN",t)},e.prototype.error=function(){for(var t=[],i=0;i<arguments.length;i++)t[i-0]=arguments[i];e.level<=e.ERROR&&this.log("ERROR",t)},e.prototype.log=function(t,i){window.console&&console.log&&(console.log([t,this.owner].concat(i)),e.executionTime&&(console.timeEnd("Execution time"),console.time("Execution time")))},e.enable=function(){e.level=e.TRACE},e.disable=function(){e.level=e.NOTHING},e.TRACE=1,e.DEBUG=2,e.INFO=3,e.WARN=4,e.ERROR=5,e.NOTHING=6,e.level=e.INFO,e.executionTime=!1,e}();e.Logger=t}(Coveo||(Coveo={}));var Coveo;!function(e){var t=function(){function t(){}return t.fail=function(e){t.failureHandler(e)},t.check=function(e,i){e||t.fail(i)},t.isUndefined=function(i){t.check(e.Utils.isUndefined(i),"Value should be undefined.")},t.isNotUndefined=function(i){t.check(!e.Utils.isUndefined(i),"Value should not be undefined.")},t.isNull=function(i){t.check(e.Utils.isNull(i),"Value should be null.")},t.isNotNull=function(i){t.check(!e.Utils.isNull(i),"Value should not be null.")},t.exists=function(i){t.check(!e.Utils.isNullOrUndefined(i),"Value should not be null or undefined")},t.doesNotExists=function(i){t.check(e.Utils.isNullOrUndefined(i),"Value should be null or undefined")},t.isString=function(i){t.check(e._.isString(i),"Value should be a string.")},t.stringStartsWith=function(e,i){t.isNonEmptyString(e),t.isNonEmptyString(i),t.check(0==e.indexOf(i),"Value should start with "+i)},t.isNonEmptyString=function(i){t.check(e.Utils.isNonEmptyString(i),"Value should be a non-empty string.")},t.isNumber=function(i){t.check(e._.isNumber(i),"Value should be a number.")},t.isLargerThan=function(e,i){t.check(i>e,"Value "+i+" should be larger than "+e)},t.isLargerOrEqualsThan=function(e,i){t.check(i>=e,"Value "+i+" should be larger or equal than "+e)},t.isSmallerThan=function(e,i){t.check(e>i,"Value "+i+" should be smaller than "+e)},t.isSmallerOrEqualsThan=function(e,i){t.check(e>=i,"Value "+i+" should be smaller or equal than "+e)},t.logger=new e.Logger("Assert"),t.failureHandler=function(n){throw t.logger.error("Assertion Failed!",n),void 0!=console.trace&&console.trace(),e.Utils.isNonEmptyString(n)?new i(n):new i("Assertion Failed!")},t}();e.Assert=t;var i=function(){function e(e){this.message=e}return e.prototype.toString=function(){return this.message},e}();e.PreconditionFailedException=i}(Coveo||(Coveo={}));var Coveo;!function(e){e.$=jQuery}(Coveo||(Coveo={}));var Coveo;!function(e){e._=window._}(Coveo||(Coveo={}));var Coveo;!function(e){var t=function(){function t(){}return t.defer=function(e){t.functions.push(e),t.arm()},t.flush=function(){for(;t.popOne(););},t.arm=function(){e._.defer(function(){t.popOne()&&t.arm()})},t.popOne=function(){if(t.functions.length>0){var i=t.functions[0];return t.functions=e._.rest(t.functions),i(),t.functions.length>0}return!1},t.functions=[],t}();e.Defer=t}(Coveo||(Coveo={}));var Coveo;!function(e){var t=function(){function e(e){this.onEmpty=e,this.cache=[]}return e.prototype.get=function(){return 0==this.cache.length?this.onEmpty():this.cache.pop()},e.prototype.push=function(e){this.cache.push(e)},e}();e.Cache=t}(Coveo||(Coveo={}));var Coveo;!function(e){var t=function(){function t(t,i,n,o){void 0===n&&(n=10),void 0===o&&(o=500),this.element=t,this.handler=i,this.distanceThreshold=n,this.timeThreshold=o,t.hasClass(e.Ui.Component.computeCssClassNameForType(e.Ui.SearchInterface.ID))?t.click(i):(this.setTouchHandlers(),this.preventMouseHandlers())}return t.prototype.setTouchHandlers=function(){var e=this;this.element.on("touchstart",function(t){return e.handleTouchStart(t)}),this.element.on("touchmove",function(t){return e.handleTouchMove(t)})},t.prototype.preventMouseHandlers=function(){this.element.on("mousedown",function(e){return e.preventDefault()}),this.element.on("mouseup",function(e){return e.preventDefault()}),this.element.on("click",function(e){return e.preventDefault()})},t.prototype.handleTouchStart=function(e){var t=this;this.reset(),this.initStartVariables(e),this.startTarget=e.target,this.startElement=this.getStartElement(),this.element.one("touchend",function(e){return t.handleTouchEnd(e)})},t.prototype.handleTouchMove=function(e){this.endX=e.originalEvent?e.originalEvent.touches[0].clientX:0,this.endY=e.originalEvent?e.originalEvent.touches[0].clientY:0,this.moved=!0},t.prototype.handleTouchEnd=function(t){this.preventGhostClickIfAndroid(t),this.mustCallHandler(t)&&(this.hideIOSKeyboardIfNecessary(t.target),this.isGhostClick(t)||e.MobileUtils.showClickFeedback(this.element,400),e.MobileUtils.showClickCancelingOverlay(400),t.clientX=this.startX,t.clientY=this.startY,this.handler.call(this,t))},t.prototype.isGhostClick=function(e){return e.originalEvent?!1:!0},t.prototype.initStartVariables=function(e){this.startTime=(new Date).getTime(),this.startX=e.originalEvent?e.originalEvent.touches[0].clientX:0,this.startY=e.originalEvent?e.originalEvent.touches[0].clientY:0,this.endX=this.startX,this.endY=this.startY},t.prototype.getStartElement=function(){return document.elementFromPoint(this.startX,this.startY)},t.prototype.mustCallHandler=function(e){return!this.scrolled(e)&&!this.held()},t.prototype.scrolled=function(e){var t=e.target,i=Math.abs(this.endX-this.startX),n=Math.abs(this.endY-this.startY),o=document.elementFromPoint(this.endX,this.endY);return!(this.startElement==o&&this.startTarget==t&&(!this.moved||i<this.distanceThreshold&&n<this.distanceThreshold))},t.prototype.held=function(){this.endTime=(new Date).getTime();var e=this.endTime-this.startTime;return e>=this.timeThreshold},t.prototype.reset=function(){this.startX=0,this.startY=0,this.endX=0,this.endY=0,this.startTime=0,this.endTime=0,this.moved=!1},t.prototype.hideIOSKeyboardIfNecessary=function(t){e.DeviceUtils.isIos()&&!e.$(t).is("input[type=text]")&&e.$(document.activeElement).is("input[type=text]")&&e.MobileUtils.hideIOSKeyboard(document.activeElement)},t.prototype.preventGhostClickIfAndroid=function(t){e.DeviceUtils.isAndroid()&&t.preventDefault()},t}();e.FastClick=t,e.$.fn.fastClick=function(i){if(i){if(e.DeviceUtils.isMobileDevice()){var n=e.$(this);return new t(n,i),n}return this.filter("a").data("href",this.filter("a").attr("href")).attr("href","javascript:"),this.click(i)}return e.DeviceUtils.isMobileDevice()?(this.trigger("touchstart"),this.trigger("touchend")):this.click()}}(Coveo||(Coveo={}));var Coveo;!function(e){var t;!function(t){function i(e){return"undefined"==typeof e}function n(e){return null===e}function o(e){return t.isUndefined(e)||t.isNull(e)}function s(e){return!t.isNullOrUndefined(e)}function r(t){return e._.isString(t)?t:""}function a(e){return e?e.toString():""}function l(e){return t.isNullOrUndefined(e)||!t.isNonEmptyString(e)}function u(t){return e._.isString(t)&&""!==t}function c(e,t){return e.slice(0,t.length)==t}function p(t){return e._.isArray(t)&&t.length>0}function d(e){return!t.isNonEmptyArray(e)}function h(e){return void 0!=window.HTMLElement?e instanceof HTMLElement:e&&e.nodeType&&1==e.nodeType}function f(e){return t.isNonEmptyString(e)?parseInt(e,10):void 0}function m(e){return t.isNonEmptyString(e)?parseFloat(e):void 0}function v(e,t){return Math.round(e*Math.pow(10,t))/Math.pow(10,t)}function g(e){if(!t.isNonEmptyString(e))return void 0;switch(e.toLowerCase()){case"true":case"1":case"yes":return!0;case"false":case"0":case"no":return!1;default:return void 0}}function y(e){return null==e?null:e.replace(/^\s+|\s+$/g,"")}function C(t,i,n){if(void 0===n&&(n=!0),n)return e._.isEqual(t,i);var o=[t,i];return e._.all(o,function(t){return t.length==o[0].length&&0==e._.difference(t,o[0]).length})}function b(t,i){return e._.isEqual(t,i)}function S(e){return/^@[a-zA-Z0-9]+$/.test(e)}function x(t){var i=t.match(/^@([a-zA-Z0-9]+)$/);return e.Assert.check(null!=i,t+" is not a vaild field"),i[1].toLowerCase()}function E(e){var t=e.replace(/[-[\]{}()*+?.,\\^$|#\s]/g,"\\$&");return t}function A(e,t,i,n,o){void 0===i&&(i={});var s,r=null,a=0,l=function(){a=i.leading===!1?0:(new Date).getTime(),r=null,s=e.apply(n,o)};return function(){var u=(new Date).getTime();a||i.leading!==!1||(a=u);var c=t-(u-a);return n=this,o=arguments,0>=c?(clearTimeout(r),r=null,a=u,s=e.apply(n,o)):r||i.trailing===!1||(r=setTimeout(l,c)),s}}function O(t,i){var n=this,o=e._.isArray(i),s=o&&[]||{};return o?(t=t||[],s=s.concat(t),e._.each(i,function(e,i){"undefined"==typeof t[i]?s[i]=e:"object"==typeof e?s[i]=n.extendDeep(t[i],e):-1===t.indexOf(e)&&s.push(e)})):(t&&"object"==typeof t&&e._.each(e._.keys(t),function(e){s[e]=t[e]}),e._.each(e._.keys(i),function(e){s[e]="object"==typeof i[e]&&i[e]?t[e]?n.extendDeep(t[e],i[e]):i[e]:i[e]})),s}function T(e,t){return void 0===t&&(t=window.location.search),t.replace(new RegExp("^(?:.*[&\\?]"+e.replace(/[\.\+\*]/g,"\\$&")+"(?:\\=([^&]*))?)?.*$","i"),"$1")}t.isUndefined=i,t.isNull=n,t.isNullOrUndefined=o,t.exists=s,t.toNotNullString=r,t.anyTypeToString=a,t.isNullOrEmptyString=l,t.isNonEmptyString=u,t.stringStartsWith=c,t.isNonEmptyArray=p,t.isEmptyArray=d,t.isHtmlElement=h,t.parseIntIfNotUndefined=f,t.parseFloatIfNotUndefined=m,t.round=v,t.parseBooleanIfNotUndefined=g,t.trim=y,t.arrayEqual=C,t.objectEqual=b,t.isCoveoField=S,t.getCoveoFieldKey=x,t.escapeRegexCharacter=E,t.throttle=A,t.extendDeep=O,t.getQueryStringValue=T}(t=e.Utils||(e.Utils={}))}(Coveo||(Coveo={}));var Coveo;!function(e){var t=function(){function t(e){this.milliseconds=e}return t.prototype.getMilliseconds=function(){return this.milliseconds},t.prototype.getSeconds=function(){return this.getMilliseconds()/1e3},t.prototype.getMinutes=function(){return this.getSeconds()/60},t.prototype.getHours=function(){return this.getMinutes()/60},t.prototype.getDays=function(){return this.getHours()/24},t.prototype.getWeeks=function(){return this.getDays()/7},t.fromDates=function(i,n){return e.Assert.exists(i),e.Assert.exists(n),new t(n.valueOf()-i.valueOf())},t}();e.TimeSpan=t}(Coveo||(Coveo={}));var Coveo;!function(e){var t;!function(e){function t(){var e=navigator.userAgent;return e.match(/Android/i)?"Android":e.match(/BlackBerry/i)?"BlackBerry":e.match(/iPhone/i)?"iPhone":e.match(/iPad/i)?"iPad":e.match(/iPod/i)?"iPod":e.match(/Opera Mini/i)?"Opera Mini":e.match(/IEMobile/i)?"IE Mobile":e.match(/Chrome/i)?"Chrome":e.match(/MSIE/i)||e.match(/Trident/i)?"IE":e.match(/Opera/i)?"Opera":e.match(/Firefox/i)?"Firefox":e.match(/Safari/i)?"Safari":"Others"}function i(){return"Android"==t()}function n(){var e=t();return"iPhone"==e||"iPad"==e||"iPod"==e}function o(){var e=navigator.userAgent.toLowerCase();return-1==e.indexOf("msie")?!1:parseInt(e.split("msie")[1])<10}function s(){return u}function r(){return c}function a(){return screen.width<=480}function l(){return screen.height<=640}var u=/Android|webOS|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini/i.test(navigator.userAgent),c=/^file:\/\/\/.*_asset/i.test(document.URL)||/^file:\/\/\/.*var\/mobile/i.test(document.URL)||/^file:\/\/\/.*\/CoreSimulator/.test(document.URL);e.getDeviceName=t,e.isAndroid=i,e.isIos=n,e.isIE8or9=o,e.isMobileDevice=s,e.isPhonegap=r,e.isSmallScreenWidth=a,e.isSmallScreenHeight=l}(t=e.DeviceUtils||(e.DeviceUtils={}))}(Coveo||(Coveo={}));var Coveo;!function(e){var t=function(){function t(){}return t.createGuid=function(){return"undefined"!=typeof crypto&&"undefined"!=typeof crypto.getRandomValues?t.generateWithCrypto():t.generateWithRandom()},t.generateWithRandom=function(){return"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,function(e){var t=16*Math.random()|0,i="x"==e?t:3&t|8;return i.toString(16)})},t.generateWithCrypto=function(){var e=new Uint16Array(8);crypto.getRandomValues(e);var t=function(e){for(var t=e.toString(16);t.length<4;)t="0"+t;return t};return t(e[0])+t(e[1])+"-"+t(e[2])+"-"+t(e[3])+"-"+t(e[4])+"-"+t(e[5])+t(e[6])+t(e[7])},t.setStateObjectOnQueryResults=function(e,i){t.setPropertyOnResult(i,"state",e)},t.setIndexAndUidOnQueryResults=function(i,n,o){e.Assert.exists(i),e.Assert.exists(n);var s=i.firstResult;t.setPropertyOnResult(n,"queryUid",o),t.setPropertyOnResult(n,"index",s,function(){return++s})},t.setTermsToHighlightOnQueryResults=function(e,i){t.setPropertyOnResult(i,"termsToHighlight",i.termsToHighlight),t.setPropertyOnResult(i,"phrasesToHighlight",i.phrasesToHighlight)},t.splitFlags=function(t,i){return void 0===i&&(i=";"),e.Assert.exists(t),t.split(i)},t.isAttachment=function(i){return e._.contains(t.splitFlags(i.flags),"IsAttachment")},t.containsAttachment=function(i){return e._.contains(t.splitFlags(i.flags),"ContainsAttachment")},t.hasHTMLVersion=function(i){return e._.contains(t.splitFlags(i.flags),"HasHtmlVersion")},t.hasThumbnail=function(i){return e._.contains(t.splitFlags(i.flags),"HasThumbnail")},t.quoteAndEscapeIfNeeded=function(i){return e.Assert.isString(i),t.isAtomicString(i)||t.isRangeString(i)||t.isRangeWithoutOuterBoundsString(i)?i:t.quoteAndEscape(i)},t.quoteAndEscape=function(i){return e.Assert.isString(i),'"'+t.escapeString(i)+'"'},t.escapeString=function(t){return e.Assert.isString(t),t.replace(/"/g," ")},t.isAtomicString=function(t){return e.Assert.isString(t),/^\d+(\.\d+)?$|^[\d\w]+$/.test(t)},t.isRangeString=function(t){return e.Assert.isString(t),/^\d+(\.\d+)?\.\.\d+(\.\d+)?$|^\d{4}\/\d{2}\/\d{2}@\d{2}:\d{2}:\d{2}\.\.\d{4}\/\d{2}\/\d{2}@\d{2}:\d{2}:\d{2}$/.test(t)},t.isRangeWithoutOuterBoundsString=function(t){return e.Assert.isString(t),/^\d+(\.\d+)?$|^\d{4}\/\d{2}\/\d{2}@\d{2}:\d{2}:\d{2}$/.test(t)},t.buildFieldExpression=function(i,n,o){return e.Assert.isNonEmptyString(i),e.Assert.stringStartsWith(i,"@"),e.Assert.isNonEmptyString(n),e.Assert.isLargerOrEqualsThan(1,o.length),1==o.length?i+n+t.quoteAndEscapeIfNeeded(o[0]):i+n+"("+e._.map(o,function(e){return t.quoteAndEscapeIfNeeded(e)}).join(",")+")"},t.buildFieldNotEqualExpression=function(i,n){e.Assert.isNonEmptyString(i),e.Assert.stringStartsWith(i,"@"),e.Assert.isLargerOrEqualsThan(1,n.length);var o;return o=1==n.length?i+"=="+t.quoteAndEscapeIfNeeded(n[0]):i+"==("+e._.map(n,function(e){return t.quoteAndEscapeIfNeeded(e)}).join(",")+")","(NOT "+o+")"},t.mergeQueryString=function(e,t){var i=e.indexOf("?");return e+=-1!=i?"&"+t:"?"+t},t.mergePath=function(e,t){var i=e.split("?");return i[0]+t+"?"+(i[1]||"")},t.setPropertyOnResult=function(t,i,n,o){e._.each(t.results,function(t){t[i]=n,e._.each(t.childResults,function(e){e[i]=n}),e.Utils.isNullOrUndefined(t.parentResult)||(t.parentResult[i]=n),n=o?o():n})},t}();e.QueryUtils=t}(Coveo||(Coveo={}));var Coveo;!function(e){var t=function(){function t(){}return t.javascriptEncode=function(t){return e.Assert.isString(t),t=t.replace(/\\/g,"\\\\"),t=t.replace(/'/g,"\\'"),t=t.replace(/"/g,'\\"')},t.htmlEncode=function(t){return e.Assert.isString(t),e.$("<div/>").text(t).html()},t.splice=function(e,t,i,n){return e.slice(0,t)+n+e.slice(t+Math.abs(i))},t.removeMiddle=function(e,i,n){if(e.length<i)return e;var o=e.length-i,s=Math.floor(i/2);return t.splice(e,s,o,n)},t.regexEncode=function(t){return e.Assert.isString(t),t.replace(/[\-\[\]\/\{\}\(\)\*\+\?\.\\\^\$\|]/g,"\\$&")},t.wildcardsToRegex=function(i){e.Assert.isString(i);var n=t.regexEncode(i);return n=n.replace(/\\\*/,".*"),n=n.replace(/\\\?/,".")},t.getHighlights=function(t,i,n){for(var o,s=[];o=i.exec(t);){var r=o[2],a=o[1],l=o.index+1;if(0==o.index&&""==a&&(l=0),s.push({offset:l,length:r.length,dataHighlightGroupTerm:n}),!i.global)break}return e._.isEmpty(s)?void 0:s},t}();e.StringUtils=t}(Coveo||(Coveo={}));var Coveo;!function(e){var t;!function(t){function i(e,t,a,c,p,d){void 0===d&&(d=0),e.appendTo(a),p.verticalOffset=p.verticalOffset?p.verticalOffset:0,p.horizontalOffset=p.horizontalOffset?p.horizontalOffset:0;var h=t.offset();o(h,e,t,p),s(h,e,t,p),n(e.offset(),h,e,p);var f=l(e),m=l(c);if(2>d){var v=u(f,m);if("ok"!=v.vertical||"ok"!=v.horizontal){var g=r(p,v);i(e,t,a,c,g,d+1)}}}function n(e,t,i,n){var o=i.position();i.css({position:"absolute",top:o.top+n.verticalOffset-(e.top-t.top)+"px",left:o.left+n.horizontalOffset-(e.left-t.left)+"px"})}function o(e,t,i,n){switch(n.vertical){case 0:e.top-=t.outerHeight();break;case 2:e.top+=i.outerHeight();break;case 1:e.top-=t.outerHeight()/3;case 3:break;case 4:e.top-=t.outerHeight()-i.outerHeight()}}function s(e,t,i,n){switch(n.horizontal){case 0:e.left-=t.outerWidth();break;case 2:e.left+=i.outerWidth();break;case 1:e.left+=a(t,i);break;case 3:break;case 4:e.left-=t.outerWidth()-i.outerWidth()}}function r(e,t){var i=e;return"left"==t.horizontal&&(i.horizontal=2),"right"==t.horizontal&&(i.horizontal=0),"top"==t.vertical&&(i.vertical=2),"bottom"==t.vertical&&(i.vertical=0),i}function a(e,t){return(t.outerWidth()-e.outerWidth())/2
}function l(e){var t=e.offset();return{top:t.top,left:t.left,right:t.left+e.outerWidth(),bottom:t.top+e.outerHeight()}}function u(e,t){var i={vertical:"ok",horizontal:"ok"};return e.top<t.top&&(i.vertical="top"),e.bottom>t.bottom&&(i.vertical="bottom"),e.left<t.left&&(i.horizontal="left"),e.right>t.right&&(i.horizontal="right"),i}function c(e,t){return"<span class='coveo-close-button'><span class='coveo-icon coveo-sprites-quickView-close'></span>"+e+"</span><span class='coveo-pop-up-reminder' >"+t+"</span>"}function p(){var t="coveo-loading-dot";return e.$("<div class='coveo-first-loading-animation' ><div class='coveo-logo' ></div><div class='coveo-loading-container'><div class='"+t+"' ></div><div class='"+t+"' ></div><div class='"+t+"' ></div><div class='"+t+"' ></div></div></div>")}function d(){var t="coveo-loading-dot";return e.$("<div class='coveo-generic-loading-animation coveo-loading-animation'><div class='coveo-loading-container'><div class='"+t+"' ></div><div class='"+t+"' ></div><div class='"+t+"' ></div><div class='"+t+"' ></div></div></div>")}function h(t,i){var n=new RegExp(e.Utils.escapeRegexCharacter(i),"i"),o=t.search(n),s=o+i.length;return e.StringUtils.htmlEncode(t.slice(0,o))+"<span class='coveo-highlight'>"+e.StringUtils.htmlEncode(t.slice(o,s))+"</span>"+e.StringUtils.htmlEncode(t.slice(s))}function f(t){for(var i=e.$(t);!i.is(document)&&0!=i.length;){if(m(i))return i.is("body")?e.$(window).get(0):i.get(0);i=i.parent()}return e.$(window).get(0)}function m(e){return"scroll"==e.css("overflow-y")}function v(t){var i=e.$("<div>").html(t);return 1==i.children().length?i.children().get(0):i.get(0)}!function(e){e[e.top=0]="top",e[e.middle=1]="middle",e[e.bottom=2]="bottom",e[e.innerTop=3]="innerTop",e[e.innerBottom=4]="innerBottom"}(t.VerticalAlignment||(t.VerticalAlignment={}));t.VerticalAlignment;!function(e){e[e.left=0]="left",e[e.center=1]="center",e[e.right=2]="right",e[e.innerLeft=3]="innerLeft",e[e.innerRight=4]="innerRight"}(t.HorizontalAlignment||(t.HorizontalAlignment={}));t.HorizontalAlignment;t.positionPopup=i,t.getPopUpCloseButton=c,t.getBasicLoadingAnimation=p,t.getBasicLoadingDots=d,t.highlightElement=h,t.findScrollingParent=f,t.htmlToDom=v,e.$.fn.fastToggle=function(e){return this.css("display",e?"":"none")}}(t=e.JQueryUtils||(e.JQueryUtils={}))}(Coveo||(Coveo={}));var Coveo;!function(e){var t=function(){function t(){}return t.getHash=function(i){void 0===i&&(i=window),e.Assert.exists(i);var n="#"+(i.location.href.split("#")[1]||"");return t.getAjaxcrawlableHash(n)},t.getValue=function(i,n){e.Assert.isNonEmptyString(i),e.Assert.exists(n),n=t.getAjaxcrawlableHash(n);var o=t.getRawValue(i,n);return void 0!=o&&(o=t.getValueDependingOnType(o)),o},t.encodeValues=function(i){var n=[];return e._.each(i,function(i,o){var s="";s=e.Utils.isNonEmptyArray(i)?t.encodeArray(i):e._.isObject(i)&&e.Utils.isNonEmptyArray(e._.keys(i))?t.encodeObject(i):encodeURIComponent(i.toString()),""!=s&&n.push(o+"="+s)}),n.join("&")},t.getAjaxcrawlableHash=function(e){return void 0!=e[1]&&"!"==e[1]?e.substring(0,1)+e.substring(2):e},t.getRawValue=function(t,i){e.Assert.exists(t),e.Assert.exists(i),e.Assert.check(0==i.indexOf("#")||""==i);for(var n=i.substr(1).split("&"),o=0,s=!0,r=void 0;s;){var a=n[o].split("=");a[0]==t?(s=!1,r=a[1]):(o++,o>=n.length&&(o=void 0,s=!1))}return r},t.getValueDependingOnType=function(e){var i,n=t.getValueType(e);return i="object"==n?t.decodeObject(e):"array"==n?t.decodeArray(e):decodeURIComponent(e)},t.getValueType=function(e){return e.substr(0,1)==t.Delimiter.objectStart&&e.substr(e.length-1)==t.Delimiter.objectEnd?"object":e.substr(0,1)==t.Delimiter.arrayStart&&e.substr(e.length-1)==t.Delimiter.arrayEnd?"array":"other"},t.encodeArray=function(i){var n=[];return e._.each(i,function(e){n.push(encodeURIComponent(e))}),t.Delimiter.arrayStart+n.join(",")+t.Delimiter.arrayEnd},t.encodeObject=function(i){var n=t.Delimiter.objectStart,o=[];return e._.each(i,function(i,n){var s="";s+='"'+encodeURIComponent(n)+'" : ',s+=e._.isArray(i)?t.encodeArray(i):e._.isObject(i)?t.encodeObject(i):e._.isNumber(i)||e._.isBoolean(i)?encodeURIComponent(i):'"'+encodeURIComponent(i)+'"',o.push(s)}),n+=o.join(" , "),n+t.Delimiter.objectEnd},t.decodeObject=function(e){return JSON.parse(decodeURIComponent(e))},t.decodeArray=function(t){t=t.substr(1),t=t.substr(0,t.length-1);for(var i=t.split(","),n=0;n<i.length;n++){var o=decodeURIComponent(i[n]),s="0"==o[0]&&o.length>1?0/0:Number(o),r=e.Utils.parseBooleanIfNotUndefined(o);i[n]=o,isNaN(s)?void 0!=r&&(i[n]=r):i[n]=s}return i},t.Delimiter={objectStart:"{",objectEnd:"}",arrayStart:"[",arrayEnd:"]",objectStartRegExp:"^{",objectEndRegExp:"}+$",arrayStartRegExp:"^[",arrayEndRegExp:"]+$"},t}();e.HashUtils=t}(Coveo||(Coveo={}));var Coveo;!function(e){var t;!function(t){function i(e){c.addClass("active"),setTimeout(function(){c.removeClass("active")},e)}function n(e,t){e.addClass("coveo-clicked"),setTimeout(function(){e.removeClass("coveo-clicked")},t)}function o(i,n){void 0===n&&(n=!1);var o="."+e.Ui.Component.computeCssClassNameForType(e.Ui.SearchInterface.ID);e.$(o+",.coveo-glass").addClass("coveo-"+i),e.$(".coveo-glass").addClass("coveo-active-glass"),n&&"Android"==e.DeviceUtils.getDeviceName()&&e.$(document).on("backbutton",e.$.proxy(t.removeToggleClassOnSearchInterface,this,!0))}function s(t){void 0===t&&(t=!1);var i="."+e.Ui.Component.computeCssClassNameForType(e.Ui.SearchInterface.ID);e.$(i+",.coveo-glass").removeClass("coveo-slide-right").removeClass("coveo-slide-left").removeClass("coveo-active-glass"),e.$(".coveo-tab-section").removeClass("coveo-opened-by-current-tab");var n=e.Ui.CurrentTab?e.Ui.CurrentTab.ID:void 0;n&&e.$("."+n).removeClass("coveo-opening-tab-section"),t&&"Android"==e.DeviceUtils.getDeviceName()&&e.$(document).off("backbutton")}function r(){e.$("."+e.Ui.Component.computeCssClassNameForType(e.Ui.SearchInterface.ID)).append(c)}function a(t){e.$(window).focus(),e.$(t).blur()}function l(){e.DeviceUtils.isIos()&&e.$(window).on("touchstart",function(i){!e.$(i.target).is("input")&&e.$(document.activeElement).is("input")&&t.hideIOSKeyboard(document.activeElement)})}function u(){e.DeviceUtils.isMobileDevice()&&(e.$(function(){return r()}),l())}var c=e.$(document.createElement("div")).addClass("coveo-click-canceling-overlay");t.showClickCancelingOverlay=i,t.showClickFeedback=n,t.addToggleClassOnSearchInterface=o,t.removeToggleClassOnSearchInterface=s,t.hideIOSKeyboard=a,u()}(t=e.MobileUtils||(e.MobileUtils={}))}(Coveo||(Coveo={}));var Coveo;!function(e){var t;!function(t){var i=function(){function t(t,i){this.message=t,this.status=i,e.Assert.exists(t),e.Assert.exists(i),this.type="Ajax Error (status: "+i+")"}return t}();t.AjaxError=i}(t=e.Rest||(e.Rest={}))}(Coveo||(Coveo={}));var Coveo;!function(e){var t;!function(e){var t=function(){function e(e){this.provider=e,this.isMissingAuthentication=!0,this.type=this.message="Missing Authentication (provider: "+e+")"}return e}();e.MissingAuthenticationError=t}(t=e.Rest||(e.Rest={}))}(Coveo||(Coveo={}));var Coveo;!function(e){var t;!function(t){var i=function(){function t(t){this.status=t.statusCode,this.message=t.data.message,this.type=t.data.type,this.queryExecutionReport=t.data.executionReport,e.Assert.isNumber(this.status),e.Assert.isNonEmptyString(this.message),e.Assert.isNonEmptyString(this.type)}return t}();t.QueryError=i}(t=e.Rest||(e.Rest={}))}(Coveo||(Coveo={}));var Coveo;!function(e){var t;!function(t){var i;!function(e){e[e.OPENED=XMLHttpRequest.OPENED||1]="OPENED",e[e.DONE=XMLHttpRequest.DONE||4]="DONE"}(i||(i={}));var n=function(){function t(t){void 0===t&&(t={}),this.options=t,this.useJsonp=!1,this.logger=new e.Logger(this)}return t.prototype.call=function(i){e.Assert.isNonEmptyString(i.url);var n={url:i.url,queryString:i.errorsAsSuccess?i.queryString.concat(["errorsAsSuccess=1"]):i.queryString,requestData:i.requestData,deferred:e.$.Deferred(),begun:new Date,method:i.method};this.logger.trace("Performing REST request",n);var o=t.parseURL(n.url),s=window.location.hostname===o.hostname||""===o.hostname,r=""!=window.location.port?window.location.port:"https:"==window.location.protocol?"443":"80",a=r==o.port,l=!(s&&a);return this.useJsonp?this.callUsingAjaxJsonP(n):this.isCORSSupported()||!l?this.callUsingXMLHttpRequest(n,i.responseType):this.isXDomainRequestSupported()?this.callUsingXDomainRequest(n):this.callUsingAjaxJsonP(n),n.deferred},t.parseURL=function(e){var t=document.createElement("a");return t.href=e,t},t.convertJsonToQueryString=function(t){e.Assert.exists(t);var i=[];return e._.each(t,function(t,n){null!=t&&(e._.isObject(t)?i.push(n+"="+encodeURIComponent(JSON.stringify(t))):i.push(n+"="+encodeURIComponent(t.toString())))}),i},t.convertJsonToFormBody=function(e){return t.convertJsonToQueryString(e).join("&")},t.prototype.callUsingXMLHttpRequest=function(n,o){var s=this;void 0===o&&(o="text");var r=new XMLHttpRequest,a=!1;r.onreadystatechange=function(){if(r.readyState!=i.OPENED||a){if(r.readyState==i.DONE){var l,u=r.status;"text"==o?l=s.tryParseResponseText(r.responseText,r.getResponseHeader("Content-Type")):(l=r.response,void 0==l&&(l=s.tryParseResponseText(r.responseText,r.getResponseHeader("Content-Type")))),s.isSuccessHttpStatus(u)?s.handleSuccessfulResponseThatMightBeAnError(n,l):s.handleError(n,r.status,void 0)}}else a=!0,s.options.anonymous===!1&&(r.withCredentials=!0),s.options.accessToken?r.setRequestHeader("Authorization","Bearer "+s.options.accessToken):s.options.username&&s.options.password&&r.setRequestHeader("Authorization","Basic "+btoa(s.options.username+":"+s.options.password)),e.DeviceUtils.isPhonegap()&&r.setRequestHeader("Basic-Auth-Challenge-Client","Phonegap"),"GET"==n.method?r.send():(r.setRequestHeader("Content-Type",'application/x-www-form-urlencoded; charset="UTF-8"'),r.send(t.convertJsonToFormBody(n.requestData))),r.responseType=o};var l=n.queryString;"GET"==n.method&&(l=l.concat(t.convertJsonToQueryString(n.requestData))),r.open(n.method,this.combineUrlAndQueryString(n.url,l))},t.prototype.callUsingXDomainRequest=function(i){var n=this,o=i.queryString.concat([]);this.options.accessToken&&o.push("access_token="+encodeURIComponent(this.options.accessToken));var s=new XDomainRequest;"GET"==i.method&&(o=o.concat(t.convertJsonToQueryString(i.requestData))),s.open(i.method,this.combineUrlAndQueryString(i.url,o)),s.onload=function(){var e=n.tryParseResponseText(s.responseText,s.contentType);n.handleSuccessfulResponseThatMightBeAnError(i,e)},s.onerror=function(){var e=n.tryParseResponseText(s.responseText,s.contentType);n.handleError(i,0,e)},s.ontimeout=function(){return n.logger.error("Request timeout",s,i.requestData)},s.onprogress=function(){return n.logger.trace("Request progress",s,i.requestData)},e._.defer(function(){"GET"==i.method?s.send():s.send(t.convertJsonToFormBody(i.requestData))})},t.prototype.callUsingAjaxJsonP=function(i){var n=this,o=i.queryString.concat(t.convertJsonToQueryString(i.requestData));this.options.accessToken&&o.push("access_token="+encodeURIComponent(this.options.accessToken)),o.push("callback=?"),e.$.jsonp({url:this.combineUrlAndQueryString(i.url,o),success:function(e){return n.handleSuccessfulResponseThatMightBeAnError(i,e)},error:function(){return n.handleError(i,0,void 0)}})},t.prototype.handleSuccessfulResponseThatMightBeAnError=function(e,t){this.isErrorResponseBody(t)?this.handleError(e,t.statusCode,t):this.handleSuccess(e,t)},t.prototype.handleSuccess=function(t,i){var n={duration:e.TimeSpan.fromDates(t.begun,new Date).getMilliseconds(),data:i};this.logger.trace("REST request successful",i,t),t.deferred.resolve(n)},t.prototype.handleError=function(e,t,i){var n={statusCode:t,data:i};this.logger.error("REST request failed",t,i,e),e.deferred.reject(n)},t.prototype.combineUrlAndQueryString=function(e,t){return e+(t.length>0?"?"+t.join("&"):"")},t.prototype.isXDomainRequestSupported=function(){return"XDomainRequest"in window},t.prototype.isCORSSupported=function(){return"withCredentials"in new XMLHttpRequest},t.prototype.isSuccessHttpStatus=function(e){return e>=200&&300>e||304===e},t.prototype.tryParseResponseText=function(t,i){if(null==i||-1==i.indexOf("application/json"))return t;if(!e.Utils.isNonEmptyString(t))return void 0;try{return JSON.parse(t)}catch(n){return void 0}},t.prototype.isErrorResponseBody=function(e){return e&&e.statusCode?!this.isSuccessHttpStatus(e.statusCode):!1},t}();t.EndpointCaller=n}(t=e.Rest||(e.Rest={}))}(Coveo||(Coveo={}));var Coveo;!function(e){var t;!function(t){var i=function(){function e(){this.queryStringArguments={},this.anonymous=!1,this.isOldRestAPI=!1}return e}();t.DefaultSearchEndpointOptions=i;var n=function(){function n(t){this.options=t,this._batchListFieldValues=[],e.Assert.exists(t);var n=new i;n.anonymous=e.Utils.isNonEmptyString(t.accessToken),this.options=e.$.extend({},n,t),e.$(window).on("beforeunload",e.$.proxy(this.handleUnload,this)),this.logger=new e.Logger(this),this.createEndpointCaller()}return n.configureSampleEndpoint=function(){n.endpoints["default"]=new n({restUri:"https://cloudplatform.coveo.com/rest/search",accessToken:"52d806a2-0f64-4390-a3f2-e0f41a4a73ec"})},n.configureCloudEndpoint=function(e,t,i,o){void 0===i&&(i="https://cloudplatform.coveo.com/rest/search");var s=n.mergeConfigOptions({restUri:i,accessToken:t,queryStringArguments:{workgroup:e}},o);n.endpoints["default"]=new n(n.removeUndefinedConfigOption(s))},n.configureOnPremiseEndpoint=function(e,t,i){var o=n.mergeConfigOptions({restUri:e,accessToken:t},i);n.endpoints["default"]=new n(n.removeUndefinedConfigOption(o))},n.removeUndefinedConfigOption=function(t){return e._.each(e._.keys(t),function(e){void 0==t[e]&&delete t[e]}),t},n.mergeConfigOptions=function(t,i){return t=n.removeUndefinedConfigOption(t),i=n.removeUndefinedConfigOption(i),e.$.extend({},t,i)},n.prototype.handleUnload=function(){this.isRedirecting=!0},n.prototype.getBaseUri=function(){return this.options.restUri},n.prototype.getAuthenticationProviderUri=function(t,i,n){var o=this.buildBaseUri("/login/"+t)+"?";return e.Utils.isNonEmptyString(i)?o+="redirectUri="+encodeURIComponent(i):e.Utils.isNonEmptyString(n)&&(o+="message="+encodeURIComponent(n)),o},n.prototype.isJsonp=function(){return this.caller.useJsonp},n.prototype.search=function(t,i){var n=this;e.Assert.exists(t),this.logger.info("Performing REST query",t),i=e._.extend({},i);var o={url:this.buildBaseUri("/"),queryString:this.buildBaseQueryString(i),requestData:t,errorsAsSuccess:!0,responseType:"text",method:"POST"},s=this.callWithErrorHandling(o);return s.done(function(i){n.logger.info("REST query successful",i,t),e.Utils.isNullOrEmptyString(i.searchUid)&&(i.searchUid=e.QueryUtils.createGuid())}),s},n.prototype.getRawDataStream=function(t,i,n){var o=this;e.Assert.exists(t),n=e._.extend({},n);var s={url:this.buildBaseUri("/datastream"),queryString:this.buildViewAsHtmlQueryString(t,n).concat(["dataStream="+i]),requestData:{},errorsAsSuccess:!1,method:"GET",responseType:"arraybuffer"},r=this.callWithErrorHandling(s);return this.logger.info("Performing REST query for datastream "+i+" on document uniqueID"+t),r.done(function(e){return o.logger.info("REST query successful",e,t)}),r},n.prototype.getDocumentText=function(t,i){i=e._.extend({},i);var n={url:this.buildBaseUri("/text"),queryString:this.buildViewAsHtmlQueryString(t,i),method:"GET",requestData:{},responseType:"text",errorsAsSuccess:!0};return this.callWithErrorHandling(n)},n.prototype.getDocumentHtml=function(t,i){i=e._.extend({},i);var n={url:this.buildBaseUri("/html"),queryString:this.buildViewAsHtmlQueryString(t,i),method:"GET",requestData:{},responseType:"document",errorsAsSuccess:!0};return this.callWithErrorHandling(n)},n.prototype.getViewAsHtmlUri=function(t,i){return i=e._.extend({},i),this.buildViewAsHtmlUri("/html",t,i)},n.prototype.getViewAsDatastreamUri=function(t,i,n){return n=e._.extend({},n),this.buildViewAsHtmlUri("/datastream",t,n)+"&dataStream="+encodeURIComponent(i)},n.prototype.batchFieldValues=function(t,i){var n=this;e.Assert.exists(t),i=e._.extend({},i),this.logger.info("Listing field values",t);var o=e.$.Deferred(),s={url:this.buildBaseUri("/values"),queryString:this.buildBaseQueryString(i),method:"POST",requestData:t,errorsAsSuccess:!0,responseType:"text"};return this.callWithErrorHandling(s).done(function(e){return o.resolve(e.values)}).fail(function(e,t){return o.reject(null,t)}),o.done(function(e){return n.logger.info("REST list field values successful",e,t)}),o},n.prototype.listFieldValues=function(t,i){var n=this;e.Assert.exists(t),i=e._.extend({},i),this.logger.info("Listing field values",t);var o=e.$.Deferred(),s={url:this.buildBaseUri("/values"),queryString:this.buildBaseQueryString(i),method:"POST",requestData:t,errorsAsSuccess:!0,responseType:"text"};return this.callWithErrorHandling(s).done(function(e){return o.resolve(e.values)}).fail(function(e,t){return o.reject(null,t)}),o.done(function(e){return n.logger.info("REST list field values successful",e,t)}),o},n.prototype.listFields=function(t){t=e._.extend({},t),this.logger.info("Listing fields");var i=e.$.Deferred(),n={url:this.buildBaseUri("/fields"),queryString:this.buildBaseQueryString(t),requestData:{},method:"GET",responseType:"text",errorsAsSuccess:!0};return this.callWithErrorHandling(n).done(function(e){return i.resolve(e.fields)}).fail(function(e,t){return i.reject(null,t)}),i},n.prototype.tagDocument=function(t,i){i=e._.extend({},i),this.logger.info("Tagging a document",t);var n=e.$.Deferred(),o={url:this.buildBaseUri("/tag"),queryString:this.buildBaseQueryString(i),method:"POST",requestData:t,errorsAsSuccess:!1,responseType:"text"};return this.callWithErrorHandling(o).done(function(){return n.resolve(!0)}).fail(function(){return n.reject(!1)}),n},n.prototype.createEndpointCaller=function(){this.caller=new t.EndpointCaller(this.options)},n.prototype.buildBaseUri=function(t){e.Assert.isString(t);var i=this.options.restUri;return i=this.removeTrailingSlash(i),i+=t,this.options.isOldRestAPI&&(i=this.addTrailingSlash(i)),i},n.prototype.buildBaseQueryString=function(t){var i=[];for(var n in this.options.queryStringArguments)i.push(n+"="+encodeURIComponent(this.options.queryStringArguments[n]));return e._.isArray(t.authentication)&&0!=t.authentication.length&&i.push("authentication="+t.authentication.join(",")),i},n.prototype.buildViewAsHtmlUri=function(t,i,n){e.Assert.isNonEmptyString(i);var o=this.buildViewAsHtmlQueryString(i,n);e.Utils.isNonEmptyString(this.options.accessToken)&&o.push("access_token="+encodeURIComponent(this.options.accessToken));var s=this.buildBaseUri(t);return s+"?"+o.join("&")},n.prototype.buildViewAsHtmlQueryString=function(e,t){var i=this.buildBaseQueryString(t);return i.push("uniqueId="+encodeURIComponent(e)),null!=t.query&&(i.push("q="+encodeURIComponent(t.query)),i.push("enableNavigation=true")),t.requestedOutputSize&&i.push("requestedOutputSize="+encodeURIComponent(t.requestedOutputSize.toString())),t.contentType&&i.push("contentType="+encodeURIComponent(t.contentType)),i},n.prototype.callWithErrorHandling=function(t){var i=e.$.Deferred();return this.performOneCall(t,i,!0),i},n.prototype.performOneCall=function(t,i,n){var o=this;this.caller.call(t).done(function(e){e.data.clientDuration=e.duration,i.resolve(e.data,t.requestData)}).fail(function(s){n&&o.canRenewAccessToken()&&o.isAccessTokenExpiredStatus(s.statusCode)?o.renewAccessToken().done(function(){return o.performOneCall(t,i,!1)}).fail(function(){return o.handleErrorResponse(s,i)}):0==s.statusCode&&o.isRedirecting?e._.defer(function(){i.resolve()}):o.handleErrorResponse(s,i)})},n.prototype.handleErrorResponse=function(e,i){this.isMissingAuthenticationProviderStatus(e.statusCode)?i.reject(null,new t.MissingAuthenticationError(e.data.provider)):e.data&&e.data.message?i.reject(null,new t.QueryError(e)):i.reject(null,new t.AjaxError("Request Error",e.statusCode))},n.prototype.canRenewAccessToken=function(){return e.Utils.isNonEmptyString(this.options.accessToken)&&e._.isFunction(this.options.renewAccessToken)},n.prototype.isAccessTokenExpiredStatus=function(e){return 419==e},n.prototype.renewAccessToken=function(){var t=this;return this.logger.info("Renewing expired access token"),this.options.renewAccessToken().done(function(i){e.Assert.isNonEmptyString(i),t.options.accessToken=i,t.createEndpointCaller()}).fail(function(e){t.logger.error("Failed to renew access token",e)})},n.prototype.isMissingAuthenticationProviderStatus=function(e){return 402==e},n.prototype.addTrailingSlash=function(e){return this.hasTrailingSlash(e)||(e+="/"),e},n.prototype.removeTrailingSlash=function(e){return this.hasTrailingSlash(e)&&(e=e.substr(0,e.length-1)),e},n.prototype.hasTrailingSlash=function(e){return"/"==e.charAt(e.length-1)},n.endpoints={},n}();t.SearchEndpoint=n}(t=e.Rest||(e.Rest={}))}(Coveo||(Coveo={}));var Coveo;!function(e){var t;!function(t){var i=function(){function t(e,t){this.endpoint=e,this.callOptions=t,this.options=e.options}return t.prototype.getBaseUri=function(){return this.endpoint.getBaseUri()},t.prototype.getAuthenticationProviderUri=function(e,t,i){return this.endpoint.getAuthenticationProviderUri(e,t,i)},t.prototype.isJsonp=function(){return this.endpoint.isJsonp()},t.prototype.search=function(e,t){return this.endpoint.search(e,this.enrichCallOptions(t))},t.prototype.tagDocument=function(e){return this.endpoint.tagDocument(e,this.enrichCallOptions(e))},t.prototype.getRawDataStream=function(e,t,i){return this.endpoint.getRawDataStream(e,t,this.enrichCallOptions(i))},t.prototype.getDocumentText=function(e,t){return this.endpoint.getDocumentText(e,this.enrichCallOptions(t))},t.prototype.getDocumentHtml=function(e,t){return this.endpoint.getDocumentHtml(e,this.enrichCallOptions(t))},t.prototype.getViewAsHtmlUri=function(e,t){return this.endpoint.getViewAsHtmlUri(e,this.enrichCallOptions(t))},t.prototype.getViewAsDatastreamUri=function(e,t,i){return this.endpoint.getViewAsDatastreamUri(e,t,this.enrichCallOptions(i))},t.prototype.listFieldValues=function(e,t){return this.endpoint.listFieldValues(e,this.enrichCallOptions(t))},t.prototype.listFields=function(e){return this.endpoint.listFields(this.enrichCallOptions(e))},t.prototype.enrichCallOptions=function(t){return e._.extend({},t,this.callOptions)},t}();t.SearchEndpointWithDefaultCallOptions=i}(t=e.Rest||(e.Rest={}))}(Coveo||(Coveo={}));var Coveo;!function(e){var t;!function(t){e._.templateSettings={evaluate:/(?:<%|{{)([\s\S]+?)(?:%>|}})/g,interpolate:/(?:<%|{{)=([\s\S]+?)(?:%>|}})/g,escape:/(?:<%|{{)-([\s\S]+?)(?:%>|}})/g};var i=function(){function t(t){if(this.logger=new e.Logger(this),e.Utils.isHtmlElement(t)){e.Assert.exists(t);var i=e.$(t).html();this.template=e._.template(i)}else t instanceof Function&&(this.template=t)}return t.prototype.instantiateToString=function(i){var n=e._.extend({},i,t.templateHelpers);return this.template(n)},t.prototype.instantiateToElement=function(t){var i=this.instantiateToString(t),n=e.JQueryUtils.htmlToDom(i);return this.logger.trace("Instantiated result template",t,n),n},t.create=function(i){return e.Assert.exists(i),new t(i)},t.registerTemplateHelper=function(e,i){t.templateHelpers[e]=i},t.isLibraryAvailable=function(){return e.Utils.exists(window._)},t.templateHelpers={},t.mimeTypes=["text/underscore","text/underscore-template","text/x-underscore","text/x-underscore-template"],t}();t.UnderscoreTemplate=i}(t=e.Ui||(e.Ui={}))}(Coveo||(Coveo={}));var Coveo;!function(e){var t;!function(t){var i=function(){function t(i){this.template=i,e.Assert.check(t.isLibraryAvailable(),"The JsRender library must be loaded within the page"),e.Assert.exists(i),this.logger=new e.Logger(this)}return t.prototype.instantiateToString=function(t){return e.$(this.template).render(t)},t.prototype.instantiateToElement=function(t){var i=e.$(this.template).render(t),n=e.JQueryUtils.htmlToDom(i);return this.logger.trace("Instantiated result template",t,n),n},t.create=function(i){return e.Assert.exists(i),new t(i)},t.isLibraryAvailable=function(){return e.Utils.exists(e.$.views)},t.mimeTypes=["text/jsrender","text/jsrender-template","text/x-jsrender","text/x-jsrender-template"],t}();t.JsRenderTemplate=i}(t=e.Ui||(e.Ui={}))}(Coveo||(Coveo={}));var Coveo;!function(e){var t;!function(t){var i=function(){function t(i){e.Assert.check(t.isLibraryAvailable(),"The Handlebars library must be loaded within the page"),e.Assert.exists(i),this.logger=new e.Logger(this);var n=e.$(i).html();this.template=Handlebars.compile(n)}return t.prototype.instantiateToString=function(e){return this.template(e)},t.prototype.instantiateToElement=function(t){var i=this.template(t),n=e.JQueryUtils.htmlToDom(i);return this.logger.trace("Instantiated result template",t,n),n},t.create=function(i){return e.Assert.exists(i),new t(i)},t.isLibraryAvailable=function(){return e.Utils.exists(window.Handlebars)},t.mimeTypes=["text/handlebars","text/handlebars-template","text/x-handlebars","text/x-handlebars-template"],t}();t.HandlebarsTemplate=i}(t=e.Ui||(e.Ui={}))}(Coveo||(Coveo={}));var Coveo;!function(e){var t;!function(t){var i=function(){function i(){}return i.registerTemplate=function(t,n){e.Assert.isNonEmptyString(t),e.Assert.exists(n),i.templates[t]=n},i.getTemplate=function(t){return e.Assert.exists(i.templates[t]),i.templates[t]},i.getTemplateNames=function(){return e._.keys(i.templates)},i.scanAndRegisterTemplates=function(){t.UnderscoreTemplate.isLibraryAvailable()&&i.scanAndRegisterUnderscoreTemplates(),t.JsRenderTemplate.isLibraryAvailable()&&(i.scanAndRegisterJsRenderTemplates(),i.scanAndRegisterJsonTemplates()),t.HandlebarsTemplate.isLibraryAvailable()&&i.scanAndRegisterHandlebarsTemplates()},i.scanAndRegisterUnderscoreTemplates=function(){e._.each(t.UnderscoreTemplate.mimeTypes,function(n){e.$("script[id][type='"+n+"']").each(function(n,o){var s=new t.UnderscoreTemplate(o);i.registerTemplate(e.$(o).attr("id"),function(e){return s.instantiateToString(e)})})})},i.scanAndRegisterJsRenderTemplates=function(){e._.each(t.JsRenderTemplate.mimeTypes,function(n){e.$("script[id][type='"+n+"']").each(function(n,o){var s=new t.JsRenderTemplate(o);i.registerTemplate(e.$(o).attr("id"),function(e){return s.instantiateToString(e)})})})},i.scanAndRegisterHandlebarsTemplates=function(){e._.each(t.HandlebarsTemplate.mimeTypes,function(n){e.$("script[id][type='"+n+"']").each(function(n,o){var s=new t.HandlebarsTemplate(o);i.registerTemplate(e.$(o).attr("id"),function(e){return s.instantiateToString(e)})})})},i.scanAndRegisterJsonTemplates=function(){e._.each(t.JsonTemplate.mimeTypes,function(n){e.$("script[id][type='"+n+"']").each(function(n,o){var s=new t.JsonTemplate(o);i.registerTemplate(e.$(o).attr("id"),function(e){return s.instantiateToString(e)})})})},i.templates={},i}();t.TemplateCache=i,e.$(function(){i.scanAndRegisterTemplates()})}(t=e.Ui||(e.Ui={}))}(Coveo||(Coveo={}));var Coveo;!function(e){var t;!function(t){var i=function(){function i(i){var n;if(e.Utils.isHtmlElement(i)){e.Assert.exists(i);var o=e.$(i).html();n=e.Utils.isNullOrEmptyString(o)?null:JSON.parse(o)}else i instanceof Object&&(n=i);this.template=new t.JsRenderTemplate(e.$(this.renderTemplate(n).result).get(0))}return i.prototype.instantiateToString=function(e){return this.template.instantiateToString(e)},i.prototype.instantiateToElement=function(e){return this.template.instantiateToElement(e)},i.prototype.renderTemplate=function(e){if(null==e&&(e={type:"list",containers:[],leftContainers:[],rightContainers:[]}),"list"==e.type){var t='<script type="text/x-jsrender"><div class="item result">';return e.leftContainers&&e.leftContainers.length>0&&(t+='<div style="float: left;">'+this.renderContainers(e.leftContainers)+"</div>"),e.rightContainers&&e.rightContainers.length>0&&(t+='<div style="float: right;">'+this.renderContainers(e.rightContainers)+"</div>"),e.containers.length>0&&(t+='<div style="overflow: hidden;">'+this.renderContainers(e.containers)+"</div>"),t+="</div></script>",{result:t}}for(var i="<thead><tr>",t='<script type="text/x-jsrender"><tr class="item result">',n=0;n<e.containers.length;n++){var o=e.containers[n],s=this.cleanWidth(o.settings.width);i+='<th width="'+s+'">'+this.plainText(o.settings.header)+"</th>";for(var r=[],a=0;a<o.contents.length;a++)r.push(this.renderContent(o.contents[a]));t+='<td width="'+s+'">'+r.join(" ")+"</td>"}return i+="</tr></thead>",t+="</tr></script>",{header:i,result:t}},i.prototype.renderContainers=function(e){for(var t="",i=0;i<e.length;i++){for(var n=e[i],o=[],s=0;s<n.contents.length;s++)o.push(this.renderContent(n.contents[s]));t+="<div>"+o.join(" ")+"</div>"}return t},i.prototype.renderContent=function(e){return"field"==e.type?this.renderField(e):"code"==e.type?this.renderCode(e):"link"==e.type?this.renderLink(e):"thumbnail"==e.type?this.renderThumbnail(e):"badge"==e.type?this.renderBadge(e):"quickview"==e.type?this.renderQuickView(e):"custom_component"==e.type?this.renderCustomComponent(e):"field_table"==e.type?this.renderFieldTable(e):""},i.prototype.renderField=function(e){var t="",i=this.cleanText(e.settings.name);i=this.lowercaseFirstLetter(i);var n="span",o=i.split("."),s={};switch(e.settings.renderAs){case"link":var r=this.cleanText(e.settings.text);""==r&&(r=i),n="a",s.href="{{url:"+i+"}}",s["data-href"]="{{>"+i+"}}",s.target=null!=e.settings.sameTab&&"true"==e.settings.sameTab?"_self":"_blank";var a=this.lowercaseFirstLetter(r);t=a.indexOf("'")>=0?"{{>"+a+"}}":"{{if "+a+"Highlights}}{{:~highlight("+a+", "+a+"Highlights)}}{{else}}{{>"+r+"}}{{/if}}",o.push("CoveoResultLink"),o.push("coveo-link");break;case"email":t="true"==e.settings.toHyperlinks?"{{:~email("+i+")}}":"{{>"+i+"}}",o.push("coveo-email");break;case"date":var l=e.settings.format;"dateToString"==l&&(l="date"),"timeToString"==l&&(l="time"),"dateTimeToString"==l&&(l="dateTime"),"emailDateTimeToString"==l&&(l="emailDateTime"),(null==l||"time"!=l&&"dateTime"!=l&&"emailDateTime"!=l)&&(l="date"),t="{{>~"+l+"("+i+")}}",o.push("coveo-date");break;default:t="true"==e.settings.emailList?"{{:~email("+i+")}}":"{{if "+i+"Highlights}}{{:~highlight("+i+", "+i+"Highlights)}}{{else}}{{>"+i+"}}{{/if}}"}return s["class"]=o.join(" "),t=this.renderStyleSettings(e.settings,t,n,s),t=this.renderEllipsis(e.settings,t),null==e.settings.label||e.settings.label.match("^\\s*$")||(t='<span class="coveo-label">'+this.plainText(e.settings.label)+"</span>"+t),"{{if "+i+"}}"+t+"{{/if}}"},i.prototype.renderEllipsis=function(e,t){return null!=e.ellipsis&&"true"==e.ellipsis?'<div class="coveo-ellipsis">'+t+"</div>":t},i.prototype.renderStyleSettings=function(e,t,i,n){var o={};null!=e.color&&""!=e.color&&(o.color=this.cleanColor(e.color)),null!=e.bold&&"true"==e.bold&&(o["font-weight"]="bold"),null!=e.italic&&"true"==e.italic&&(o["font-style"]="italic"),null!=e.underline&&"true"==e.underline&&(o["text-decoration"]="underline");var s=" ";for(var r in n)s+=r+'="'+n[r]+'" ';var a="";for(var r in o)a+=r+":"+o[r]+";";return"<"+i+s+'style="'+a+'">'+t+"</"+i+">"},i.prototype.renderCustomComponent=function(e){var t="{{if "+this.jsRenderEncode(e.settings.condition)+"}}";return t+='     <span class="'+this.jsRenderEncode(e.settings.component)+'" href="javascript:void(0);"></span>',t+="{{/if}}"},i.prototype.renderCode=function(e){return"<span>{{html:"+this.jsRenderEncode(e.settings.value)+"}}</span>"},i.prototype.renderLink=function(e){var t=this.jsRenderEncode(e.settings.value),i=this.jsRenderEncode(e.settings.text);(null==i||""==i)&&(i=t),i=this.lowercaseFirstLetter(i);var n,o=null!=e.settings.sameTab&&"true"==e.settings.sameTab?"_self":"_blank";return n=i.indexOf("'")>=0?"{{>"+i+"}}":"{{if "+i+"Highlights}}{{:~highlight("+i+", "+i+"Highlights)}}{{else}}{{html:"+i+"}}{{/if}}",'<a href="{{url:'+t+'}}" data-href="{{>'+t+'}}" target="'+o+'">'+n+"</a>"},i.prototype.renderThumbnail=function(e){var t=this.jsRenderEncode(e.settings.url);return'<img class="coveo-sf-thumb" src="{{url:'+t+'}}" style="height: '+e.settings.height+'px"/>'},i.prototype.renderBadge=function(e){var t=this.jsRenderEncode(e.settings.fieldName),i="{{html:"+t+"}}";
return i=this.renderStyleSettings(e.settings,i,"span",{"class":"coveo-badge"}),"{{if "+t+" != undefined}}"+i+"{{/if}}"},i.prototype.renderQuickView=function(e){return'<div class="CoveoQuickView" data-title="{{html:'+this.jsRenderEncode(e.settings.title)+'}}"><div class="CoveoQuickViewDocument"></div></div>'},i.prototype.renderFieldTable=function(t){var i,n=this;try{i=JSON.parse(t.settings.rows)}catch(o){i=[]}return'<table class="CoveoFieldTable">'+e._.map(i,function(e){var t=[];return t.push('data-field="'+n.jsRenderEncode(e.field)+'"'),e.caption&&t.push('data-caption="'+n.jsRenderEncode(e.caption)+'"'),"<tr "+t.join(" ")+"></tr>"}).join("")+"</div>"},i.prototype.cleanText=function(e){return null==e?"":e.replace(/[^A-Za-z0-9_\.]/g,"")},i.prototype.lowercaseFirstLetter=function(e){return e&&e.length>0?e.charAt(0).toLowerCase()+e.slice(1):""},i.prototype.cleanColor=function(e){return null==e?"":e.match(/^#[0-9A-Fa-f]{3,6}$/)||e.match(/^[a-z]+$/)?e:""},i.prototype.cleanWidth=function(e){return null==e?"":e.match(/^[0-9]{1,2}?%|[0-9]+$/)?e:""},i.prototype.plainText=function(e){return this.jsRenderEncode(this.htmlEncode(e))},i.prototype.htmlEncode=function(e){return null==e?"":e.replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;")},i.prototype.jsRenderEncode=function(e){return null==e?"":e.replace(/\}\}/g,"}}")},i.create=function(t){return e.Assert.exists(t),new i(t)},i.isLibraryAvailable=function(){return e.Utils.exists(window.TemplateEditorUtils)&&t.JsRenderTemplate.isLibraryAvailable()},i.mimeTypes=["text/json-template"],i}();t.JsonTemplate=i}(t=e.Ui||(e.Ui={}))}(Coveo||(Coveo={}));var Coveo;!function(e){var t;!function(t){var i=function(){function i(){}return i.registerTemplateHelper=function(n,o){e.Assert.isNonEmptyString(n),e.Assert.exists(o),t.UnderscoreTemplate.isLibraryAvailable()&&i.registerTemplateHelperInUnderscore(n,o),t.JsRenderTemplate.isLibraryAvailable()&&i.registerTemplateHelperInJsRender(n,o),t.HandlebarsTemplate.isLibraryAvailable()&&i.registerTemplateHelperInHandlebars(n,o),i.helpers[n]=o},i.getHelper=function(e){return i.helpers[e]},i.registerTemplateHelperInJsRender=function(t,i){e.Assert.isNonEmptyString(t),e.Assert.exists(i);var n={};n[t]=function(){for(var e=[],t=0;t<arguments.length;t++)e[t-0]=arguments[t];return i.apply(this.data,e)},e.$.views.helpers(n)},i.registerTemplateHelperInHandlebars=function(i,n){e.Assert.isNonEmptyString(i),e.Assert.exists(n),e.Assert.check(t.HandlebarsTemplate.isLibraryAvailable()),Handlebars.registerHelper(i,function(){for(var t=[],i=0;i<arguments.length;i++)t[i-0]=arguments[i];var o=t[t.length-1];return e._.isObject(o)&&e.Utils.exists(o.hash)&&(t[t.length-1]=o.hash),new Handlebars.SafeString(n.apply(this,t))})},i.registerTemplateHelperInUnderscore=function(i,n){e.Assert.isNonEmptyString(i),e.Assert.exists(n),e.Assert.check(t.UnderscoreTemplate.isLibraryAvailable()),t.UnderscoreTemplate.registerTemplateHelper(i,n)},i.helpers={},i}();t.TemplateHelpers=i}(t=e.Ui||(e.Ui={}))}(Coveo||(Coveo={}));var Coveo;!function(e){var t;!function(t){var i=function(){function i(){}return i.registerDefaultOptions=function(t,i){var n=e.$(t).data("CoveoDefaultOptions")||{},o=e.$.extend(!0,{},n,i);e.$(t).data("CoveoDefaultOptions",o)},i.resolveDefaultOptions=function(t,n){var o,s=e.$(t).data("CoveoDefaultOptions");return o=e.Utils.exists(s)?e.$.extend(!0,{},s,n):n,t.parentElement?i.resolveDefaultOptions(t.parentElement,o):o},i.registerAutoCreateComponent=function(t){e.Assert.exists(t),e.Assert.exists(t.ID),e.Assert.doesNotExists(i.autoCreateComponents[t.ID]),e.Assert.doesNotExists(i.namedMethods[t.ID]),i.autoCreateComponents[t.ID]=t},i.isComponentClassIdRegistered=function(t){return e.Utils.exists(i.autoCreateComponents[t])},i.getListOfRegistredComponents=function(){return e._.keys(i.autoCreateComponents)},i.getRegistredComponent=function(e){return i.autoCreateComponents[e]},i.initializeSearchInterface=function(n,o){e.Assert.exists(n),this.logger.info("Internal Coveo JQuery version",e.$.fn.jquery),e.DeviceUtils.isIE8or9()&&e.$("html").addClass("ie8or9"),o=i.resolveDefaultOptions(n,o),i.performInitFunctionsOption(o,e.Events.InitializationEvents.beforeInitialization),e.$(n).trigger(e.Events.InitializationEvents.beforeInitialization),i.initComponents(n,o),i.initExternalComponents(n,o),i.performInitFunctionsOption(o,e.Events.InitializationEvents.afterComponentsInitialization),e.$(n).trigger(e.Events.InitializationEvents.afterComponentsInitialization),e.$(n).trigger(e.Events.InitializationEvents.restoreHistoryState),i.performInitFunctionsOption(o,e.Events.InitializationEvents.afterInitialization),e.$(n).trigger(e.Events.InitializationEvents.afterInitialization);var s=t.Component.get(n,t.SearchInterface);e.$(".coveo-hide-until-loaded").removeClass("coveo-hide-until-loaded").addClass("coveo-show-after-loaded"),s.options.autoTriggerQuery&&t.Component.get(n,e.Controllers.QueryController).executeQuery()},i.initializeSearchInterfaceForSearchBox=function(t,n,o){e.Assert.isNonEmptyString(n);var s={};s.searchPageUri=n,s.autoTriggerQuery=!1,s.hideUntilFirstQuery=!1,s.enableHistory=!1,o=e._.extend({},o,{SearchInterface:s}),i.initializeSearchInterface(t,o)},i.performInitFunctionsOption=function(t,n){e.Utils.exists(t)&&i.performFunctions(t[n])},i.performPreInitFunctions=function(t){e.Utils.exists(t)&&i.performFunctions(t[e.Events.InitializationEvents.beforeInitialization])},i.performPostInitFunction=function(t){e.Utils.exists(t)&&i.performFunctions(t[e.Events.InitializationEvents.afterInitialization])},i.performFunctions=function(t){e.Utils.exists(t)&&e._.each(t,function(e){"function"==typeof e&&e()})},i.initComponents=function(n,o){void 0===o&&(o={}),o.SearchInterface=o.SearchInterface||{},o.SearchInterface.initOptions=o;var s=new t.SearchInterface(n,o.SearchInterface,o.Analytics),r=e.$.extend({},{options:o},s.getBindings());i.automaticallyCreateComponentsInside(n,r)},i.initExternalComponents=function(t,n){if(n&&n.externalComponents){var o=e.$(t).coveo(e.Ui.SearchInterface),s=e.$(t).coveo(e.Models.QueryStateModel),r=e.$(t).coveo(e.Models.ComponentStateModel),a=e.$(t).coveo(e.Controllers.QueryController),l=e.$(t).coveo(e.Models.ComponentOptionsModel),u=o.usageAnalytics;e.Assert.exists(o),e.Assert.exists(s),e.Assert.exists(a),e.Assert.exists(r),e.Assert.exists(u);var c={options:n,searchInterface:o,queryStateModel:s,queryController:a,usageAnalytics:u,componentStateModel:r,componentOptionsModel:l,root:t};e._.each(n.externalComponents,function(t){var n=t;n instanceof e.$&&(n=e.$(n).get(0)),e.Utils.isHtmlElement(n)&&i.automaticallyCreateComponentsInside(n,c)})}},i.automaticallyCreateComponentsInside=function(n,o,s){e.Assert.exists(n);var r=[];for(var a in i.autoCreateComponents)if(!e._.contains(s,a)){var l=i.autoCreateComponents[a],u=t.Component.computeCssClassNameForType(l.ID),c=e.$(n).find("."+u);e.$(n).hasClass(u)&&(c=c.add(n)),0!=c.length&&r.push(i.createFunctionThatInitializesComponentOnElements(c,a,l,o))}e._.each(r,function(e){return e()})},i.createFunctionThatInitializesComponentOnElements=function(t,n,o,s){return function(){t.each(function(t,r){var a=void 0;if(e.Utils.exists(s.options)){var l=s.options[n],u=s.options[r.id],c=s.options.initOptions?s.options.initOptions[n]:{};a=e.$.extend({},l,u,c)}var p=e.$.extend({},s,{options:a});i.createComponentOfThisClassOnElement(o.ID,r,p)})}},i.createComponentOfThisClassOnElement=function(t,n,o){e.Assert.isNonEmptyString(t),e.Assert.exists(n);var s=i.autoCreateComponents[t];e.Assert.exists(s);var r={},a={},l=void 0;return void 0!=o&&(r={queryController:o.queryController,queryStateModel:o.queryStateModel,componentStateModel:o.componentStateModel,root:o.root,searchInterface:o.searchInterface,usageAnalytics:o.usageAnalytics,componentOptionsModel:o.componentOptionsModel},a=o.options,l=o.result),i.logger.trace("Creating component of class "+t,n,a),new s(n,a,r,l)},i.registerNamedMethod=function(t,n){e.Assert.isNonEmptyString(t),e.Assert.doesNotExists(i.autoCreateComponents[t]),e.Assert.doesNotExists(i.namedMethods[t]),e.Assert.exists(n),i.namedMethods[t]=n},i.isNamedMethodRegistered=function(t){return e.Utils.exists(i.namedMethods[t])},i.dispatchNamedMethodCall=function(t,n,o){e.Assert.isNonEmptyString(t),e.Assert.exists(n);var s=i.namedMethods[t];return e.Assert.exists(s),i.logger.trace("Dispatching named method call of "+t,n,o),s.apply(null,[n].concat(o))},i.isThereASingleComponentBoundToThisElement=function(i){return e.Assert.exists(i),e.Utils.exists(t.Component.get(i))},i.dispatchMethodCallOnBoundComponent=function(i,n,o){e.Assert.isNonEmptyString(i),e.Assert.exists(n);var s=t.Component.get(n);e.Assert.exists(s);var r=s[i];return e.Utils.exists(r)?r.apply(s,o):(e.Assert.fail("No method named "+i+" exist on component "+s.type),void 0)},i.dispatchNamedMethodCallOrComponentCreation=function(t,n,o){return e.Assert.isNonEmptyString(t),e.Assert.exists(n),i.isNamedMethodRegistered(t)?i.dispatchNamedMethodCall(t,n,o):i.isComponentClassIdRegistered(t)?i.createComponentOfThisClassOnElement(t,n,o[0]):i.isThereASingleComponentBoundToThisElement(n)?i.dispatchMethodCallOnBoundComponent(t,n,o):(e.Assert.fail("No method or component named "+t+" are registered."),void 0)},i.monkeyPatchComponentMethod=function(i,n,o){e.Assert.isNonEmptyString(i),e.Assert.exists(o);var s;if(i.indexOf(".")>0){var r=i.split(".");e.Assert.check(2==r.length,"Invalid method name, correct syntax is CoveoComponent.methodName."),s=r[0],i=r[1]}var a=t.Component.get(n,s);e.Assert.exists(a),e.Assert.exists(a[i]);var l="__"+i;e.Utils.exists(a[l])||(a[l]=a[i]),a[i]=o},i.noConflict=function(){e.$=jQuery.noConflict(!0),window.$.fn.coveo=e.$.fn.coveo},i.logger=new e.Logger("JQuery"),i.autoCreateComponents={},i.namedMethods={},i}();t.CoveoJQuery=i}(t=e.Ui||(e.Ui={}))}(Coveo||(Coveo={})),$.fn.coveo=function(){for(var e=[],t=0;t<arguments.length;t++)e[t-0]=arguments[t];var i;return this.each(function(t,n){var o;if(_.isString(e[0])){var s=e[0];o=Coveo.Ui.CoveoJQuery.dispatchNamedMethodCallOrComponentCreation(s,n,e.slice(1))}else o=Coveo.Ui.CoveoJQuery.dispatchNamedMethodCall("get",n,e);i=i||o}),i},Coveo.$.fn.getCursorPosition=function(){var e=this.get(0);if(e){if("selectionStart"in e)return e.selectionStart;if(document.selection){e.focus();var t=document.selection.createRange(),i=document.selection.createRange().text.length;return t.moveStart("character",-e.value.length),t.text.length-i}}},Coveo.Ui.CoveoJQuery.registerNamedMethod("options",function(e,t){Coveo.Ui.CoveoJQuery.registerDefaultOptions(e,t)}),Coveo.Ui.CoveoJQuery.registerNamedMethod("init",function(e,t){Coveo.Ui.CoveoJQuery.initializeSearchInterface(e,t)}),Coveo.Ui.CoveoJQuery.registerNamedMethod("initSearchBox",function(e,t,i){Coveo.Ui.CoveoJQuery.initializeSearchInterfaceForSearchBox(e,t,i)}),Coveo.Ui.CoveoJQuery.registerNamedMethod("patch",function(e,t,i){Coveo.Ui.CoveoJQuery.monkeyPatchComponentMethod(t,e,i)}),Coveo.Ui.CoveoJQuery.registerNamedMethod("noConflict",function(){Coveo.Ui.CoveoJQuery.noConflict()});var Coveo;!function(e){var t;!function(t){var i=function(){function i(n,o,s){var r=this;void 0===s&&(s={}),this.element=n,this.type=o,this.disabled=!1,this.bind=new t.ComponentEvents(this),e.Assert.exists(n),e.Assert.isNonEmptyString(o),i.bindComponentToElement(this.element,this),this.logger=new e.Logger(this),this.root=s.root||this.resolveRoot(),this.queryStateModel=s.queryStateModel||this.resolveQueryStateModel(),this.componentStateModel=s.componentStateModel||this.resolveComponentStateModel(),this.queryController=s.queryController||this.resolveQueryController(),this.searchInterface=s.searchInterface||this.resolveSearchInterface(),this.usageAnalytics=s.usageAnalytics||this.resolveUA(),this.componentOptionsModel=s.componentOptionsModel||this.resolveComponentOptionsModel(),this.ensureDom=e._.once(function(){return r.createDom()}),null!=this.searchInterface&&this.searchInterface.attachComponent(o,this)}return i.prototype.getBindings=function(){return{root:this.root,queryStateModel:this.queryStateModel,queryController:this.queryController,searchInterface:this.searchInterface,componentStateModel:this.componentStateModel,componentOptionsModel:this.componentOptionsModel,usageAnalytics:this.usageAnalytics}},i.prototype.enable=function(){this.disabled=!1},i.prototype.disable=function(){this.disabled=!0},i.prototype.createDom=function(){},i.prototype.resolveSearchInterface=function(){return i.resolveBinding(this.element,t.SearchInterface)},i.prototype.resolveRoot=function(e){var n=i.resolveBinding(this.element,t.SearchInterface);return n?n.element:e},i.prototype.resolveQueryController=function(t){return i.resolveBinding(this.element,e.Controllers.QueryController)||t},i.prototype.resolveComponentStateModel=function(t){return i.resolveBinding(this.element,e.Models.ComponentStateModel)||t},i.prototype.resolveQueryStateModel=function(t){return i.resolveBinding(this.element,e.Models.QueryStateModel)||t},i.prototype.resolveComponentOptionsModel=function(t){return i.resolveBinding(this.element,e.Models.ComponentOptionsModel)||t},i.prototype.resolveUA=function(){var e=this.resolveSearchInterface();return e&&e.usageAnalytics?e.usageAnalytics:new t.NoopAnalyticsClient},i.prototype.resolveResult=function(){var t=e.$(this.element).closest(".CoveoResult");return e.Assert.check(1==t.length),t.get(0).CoveoResult},i.prototype.isInstanceOf=function(t){return i.getComponentRef(t)&&this instanceof e.Ui[t]},i.getComponentRef=function(t){return e.Ui[t]},i.get=function(t,n,o){if(e.Assert.exists(t),e._.isString(n))return t[i.computeMemberNameForType(n)];if(e.Utils.exists(n))return e.Assert.exists(n.ID),t[i.computeMemberNameForType(n.ID)];var s=i.getBoundComponentsForElement(t);return o||e.Assert.check(s.length<=1,"More than one component is bound to this element. You need to specify the component type."),s[0]},i.bindComponentToElement=function(t,n){e.Assert.exists(t),e.Assert.exists(n),e.Assert.isNonEmptyString(n.type),t[i.computeMemberNameForType(n.type)]=n,e.$(t).addClass(i.computeCssClassNameForType(n.type)),i.getBoundComponentsForElement(t).push(n)},i.bindResultToElement=function(t,i){e.Assert.exists(t),e.Assert.exists(i),e.$(t).addClass("CoveoResult"),t.CoveoResult=i},i.resolveBinding=function(t,n){e.Assert.exists(t),e.Assert.exists(n),e.Assert.exists(n.ID);var o=e.$(t).closest("."+i.computeCssClassNameForType(n.ID));return 0==o.length?void 0:o.get(0)[i.computeMemberNameForType(n.ID)]},i.computeCssClassNameForType=function(t){return e.Assert.isNonEmptyString(t),"Coveo"+t},i.computeSelectorForType=function(t){return e.Assert.isNonEmptyString(t),"."+i.computeCssClassNameForType(t)},i.computeMemberNameForType=function(t){return e.Assert.isNonEmptyString(t),"Coveo"+t},i.pointElementsToDummyForm=function(e){e.add(e.find("*")).filter("input").attr("form","coveo-dummy-form")},i.getBoundComponentsForElement=function(t){return e.Assert.exists(t),null==t.CoveoBoundComponents&&(t.CoveoBoundComponents=[]),t.CoveoBoundComponents},i}();t.Component=i,t.CoveoJQuery.registerNamedMethod("get",function(t,n){return e.Assert.exists(t),i.get(t,n)})}(t=e.Ui||(e.Ui={}))}(Coveo||(Coveo={}));var Coveo;!function(e){var t;!function(t){var i=function(){function t(t){this.owner=t,e.Assert.exists(t)}return t.prototype.on=function(e,t,i){e.on(t,this.wrapToCallIfEnabled(i))},t.prototype.onRoot=function(t,i){this.on(e.$(this.owner.root),t,i)},t.prototype.fastClick=function(e,t){e.fastClick(this.wrapToCallIfEnabled(t))},t.prototype.trigger=function(e,t,i){this.wrapToCallIfEnabled(function(){e.trigger(t,i)})},t.prototype.wrapToCallIfEnabled=function(e){var t=this;return function(){for(var i=[],n=0;n<arguments.length;n++)i[n-0]=arguments[n];return t.owner.disabled?void 0:e.apply(t.owner,i)}},t}();t.ComponentEvents=i}(t=e.Ui||(e.Ui={}))}(Coveo||(Coveo={}));var Coveo;!function(e){var t;!function(t){var i;!function(i){function n(e){return v(0,T,e)}function o(e){return v(1,A,e)}function s(e){return v(2,S,e)}function r(e){return v(9,S,e)}function a(e){return v(3,E,e)}function l(e){return v(8,x,e)}function u(e){return v(4,w,e)}function c(e){return v(5,_,e)}function p(e){return v(6,U,e)}function d(e){return v(7,V,e)}function h(e,t){var i=function(t,i,n){var o=S(t,i,n);return e(o)};return v(2,i,t)}function f(e,t){var i=function(t,i,n){var o=w(t,i,n);return e(o)};return v(4,i,t)}function m(t){var i=function(i,n){for(var o=e._.keys(t.subOptions),s={},r={},a=0;a<o.length;a++){var l=o[a],u=n+l.substr(0,1).toUpperCase()+l.substr(1);s[u]=t.subOptions[l]}b(i,s,r);for(var c={},a=0;a<o.length;a++){var l=o[a],u=n+l.substr(0,1).toUpperCase()+l.substr(1);null!=r[u]&&(c[l]=r[u])}return e._.keys(c).length>0?c:null};return v(10,i,t)}function v(e,t,i){void 0===i&&(i={});var n=i;return n.type=e,n.load=t,n}function g(e,t){return t.attrName?t.attrName:"data-"+e.replace(/([A-Z])/g,"-$1").toLowerCase()}function y(e){var t=e.split("-");t.shift();for(var i=1;i<t.length;i++)t[i]=t[i].substr(0,1).toUpperCase()+t[i].substr(1);return t.join("")}function C(e,t,i){return b(e,t.options,i)}function b(t,i,n){null==n&&(n={});for(var o=e._.keys(i),s=0;s<o.length;s++){var r,a=o[s],l=i[a],u=(l.attrName||g(a,l),l.load);null!=u&&(r=u(t,a,l)),null==r&&void 0==n[a]&&(null!=l.defaultValue?r=4==l.type?e._.extend([],l.defaultValue):10==l.type?e._.extend({},l.defaultValue):l.defaultValue:null!=l.defaultFunction&&(r=l.defaultFunction(t))),null!=r&&(n[a]=r)}for(var s=0;s<o.length;s++){var a=o[s],l=i[a];l.postProcessing&&(n[a]=l.postProcessing(n[a],n))}return n}function S(t,i,n){return e.$(t).attr(g(i,n))}function x(t,i,n){var o=S(t,i,n);return e.Assert.check(!e.Utils.isNonEmptyString(o)||e.Utils.isCoveoField(o),o+" is not a valid field"),null!=o?o.toLowerCase():null}function E(t,i,n){var o=S(t,i,n),s=String.locale||String.defaultLocale;if(null!=s&&null!=o){var r=s.toLowerCase().split("-"),a=e._.map(r,function(e,t){return r.slice(0,t+1).join("-")}),l=o.match(Q);if(null!=l)for(var u=0;u<l.length;u++){var c=Q.exec(l[u]);if(null!=c){var p=c[1].toLowerCase();if(e._.contains(a,p))return c[2].replace(/^\s+|\s+$/g,"")}}return null!=o?o.toLocaleString():null}return o}function A(t,i,n){return e.Utils.parseIntIfNotUndefined(S(t,i,n))}function O(t,i,n){return e.Utils.parseFloatIfNotUndefined(S(t,i,n))}function T(t,i,n){return e.Utils.parseBooleanIfNotUndefined(S(t,i,n))}function w(t,i,n){var o=n.separator||/\s*,\s*/,s=S(t,i,n);return e.Utils.isNonEmptyString(s)?s.split(o):null}function I(e,t,i,n){var o=S(e,t,i);return null!=o?n[o]:null}function _(t,i,n){var o=S(t,i,n);return e.Utils.isNonEmptyString(o)?e.$(o).get(0):null}function U(t,i,n){var o,s=n.selectorAttr||g(i,n)+"-selector",r=e.$(t).attr(s);if(o=e.$(r).get(0),null==o){var a=n.childSelector;null==a&&(a="."+i),o=F(t,a)}return o}function F(t,i){if(e.Assert.isNonEmptyString(i),e.$(t).is(i))return t;var n=e.$(t).find(i);return 0!=n.length?n.get(0):null}function V(t,i,n){var o,s=n.selectorAttr||g(i,n)+"-selector",r=e.$(t).attr(s),a=e.$(r).get(0);if(null!=a&&(o=B(a)),null==o){var l=n.idAttr||g(i,n)+"-id",u=e.$(t).attr(l);null!=u&&(o=D(u))}if(null==o){var c=n.childSelector;null==c&&(c="."+i.replace(/([A-Z])/g,"-$1").toLowerCase()),o=R(t,c)}return o}function D(i){return e.Utils.isNonEmptyString(i)?new t.UnderscoreTemplate(t.TemplateCache.getTemplate(i)):null}function R(e,t){var i=F(e,t);return null!=i?B(i):null}function M(t){for(var i=e.$(t);!i.is(document)&&0!=i.length;){if($(i))return i.is("body")?e.$(window).get(0):i.get(0);i=i.parent()}return e.$(window).get(0)}function $(e){return"scroll"==e.css("overflow-y")}function B(i){e.Assert.exists(i);var n=e.$(i).attr("type");return e.Assert.check(e.Utils.isNonEmptyString(n),"You must specify the type of template"),-1!=e._.indexOf(t.UnderscoreTemplate.mimeTypes,n)?t.UnderscoreTemplate.create(i):-1!=e._.indexOf(t.JsRenderTemplate.mimeTypes,n)?t.JsRenderTemplate.create(i):-1!=e._.indexOf(t.HandlebarsTemplate.mimeTypes,n)?t.HandlebarsTemplate.create(i):-1!=e._.indexOf(t.JsonTemplate.mimeTypes,n)?t.JsonTemplate.create(i):(e.Assert.fail("Cannot guess template type from attribute: "+n),void 0)}!function(e){e[e.BOOLEAN=0]="BOOLEAN",e[e.NUMBER=1]="NUMBER",e[e.STRING=2]="STRING",e[e.LOCALIZED_STRING=3]="LOCALIZED_STRING",e[e.LIST=4]="LIST",e[e.SELECTOR=5]="SELECTOR",e[e.CHILD_HTML_ELEMENT=6]="CHILD_HTML_ELEMENT",e[e.TEMPLATE=7]="TEMPLATE",e[e.FIELD=8]="FIELD",e[e.ICON=9]="ICON",e[e.OBJECT=10]="OBJECT",e[e.NONE=11]="NONE"}(i.Type||(i.Type={}));i.Type;i.buildBooleanOption=n,i.buildNumberOption=o,i.buildStringOption=s,i.buildIconOption=r,i.buildLocalizedStringOption=a,i.buildFieldOption=l,i.buildListOption=u,i.buildSelectorOption=c,i.buildChildHtmlElementOption=p,i.buildTemplateOption=d,i.buildCustomOption=h,i.buildCustomListOption=f,i.buildObjectOption=m,i.buildOption=v,i.attrNameFromName=g,i.nameFromattrName=y,i.initComponentOptions=C,i.initOptions=b,i.loadStringOption=S,i.loadFieldOption=x;var Q=/([a-zA-Z\-]+)\s*:\s*(([^,]|,\s*(?!([a-zA-Z\-]+)\s*:))+)/g;i.loadLocalizedStringOption=E,i.loadNumberOption=A,i.loadFloatOption=O,i.loadBooleanOption=T,i.loadListOption=w,i.loadEnumOption=I,i.loadSelectorOption=_,i.loadChildHtmlElementOption=U,i.loadChildHtmlElementFromSelector=F,i.loadTemplateOption=V,i.loadResultTemplateFromId=D,i.loadChildResultTemplateFromSelector=R,i.findParentScrolling=M,i.isElementScrollable=$,i.createResultTemplateFromElement=B}(i=t.ComponentOptions||(t.ComponentOptions={}))}(t=e.Ui||(e.Ui={}))}(Coveo||(Coveo={}));var Coveo;!function(e){var t;!function(t){var i=function(){function i(){this.expression=new t.ExpressionBuilder,this.advancedExpression=new t.ExpressionBuilder,this.constantExpression=new t.ExpressionBuilder,this.disjunctionExpression=new t.ExpressionBuilder,this.firstResult=0,this.numberOfResults=10,this.enableDidYouMean=!1,this.enableDebug=!0,this.sortCriteria="relevancy",this.retrieveFirstSentences=!0,this.queryUid=e.QueryUtils.createGuid(),this.queryFunctions=[],this.rankingFunctions=[],this.groupByRequests=[],this.enableDuplicateFiltering=!1}return i.prototype.build=function(){var e={q:this.expression.build(),aq:this.advancedExpression.build(),cq:this.constantExpression.build(),dq:this.disjunctionExpression.build(),wildcards:this.enableWildcards,questionMarks:this.enableQuestionMarks,lowercaseOperators:this.enableLowercaseOperators,partialMatch:this.enablePartialMatch,partialMatchKeywords:this.partialMatchKeywords,partialMatchThreshold:this.partialMatchThreshold,firstResult:this.firstResult,numberOfResults:this.numberOfResults,excerptLength:this.excerptLength,filterField:this.filterField,filterFieldRange:this.filterFieldRange,parentField:this.parentField,childField:this.childField,fieldsToInclude:this.fieldsToInclude,fieldsToExclude:this.fieldsToExclude,enableDidYouMean:this.enableDidYouMean,sortCriteria:this.sortCriteria,sortField:this.sortField,queryFunctions:this.queryFunctions,rankingFunctions:this.rankingFunctions,groupBy:this.groupByRequests,retrieveFirstSentences:this.retrieveFirstSentences,timezone:this.timezone,enableDuplicateFiltering:this.enableDuplicateFiltering};return e},i.prototype.computeCompleteExpression=function(){return this.computeCompleteExpressionParts().full},i.prototype.computeCompleteExpressionParts=function(){var e=t.ExpressionBuilder.merge(this.expression,this.advancedExpression);return{full:t.ExpressionBuilder.mergeUsingOr(t.ExpressionBuilder.merge(e,this.constantExpression),this.disjunctionExpression).build(),withoutConstant:t.ExpressionBuilder.mergeUsingOr(e,this.disjunctionExpression).build(),constant:t.ExpressionBuilder.mergeUsingOr(this.constantExpression,this.disjunctionExpression).build()}},i.prototype.computeCompleteExpressionExcept=function(e){return this.computeCompleteExpressionPartsExcept(e).full},i.prototype.computeCompleteExpressionPartsExcept=function(e){var i=t.ExpressionBuilder.merge(this.expression,this.advancedExpression);return i.remove(e),{full:t.ExpressionBuilder.mergeUsingOr(t.ExpressionBuilder.merge(i,this.constantExpression),this.disjunctionExpression).build(),withoutConstant:t.ExpressionBuilder.mergeUsingOr(i,this.disjunctionExpression).build(),constant:t.ExpressionBuilder.mergeUsingOr(this.constantExpression,this.disjunctionExpression).build()}},i}();t.QueryBuilder=i}(t=e.Ui||(e.Ui={}))}(Coveo||(Coveo={}));var Coveo;!function(e){var t;!function(t){var i=function(){function t(){this.parts=[],this.wrapParts=!0}return t.prototype.add=function(t){e.Assert.isNonEmptyString(t),this.parts.push(t)},t.prototype.addFieldExpression=function(t,i,n){e.Assert.isNonEmptyString(t),e.Assert.stringStartsWith(t,"@"),e.Assert.isNonEmptyString(i),e.Assert.isLargerOrEqualsThan(1,n.length),this.add(e.QueryUtils.buildFieldExpression(t,i,n))},t.prototype.addFieldNotEqualExpression=function(t,i){e.Assert.isNonEmptyString(t),e.Assert.stringStartsWith(t,"@"),e.Assert.isLargerOrEqualsThan(1,i.length),this.add(e.QueryUtils.buildFieldNotEqualExpression(t,i))},t.prototype.remove=function(t){e.Assert.isNonEmptyString(t);var i=e._.indexOf(this.parts,t);-1!=i&&this.parts.splice(e._.indexOf(this.parts,t),1)},t.prototype.isEmpty=function(){return 0==this.parts.length},t.prototype.build=function(){return 0==this.parts.length?void 0:1==this.parts.length?this.parts[0]:this.wrapParts?"("+this.parts.join(") (")+")":this.parts.join(" ")},t.merge=function(){for(var i=[],n=0;n<arguments.length;n++)i[n-0]=arguments[n];var o=new t;return e._.each(i,function(e){o.parts=o.parts.concat(e.parts)}),o},t.mergeUsingOr=function(){for(var i=[],n=0;n<arguments.length;n++)i[n-0]=arguments[n];var o=e._.filter(i,function(e){return!e.isEmpty()}),s=new t;if(1==o.length)s.parts=[].concat(o[0].parts);else if(o.length>1){var r=e._.map(o,function(e){return e.build()});s.add("("+r.join(") OR (")+")")}return s},t}();t.ExpressionBuilder=i}(t=e.Ui||(e.Ui={}))}(Coveo||(Coveo={}));var Coveo;!function(e){var t;!function(e){e.AnalyticsActionCauseList={interfaceLoad:{name:"interfaceLoad",type:"interface"},interfaceChange:{name:"interfaceChange",type:"interface",metaMap:{interfaceChangeTo:1}},contextRemove:{name:"contextRemove",type:"misc",metaMap:{contextName:1}},didyoumeanAutomatic:{name:"didyoumeanAutomatic",type:"misc"},didyoumeanClick:{name:"didyoumeanClick",type:"misc"},resultsSort:{name:"resultsSort",type:"misc",metaMap:{resultsSortBy:1}},searchboxSubmit:{name:"searchboxSubmit",type:"search box"},searchboxClear:{name:"searchboxClear",type:"search box"},searchboxAsYouType:{name:"searchboxAsYouType",type:"search box"},breadcrumbFacet:{name:"breadcrumbFacet",type:"breadcrumb",metaMap:{facetId:1,facetValue:2}},breadcrumbResetAll:{name:"breadcrumbResetAll",type:"breadcrumb"},documentTag:{name:"documentTag",type:"document",metaMap:{facetId:1,facetValue:2}},documentField:{name:"documentField",type:"document",metaMap:{facetId:1,facetValue:2}},documentQuickView:{name:"documentQuickView",type:"document",metaMap:{documentTitle:1,documentURL:2}},documentOpen:{name:"documentOpen",type:"document",metaMap:{documentTitle:1,documentURL:2}},omniboxFacet:{name:"omniboxFacet",type:"omnibox",metaMap:{facetId:1,facetValue:2}},omniboxAnalytics:{name:"omniboxAnalytics",type:"omnibox"},omniboxField:{name:"omniboxField",type:"omnibox"},facetClearAll:{name:"facetClearAll",type:"facet",metaMap:{facetId:1}},facetSearch:{name:"facetSearch",type:"facet",metaMap:{facetId:1}},facetToggle:{name:"facetToggle",type:"facet",metaMap:{facetId:1,facetOperatorBefore:2,facetOperatorAfter:3}},facetRangeSlider:{name:"facetRangeSlider",type:"facet",metaMap:{facetId:1,facetRangeStart:2,facetRangeEnd:3}},facetRangeGraph:{name:"facetRangeGraph",type:"facet",metaMap:{facetId:1,facetRangeStart:2,facetRangeEnd:3}},facetSelect:{name:"facetSelect",type:"facet",metaMap:{facetId:1,facetValue:2}},facetSelectAll:{name:"facetSelectAll",type:"facet",metaMap:{facetId:1,facetValue:2}},facetDeselect:{name:"facetDeselect",type:"facet",metaMap:{facetId:1,facetValue:2}},facetExclude:{name:"facetExclude",type:"facet",metaMap:{facetId:1,facetValue:2}},facetUnexclude:{name:"facetUnexclude",type:"facet",metaMap:{facetId:1,facetValue:2}},facetSortValues:{name:"facetSortValues",type:"facet",metaMap:{facetId:1,facetSortBy:2}},errorBack:{name:"errorBack",type:"errors"},errorClearQuery:{name:"errorClearQuery",type:"errors"},errorRetry:{name:"errorRetry",type:"errors"},expandToFullUI:{name:"expandToFullUI",type:"interface"},caseCreate:{name:"caseCreate",type:"case"},casecontextAdd:{name:"casecontextAdd",type:"casecontext",metaMap:{caseID:5}},casecontextRemove:{name:"casecontextRemove",type:"casecontext",metaMap:{caseID:5}},preferencesChange:{name:"preferencesChange",type:"preferences",metaMap:{preferenceName:1,preferenceType:2}},caseAttach:{name:"caseAttach",type:"case",metaMap:{documentTitle:1,resultUriHash:3,articleID:4,caseID:5}},caseDetach:{name:"caseDetach",type:"case",metaMap:{documentTitle:1,resultUriHash:3,articleID:4,caseID:5}},customfiltersChange:{name:"customfiltersChange",type:"customfilters",metaMap:{customFilterName:1,customFilterType:2,customFilterExpression:3}},pagerNumber:{name:"pagerNumber",type:"getMoreResults",metaMap:{pagerNumber:1}},pagerNext:{name:"pagerNext",type:"getMoreResults",metaMap:{pagerNumber:1}},pagerPrevious:{name:"pagerPrevious",type:"getMoreResults",metaMap:{pagerNumber:1}},pagerScrolling:{name:"pagerScrolling",type:"getMoreResults"},searchFromLink:{name:"searchFromLink",type:"interface"}}}(t=e.Ui||(e.Ui={}))}(Coveo||(Coveo={}));var Coveo;!function(e){var t;!function(t){var i=function(){function t(){this.isContextual=!1}return t.prototype.isActivated=function(){return!1},t.prototype.getCurrentEventCause=function(){return null},t.prototype.getCurrentEventMeta=function(){return{}},t.prototype.logSearchEvent=function(){},t.prototype.logSearchAsYouType=function(){},t.prototype.logClickEvent=function(){},t.prototype.logCustomEvent=function(){},t.prototype.getTopQueries=function(){var t=e.$.Deferred();return t.resolve([]),t},t.prototype.sendAllPendingEvents=function(){},t}();t.NoopAnalyticsClient=i}(t=e.Ui||(e.Ui={}))}(Coveo||(Coveo={}));var __extends=this.__extends||function(e,t){function i(){this.constructor=e}for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n]);i.prototype=t.prototype,e.prototype=new i},Coveo;!function(e){var t;!function(t){var i=function(t){function i(i,n,o,s){t.call(this,i,n,s),this.eventNameSpace=n,this.defaultAttributes=e.$.extend(!0,{},this.defaultAttributes,o),this.attributes=o,this.logger.debug("Creating model")}return __extends(i,t),i.prototype.set=function(e,t,i){var n={};n[e]=t,this.setMultiple(n,i)},i.prototype.setMultiple=function(t,i){var n=this,o=!1;this.preprocessEvent(t),e._.each(t,function(e,t){i&&i.customAttribute||n.checkIfAttributeExists(t),e=n.parseToCorrectType(t,e),(!i||i.validateType)&&n.validateType(t,e),n.checkIfAttributeChanged(t,e)&&(n.attributes[t]=e,o=!0,null!=i&&i.silent||n.attributeHasChangedEvent(t))}),!o||null!=i&&i.silent||(this.attributesHasChangedEvent(),this.anyEvent())},i.prototype.setNewDefault=function(e,t,i){i&&i.customAttribute||this.checkIfAttributeExists(e),this.defaultAttributes[e]=t},i.prototype.setDefault=function(e){this.set(e,this.defaultAttributes[e])},i.prototype.get=function(e){return void 0==e?this.attributes:this.attributes[e]},i.prototype.getDefault=function(e){return void 0==e?this.defaultAttributes:this.defaultAttributes[e]},i.prototype.reset=function(){this.setMultiple(this.defaultAttributes),this.modelWasResetEvent()},i.prototype.registerNewAttribute=function(e,t){this.defaultAttributes[e]=t,this.attributes[e]=t},i.prototype.getEventName=function(e){return this.eventNameSpace+":"+e},i.prototype.attributesHasChangedEvent=function(){e.$(this.element).trigger(this.getEventName(i.eventTypes.change),this.createAttributesChangedArgument())},i.prototype.attributeHasChangedEvent=function(t){e.$(this.element).trigger(this.getEventName(i.eventTypes.changeOne)+t,this.createAttributeChangedArgument(t))},i.prototype.preprocessEvent=function(t){e.$(this.element).trigger(this.getEventName(i.eventTypes.preprocess),t)},i.prototype.modelWasResetEvent=function(){e.$(this.element).trigger(this.getEventName(i.eventTypes.reset),this.createModelChangedArgument())
},i.prototype.anyEvent=function(){e.$(this.element).trigger(this.getEventName(i.eventTypes.all),this.createModelChangedArgument())},i.prototype.createAttributeChangedArgument=function(e){return{attribute:e,value:this.attributes[e]}},i.prototype.createAttributesChangedArgument=function(){return{attributes:this.attributes}},i.prototype.createModelChangedArgument=function(){return{model:this}},i.prototype.checkIfAttributeExists=function(t){e.Assert.check(e._.has(this.attributes,t))},i.prototype.validateType=function(t,i){e.Utils.isNullOrUndefined(this.attributes[t])||e.Utils.isUndefined(i)||(e._.isNumber(this.attributes[t])?e.Assert.check(e._.isNumber(i)&&!isNaN(i),"Non-matching type"):e._.isBoolean(this.attributes[t])?e.Assert.check(e._.isBoolean(i)||void 0!==e.Utils.parseBooleanIfNotUndefined(i),"Non-matching type"):e.Utils.isNullOrUndefined(this.defaultAttributes[t])||e.Assert.check(typeof i==typeof this.defaultAttributes[t],"Non-matching type"))},i.prototype.parseToCorrectType=function(t,i){return e._.isNumber(this.attributes[t])?parseInt(i,10):e._.isBoolean(this.attributes[t])?e._.isBoolean(i)?i:e.Utils.parseBooleanIfNotUndefined(i):i},i.prototype.checkIfAttributeChanged=function(t,i){var n=this.attributes[t];return e._.isNumber(n)||e._.isString(n)||e._.isBoolean(n)?n!==i:e._.isArray(n)?!e.Utils.arrayEqual(n,i):e._.isObject(n)?!e.Utils.objectEqual(n,i):!0},i.eventTypes={preprocess:"preprocess",changeOne:"change:",change:"change",reset:"reset",all:"all"},i}(e.Ui.Component);t.Model=i}(t=e.Models||(e.Models={}))}(Coveo||(Coveo={}));var Coveo;!function(e){var t;!function(t){var i=function(t){function i(n,o,s){var r=e._.extend({},i.defaultAttributes,o);t.call(this,n,i.ID,r,s)}return __extends(i,t),i.getFacetId=function(e,t){return void 0===t&&(t=!0),"f:"+e+(t?"":":not")},i.getFacetOperator=function(e){return"f:"+e+":operator"},i.getFacetLookupValue=function(e){return i.getFacetId(e)+":lookupvalues"},i.prototype.set=function(e,i,n){this.validate(e,i),t.prototype.set.call(this,e,i,n)},i.prototype.validate=function(t,n){t==i.attributesEnum.first&&e.Assert.isLargerOrEqualsThan(0,n)},i.prototype.getAttributes=function(){var t=this,i={};return e._.each(this.queryStateModel.attributes,function(n,o){e._.isObject(n)?e.Utils.objectEqual(n,t.queryStateModel.defaultAttributes[o])||(i[o]=n):n!=t.queryStateModel.defaultAttributes[o]&&(i[o]=n)}),i},i.ID="state",i.defaultAttributes={q:"",first:0,t:"",hd:"",hq:"",sort:"",tg:""},i.attributesEnum={q:"q",first:"first",t:"t",sort:"sort",hd:"hd",hq:"hq",tg:"tg"},i}(t.Model);t.QueryStateModel=i,e.Ui.CoveoJQuery.registerNamedMethod("state",function(t){for(var n=[],o=1;o<arguments.length;o++)n[o-1]=arguments[o];e.Assert.exists(t);var s=e.Ui.Component.resolveBinding(t,i);if(e.Assert.exists(s),0==n.length)return s;if(1==n.length&&e.Utils.isNonEmptyString(n[0]))return s.get(n[0]);if(e._.isObject(n[0])){var r=n[0],a=e.$.extend({customAttribute:!0},n[1]);return s.setMultiple(r,a)}if(n.length>1){var l=n[0],u=n[1],a=e.$.extend({customAttribute:!0},n[2]);return e.Assert.isNonEmptyString(l),s.set(l,u,a)}})}(t=e.Models||(e.Models={}))}(Coveo||(Coveo={}));var Coveo;!function(e){var t;!function(e){var t=function(e){function t(i){e.call(this,i,t.ID,{})}return __extends(t,e),t.prototype.registerComponent=function(e,t){var i=this.attributes[e];void 0==i?this.attributes[e]=[t]:this.attributes[e].push(t)},t.ID="ComponentState",t}(e.Model);e.ComponentStateModel=t}(t=e.Models||(e.Models={}))}(Coveo||(Coveo={}));var Coveo;!function(e){var t;!function(t){var i=function(t){function i(n,o){var s=e._.extend({},i.defaultAttributes,o);t.call(this,n,i.ID,s)}return __extends(i,t),i.ID="ComponentOptions",i.defaultAttributes={resultLink:void 0},i.attributesEnum={resultLink:"resultLink"},i}(t.Model);t.ComponentOptionsModel=i}(t=e.Models||(e.Models={}))}(Coveo||(Coveo={}));var Coveo;!function(e){var t;!function(t){var i=function(t){function i(n,o,s,r){var a=this;t.call(this,n,i.ID),this._window=o,this.queryStateModel=s,this.queryController=r,this.ignoreNextHashChange=!1,this.initialHashChange=!1,this.willUpdateHash=!1,this._window=this._window||window,this.queryStateModel=s||this.resolveQueryStateModel(),this.queryController=r||this.resolveQueryController(),e.Assert.exists(this.queryStateModel),e.Assert.exists(this.queryController),e.$(this.element).on(e.Events.InitializationEvents.restoreHistoryState,function(){return a.updateModelFromHash()}),e.$(this.element).on(this.queryStateModel.getEventName(e.Models.Model.eventTypes.all),function(){return a.updateHashFromModel()}),e.$(this._window).on("hashchange",e.$.proxy(this.handleHashChange,this))}return __extends(i,t),i.prototype.handleHashChange=function(){return this.ignoreNextHashChange?(this.ignoreNextHashChange=!1,void 0):(this.updateModelFromHash(),this.queryController.executeQuery(),void 0)},i.prototype.updateHashFromModel=function(){var t=this;this.willUpdateHash||(e.Defer.defer(function(){var e=t.queryStateModel.getAttributes();t.setHashValues(e),t.logger.debug("Saving state to hash",e),t.willUpdateHash=!1}),this.willUpdateHash=!0)},i.prototype.updateModelFromHash=function(){var t=this,i={};e._.each(this.queryStateModel.attributes,function(e,n){var o=t.getHashValue(n);void 0==o&&(o=t.queryStateModel.defaultAttributes[n]),i[n]=o}),this.initialHashChange=!0,this.queryStateModel.setMultiple(i)},i.prototype.getHashValue=function(t){return e.Assert.isNonEmptyString(t),e.HashUtils.getValue(t,e.HashUtils.getHash(this._window))},i.prototype.setHashValues=function(t){var i="#"+e.HashUtils.encodeValues(t);this.ignoreNextHashChange=this._window.location.hash!=i,this.ignoreNextHashChange&&(this.initialHashChange?(this.initialHashChange=!1,this._window.location.replace(i)):this._window.location.hash=i)},i.ID="HistoryController",i}(e.Ui.Component);t.HistoryController=i}(t=e.Controllers||(e.Controllers={}))}(Coveo||(Coveo={}));var Coveo;!function(e){var t;!function(t){var i=function(){function e(){this.searchAsYouType=!1}return e}(),n=function(t){function n(i,o){t.call(this,i,n.ID),this.options=o,this.showingExecutingQueryAnimation=!1,e.Assert.exists(i),e.Assert.exists(o),this.firstQuery=!0}return __extends(n,t),n.prototype.setEndpoint=function(e){this.overrideEndpoint=e,this.logger.debug("Endpoint set",e)},n.prototype.getEndpoint=function(){var t=this.overrideEndpoint||this.options.endpoint;return new e.Rest.SearchEndpointWithDefaultCallOptions(t,this.getCallOptions())},n.prototype.executeQuery=function(t){var n=this;e.ModalBox.close(!0),this.logger.debug("Executing new query",l);var t=e._.extend(new i,t);if(this.cancelAnyCurrentPendingQuery(),null!=t.beforeExecuteQuery&&t.beforeExecuteQuery(),this.isStandaloneSearchBox()&&!t.searchAsYouType)return this.redirectToSearchPage(),e.$.Deferred();this.showExecutingQueryAnimation();var o=e.$.Deferred();if(this.currentPendingQuery=o,this.firstQuery){var s=e.HashUtils.getValue("firstQueryCause",e.HashUtils.getHash());if(null!=s){var r=e.HashUtils.getValue("firstQueryMeta",e.HashUtils.getHash())||{};this.usageAnalytics.logSearchEvent(e.Ui.AnalyticsActionCauseList[s],r)}else e.Utils.isNonEmptyString(this.getBindings().queryStateModel.get("q"))?this.usageAnalytics.logSearchEvent(e.Ui.AnalyticsActionCauseList.searchFromLink,{}):this.usageAnalytics.logSearchEvent(e.Ui.AnalyticsActionCauseList.interfaceLoad,{})}e.$(this.element).trigger(e.Events.QueryEvents.newQuery,{deferred:o});var a=this.createQueryBuilder(t),l=a.build(),u=this.getEndpoint(),c=u.search(l);c.done(function(i){if(e.Assert.exists(i),n.firstQuery&&(n.firstQuery=!1),o===n.currentPendingQuery){n.logger.debug("Query results received",l,i),n.lastSearchUid=i.searchUid,e.QueryUtils.setIndexAndUidOnQueryResults(l,i,n.lastSearchUid),e.QueryUtils.setStateObjectOnQueryResults(n.queryStateModel.get(),i),e.QueryUtils.setTermsToHighlightOnQueryResults(l,i);var s={queryBuilder:a,query:l,results:i,searchAsYouType:t.searchAsYouType};n.preprocessResultsEvent(s);var r={queryBuilder:a,query:l,results:i,searchAsYouType:t.searchAsYouType,retryTheQuery:!1};if(0==i.results.length&&n.noResultEvent(r),r.retryTheQuery)n.executeQuery().done(function(e){o.resolve(e)}).fail(function(e,t){o.reject(e,t)});else{n.lastQueryBuilder=a,n.currentPendingQuery.resolve(i),n.currentPendingQuery=void 0;var u={queryBuilder:a,query:l,results:i,searchAsYouType:t.searchAsYouType};n.querySuccessEvent(u),e.Defer.defer(function(){n.deferredQuerySuccessEvent(u),n.hideExecutingQueryAnimation()})}}}),c.fail(function(e,i){if(o===n.currentPendingQuery){n.logger.error("Query triggered an error",l,i),n.currentPendingQuery.reject(i),n.currentPendingQuery=void 0;var s={queryBuilder:a,endpoint:u,query:l,error:i,searchAsYouType:t.searchAsYouType};n.queryError(s),n.hideExecutingQueryAnimation()}});var p={queryBuilder:a,query:l,deferred:o,searchAsYouType:t.searchAsYouType};return this.duringQueryEvent(p),o},n.prototype.deferExecuteQuery=function(t){var i=this;this.showExecutingQueryAnimation(),e.Defer.defer(function(){return i.executeQuery(t)})},n.prototype.fetchMore=function(t){var i=this;if(void 0!=this.currentPendingQuery)return void 0;var n=this.currentPendingQuery=e.$.Deferred(),o=new e.Ui.QueryBuilder;this.continueLastQueryBuilder(o,t);var s=o.build();n=this.getEndpoint().search(s);var r={queryBuilder:o,query:s,deferred:n,searchAsYouType:!1};return e.$(this.element).trigger(e.Events.QueryEvents.duringFetchMoreQuery,r),this.lastQueryBuilder=o,n.done(function(t){e.QueryUtils.setIndexAndUidOnQueryResults(s,t,i.lastSearchUid),e.QueryUtils.setStateObjectOnQueryResults(i.queryStateModel.get(),t),e.QueryUtils.setTermsToHighlightOnQueryResults(s,t),i.currentPendingQuery=void 0}),n},n.prototype.isStandaloneSearchBox=function(){return e.Utils.isNonEmptyString(this.options.searchPageUri)},n.prototype.continueLastQueryBuilder=function(t,i){e.$.extend(t,this.lastQueryBuilder),t.firstResult=t.firstResult+t.numberOfResults,t.numberOfResults=i},n.prototype.createQueryBuilder=function(t){e.Assert.exists(t);var i=new e.Ui.QueryBuilder;i.firstResult=i.firstResult||0,i.numberOfResults=this.options.resultsPerPage,i.filterField=this.options.filterField,i.excerptLength=this.options.excerptLength,e.Utils.isNonEmptyString(this.options.hiddenExpression)&&i.advancedExpression.add(this.options.hiddenExpression),e.Utils.isNonEmptyString(this.options.timezone)&&(i.timezone=this.options.timezone);var n={queryBuilder:i,searchAsYouType:t.searchAsYouType};this.buildingQueryEvent(n);var o={queryBuilder:i,searchAsYouType:t.searchAsYouType};return this.doneBuildingQueryEvent(o),i},n.prototype.cancelAnyCurrentPendingQuery=function(){return e.Utils.exists(this.currentPendingQuery)?(this.logger.debug("Cancelling current pending query"),this.currentPendingQuery.reject(),this.currentPendingQuery=void 0,!0):!1},n.prototype.showExecutingQueryAnimation=function(){this.showingExecutingQueryAnimation||(e.$(this.root).addClass("coveo-executing-query"),this.showingExecutingQueryAnimation=!0)},n.prototype.hideExecutingQueryAnimation=function(){this.showingExecutingQueryAnimation&&(e.$(this.root).removeClass("coveo-executing-query"),this.showingExecutingQueryAnimation=!1)},n.prototype.redirectToSearchPage=function(){var t=this.queryStateModel.getAttributes(),i=this.usageAnalytics.getCurrentEventCause();null!=i&&(t.firstQueryCause=i);var n=this.usageAnalytics.getCurrentEventMeta();null!=n&&(t.firstQueryMeta=n),window.location.href=this.options.searchPageUri+"#"+e.HashUtils.encodeValues(t)},n.prototype.getCallOptions=function(){var t={options:{authentication:[]}};return e.$(this.element).trigger(e.Events.QueryEvents.buildingCallOptions,t),t.options},n.prototype.buildingQueryEvent=function(t){e.$(this.element).trigger(e.Events.QueryEvents.buildingQuery,t)},n.prototype.doneBuildingQueryEvent=function(t){e.$(this.element).trigger(e.Events.QueryEvents.doneBuildingQuery,t)},n.prototype.duringQueryEvent=function(t){e.$(this.element).trigger(e.Events.QueryEvents.duringQuery,t)},n.prototype.querySuccessEvent=function(t){e.$(this.element).trigger(e.Events.QueryEvents.querySuccess,t)},n.prototype.deferredQuerySuccessEvent=function(t){e.$(this.element).trigger(e.Events.QueryEvents.deferredQuerySuccess,t)},n.prototype.queryError=function(t){e.$(this.element).trigger(e.Events.QueryEvents.queryError,t)},n.prototype.preprocessResultsEvent=function(t){e.$(this.element).trigger(e.Events.QueryEvents.preprocessResults,t)},n.prototype.noResultEvent=function(t){e.$(this.element).trigger(e.Events.QueryEvents.noResults,t)},n.ID="QueryController",n}(e.Ui.Component);t.QueryController=n,e.Ui.CoveoJQuery.registerNamedMethod("executeQuery",function(t){e.Assert.exists(t);var i=e.Ui.Component.resolveBinding(t,n);e.Assert.exists(i),i.executeQuery()})}(t=e.Controllers||(e.Controllers={}))}(Coveo||(Coveo={}));var Coveo;!function(e){var t;!function(e){var t=function(){function e(){}return e.newQuery="newQuery",e.buildingQuery="buildingQuery",e.doneBuildingQuery="doneBuildingQuery",e.duringQuery="duringQuery",e.duringFetchMoreQuery="duringFetchMoreQuery",e.querySuccess="querySuccess",e.deferredQuerySuccess="deferredQuerySuccess",e.queryError="queryError",e.preprocessResults="preprocessResults",e.noResults="noResults",e.buildingCallOptions="buildingCallOptions",e}();e.QueryEvents=t}(t=e.Events||(e.Events={}))}(Coveo||(Coveo={}));var Coveo;!function(e){var t;!function(e){var t=function(){function e(){}return e.beforeInitialization="beforeInitialization",e.afterComponentsInitialization="afterComponentsInitialization",e.restoreHistoryState="restoreHistoryState",e.afterInitialization="afterInitialization",e}();e.InitializationEvents=t}(t=e.Events||(e.Events={}))}(Coveo||(Coveo={}));var Coveo;!function(e){var t;!function(e){var t=function(){function e(){}return e.newResultsDisplayed="newResultsDisplayed",e.newResultDisplayed="newResultDisplayed",e}();e.ResultListEvents=t}(t=e.Events||(e.Events={}))}(Coveo||(Coveo={}));var Coveo;!function(e){var t;!function(e){var t=function(){function e(){}return e.imageResultsLayoutComplete="imageResultsLayoutComplete",e}();e.ImageResultListEvents=t}(t=e.Events||(e.Events={}))}(Coveo||(Coveo={}));var Coveo;!function(e){var t;!function(e){var t=function(){function e(){}return e.enterOnSearchBox="enterOnSearchBox",e.quickViewLoaded="quickViewLoaded",e}();e.UserActionEvents=t}(t=e.Events||(e.Events={}))}(Coveo||(Coveo={}));var Coveo;!function(e){var t;!function(e){var t=function(){function e(){}return e.savePreferences="savePreferences",e.exitPreferencesWithoutSave="exitPreferencesWithoutSave",e}();e.PreferencesPanelEvents=t}(t=e.Events||(e.Events={}))}(Coveo||(Coveo={}));var Coveo;!function(e){var t;!function(t){var i=function(i){function n(o,s,r,a){var l=this;void 0===a&&(a=window),i.call(this,o,n.ID),this.element=o,this.options=s,this.analyticsOptions=r,this.options=t.ComponentOptions.initComponentOptions(o,n,s),e.Assert.exists(o),e.Assert.exists(this.options),this.options.hideUntilFirstQuery&&this.showAndHideFirstQueryAnimation(),this.root=o,this.usageAnalytics=this.initializeAnalytics(),this.queryStateModel=new e.Models.QueryStateModel(o),this.componentStateModel=new e.Models.ComponentStateModel(o),this.componentOptionsModel=new e.Models.ComponentOptionsModel(o),this.queryController=new e.Controllers.QueryController(o,this.options),this.searchInterface=this;var u=this.queryStateModel.getEventName(e.Models.Model.eventTypes.preprocess);if(e.$(this.element).on(u,function(e,t){return l.handlePreprocessQueryStateModel(t)}),this.options.enableHistory?new e.Controllers.HistoryController(o,a,this.queryStateModel,this.queryController):e.$(this.element).on(e.Events.InitializationEvents.restoreHistoryState,function(){return l.queryStateModel.setMultiple(l.queryStateModel.defaultAttributes)}),this.options.enableDebugInfo){var c=t.Component.getComponentRef("Debug");c?setTimeout(function(){return new c(o)}):this.logger.warn("Options to enable debug component was true, but not present in the Coveo object (not compiled)")}}return __extends(n,i),n.prototype.initializeAnalytics=function(){var e=t.Component.getComponentRef("Analytics");return e?e.makeSingleton(this.element,this.analyticsOptions,this.getBindings()):new t.NoopAnalyticsClient},n.prototype.showAndHideFirstQueryAnimation=function(){var t=this;this.displayFirstQueryWaitAnimation(),e.$(this.element).one(e.Events.QueryEvents.querySuccess,function(){e._.defer(function(){return t.hideFirstQueryWaitAnimation()})}),e.$(this.element).on(e.Events.QueryEvents.queryError,function(){e._.defer(function(){return t.hideFirstQueryWaitAnimation()})})},n.prototype.displayFirstQueryWaitAnimation=function(){e.$(this.options.firstLoadingAnimation).remove(),e.$(this.element).addClass("coveo-waiting-for-first-query"),e.$(this.element).append(this.options.firstLoadingAnimation)},n.prototype.hideFirstQueryWaitAnimation=function(){e.$(this.options.firstLoadingAnimation).remove(),e.$(this.element).removeClass("coveo-waiting-for-first-query")},n.prototype.handlePreprocessQueryStateModel=function(t){var i=this.queryStateModel.get(e.Models.QueryStateModel.attributesEnum.tg),n=this.queryStateModel.get(e.Models.QueryStateModel.attributesEnum.t),o=i,s=n;void 0!==t.tg&&(t.tg=this.getTabGroupId(t.tg),o!=t.tg&&(t.t=t.t||e.Models.QueryStateModel.defaultAttributes.t,t.sort=t.sort||e.Models.QueryStateModel.defaultAttributes.sort,o=t.tg)),void 0!==t.t&&(t.t=this.getTabId(o,t.t),s!=t.t&&(t.sort=t.sort||e.Models.QueryStateModel.defaultAttributes.sort,s=t.t)),void 0!==t.sort&&(t.sort=this.getSort(s,t.sort))},n.prototype.getTabGroupId=function(i){var n=t.Component.getComponentRef("TabGroup");if(n){var o=this.searchInterface.components(n.ID);if(i!=e.Models.QueryStateModel.defaultAttributes.tg&&e._.any(o,function(e){return!e.disabled&&i==e.options.id}))return i;if(o.length>0)return o[0].options.id}return e.Models.QueryStateModel.defaultAttributes.tg},n.prototype.getTabId=function(i,n){var o=t.Component.getComponentRef("Tab"),s=t.Component.getComponentRef("TabGroup");if(o){var r=this.searchInterface.components(o.ID);if(s&&i!=e.Models.QueryStateModel.defaultAttributes.tg){var a=this.searchInterface.components(s.ID),l=e._.find(a,function(e){return i==e.options.id});if(n!=e.Models.QueryStateModel.defaultAttributes.t&&e._.any(r,function(e){return n==e.options.uniqueId&&l.isElementIncludedInTabGroup(e.element)}))return n;var u=e._.find(r,function(e){return l.isElementIncludedInTabGroup(e.element)});return null!=u?u.options.uniqueId:e.Models.QueryStateModel.defaultAttributes.t}if(n!=e.Models.QueryStateModel.defaultAttributes.t&&e._.any(r,function(e){return n==e.options.uniqueId}))return n;if(r.length>0)return r[0].options.uniqueId}return e.Models.QueryStateModel.defaultAttributes.t},n.prototype.getSort=function(i,n){var o=t.Component.getComponentRef("Sort");if(o){var s=this.searchInterface.components(o.ID),r=t.Component.getComponentRef("Tab");if(r&&i!=e.Models.QueryStateModel.defaultAttributes.t){var a=this.searchInterface.components(r.ID),l=e._.find(a,function(e){return i==e.options.uniqueId}),u=l.options.sort;if(n!=e.Models.QueryStateModel.defaultAttributes.sort&&e._.any(s,function(e){return l.isElementIncludedInTab(e.element)&&e.match(n)}))return n;if(null!=u)return u.toString();var c=e._.find(s,function(e){return l.isElementIncludedInTab(e.element)});return null!=c?c.options.sortCriteria[0].toString():e.Models.QueryStateModel.defaultAttributes.sort}if(n!=e.Models.QueryStateModel.defaultAttributes.sort&&e._.any(s,function(e){return e.match(n)}))return n;if(s.length>0)return s[0].options.sortCriteria[0].toString()}return e.Models.QueryStateModel.defaultAttributes.sort},n.prototype.attachComponent=function(e,t){this.components(e).push(t)},n.prototype.detachComponent=function(t,i){var n=this.components(t),o=e._.indexOf(n,i);o>-1&&n.splice(o,1)},n.prototype.components=function(e){return null==this.attachedComponents&&(this.attachedComponents={}),e in this.attachedComponents||(this.attachedComponents[e]=[]),this.attachedComponents[e]},n.ID="SearchInterface",n.options={searchPageUri:t.ComponentOptions.buildStringOption(),enableHistory:t.ComponentOptions.buildBooleanOption({defaultValue:!1}),resultsPerPage:t.ComponentOptions.buildNumberOption({defaultValue:10}),excerptLength:t.ComponentOptions.buildNumberOption({defaultValue:200}),hiddenExpression:t.ComponentOptions.buildStringOption({defaultValue:""}),filterField:t.ComponentOptions.buildStringOption({defaultValue:""}),hideUntilFirstQuery:t.ComponentOptions.buildBooleanOption({defaultValue:!0}),firstLoadingAnimation:t.ComponentOptions.buildChildHtmlElementOption({childSelector:".coveo-first-loading-animation",defaultFunction:function(){return e.JQueryUtils.getBasicLoadingAnimation().get(0)}}),autoTriggerQuery:t.ComponentOptions.buildBooleanOption({defaultValue:!0}),endpoint:t.ComponentOptions.buildCustomOption(function(t){return null!=t&&t in e.Rest.SearchEndpoint.endpoints?e.Rest.SearchEndpoint.endpoints[t]:null},{defaultFunction:function(){return e.Rest.SearchEndpoint.endpoints["default"]}}),timezone:t.ComponentOptions.buildStringOption({defaultFunction:function(){return jstz.determine().name()}}),enableDebugInfo:t.ComponentOptions.buildBooleanOption({defaultValue:!0})},n}(t.Component);t.SearchInterface=i}(t=e.Ui||(e.Ui={}))}(Coveo||(Coveo={}));var Coveo;!function(e){var t;!function(t){var i=function(i){function n(o,s,r){i.call(this,o,n.ID,r),this.element=o,this.options=s,this.options=t.ComponentOptions.initComponentOptions(o,n,s),this.bind.onRoot(e.Events.QueryEvents.buildingQuery,this.handleBuildingQuery),this.bind.onRoot(e.Events.QueryEvents.querySuccess,this.handleQuerySuccess),e.$(this.element).hide()}return __extends(n,i),n.prototype.handleBuildingQuery=function(e,t){var i={field:this.options.field,maximumNumberOfValues:0,computedFields:[{field:this.options.field,operation:this.options.operation}]};this.index=t.queryBuilder.groupByRequests.length,t.queryBuilder.groupByRequests.push(i)},n.prototype.handleQuerySuccess=function(t,i){if(e._.isNumber(this.index)&&0!=i.results.groupByResults.length){var n=i.results.groupByResults[this.index],o=n.globalComputedFieldResults[0];e.$(this.element).text(Globalize.format(o,this.options.format)),e.$(this.element).show()}else e.$(this.element).hide()},n.ID="Aggregate",n.options={field:t.ComponentOptions.buildStringOption(),operation:t.ComponentOptions.buildStringOption({defaultValue:"sum"}),format:t.ComponentOptions.buildStringOption({defaultValue:"c0"})},n}(t.Component);t.Aggregate=i,t.CoveoJQuery.registerAutoCreateComponent(i)}(t=e.Ui||(e.Ui={}))}(Coveo||(Coveo={}));var Coveo;!function(e){var t;!function(t){var i=function(){function t(t){this.options=t,this.logger=new e.Logger(this)}return t.prototype.sendSearchEvents=function(e){e.length>0&&(this.logger.info("Logging analytics search events",e),this.sendEventToApi(e,"searches","searchEvents"))},t.prototype.sendDocumentViewEvent=function(t){e.Assert.exists(t),this.logger.info("Logging analytics document view",t),this.sendEventToApi(t,"click","clickEvent")},t.prototype.sendCustomEvent=function(t){e.Assert.exists(t),this.logger.info("Logging analytics custom event",t),this.sendEventToApi(t,"custom","customEvent")},t.prototype.getTopQueries=function(i){var n=e.QueryUtils.mergePath(this.options.serviceUrl,"/rest/"+(t.CUSTOM_ANALYTICS_VERSION||t.DEFAULT_ANALYTICS_VERSION)+"/stats/topQueries");return this.getFromService(n,i)},t.prototype.sendEventToApi=function(i,n,o){var s=e.QueryUtils.mergePath(this.options.serviceUrl,"/rest/"+(t.CUSTOM_ANALYTICS_VERSION||t.DEFAULT_ANALYTICS_VERSION)+"/analytics/"+n);return s=this.appendUrlParamSign(s),s+=o+"="+encodeURIComponent(JSON.stringify(i)),this.options.token&&""!=this.options.token&&(s+="&access_token="+encodeURIComponent(this.options.token)),e.Utils.isNonEmptyString(this.options.userId)&&(s+="&user="+encodeURIComponent(this.options.userId)),e.$.ajax({url:s,dataType:"jsonp"})},t.prototype.appendUrlParamSign=function(e){return"?"==e.charAt(e.length-1)?e:e+"?"},t.prototype.getFromService=function(t,i){var n=this.options.token&&""!=this.options.token?e.$.extend({access_token:this.options.token},i):i;return e.$.ajax({url:this.appendUrlParamSign(t)+this.buildQueryStringFromParam(n),dataType:"jsonp"})},t.prototype.buildQueryStringFromParam=function(t){var i=e._.map(e._.pairs(t),function(e){return e[0]+"="+e[1]});return i.join("&")},t.DEFAULT_ANALYTICS_URI="https://usageanalytics.coveo.com",t.DEFAULT_ANALYTICS_VERSION="v10",t.CUSTOM_ANALYTICS_VERSION=void 0,t}();t.AnalyticsEndpoint=i}(t=e.Rest||(e.Rest={}))}(Coveo||(Coveo={}));var Coveo;!function(e){var t;!function(t){var i=function(){function i(t,i,n,o){this._root=t,this._endpoint=i,this._templateSearchEvent=n,this._sendToCloud=o,this.searchDeferred=[],this.searchEvents=[],this.results=[],this._cancelled=!1,this._finished=!1,e.Assert.exists(t),e.Assert.exists(i),e.Assert.exists(n),this.handler=e.$.proxy(this._handleDuringQuery,this),e.$(t).on(e.Events.QueryEvents.duringQuery+" "+e.Events.QueryEvents.duringFetchMoreQuery,this.handler)}return i.prototype.getEventCause=function(){return this._templateSearchEvent.actionCause},i.prototype.getEventMeta=function(){return this._templateSearchEvent.customData},i.prototype.cancel=function(){this._stopRecording(),this._cancelled=!0},i.prototype._handleDuringQuery=function(i,n){var o=this;e.Assert.check(!this._finished),e.Assert.check(!this._cancelled),this.searchDeferred.push(n.deferred);var s=t.Component.get(i.target,t.SearchInterface);e.Assert.exists(s);var r=t.Component.get(i.target,e.Controllers.QueryController);e.Assert.exists(r),n.deferred.done(function(t){e.Assert.exists(t),e.Assert.check(!o._finished);var i=e._.extend({},o._templateSearchEvent);o.fillSearchEvent(i,s,n.query,t),o.searchEvents.push(i),o.results.push(t)}).always(function(){var t=e._.indexOf(o.searchDeferred,n.deferred);o.searchDeferred.splice(t,1),0==o.searchDeferred.length&&o.flush()})},i.prototype._stopRecording=function(){this.handler&&(e.$(this._root).off(e.Events.QueryEvents.duringQuery+" "+e.Events.QueryEvents.duringFetchMoreQuery,this.handler),this.handler=void 0)},i.prototype.flush=function(){var t=this;this._cancelled||(this._stopRecording(),this._finished=!0,e.Assert.check(this.searchEvents.length==this.results.length),e.Defer.defer(function(){t._sendToCloud&&t._endpoint.sendSearchEvents(t.searchEvents);var i=e._.map(t.searchEvents,function(t){return e.Rest.APIAnalyticsBuilder.convertSearchEventToAPI(t)});e.$(t._root).trigger(e.Events.AnalyticsEvents.searchEvent,{searchEvents:i})}))},i.prototype.fillSearchEvent=function(t,i,n,o){e.Assert.exists(t),e.Assert.exists(i),e.Assert.exists(n),e.Assert.exists(o);var s=i.queryStateModel.get(e.Models.QueryStateModel.attributesEnum.q);t.originLevel2=t.originLevel2||i.queryStateModel.get("t")||"default",t.queryText=s||n.q||"",t.advancedQuery=n.aq||"",t.didYouMean=n.enableDidYouMean,t.results=this.convertResults(o),t.responseTime=o.duration,t.pageNumber=n.firstResult/n.numberOfResults,t.resultsPerPage=n.numberOfResults,t.facets=this.convertFacets(),t.searchQueryUid=o.searchUid},i.prototype.convertResults=function(t){e.Assert.exists(t);var i=[];return e.$.each(t.results,function(e,t){i.push({clickUri:t.clickUri,documentUri:t.uri,documentUriHash:t.raw.sysurihash})}),i},i.prototype.convertFacets=function(){var i=this,n=[],o=t.Component.getComponentRef("Facet");return o&&e.$.each(e.$(this.getFacetSelector(o)),function(t,o){var o=e.$(o).coveo();o.disabled||n.push({fieldName:o.options.field,mode:o.options.useAnd?"and":"or",name:o.options.title,sort:o.options.sortCriteria,selections:i.convertFacetValues(o)})}),n},i.prototype.getFacetSelector=function(e){return["."+t.Component.computeCssClassNameForType(e.ID),"."+t.Component.computeCssClassNameForType(e.ID)].join(", ")},i.prototype.convertFacetValues=function(t){return e.Assert.exists(t),this.convertClassicFacetValues(t)},i.prototype.convertClassicFacetValues=function(t){var i=[];return t.disabled||(e.$.each(t.getSelectedValues(),function(e,t){i.push({entryName:t,status:"INCLUDE"})}),e.$.each(t.getExcludedValues(),function(e,t){i.push({entryName:t,status:"EXCLUDE"})})),i},i}();t.PendingSearchEvent=i}(t=e.Ui||(e.Ui={}))}(Coveo||(Coveo={}));var Coveo;!function(e){var t;!function(t){var i=function(t){function i(i,n,o,s){t.call(this,i,n,o,s),this._root=i,this._endpoint=n,this._templateSearchEvent=o,this._sendToCloud=s,this.delayBeforeSending=5e3,this.armBatchDelay=50,this.beforeUnloadHandler=e.$.proxy(this.onWindowUnload,this),e.$(window).on("beforeunload",this.beforeUnloadHandler)}return __extends(i,t),i.prototype._handleDuringQuery=function(i,n){var o=this;this.toSendRightNow=function(){o.isCancelledOrFinished()||t.prototype._handleDuringQuery.call(o,i,n)},e._.delay(function(){o.toSendRightNow()},this.delayBeforeSending)},i.prototype.sendRightNow=function(){this.toSendRightNow&&this.toSendRightNow()},i.prototype._stopRecording=function(){t.prototype._stopRecording.call(this),this.beforeUnloadHandler&&(e.$(window).off("beforeunload",this.beforeUnloadHandler),this.beforeUnloadHandler=void 0)},i.prototype.onWindowUnload=function(){this.isCancelledOrFinished()||(this.armBatchDelay=0,this.sendRightNow())},i.prototype.isCancelledOrFinished=function(){return this._cancelled?!0:this._finished?(this.cancel(),!0):!1},i}(t.PendingSearchEvent);t.PendingSearchAsYouTypeSearchEvent=i}(t=e.Ui||(e.Ui={}))}(Coveo||(Coveo={}));var Coveo;!function(e){var t;!function(e){var t=function(){function e(){}return e.searchEvent="analyticsSearchEvent",e.documentViewEvent="analyticsDocumentViewEvent",e.customEvent="analyticsCustomEvent",e.changeAnalyticsCustomData="changeAnalyticsCustomData",e}();e.AnalyticsEvents=t}(t=e.Events||(e.Events={}))}(Coveo||(Coveo={}));var Coveo;!function(e){var t;!function(t){var i=function(){function t(){}return t.convertSearchEventToAPI=function(e){var i={advancedQuery:e.advancedQuery,customMetadatas:e.customData,device:e.device,didYouMean:e.didYouMean,facets:t.convertFacetToAPI(e.facets),language:e.language,pageNumber:e.pageNumber,queryText:e.queryText,responseTime:e.responseTime,results:t.convertResultsToAPI(e.results),resultsPerPage:e.resultsPerPage,searchHub:e.originLevel1,searchInterface:e.originLevel2,searchQueryUid:e.searchQueryUid,type:e.actionType,actionCause:e.actionCause};return i},t.convertFacetToAPI=function(i){var n=e._.map(i,function(e){return{fieldName:e.fieldName,mode:e.mode,name:e.name,selections:t.convertFacetSelectionToAPI(e.selections),sort:e.sort}});return n},t.convertFacetSelectionToAPI=function(t){var i=e._.map(t,function(e){return{entryName:e.entryName,status:e.status}});return i},t.convertResultsToAPI=function(t){var i=e._.map(t,function(e){return{clickUri:e.clickUri,documentUri:e.documentUri,documentUriHash:e.documentUriHash}});return i},t.convertDocumentViewToAPI=function(e){var t={collectionName:e.collectionName,device:e.device,documentPosition:e.documentPosition,title:e.customMetadata1,documentClickUri:e.customMetadata2,documentUri:e.documentUri,documentUriHash:e.documentUriHash,language:e.language,responseTime:e.responseTime,searchHub:e.originLevel1,searchInterface:e.originLevel2,searchQueryUid:e.searchQueryUid,sourceName:e.sourceName,viewMethod:e.viewMethod,customMetadatas:e.customData,actionCause:e.actionCause};return t},t.convertCustomEventToAPI=function(e){var t={actionCause:e.actionCause,actionType:e.actionType,device:e.device,language:e.language,responseTime:e.responseTime,searchHub:e.originLevel1,searchInterface:e.originLevel2,customMetadatas:e.customData};return t},t}();t.APIAnalyticsBuilder=i}(t=e.Rest||(e.Rest={}))}(Coveo||(Coveo={}));var Coveo;!function(e){var t;!function(t){var i=function(){function i(t,i,n,o){this.endpoint=t,this.rootElement=i,this.originLevel1=n,this.sendToCloud=o,this.isContextual=!1,this.language=String.locale,this.device=e.DeviceUtils.getDeviceName(),e.Assert.exists(t),e.Assert.exists(i),e.Assert.isNonEmptyString(this.language),e.Assert.isNonEmptyString(this.device),e.Assert.isNonEmptyString(this.originLevel1)}return i.prototype.isActivated=function(){return!0},i.prototype.getCurrentEventCause=function(){return null!=this.pendingSearchEvent?this.pendingSearchEvent.getEventCause():null!=this.pendingSearchAsYouTypeSearchEvent?this.pendingSearchAsYouTypeSearchEvent.getEventCause():null
},i.prototype.getCurrentEventMeta=function(){return null!=this.pendingSearchEvent?this.pendingSearchEvent.getEventMeta():null!=this.pendingSearchAsYouTypeSearchEvent?this.pendingSearchAsYouTypeSearchEvent.getEventMeta():null},i.prototype.logSearchEvent=function(e,t){var i=this.buildMetaObject(e,t);this.pushSearchEvent(e,i)},i.prototype.logSearchAsYouType=function(e,t){var i=this.buildMetaObject(e,t);this.pushSearchAsYouTypeEvent(e,i)},i.prototype.logClickEvent=function(e,t,i,n){var o=this.buildMetaObject(e,t);this.pushClickEvent(e,o,i,n)},i.prototype.logCustomEvent=function(e,t,i){var n=this.buildMetaObject(e,t);this.pushCustomEvent(e,n,i)},i.prototype.getTopQueries=function(e){return this.endpoint.getTopQueries(e)},i.prototype.sendAllPendingEvents=function(){this.pendingSearchAsYouTypeSearchEvent&&this.pendingSearchAsYouTypeSearchEvent.sendRightNow()},i.prototype.pushCustomEvent=function(t,i,n){var o=this,s=this.buildCustomEvent(t,i,n);this.triggerChangeAnalyticsCustomData("CustomEvent",i,s),this.checkToSendAnyPendingSearchAsYouType(t),e.Defer.defer(function(){o.sendToCloud&&o.endpoint.sendCustomEvent(s),e.$(o.rootElement).trigger(e.Events.AnalyticsEvents.customEvent,{customEvent:e.Rest.APIAnalyticsBuilder.convertCustomEventToAPI(s)})})},i.prototype.pushSearchEvent=function(i,n){var o=this;if(e.Assert.exists(i),this.pendingSearchEvent&&this.pendingSearchEvent.getEventCause()!==i.name&&(this.pendingSearchEvent._stopRecording(),this.pendingSearchEvent=null),this.checkToSendAnyPendingSearchAsYouType(i),!this.pendingSearchEvent){var s=this.buildSearchEvent(i,n);this.triggerChangeAnalyticsCustomData("SearchEvent",n,s);var r=this.pendingSearchEvent=new t.PendingSearchEvent(this.rootElement,this.endpoint,s,this.sendToCloud);e.Defer.defer(function(){o.pendingSearchEvent=void 0,r._stopRecording()})}},i.prototype.checkToSendAnyPendingSearchAsYouType=function(e){this.eventIsNotRelatedToSearchBox(e.name)?this.sendAllPendingEvents():this.cancelAnyPendingSearchAsYouTypeEvent()},i.prototype.pushSearchAsYouTypeEvent=function(e,i){this.cancelAnyPendingSearchAsYouTypeEvent();var n=this.buildSearchEvent(e,i);this.triggerChangeAnalyticsCustomData("SearchEvent",i,n),this.pendingSearchAsYouTypeSearchEvent=new t.PendingSearchAsYouTypeSearchEvent(this.rootElement,this.endpoint,n,this.sendToCloud)},i.prototype.pushClickEvent=function(t,i,n,o){var s=this,r=this.buildClickEvent(t,i,n,o);this.triggerChangeAnalyticsCustomData("ClickEvent",i,r),e.Assert.isNonEmptyString(r.searchQueryUid),e.Assert.isNonEmptyString(r.collectionName),e.Assert.isNonEmptyString(r.sourceName),e.Assert.isNumber(r.documentPosition),e.Defer.defer(function(){s.sendToCloud&&s.endpoint.sendDocumentViewEvent(r),e.$(s.rootElement).trigger(e.Events.AnalyticsEvents.documentViewEvent,{documentViewEvent:e.Rest.APIAnalyticsBuilder.convertDocumentViewToAPI(r)})})},i.prototype.buildAnalyticsEvent=function(t,i){return{actionCause:t.name,actionType:t.type,device:this.device,language:this.language,responseTime:void 0,originLevel1:this.originLevel1,originLevel2:this.resolveActiveTabFromElement(this.rootElement),customData:e._.keys(i.metaDataAsString).length>0?i.metaDataAsString:void 0,customMetadata1:i.metaDataAsNumber.customMetadata1,customMetadata2:i.metaDataAsNumber.customMetadata2,customMetadata3:i.metaDataAsNumber.customMetadata3,customMetadata4:i.metaDataAsNumber.customMetadata4,customMetadata5:i.metaDataAsNumber.customMetadata5,userAgent:navigator.userAgent}},i.prototype.buildSearchEvent=function(t,i){return this.merge(this.buildAnalyticsEvent(t,i),{mobile:e.DeviceUtils.isMobileDevice(),queryText:void 0,advancedQuery:void 0,results:void 0,resultsPerPage:void 0,searchQueryUid:void 0,pageNumber:void 0,didYouMean:void 0,facets:void 0,contextual:this.isContextual})},i.prototype.buildClickEvent=function(e,t,i,n){return this.merge(this.buildAnalyticsEvent(e,t),{searchQueryUid:i.queryUid,documentUri:i.uri,originLevel2:this.resolveActiveTabFromElement(n)||"default",documentUriHash:i.raw.sysurihash,collectionName:i.raw.syscollection,sourceName:i.raw.syssource,documentPosition:i.index,responseTime:0,viewMethod:e.name})},i.prototype.buildCustomEvent=function(e,t,i){return this.merge(this.buildAnalyticsEvent(e,t),{eventType:e.type,eventValue:e.name,originLevel2:this.resolveActiveTabFromElement(i)||"default",responseTime:0})},i.prototype.buildMetaObject=function(t,i){var n={metaDataAsNumber:{},metaDataAsString:{}};return e._.each(i,function(e,i){if(void 0!=t.metaMap&&void 0!=t.metaMap[i]){var o=t.metaMap[i];n.metaDataAsNumber["customMetadata"+o.toString()]=e}n.metaDataAsString[i]=e}),n.metaDataAsString.JSUIVersion=e.version.lib+";"+e.version.product,n},i.prototype.cancelAnyPendingSearchAsYouTypeEvent=function(){this.pendingSearchAsYouTypeSearchEvent&&(this.pendingSearchAsYouTypeSearchEvent.cancel(),this.pendingSearchAsYouTypeSearchEvent=void 0)},i.prototype.resolveActiveTabFromElement=function(t){e.Assert.exists(t);var i=this.resolveQueryStateModel(t);return i&&i.get(e.Models.QueryStateModel.attributesEnum.t)},i.prototype.resolveQueryStateModel=function(i){return t.Component.resolveBinding(i,e.Models.QueryStateModel)},i.prototype.eventIsNotRelatedToSearchBox=function(e){return e!==t.AnalyticsActionCauseList.searchboxSubmit.name&&e!==t.AnalyticsActionCauseList.searchboxClear.name},i.prototype.triggerChangeAnalyticsCustomData=function(t,i,n){var o={language:n.language,originLevel1:n.originLevel1,originLevel2:n.originLevel2,originLevel3:n.originLevel3},s=e.$.extend({},{type:t,metaObject:i},o);e.$(this.rootElement).trigger(e.Events.AnalyticsEvents.changeAnalyticsCustomData,s),n.language=s.language,n.originLevel1=s.originLevel1,n.originLevel2=s.originLevel2,n.originLevel3=s.originLevel3,n.customData=i.metaDataAsString,e._.each(e._.keys(i.metaDataAsNumber),function(e){n[e]=i.metaDataAsNumber[e]})},i.prototype.merge=function(t,i){return e.$.extend({},t,i)},i}();t.LiveAnalyticsClient=i}(t=e.Ui||(e.Ui={}))}(Coveo||(Coveo={}));var Coveo;!function(e){var t;!function(t){var i=function(){function t(e){void 0===e&&(e=[]),this.analyticsClients=e,this.isContextual=!1}return t.prototype.isActivated=function(){return e._.some(this.analyticsClients,function(e){return e.isActivated()})},t.prototype.getCurrentEventCause=function(){return e._.find(e._.map(this.analyticsClients,function(e){return e.getCurrentEventCause()}),function(e){return null!=e})},t.prototype.getCurrentEventMeta=function(){return e._.find(e._.map(this.analyticsClients,function(e){return e.getCurrentEventMeta()}),function(e){return null!=e})},t.prototype.logSearchEvent=function(t,i){e._.each(this.analyticsClients,function(e){return e.logSearchEvent(t,i)})},t.prototype.logSearchAsYouType=function(t,i){e._.each(this.analyticsClients,function(e){return e.logSearchEvent(t,i)})},t.prototype.logClickEvent=function(t,i,n,o){e._.each(this.analyticsClients,function(e){return e.logClickEvent(t,i,n,o)})},t.prototype.logCustomEvent=function(t,i,n){e._.each(this.analyticsClients,function(e){return e.logCustomEvent(t,i,n)})},t.prototype.getTopQueries=function(t){var i=this,n=e.$.Deferred(),o=[];return e._.forEach(this.analyticsClients,function(e){e.getTopQueries(t).done(function(e){o[r]=e;for(var s=!0,r=0;r<i.analyticsClients.length&&s;r++)s=s&&void 0!=o[r];s&&n.resolve(i.mergeTopQueries(o,t.pageSize))})}),n},t.prototype.sendAllPendingEvents=function(){e._.each(this.analyticsClients,function(e){return e.sendAllPendingEvents()})},t.prototype.mergeTopQueries=function(t,i){var n=[];return e._.each(t,function(t){return e._.each(t,function(e){return n.push(e)})}),n.length=Math.min(n.length,i),n},t}();t.MultiAnalyticsClient=i}(t=e.Ui||(e.Ui={}))}(Coveo||(Coveo={}));var Coveo;!function(e){var t;!function(t){var i=function(i){function n(o,s,r){if(void 0===s&&(s={}),i.call(this,o,n.ID,r),this.element=o,this.options=s,this.options=t.ComponentOptions.initComponentOptions(o,n,s),null==this.options.token){var a=e.Rest.SearchEndpoint.endpoints["default"];a&&(this.options.token=a.options.accessToken)}this.initializeAnalyticsClient(),e.Assert.exists(this.client)}return __extends(n,i),n.makeSingleton=function(i,o){if(!n.analyticsSingleton){var s=t.Component.computeSelectorForType(n.ID),r=e.$(i),a=r.find(s).add(r.closest(s));n.analyticsSingleton=1==a.length?new n(a.get(0),o).client:a.length>1?new t.MultiAnalyticsClient(e._.map(a,function(e){return new n(e,o).client})):new t.NoopAnalyticsClient}return n.analyticsSingleton},n.prototype.initializeAnalyticsClient=function(){if(e.Utils.isNonEmptyString(this.options.endpoint)){var i=new e.Rest.AnalyticsEndpoint({token:this.options.token,userId:this.options.user,serviceUrl:this.options.endpoint});this.client=new t.LiveAnalyticsClient(i,this.root||this.element,this.options.searchHub,this.options.sendToCloud)}else this.client=new t.NoopAnalyticsClient},n.ID="Analytics",n.options={user:t.ComponentOptions.buildStringOption(),token:t.ComponentOptions.buildStringOption(),endpoint:t.ComponentOptions.buildStringOption({defaultValue:e.Rest.AnalyticsEndpoint.DEFAULT_ANALYTICS_URI}),searchHub:t.ComponentOptions.buildStringOption({defaultValue:"default"}),sendToCloud:t.ComponentOptions.buildBooleanOption({defaultValue:!0})},n}(t.Component);t.Analytics=i}(t=e.Ui||(e.Ui={}))}(Coveo||(Coveo={}));var Coveo;!function(e){var t;!function(t){var i=function(i){function n(o,s,r){void 0===s&&(s={}),i.call(this,o,n.ID,r),this.element=o,this.options=s,this.options=t.ComponentOptions.initComponentOptions(o,n,s),this.bind.onRoot(e.Events.QueryEvents.buildingCallOptions,this.handleBuildingCallOptions),this.bind.onRoot(e.Events.QueryEvents.queryError,this.handleQueryError)}return __extends(n,i),n.prototype.getCssClass=function(){return"coveo-authentication-provider"},n.prototype.getMenuItems=function(){var e=this;return[{text:t.l("Reauthenticate",this.options.caption),onOpen:function(){return e.authenticateWithProvider()},onClose:function(){return 0}}]},n.prototype.handleBuildingCallOptions=function(e,t){t.options.authentication.push(this.options.name)},n.prototype.handleQueryError=function(e,t){t.error.provider==this.options.name&&this.authenticateWithProvider()},n.prototype.authenticateWithProvider=function(){this.options.useIFrame?this.useIFrameToAuthenticate():this.redirectToAuthenticationProvider()},n.prototype.redirectToAuthenticationProvider=function(){this.logger.info("Redirecting to authentication provider "+this.options.name),window.location.href=this.getAuthenticationProviderUriForRedirect()},n.prototype.useIFrameToAuthenticate=function(){var t=this;this.logger.info("Using iframe to retrieve authentication for provider "+this.options.name);var i,n=e.$("<iframe/>").attr("src",this.getAuthenticationProviderUriForIFrame());i=this.options.showIFrame?this.createPopupForVisibleIFrame(n):this.createPopupForWaitMessage(n),e.$(window).one("message",function(){i.close(),n.detach(),t.logger.info("Got authentication for provider "+t.options.name+"; retrying query."),t.queryController.executeQuery()})},n.prototype.createPopupForWaitMessage=function(i){var n=e.$("<div/>").addClass("coveo-waiting-for-authentication-popup").append(e.JQueryUtils.getBasicLoadingDots());return i.hide().appendTo(document.body),e.ModalBox.open(n,{title:t.l("Authenticating",this.options.caption)})},n.prototype.createPopupForVisibleIFrame=function(t){var i=e.$("<div/>");return t.addClass("coveo-authentication-iframe").appendTo(i),e.ModalBox.open(i,{className:"coveo-authentication-popup"})},n.prototype.getAuthenticationProviderUriForRedirect=function(){return this.queryController.getEndpoint().getAuthenticationProviderUri(this.options.name,window.location.href,void 0)},n.prototype.getAuthenticationProviderUriForIFrame=function(){return this.queryController.getEndpoint().getAuthenticationProviderUri(this.options.name,void 0,"success")},n.ID="AuthenticationProvider",n.options={name:t.ComponentOptions.buildStringOption(),caption:t.ComponentOptions.buildStringOption({postProcessing:function(e,t){return e||t.name}}),useIFrame:t.ComponentOptions.buildBooleanOption({defaultValue:!1,attrName:"data-use-iframe"}),showIFrame:t.ComponentOptions.buildBooleanOption({defaultValue:!0,attrName:"data-show-iframe"})},n}(t.Component);t.AuthenticationProvider=i,t.CoveoJQuery.registerAutoCreateComponent(i)}(t=e.Ui||(e.Ui={}))}(Coveo||(Coveo={}));var Coveo;!function(e){var t;!function(e){var t=function(){function e(){}return e.populateBreadcrumb="populateBreadcrumb",e.clearBreadcrumb="clearBreadcrumb",e.redrawBreadcrumb="redrawBreadcrumb",e}();e.BreadcrumbEvents=t}(t=e.Events||(e.Events={}))}(Coveo||(Coveo={}));var Coveo;!function(e){var t;!function(t){var i=function(i){function n(o,s,r){var a=this;i.call(this,o,n.ID,r),this.element=o,this.options=s,this.options=t.ComponentOptions.initComponentOptions(o,n,s),e.$(this.root).on(e.Events.QueryEvents.querySuccess,function(){return a.handleQuerySuccess()}),e.$(this.root).on(e.Events.BreadcrumbEvents.redrawBreadcrumb,function(){return a.redrawBreadcrumb()}),e.$(this.element).hide()}return __extends(n,i),n.prototype.drawBreadcrumb=function(i){var n=this;this.element.innerHTML="";var o=e.$("<div />").addClass("coveo-clear-all");e.$(this.element).fastToggle(0!=i.length),e.DeviceUtils.isMobileDevice()||e.$(this.element).append(o);for(var s=0;s<i.length;s++)e.$(i[s].element).addClass("item").appendTo(this.element);e.DeviceUtils.isMobileDevice()&&e.$(this.element).append(o),o.attr("title",t.l("ClearAllFilters")),o.append(e.$("<div />").addClass("coveo-icon")),this.bind.fastClick(o,function(){n.clearBreadcrumbs()})},n.prototype.redrawBreadcrumb=function(){this.lastBreadcrumbs?this.drawBreadcrumb(this.lastBreadcrumbs):this.drawBreadcrumb(this.getBreadcrumbs())},n.prototype.handleQuerySuccess=function(){this.drawBreadcrumb(this.getBreadcrumbs())},n.prototype.getBreadcrumbs=function(){var t={breadcrumbs:[]};return e.$(this.root).trigger(e.Events.BreadcrumbEvents.populateBreadcrumb,t),this.logger.debug("Retrieved breadcrumbs",t.breadcrumbs),this.lastBreadcrumbs=t.breadcrumbs,t.breadcrumbs},n.prototype.clearBreadcrumbs=function(){var i=this,n={};e.$(this.root).trigger(e.Events.BreadcrumbEvents.clearBreadcrumb,n),this.logger.debug("Clearing breadcrumbs"),this.queryController.deferExecuteQuery({beforeExecuteQuery:function(){return i.usageAnalytics.logSearchEvent(t.AnalyticsActionCauseList.breadcrumbResetAll,{})}})},n.ID="Breadcrumb",n.options={},n}(t.Component);t.Breadcrumb=i,t.CoveoJQuery.registerAutoCreateComponent(i)}(t=e.Ui||(e.Ui={}))}(Coveo||(Coveo={}));var Coveo;!function(e){var t;!function(t){var i=function(){function t(i,n){void 0===n&&(n=""),this.sort=i,this.direction=n,e.Assert.isNonEmptyString(i),e.Assert.check(e._.contains(t.validSorts,i)||t.sortIsField(i)),t.sortNeedsDirection(i)?e.Assert.check(e._.contains(t.validDirections,n)):e.Assert.check(""==n)}return t.prototype.putInQueryBuilder=function(i){e.Assert.exists(i),t.sortIsField(this.sort)?(i.sortCriteria="field"+this.direction,i.sortField=this.sort):i.sortCriteria=""!=this.direction?this.sort+this.direction:this.sort},t.prototype.getValueFromResult=function(i){return e.Assert.exists(i),t.sortIsField(this.sort)?(e.Assert.stringStartsWith(this.sort,"@"),i.raw[this.sort.substr(1)]):"date"==this.sort?i.raw.sysdate:(e.Assert.fail("Cannot retrieve value: "+this.sort),void 0)},t.prototype.toString=function(){return e.Utils.isNonEmptyString(this.direction)?this.sort+" "+this.direction:this.sort},t.prototype.equals=function(t){return e.Assert.exists(t),t.sort==this.sort&&t.direction==this.direction},t.parse=function(i){e.Assert.isNonEmptyString(i);var n=i.split(" ");return new t(n[0],n[1])},t.sortIsField=function(e){return"@"==e.substr(0,1)},t.sortNeedsDirection=function(i){return e._.contains(t.sortsNeedingDirection,i)||t.sortIsField(i)},t.validSorts=["relevancy","date","qre"],t.sortsNeedingDirection=["date"],t.validDirections=["ascending","descending"],t}();t.SortCriteria=i}(t=e.Ui||(e.Ui={}))}(Coveo||(Coveo={}));var Coveo;!function(e){var t;!function(t){var i=function(i){function n(o,s,r){i.call(this,o,n.ID,r),this.element=o,this.options=s,this.iconTemplate=e._.template("<span class='coveo-icon <%= icon %>'></span>"),this.tabTemplate=e._.template("<span><%= caption %></span>"),this.isFirstQuery=!0,this.options=t.ComponentOptions.initComponentOptions(o,n,s),e.$(this.root).on(e.Events.QueryEvents.buildingQuery,e.$.proxy(this.handleBuildingQuery,this));var a=this.queryStateModel.getEventName(e.Models.Model.eventTypes.changeOne+e.Models.QueryStateModel.attributesEnum.t);e.$(this.root).on(a,e.$.proxy(this.handleQueryStateChanged,this)),this.render(),e.$(this.element).fastClick(e.$.proxy(this.handleClick,this))}return __extends(n,i),n.prototype.select=function(){this.queryStateModel.setMultiple({t:this.options.uniqueId,sort:e.Models.QueryStateModel.defaultAttributes.sort})},n.prototype.handleClick=function(i){var n=this;i.preventDefault(),this.select(),e.DeviceUtils.isMobileDevice()&&e.MobileUtils.removeToggleClassOnSearchInterface(),this.queryController.deferExecuteQuery({beforeExecuteQuery:function(){return n.usageAnalytics.logSearchEvent(t.AnalyticsActionCauseList.interfaceChange,{interfaceChangeTo:n.options.uniqueId})}})},n.prototype.render=function(){var t=this.options.icon;""!=t&&e.$(this.element).prepend(this.iconTemplate({icon:t}));var i=this.options.caption;e.Utils.isNonEmptyString(i)&&e.$(this.element).append(this.tabTemplate({caption:i}))},n.prototype.handleBuildingQuery=function(t,i){e.Assert.exists(i),this.isFirstQuery=!1,this.isSelected()&&e.Utils.isNonEmptyString(this.options.expression)&&(this.options.constant?i.queryBuilder.constantExpression.add(this.options.expression):i.queryBuilder.advancedExpression.add(this.options.expression))},n.prototype.handleQueryStateChanged=function(t,i){e.Assert.exists(i),this.isSelected()?(e.$(this.element).addClass("coveo-selected"),this.queryController.setEndpoint(this.options.endpoint),this.showAndHideAppropriateElements()):e.$(this.element).removeClass("coveo-selected")},n.prototype.isSelected=function(){var t=this.queryStateModel.get(e.Models.QueryStateModel.attributesEnum.t);return t==this.options.uniqueId},n.prototype.showAndHideAppropriateElements=function(){var t=this,i=[],n=[];e._.each(e.$(this.root).find("[data-tab],[data-tab-not]"),function(e){t.isElementIncludedInTab(e)?(t.toggleAllComponentsUnder(e,!0),i.push(e)):(t.toggleAllComponentsUnder(e,!1),n.push(e))}),e.$(this.root).one(e.Events.QueryEvents.querySuccess,function(){e._.each(i,function(t){return e.$(t).removeClass("coveo-tab-disabled")}),e._.each(n,function(t){return e.$(t).addClass("coveo-tab-disabled")})})},n.prototype.isElementIncludedInTab=function(t){e.Assert.exists(t);var i=this.splitListOfTabs(e.$(t).attr("data-tab")),n=this.splitListOfTabs(e.$(t).attr("data-tab-not"));return e.Assert.check(!(0!=i.length&&0!=n.length),"You cannot both explicity include and exclude an element from tabs"),0!=i.length&&-1!=e._.indexOf(i,this.options.uniqueId)||0!=n.length&&-1==e._.indexOf(n,this.options.uniqueId)||0==i.length&&0==n.length},n.prototype.splitListOfTabs=function(t){return e.Utils.exists(t)?e._.map(t.split(","),function(t){return e.Utils.trim(t)}):[]},n.prototype.toggleAllComponentsUnder=function(i,n){e.Assert.exists(i),e.$(i).find("*").addBack().each(function(e,i){var o=t.Component.get(i,void 0,!0);o&&(n?o.enable():o.disable())})},n.prototype.enable=function(){i.prototype.enable.call(this),e.$(this.element).css("display","")},n.prototype.disable=function(){i.prototype.disable.call(this),e.$(this.element).css("display","none")},n.ID="Tab",n.options={uniqueId:t.ComponentOptions.buildStringOption({attrName:"data-id",required:!0}),icon:t.ComponentOptions.buildIconOption(),caption:t.ComponentOptions.buildLocalizedStringOption(),expression:t.ComponentOptions.buildStringOption(),endpoint:t.ComponentOptions.buildCustomOption(function(t){return null!=t?e.Rest.SearchEndpoint.endpoints[t]:null}),sort:t.ComponentOptions.buildCustomOption(function(e){return null!=e?t.SortCriteria.parse(e):null}),constant:t.ComponentOptions.buildBooleanOption({defaultValue:!0})},n}(t.Component);t.Tab=i,t.CoveoJQuery.registerAutoCreateComponent(i)}(t=e.Ui||(e.Ui={}))}(Coveo||(Coveo={}));var Coveo;!function(e){var t;!function(t){var i=function(i){function n(o,s,r){var a=this;i.call(this,o,n.ID,r),this.element=o,this.options=s,this.options=t.ComponentOptions.initComponentOptions(o,n,s);var l=this.queryStateModel.getEventName(e.Models.Model.eventTypes.changeOne+e.Models.QueryStateModel.attributesEnum.t);e.$(this.root).on(l,e.$.proxy(this.handleTabChange,this)),this.options.tabSectionToOpen&&(e.$(this.options.tabSectionToOpen).addClass("coveo-targeted-by-current-tab"),e.$(this.element).addClass("coveo-targeting-tab-section"),this.bind.fastClick(e.$(this.element),function(){e.$(".coveo-glass").toggleClass("coveo-active-glass").toggleClass("coveo-active-glass-for-current-tab"),e.$(a.element).toggleClass("coveo-opening-tab-section"),e.$(a.options.tabSectionToOpen).toggleClass("coveo-opened-by-current-tab"),e.$(a.element).hasClass("coveo-opening-tab-section")?(e.$(a.options.tabSectionToOpen).css("z-index","1001"),e.$(a.element).css("z-index","1001")):(e.$(a.options.tabSectionToOpen).css("z-index",void 0),e.$(a.element).css("z-index",void 0))}))}return __extends(n,i),n.prototype.handleTabChange=function(){var i=this,n=this.queryStateModel.get(e.Models.QueryStateModel.attributesEnum.t);if(e.Utils.isNonEmptyString(n)){var o=!1;e.$(this.root).find(t.Component.computeSelectorForType(t.Tab.ID)).each(function(s,r){var a=t.Component.get(r,t.Tab);a.options.uniqueId==n&&(e.$(i.element).html(e.$(a.element).html()),o=!0)}),e.Assert.check(o,"Cannot find the currently active tab")}else e.$(this.element).hide()},n.ID="CurrentTab",n.options={tabSectionToOpen:t.ComponentOptions.buildStringOption()},n}(t.Component);t.CurrentTab=i,t.CoveoJQuery.registerAutoCreateComponent(i)}(t=e.Ui||(e.Ui={}))}(Coveo||(Coveo={}));var Coveo;!function(e){var t;!function(t){var i=function(i){function n(o,s,r){var a=this;i.call(this,o,n.ID,r),this.element=o,this.options=s,this.options=t.ComponentOptions.initComponentOptions(o,n,s),e.$(this.root).on(e.Events.ResultListEvents.newResultsDisplayed,function(){return a.handleNewResultsDisplayed()})}return __extends(n,i),n.prototype.handleNewResultsDisplayed=function(){var t=this;e.$(this.root).find(".CoveoResult").dblclick(function(e){return t.handleResultDoubleClick(e)})},n.prototype.handleResultDoubleClick=function(i){var n=t.Component.computeCssClassNameForType(e.Ui.ResultLink.ID),o=e.$(i.target).hasClass(n);if(i.altKey&&!o){var s=e.$(i.currentTarget).data("CoveoResult"),r=this.buildResultInfo(s),a=e.ModalBox.open(r,{title:"Debug",className:"coveo-debug"});e.$(a.wrapper.find(".coveo-title")).fastClick(function(){return a.close()}),e.$(a.overlay).fastClick(function(){return a.close()}),i.cancelBubble=!0,i.result=!1}},n.prototype.buildResultInfo=function(t){e.Assert.exists(t);var i=e.$("<div/>");return i.append(e.$("<div/>").append(e.$("<a/>").attr("href",t.clickUri).text(t.title||t.uri))),e.$("<div>Properties</div>").addClass("coveo-debug-title").appendTo(i),this.buildPropertyTable(t).appendTo(i),e.$("<div>Fields</div>").addClass("coveo-debug-title").appendTo(i),this.buildFieldTable(t).appendTo(i),e.$("<div>Ranking Info</div>").addClass("coveo-debug-title").appendTo(i),this.buildRankingInfo(t).appendTo(i),i},n.prototype.buildPropertyTable=function(t){var i=this;e.Assert.exists(t);var n=e.$("<table/>").addClass("coveo-debug-property-table"),o=e._.keys(t).sort();return e._.each(o,function(o){if("raw"!=o&&o[0]==o.toLowerCase()[0]){var s=e.$("<tr/>").appendTo(n);e.$("<td/>").addClass("coveo-debug-property-name").text(o).appendTo(s),e.$("<td/>").addClass("coveo-debug-property-value").append(i.formatValue(t[o])).appendTo(s)}}),n},n.prototype.buildFieldTable=function(t){var i=this;e.Assert.exists(t);var n=e.$("<table/>").addClass("coveo-debug-fields-table"),o=e._.keys(t.raw).sort();return e._.each(o,function(o){var s=e.$("<tr/>").appendTo(n);e.$("<td/>").addClass("coveo-debug-field-name").text("@"+o).appendTo(s),e.$("<td/>").addClass("coveo-debug-field-value").append(i.formatValue(t.raw[o])).appendTo(s)}),n},n.prototype.buildRankingInfo=function(t){return e.Assert.exists(t),e.$("<div/>").addClass("coveo-debug-ranking-info").text(t.rankingInfo)},n.prototype.formatValue=function(t){return e.Utils.isNonEmptyString(t)&&0==t.indexOf("http")?e.$("<a/>").attr("href",t).text(t):e.$("<span/>").text(t)},n.ID="Debug",n.options={},n}(t.Component);t.Debug=i,t.CoveoJQuery.registerAutoCreateComponent(i)}(t=e.Ui||(e.Ui={}))}(Coveo||(Coveo={}));var Coveo;!function(e){var t;!function(t){var i=function(i){function n(o,s,r){i.call(this,o,n.ID,r),this.element=o,this.options=s,this.bindings=r,this.options=t.ComponentOptions.initComponentOptions(o,n,s),e.Assert.exists(o),e.Assert.exists(this.options),this.hideNext=!0,this.bind.onRoot(e.Events.QueryEvents.buildingQuery,this.handlePrepareQueryBuilder),this.bind.onRoot(e.Events.QueryEvents.querySuccess,this.handleProcessNewQueryResults),this.bind.onRoot(e.Events.QueryEvents.noResults,this.handleNoResults),this.bind.onRoot(e.Events.QueryEvents.newQuery,this.handleNewQuery),e.$(this.element).hide()}return __extends(n,i),n.prototype.handleNewQuery=function(){this.hideNext?(e.$(this.element).empty(),e.$(this.element).hide()):this.hideNext=!0},n.prototype.handlePrepareQueryBuilder=function(t,i){e.Assert.exists(i),i.queryBuilder.enableDidYouMean=!0},n.prototype.handleNoResults=function(i,n){if(e.Utils.isNonEmptyArray(n.results.queryCorrections)&&!n.searchAsYouType){var o=this.queryStateModel.get(e.Models.QueryStateModel.attributesEnum.q),s=this.buildCorrectedSentence(n.results.queryCorrections[0]);this.queryStateModel.set(e.Models.QueryStateModel.attributesEnum.q,n.results.queryCorrections[0].correctedQuery),n.retryTheQuery=!0,this.hideNext=!1,e.$("<div/>").html(t.l("noResultFor","<span class='coveo-highlight'>"+e.StringUtils.htmlEncode(o)+"</span>")).appendTo(this.element),e.$("<div/>").html(t.l("autoCorrectedQueryTo","<span class='coveo-highlight'>"+s+"</span>")).appendTo(this.element),e.$(this.element).show(),this.usageAnalytics.logSearchEvent(t.AnalyticsActionCauseList.didyoumeanAutomatic,{})}},n.prototype.handleProcessNewQueryResults=function(i,n){var o=this;e.Assert.exists(n),e.Assert.exists(n.results);var s=n.results;if(this.logger.trace("Received query results from new query",s),e.Utils.isNonEmptyArray(s.queryCorrections)){var r=this.buildCorrectedSentence(s.queryCorrections[0]),a=e.$("<div/>").text(t.l("didYouMean","")).appendTo(this.element),l=e.$("<a/>").html(r).appendTo(a);e.$(l).fastClick(function(){o.doQueryWithCorrectedTerm(s.queryCorrections[0].correctedQuery)}),e.$(this.element).show()}},n.prototype.buildCorrectedSentence=function(t){var i=[],n='<span class="coveo-word-correction">',o="</span>",s=0;return e._.each(t.wordCorrections,function(r){i.push(e.StringUtils.htmlEncode(t.correctedQuery.slice(s,r.offset))),s=r.offset,i.push(n),i.push(e.StringUtils.htmlEncode(t.correctedQuery.slice(s,r.length+s))),i.push(o),s=r.offset+r.length}),i.push(e.StringUtils.htmlEncode(t.correctedQuery.slice(s))),i.join("")},n.prototype.doQueryWithCorrectedTerm=function(i){var n=this;this.queryStateModel.set(e.Models.QueryStateModel.attributesEnum.q,i),this.queryController.deferExecuteQuery({beforeExecuteQuery:function(){return n.usageAnalytics.logSearchEvent(t.AnalyticsActionCauseList.didyoumeanClick,{})}})},n.ID="DidYouMean",n.options={},n}(t.Component);t.DidYouMean=i,t.CoveoJQuery.registerAutoCreateComponent(i)}(t=e.Ui||(e.Ui={}))}(Coveo||(Coveo={}));var Coveo;!function(e){var t;!function(t){var i=function(i){function n(o,s,r){i.call(this,o,n.ID,r),this.element=o,this.options=s,this.options=t.ComponentOptions.initComponentOptions(o,n,s),e.$(this.element).append(e.$("<div />").addClass("coveo-error-title").append("<h3></h3><h4></h4>"));var a=e.$("<div />").addClass("coveo-options").append(this.buildPrevious()).append(this.buildClear()).append(this.buildRetry());e.$(this.element).append(a).append(this.message=e.$("<div class='coveo-error-message'></div>")).hide(),e.$(this.root).on(e.Events.QueryEvents.newQuery,e.$.proxy(this.handleNewQuery,this)),e.$(this.root).on(e.Events.QueryEvents.queryError,e.$.proxy(this.handleQueryError,this))}return __extends(n,i),n.prototype.setErrorTitle=function(){var i={h3:t.l("OopsError"),h4:t.l("ProblemPersists")};e.DeviceUtils.isPhonegap()&&navigator.connection&&window.Connection&&(navigator.connection.type==window.Connection.NONE||0===navigator.connection.type)&&(i={h3:t.l("CannotConnect"),h4:t.l("NoNetworkConnection")}),e.$(this.element).find("h3").text(i.h3),e.$(this.element).find("h4").text(i.h4)},n.prototype.buildPrevious=function(){var i=this;return e.$("<span class='coveo-previous' > "+t.l("GoBack")+" </span>").fastClick(function(){i.usageAnalytics.logCustomEvent(t.AnalyticsActionCauseList.errorBack,{},i.root),i.usageAnalytics.logSearchEvent(t.AnalyticsActionCauseList.errorBack,{}),history.back()})},n.prototype.buildClear=function(){var i=this;return e.$("<span class='coveo-clear'>"+t.l("Reset")+"</span>").fastClick(function(){i.queryStateModel.reset(),i.queryController.deferExecuteQuery({beforeExecuteQuery:function(){i.usageAnalytics.logSearchEvent(t.AnalyticsActionCauseList.errorClearQuery,{}),i.usageAnalytics.logCustomEvent(t.AnalyticsActionCauseList.errorClearQuery,{},i.root)}})})},n.prototype.buildRetry=function(){var i=this;return e.$("<span class='coveo-retry'>"+t.l("Retry")+"</span>").fastClick(function(){i.queryController.deferExecuteQuery({beforeExecuteQuery:function(){i.usageAnalytics.logSearchEvent(t.AnalyticsActionCauseList.errorRetry,{}),i.usageAnalytics.logCustomEvent(t.AnalyticsActionCauseList.errorRetry,{},i.root)}})})},n.prototype.handleNewQuery=function(){e.$(this.element).hide(),null!=this.closePopup&&this.closePopup()},n.prototype.handleQueryError=function(i,n){if(e.Assert.exists(n),e.Assert.exists(n.error),!n.error.isMissingAuthentication&&(this.message.empty(),this.setErrorTitle(),this.options.showDetailedError&&this.message.append(e.$("<span class='coveo-more-info'>"+t.l("MoreInfo")+"</span>").fastClick(function(t){e.$(t.target).parent().html(e._.template("<pre><%- type %>\n<%- message %></pre>",n.error))})),e.$(this.element).show(),this.options.popUp)){var o=e.ModalBox.open(e.$(this.element).clone(!0,!0),{title:e.JQueryUtils.getPopUpCloseButton(t.l("Close"),t.l("ErrorReport")),titleClose:!0,overlayClose:!0,className:"coveo-error-report"});this.closePopup=o.close}},n.ID="ErrorReport",n.options={popUp:t.ComponentOptions.buildBooleanOption({defaultValue:!1}),showDetailedError:t.ComponentOptions.buildBooleanOption({defaultValue:!1})},n}(t.Component);t.ErrorReport=i,t.CoveoJQuery.registerAutoCreateComponent(i)}(t=e.Ui||(e.Ui={}))}(Coveo||(Coveo={}));var Coveo;!function(e){var t;!function(t){var i=function(){function t(){this.selected=!1,this.excluded=!1,this.waitingForDelta=!1}return t.prototype.reset=function(){this.selected=!1,this.excluded=!1},t.prototype.updateCountsFromNewValue=function(t){e.Assert.exists(t),this.occurrences=t.occurrences,this.delta=t.delta,this.computedField=t.computedField},t.prototype.cloneWithZeroOccurrences=function(){return this.occurrences=0,this.computedField=0,this.delta=void 0,this},t.prototype.cloneWithDelta=function(t,i){e.Assert.isLargerOrEqualsThan(0,t);var n=this.cloneWithZeroOccurrences();return n.delta=i,n.occurrences=t,n},t.prototype.getFormattedCount=function(){var t=void 0;return e.Utils.exists(this.delta)&&this.delta>0?t="+"+Globalize.format(this.delta,"n0"):this.occurrences>0&&(t=Globalize.format(this.occurrences,"n0")),t},t.prototype.getFormattedComputedField=function(e){return 0!=this.computedField?Globalize.format(this.computedField,e):void 0},t.create=function(i){if(e._.isString(i))return t.createFromValue(i);if(e._.isObject(i))return"computedFieldResults"in i?t.createFromGroupByValue(i):t.createFromFieldValue(i);throw new Error("Can't create value from "+i)},t.createFromValue=function(i){e.Assert.isNonEmptyString(i);
var n=new t;return n.value=i.toLowerCase(),n.lookupValue=i,n},t.createFromGroupByValue=function(i){e.Assert.exists(i),e.Assert.exists(i);var n=new t;return n.value=i.value.toLowerCase(),n.lookupValue=e.Utils.exists(i.lookupValue)?i.lookupValue:i.value,n.occurrences=i.numberOfResults,n.computedField=e.Utils.isNonEmptyArray(i.computedFieldResults)?i.computedFieldResults[0]:void 0,n.score=i.score,n},t.createFromFieldValue=function(i){e.Assert.exists(i);var n=new t;return n.value=i.value.toLowerCase(),n.lookupValue=i.lookupValue,n.occurrences=i.numberOfResults,n},t}();t.FacetValue=i;var n=function(){function t(t){this.values=e.Utils.exists(t)?e._.map(t.values,function(e){return i.createFromGroupByValue(e)}):[]}return t.prototype.add=function(t){e.Assert.exists(t),e.Assert.check(!this.contains(t.value)),this.values.push(t)},t.prototype.remove=function(t){e.Assert.isNonEmptyString(t),t=t,this.values=e._.filter(this.values,function(e){return e.value!=t})},t.prototype.size=function(){return this.values.length},t.prototype.isEmpty=function(){return 0==this.values.length},t.prototype.at=function(t){return e.Assert.isLargerOrEqualsThan(0,t),e.Assert.isSmallerThan(this.values.length,t),this.values[t]},t.prototype.get=function(t){return e._.find(this.values,function(e){return e.value.toLowerCase()==t.toLowerCase()})},t.prototype.contains=function(t){return e.Utils.exists(this.get(t))},t.prototype.getAll=function(){return this.values},t.prototype.getSelected=function(){return e._.filter(this.values,function(e){return e.selected})},t.prototype.getExcluded=function(){return e._.filter(this.values,function(e){return e.excluded})},t.prototype.hasSelectedOrExcludedValues=function(){return 0!=this.getSelected().length||0!=this.getExcluded().length},t.prototype.reset=function(){e._.each(this.values,function(e){return e.reset()})},t.prototype.importActiveValuesFromOtherList=function(t){var i=this;e.Assert.exists(t),e._.each(t.getSelected(),function(t){var n=i.get(t.value);e.Utils.exists(n)?n.selected=!0:i.values.push(t.cloneWithZeroOccurrences())}),e._.each(t.getExcluded(),function(t){var n=i.get(t.value);e.Utils.exists(n)?n.excluded=!0:i.values.push(t.cloneWithZeroOccurrences())})},t.prototype.updateCountsFromNewValues=function(t){e.Assert.exists(t),this.values=e._.map(this.values,function(i){var n=t.get(i.value);return e.Utils.exists(n)?(i.updateCountsFromNewValue(n),i):i.cloneWithZeroOccurrences()})},t.prototype.updateDeltaWithFilteredFacetValues=function(t){e.Assert.exists(t),e._.each(this.values,function(i){var n=t.get(i.value);i.waitingForDelta=!1,e.Utils.exists(n)?i.delta=i.occurrences-n.occurrences>0?i.occurrences-n.occurrences:null:i.selected||i.excluded||(i.delta=i.occurrences)})},t.prototype.mergeWithUnfilteredFacetValues=function(t){var i=this;e.Assert.exists(t);var n=[];e._.each(t.values,function(t){var o=i.get(t.value);e.Utils.exists(o)?o.occurrences==t.occurrences?n.push(o):n.push(t.cloneWithDelta(t.occurrences,t.occurrences-o.occurrences)):n.push(t.cloneWithDelta(t.occurrences,t.occurrences))});var o=0;e._.each(this.values,function(i){var s=t.get(i.value);if(e.Utils.exists(s)){for(var r=0;r<n.length;r++)if(n[r].value==i.value){o=r+1;break}}else(i.selected||i.excluded)&&(n.splice(o,0,i),o++)}),this.values=n},t.prototype.sortValuesDependingOnStatus=function(t){if(this.values=e._.sortBy(this.values,function(e){return e.selected?1:e.excluded?3:2}),null!=t&&t<this.values.length){var i=this.getExcluded().length,n=this.values.splice(this.values.length-i,i);Array.prototype.splice.apply(this.values,[t-i,0].concat(n))}},t}();t.FacetValues=n}(t=e.Ui||(e.Ui={}))}(Coveo||(Coveo={}));var Coveo;!function(e){var t;!function(t){var i;!function(i){function n(i){var n=i.raw.objecttype,r=i.raw.sysfiletype;return e.Utils.isNonEmptyString(n)?o(n):e.Utils.isNonEmptyString(r)?s(r):{icon:"coveo-icon sysfiletype",caption:t.l("Unknown")}}function o(e){e=e.toLowerCase();var i=t.l["objecttype_"+e];return{icon:"coveo-icon objecttype "+e,caption:i?i():e}}function s(e){e=e.toLowerCase(),"."==e[0]&&(e=e.substring(1));var i=t.l["sysfiletype_"+e];return{icon:"coveo-icon sysfiletype "+e,caption:i?i():e}}function r(){if(void 0==a){a={};var t=String.locales[String.locale];e.Assert.isNotUndefined(t),e._.each(e._.keys(t),function(e){0==e.indexOf("sysfiletype_")?a[e.substr("sysfiletype_".length)]=e.toLocaleString():0==e.indexOf("objecttype_")&&(a[e.substr("objecttype_".length)]=e.toLocaleString())})}return a}var a;i.get=n,i.getObjectType=o,i.getSysFileType=s,i.getSysFileTypeCaptions=r}(i=t.FileTypes||(t.FileTypes={}))}(t=e.Ui||(e.Ui={}))}(Coveo||(Coveo={}));var Coveo;!function(e){var t;!function(t){var i;!function(i){function n(t){return new RegExp(e.Utils.escapeRegexCharacter(t),"i")}function o(i,n){var o=[i],s=this.getRegexToUseForFacetSearch(i);return n.options.valueCaption&&e._.each(e._.filter(e._.pairs(n.options.valueCaption),function(e){return s.test(e[1])}),function(e){o.push(e[0])}),("@objecttype"==n.options.field||"@sysfiletype"==n.options.field)&&e._.each(e._.filter(e._.pairs(t.FileTypes.getSysFileTypeCaptions()),function(e){return s.test(e[1])}),function(e){o.push(e[0])}),o}function s(t){return t=e._.map(t,function(t){return e.Utils.escapeRegexCharacter(t)}),t[0]=".*"+t[0]+".*",t.join("|")}function r(e,t,i,n){return t>e&&n>e&&t!=i}function a(t,i){if(0!=t.values.getSelected().length){var n=i.find("li").not(".coveo-selected");e._.each(n,function(t){e.$(t).addClass("coveo-no-state")})}}function l(i){var n=t.FileTypes.getSysFileTypeCaptions()[i.toLowerCase()];return void 0!=n&&e.Utils.isNonEmptyString(n)?n:i}function u(t,i){if(!t.isInstanceOf("HierarchicalFacet")||i){t.logger.trace("Clipping captions");for(var n=e.$(t.element).show(),o=n.find(".coveo-caption"),s=0;s<o.length;s++)""!=o[s].style.width&&(o[s].style.width="");for(var r=n.find(".coveo-label"),a=[],s=0;s<r.length;s++){var l=r.get(s),u=e.$(l),c=u.find(".coveo-caption"),p=c.get(0),d=l.scrollWidth,h=l.clientWidth,f=p.scrollWidth,m=Math.max(0,d-h);m&&a.push({element:c,width:f,crop:m,label:u})}n.css("display","");for(var s=0;s<a.length;s++){var v=a[s],g=v.element.get(0);g.style.width=v.width-v.crop+"px";{v.element[0]}v.crop>0?v.label.attr("title",v.element.text()):v.label.attr("title",null)}}}i.getRegexToUseForFacetSearch=n,i.getValuesToUseForSearchInFacet=o,i.buildFacetSearchPattern=s,i.needAnotherFacetSearch=r,i.addNoStateCssClassToFacetValues=a,i.tryToGetTranslatedCaption=l,i.clipCaptionsToAvoidOverflowingTheirContainer=u}(i=t.FacetUtils||(t.FacetUtils={}))}(t=e.Ui||(e.Ui={}))}(Coveo||(Coveo={}));var Coveo;!function(e){var t;!function(t){var i=function(){function t(e){this.facet=e}return t.prototype.prepareForNewQuery=function(){this.lastGroupByRequestIndex=void 0,this.expressionToUseForFacetSearch=void 0},t.prototype.computeOurFilterExpression=function(){var t=this;e.Assert.check(this.facet.values.hasSelectedOrExcludedValues());var i=new e.Ui.ExpressionBuilder,n=this.facet.values.getSelected();n.length>0&&(this.facet.options.useAnd?e._.each(n,function(e){i.addFieldExpression(t.facet.options.field,"==",[e.value])}):i.addFieldExpression(this.facet.options.field,"==",e._.map(n,function(e){return e.value})));var o=this.facet.values.getExcluded();return o.length>0&&i.addFieldNotEqualExpression(this.facet.options.field,e._.map(o,function(e){return e.value})),i.build()},t.prototype.putGroupByIntoQueryBuilder=function(t){e.Assert.exists(t);var i=this._createGroupByAllowedValues(),n=this._createBasicGroupByRequest(i),o=this.createGroupByQueryOverride(t);e.Utils.isNullOrUndefined(o)?(this.expressionToUseForFacetSearch=t.computeCompleteExpression(),null==this.expressionToUseForFacetSearch&&(this.expressionToUseForFacetSearch="@sysuri")):(n.queryOverride=o.withoutConstant,n.constantQueryOverride=o.constant,this.expressionToUseForFacetSearch=o.withoutConstant+(o.constant?" "+o.constant:"")),this.lastGroupByRequestIndex=t.groupByRequests.length,t.groupByRequests.push(n)},t.prototype.searchInFacet=function(e,t,i){void 0===i&&(i=!0);var n=this.buildListFieldValuesRequest(e,t,!1);return this.createListFieldDeferer(n)},t.prototype.searchInFacetWithLookupField=function(t,i,n){void 0===n&&(n=!0);var o=this.buildGroupByQuery(),s=o.groupBy[0];s.maximumNumberOfValues=t,s.allowedValues=e._.map(i,function(e){return"*"+e+"*"});var r=this.buildSearchQueryForFacetWithLookupField(i);return null==o.aq?o.aq=r:o.aq+=" "+r,this.createSearchDeferer(o)},t.prototype.recursiveFacetSearch=function(t,i,n,o){var s=this;void 0===o&&(o=e.$.Deferred());var r,a=e.Ui.FacetUtils.getValuesToUseForSearchInFacet(t,this.facet),l=function(r){var a=r.length;r=s.checkForFacetSearchValuesToRemove(r,t),e.Ui.FacetUtils.needAnotherFacetSearch(r.length,a,n,5)?s.recursiveFacetSearch(t,i+i,a,o):o.resolve(r)};return null==this.facet.options.lookupField&&null==this.facet.options.computedField?(r=this.facet.facetQueryController.searchInFacet(i,a,this.facet.options.facetSearchIgnoreAccents),r.done(l)):(r=this.facet.facetQueryController.searchInFacetWithLookupField(i,a,!1),r.done(function(e){var t=e.groupByResults.length>0?e.groupByResults[0].values:[];l(t)})),r.fail(function(e,t){o.reject(e,t)}),o.fail(function(){r.reject()}),o},t.prototype.fetchMore=function(){var t=this.buildGroupByQuery();return this.facet.values.size()>0&&t.groupBy.push(this._createBasicGroupByRequest(e._.map(this.facet.values.getAll(),function(e){return e.value}))),this.createSearchDeferer(t)},t.prototype.searchInFacetToUpdateDelta=function(t){var i=this.buildGroupByQuery();return i.aq=this.computeOurFilterExpression(),e._.each(t,function(e){e.waitingForDelta=!0}),i.groupBy=[this._createBasicGroupByRequest(e._.map(t,function(e){return e.value}))],i.groupBy[0].completeFacetWithStandardValues=!1,this.createSearchDeferer(i)},t.prototype.createSearchDeferer=function(e){return this.facet.getEndpoint().search(e)},t.prototype.createListFieldDeferer=function(e){return this.facet.queryController.getEndpoint().listFieldValues(e)},t.prototype.buildSearchQueryForFacetWithLookupField=function(t){var i=this.facet.options.lookupField?this.facet.options.lookupField:this.facet.options.field;return"("+t.map(function(t){return e.QueryUtils.buildFieldExpression(i,"*=",["*"+t+"*"])}).join(" OR ")+")"},t.prototype.buildListFieldValuesRequest=function(e,i,n,o){void 0===n&&(n=!0);var s={field:this.facet.options.field,ignoreAccents:n,sortCriteria:"occurrences",maximumNumberOfValues:e,queryOverride:o||this.expressionToUseForFacetSearch};return null!=i&&(s.pattern=t.makeFacetSearchPattern(i),s.patternType="RegularExpression"),s},t.prototype.buildGroupByQuery=function(e){var t=[this._createBasicGroupByRequest(e)];return{q:this.expressionToUseForFacetSearch,enableDidYouMean:!1,firstResult:0,numberOfResults:0,groupBy:t}},t.prototype._createGroupByAllowedValues=function(){var t;if(void 0!=this.facet.options.allowedValues)return this.facet.options.allowedValues;if(void 0!=this.facet.options.customSort)return this.facet.options.customSort;if(this.facet.options.useAnd||!this.facet.keepDisplayedValuesNextTime){var i=this.facet.values.getSelected();if(0==i.length)return void 0;t=this.facet.values.getSelected()}else t=this.facet.values.getAll();return e._.map(t,function(e){return e.value})},t.prototype.createGroupByQueryOverride=function(t){var i=this.facet.options.additionalFilter?this.facet.options.additionalFilter:void 0;if(!this.facet.values.hasSelectedOrExcludedValues()||this.facet.options.useAnd)return i?{constant:i,withoutConstant:"@sysuri"}:void 0;var n=e._.defaults(t.computeCompleteExpressionPartsExcept(this.computeOurFilterExpression()),{withoutConstant:"@sysuri"});return void 0==n.constant?n.constant=i:n.constant+=i?" "+i:"",n},t.prototype._createBasicGroupByRequest=function(t,i){void 0===i&&(i=!0);var n=(this.facet.numberOfValues+(this.facet.options.enableMoreLess?1:0),{field:this.facet.options.field,maximumNumberOfValues:this.facet.numberOfValues+(this.facet.options.enableMoreLess?1:0),sortCriteria:this.facet.options.sortCriteria,injectionDepth:this.facet.options.injectionDepth,completeFacetWithStandardValues:void 0==this.facet.options.allowedValues?!0:!1});return this.facet.options.lookupField&&(n.lookupField=this.facet.options.lookupField),null!=t&&(n.allowedValues=t,n.maximumNumberOfValues=Math.max(n.maximumNumberOfValues,t.length)),i&&e.Utils.isNonEmptyString(this.facet.options.computedField)&&(n.computedFields=[{field:this.facet.options.computedField,operation:this.facet.options.computedFieldOperation}]),n},t.prototype.checkForFacetSearchValuesToRemove=function(t,i){var n=this,o=e.Ui.FacetUtils.getRegexToUseForFacetSearch(i);return e._.filter(t,function(e){return o.test(n.facet.getValueCaption(e))})},t.makeFacetSearchPattern=function(t){return t=e._.map(t,function(t){return e.Utils.escapeRegexCharacter(t)}),t[0]=".*"+t[0]+".*",t.join("|")},t}();t.FacetQueryController=i}(t=e.Controllers||(e.Controllers={}))}(Coveo||(Coveo={}));var Coveo;!function(e){!function(e){e[e.BACKSPACE=8]="BACKSPACE",e[e.TAB=9]="TAB",e[e.ENTER=13]="ENTER",e[e.SHIFT=16]="SHIFT",e[e.CTRL=17]="CTRL",e[e.ALT=18]="ALT",e[e.ESCAPE=27]="ESCAPE",e[e.SPACEBAR=32]="SPACEBAR",e[e.PAGE_UP=33]="PAGE_UP",e[e.PAGE_DOWN=34]="PAGE_DOWN",e[e.HOME=36]="HOME",e[e.LEFT_ARROW=37]="LEFT_ARROW",e[e.UP_ARROW=38]="UP_ARROW",e[e.RIGHT_ARROW=39]="RIGHT_ARROW",e[e.DOWN_ARROW=40]="DOWN_ARROW",e[e.INSERT=45]="INSERT",e[e.DELETE=46]="DELETE"}(e.KEYBOARD||(e.KEYBOARD={}));var t=(e.KEYBOARD,function(){function t(){}return t.keysEqual=function(t,i){return e.Utils.isNullOrUndefined(t.keyCode)?e.Utils.isNullOrUndefined(t.which)?!1:t.which==i:t.keyCode==i},t.isAllowedKeyForOmniBox=function(e){var i=e.keyCode,n=t.isNumberKeyPushed(i)||32==i||13==i||t.isLetterKeyPushed(i)||i>95&&112>i||i>185&&193>i||i>218&&223>i||8==i||46==i||t.isArrowKeyPushed(i);return n},t.isAllowedKeyForSearchAsYouType=function(e){return t.isAllowedKeyForOmniBox(e)&&!t.isArrowKeyPushed(e.keyCode)},t.isDeleteOrBackspace=function(e){return t.keysEqual(e,8)||t.keysEqual(e,46)},t.isArrowKeyPushed=function(e){return 37==e||38==e||39==e||40==e},t.isNumberKeyPushed=function(e){return e>47&&58>e},t.isLetterKeyPushed=function(e){return e>64&&91>e},t}());e.KeyboardUtils=t}(Coveo||(Coveo={}));var Coveo;!function(e){var t;!function(t){var i=function(){function i(i,n){var o=this;this.facet=i,this.facetSearchValuesListKlass=n,this.showingFacetSearchWaitAnimation=!1,this.searchTemplate=e._.template("<div class='coveo-search'></div>"),this.magnifierTemplate=e._.template("<div class='coveo-magnifier'></div>"),this.waitTemplate=e._.template("<div class='coveo-wait-animation'></div>"),this.clearIconTemplate=e._.template("<span class='coveo-icon'></span>"),this.clearTemplate=e._.template("<div title='"+t.l("Clear",t.l("Search"))+"' class='coveo-clear'></div>"),this.middleTemplate=e._.template("<div class='coveo-middle'></div>"),this.inputTemplate=e._.template("<input type='text' autocapitalize='off' autocorrect='off' placeholder='<%- placeholder %>'/>"),this.searchResultsTemplate=e._.template('<ul class="coveo-search-results"/>'),this.searchResults=e.$(this.searchResultsTemplate()),e.$(window).resize(function(){e.DeviceUtils.isMobileDevice()||o.positionSearchResults()})}return i.prototype.build=function(){return e.DeviceUtils.isMobileDevice()?this.buildSearchMobile():this.buildBaseSearch()},i.prototype.positionSearchResults=function(){if(null!=this.searchResults&&this.searchResults.is(":visible"))if(e.DeviceUtils.isMobileDevice())this.searchResults.insertAfter(this.search);else{var t=this.searchResults.outerWidth()-this.searchResults.innerWidth();this.searchResults.outerWidth(this.search.outerWidth()-t),this.searchResults.show(),e.JQueryUtils.positionPopup(this.searchResults,this.search,e.$(this.facet.element),e.$(this.facet.root),{vertical:2,horizontal:1})}},i.prototype.completelyDismissSearch=function(){this.cancelAnyPendingSearchOperation(),this.facet.unfadeInactiveValuesInMainList(),this.search.removeClass("coveo-no-results"),this.hideSearchResultsElement(),this.input.val(""),this.clear.hide()},i.prototype.buildBaseSearch=function(){var i=this;return this.search=e.$(this.searchTemplate()),this.magnifier=e.$(this.magnifierTemplate()).appendTo(this.search),this.wait=e.$(this.waitTemplate()).hide().appendTo(this.search),this.clearIcon=e.$(this.clearIconTemplate()),this.clear=e.$(this.clearTemplate()).appendTo(this.search).hide().append(this.clearIcon),this.middle=e.$(this.middleTemplate()).appendTo(this.search),this.input=e.$(this.inputTemplate({placeholder:t.l("SearchIn",this.facet.options.title)})).appendTo(this.middle),t.Component.pointElementsToDummyForm(this.input),this.input.keyup(function(e){return i.handleFacetSearchKeyUp(e)}),this.clear.fastClick(function(){return i.handleFacetSearchClear()}),this.input.focus(function(e){return i.handleFacetSearchFocus(e)}),this.input.blur(function(){return i.handleFacetSearchBlur()}),this.search},i.prototype.buildSearchMobile=function(){var i=this,n=e.$("<div class='coveo-search-button-mobile'>"+t.l("Search")+"</div>");return this.search=this.buildBaseSearch(),n.fastClick(function(){var n=e.ModalBox.open(e.$("<div />").append(i.search),{title:e.JQueryUtils.getPopUpCloseButton(t.l("Close"),t.l("SearchIn",i.facet.options.title)),validation:function(){return i.completelyDismissSearch(),!0},className:"coveo-mobile-facet-search"});e.$(n.wrapper.find(".coveo-title")).fastClick(function(){return n.close()}),i.input.val("").keyup().focus()}),n},i.prototype.handleFacetSearchKeyUp=function(t){e.Assert.exists(t);var i=""==this.input.val();this.showOrHideClearElement(i),e.DeviceUtils.isMobileDevice()?this.startNewSearchTimeout():this.handleKeyboardNavigation(t,i)},i.prototype.handleFacetSearchFocus=function(){""==this.getValueInInputForFacetSearch()||e.DeviceUtils.isMobileDevice()||this.startNewSearchTimeout(),e.DeviceUtils.isSmallScreenWidth()&&e.MobileUtils.addToggleClassOnSearchInterface("slide-left")},i.prototype.handleFacetSearchBlur=function(){var t=this;setTimeout(function(){e.DeviceUtils.isMobileDevice()||t.completelyDismissSearch()},250)},i.prototype.handleFacetSearchClear=function(){this.input.val(""),this.clear.hide(),this.completelyDismissSearch()},i.prototype.showOrHideClearElement=function(e){e?(this.clear.hide(),this.search.removeClass("coveo-no-results")):this.clear.show()},i.prototype.handleKeyboardNavigation=function(e,t){switch(e.which){case 13:this.keyboardNavigationEnterPressed(e,t);break;case 46:this.keyboardNavigationDeletePressed(e);break;case 27:this.completelyDismissSearch();break;case 40:this.moveCurrentResultDown();break;case 38:this.moveCurrentResultUp();break;default:this.highlightCurrentQueryWithinSearchResults(),this.startNewSearchTimeout()}},i.prototype.keyboardNavigationEnterPressed=function(e,t){e.shiftKey?this.triggerNewFacetSearch():this.searchResults.is(":visible")||"block"==this.searchResults.css("display")?(this.performSelectActionOnCurrentSearchResult(),this.completelyDismissSearch()):this.search.is(".coveo-no-results")||t||this.selectAllValuesMatchingSearch()},i.prototype.keyboardNavigationDeletePressed=function(e){e.shiftKey&&(this.performExcludeActionOnCurrentSearchResult(),this.completelyDismissSearch(),this.input.val(""))},i.prototype.triggerNewFacetSearch=function(i){var n=this;void 0===i&&(i=this.facet.options.numberOfValuesInFacetSearch),this.cancelAnyPendingSearchOperation(),this.showFacetSearchWaitingAnimation(),this.facet.logger.info("Triggering new facet search");{var o=this.getValueInInputForFacetSearch();t.FacetUtils.getValuesToUseForSearchInFacet(o,this.facet)}this.facetSearchDeferred=this.facet.facetQueryController.recursiveFacetSearch(o,this.facet.options.numberOfValuesInFacetSearch),this.facetSearchDeferred.done(function(e){n.facet.usageAnalytics.logCustomEvent(t.AnalyticsActionCauseList.facetSearch,{facetId:n.facet.options.uniqueId},n.facet.root),n.facet.logger.debug("Received field values",e),n._processNewFacetSearchResults(e.slice(0,n.facet.options.numberOfValuesInFacetSearch+1)),n.hideFacetSearchWaitingAnimation(),n.facetSearchDeferred=void 0}),this.facetSearchDeferred.fail(function(t,i){e.Utils.exists(i)&&(n.facet.logger.error("Error while retrieving facet values",i),n.hideFacetSearchWaitingAnimation()),n.facetSearchDeferred=void 0})},i.prototype.startNewSearchTimeout=function(){var e=this;this.cancelAnyPendingSearchOperation(),this.facetSearchTimeout=setTimeout(function(){""!=e.getValueInInputForFacetSearch()?e.triggerNewFacetSearch():e.completelyDismissSearch()},this.facet.options.facetSearchDelay)},i.prototype.cancelAnyPendingSearchOperation=function(){e.Utils.exists(this.facetSearchTimeout)&&(clearTimeout(this.facetSearchTimeout),this.facetSearchTimeout=void 0),e.Utils.exists(this.facetSearchDeferred)&&(this.facetSearchDeferred.reject(),this.facetSearchDeferred=void 0),this.hideFacetSearchWaitingAnimation()},i.prototype._processNewFacetSearchResults=function(i){e.Assert.exists(i),i.length>0?(this.search.removeClass("coveo-no-results"),this.facet.fadeInactiveValuesInMainList(this.facet.options.facetSearchDelay),this.rebuildSearchResults(i),this.showSearchResultsElement(),this.highlightCurrentQueryWithinSearchResults(),t.FacetUtils.clipCaptionsToAvoidOverflowingTheirContainer(this.facet,!0),this.makeFirstSearchResultTheCurrentOne()):(this.hideSearchResultsElement(),this.search.addClass("coveo-no-results"))},i.prototype.rebuildSearchResults=function(i){var n=this;e.Assert.exists(i),this.searchResults.empty();var o=e.$('<li class="coveo-selectable coveo-select-all"/>').text(t.l("SelectAll"));o.fastClick(function(){return n.selectAllValuesMatchingSearch()}),e.DeviceUtils.isMobileDevice()||o.appendTo(this.searchResults);var s=e._.map(i,function(e){return t.FacetValue.create(e)});new this.facetSearchValuesListKlass(this.facet,t.FacetValueElement).build(s).appendTo(this.searchResults),e.DeviceUtils.isMobileDevice()&&(o.append("<span class='coveo-mobile-facet-search-select-all'></span>"),o.appendTo(this.searchResults)),this.searchResults.find(".coveo-selectable").each(function(t,i){e.$(i).mousemove(function(){n.makeCurrentResult(e.$(i))})})},i.prototype.showSearchResultsElement=function(){this.searchResults.appendTo(this.facet.root),this.positionSearchResults()},i.prototype.hideSearchResultsElement=function(){this.searchResults.remove()},i.prototype.highlightCurrentQueryWithinSearchResults=function(){var t=this;e.$(this.searchResults).find(".coveo-caption").each(function(i,n){var o=t.getValueInInputForFacetSearch(),s=new RegExp("("+e.StringUtils.wildcardsToRegex(o)+")","ig"),r=e.$(n).text(),a=r.replace(s,'<span class="coveo-highlight">$1</span>');e.$(n).html(a)})},i.prototype.makeFirstSearchResultTheCurrentOne=function(){this.makeCurrentResult(this.getSelectables().first())},i.prototype.makeCurrentResult=function(){this.getSelectables().removeClass("coveo-current"),this.getSelectables().first().addClass("coveo-current")},i.prototype.moveCurrentResultDown=function(){var e=this.searchResults.find(".coveo-current");this.getSelectables().removeClass("coveo-current");var t=e.next(".coveo-selectable").first();t.length>0?t.addClass("coveo-current"):e.siblings(".coveo-selectable").first().addClass("coveo-current")},i.prototype.moveCurrentResultUp=function(){var e=this.searchResults.find(".coveo-current");this.searchResults.find(".coveo-selectable").removeClass("coveo-current");var t=e.prev(".coveo-selectable").first();t.length>0?t.addClass("coveo-current"):e.siblings(".coveo-selectable").last().addClass("coveo-current")},i.prototype.getSelectables=function(e){return void 0===e&&(e=this.searchResults),e.find(".coveo-selectable")},i.prototype.performSelectActionOnCurrentSearchResult=function(){var t=this.searchResults.find(".coveo-current");e.Assert.check(1==t.length);var i=t.find('input[type="checkbox"]');i.length>0?(i.prop("checked",!0),i.change()):t.fastClick()},i.prototype.performExcludeActionOnCurrentSearchResult=function(){var t=this.searchResults.find(".coveo-current");e.Assert.check(1==t.length),t.find(".coveo-exclude").fastClick()},i.prototype.getValueInInputForFacetSearch=function(){return this.input.val()},i.prototype.selectAllValuesMatchingSearch=function(){var i=this;this.facet.showWaitingAnimation();var n=this.getValueInInputForFacetSearch(),o=t.FacetUtils.getValuesToUseForSearchInFacet(n,this.facet),s=this.facet.facetQueryController.searchInFacet(1e3,o,this.facet.options.facetSearchIgnoreAccents);s.done(function(n){i.completelyDismissSearch();var o=e._.map(n,function(n){var o=i.facet.values.get(n.value);return e.Utils.exists(o)||(o=t.FacetValue.create(n)),o.selected=!0,o.excluded=!1,o});i.facet.processFacetSearchAllResultsSelected(o)}),this.completelyDismissSearch()},i.prototype.showFacetSearchWaitingAnimation=function(){var t=this;e.Defer.defer(function(){t.showingFacetSearchWaitAnimation||(t.wait.width(t.magnifier.width()),t.wait.height(t.magnifier.height()),t.magnifier.hide(),t.wait.show(),t.showingFacetSearchWaitAnimation=!0)})},i.prototype.hideFacetSearchWaitingAnimation=function(){this.showingFacetSearchWaitAnimation&&(this.magnifier.show(),this.wait.hide(),this.showingFacetSearchWaitAnimation=!1)},i}();t.FacetSearch=i}(t=e.Ui||(e.Ui={}))}(Coveo||(Coveo={}));var Coveo;!function(e){var t=function(){function t(t){this.id=t,e.Assert.exists(window.localStorage)}return t.prototype.save=function(e){localStorage.setItem(this.getLocalStorageKey(),JSON.stringify(e))},t.prototype.load=function(){var e=localStorage.getItem(this.getLocalStorageKey());return e&&JSON.parse(e)},t.prototype.remove=function(e){if(void 0==e)localStorage.removeItem(this.getLocalStorageKey());else{var t=this.load();delete t[e],this.save(t)}},t.prototype.getLocalStorageKey=function(){return"coveo-"+this.id},t}();e.LocalStorageUtils=t}(Coveo||(Coveo={}));var Coveo;!function(e){var t;!function(t){var i=function(){function i(n,o){var s=this;this.facet=o,this.facetSettingsIconTemplate=e._.template("<span class='coveo-icon'></span>"),this.facetSettingsButtonTemplate=e._.template("<div title='"+t.l("Settings")+"' class='coveo-settings'></div>"),this.facetSettingsPopupTemplate=e._.template('<div class="coveo-settings-popup"></div>'),this.facetSettingsSectionTemplate=e._.template("<div class='coveo-section <%= _class %>'></div>"),this.facetSettingsSectionIconTemplate=e._.template("<div class='coveo-icon'></div>"),this.facetSettingsItemsTemplate=e._.template("<div class='coveo-items'></div>"),this.facetSettingsItemTemplate=e._.template("<div class='coveo-item' title='<%- title %>'><%- label %></div>"),this.enabledSorts=[],this.enabledSortsIgnoreRenderBecauseOfPairs=[],this.customSortDirection="ascending",this.customSortDirectionChange=!1,e._.each(n,function(e){var t=i.availableSorts[e.toLowerCase()];void 0!=t&&s.enabledSorts.push(t)}),this.removeEnabledSortsBasedOnFacetType(),this.filterDuplicateForRendering(),e.Utils.isNonEmptyArray(this.enabledSorts)&&(void 0!=this.facet.options.sortCriteria&&(this.activeSort=e._.find(this.enabledSorts,function(e){return e.name==s.facet.options.sortCriteria})),this.activeSort||(this.activeSort=this.enabledSorts[0]))}return i.prototype.build=function(){if(this.settingsButton=e.$(this.facetSettingsButtonTemplate()),this.settingsIcon=e.$(this.facetSettingsIconTemplate()),this.settingsPopup=e.$(this.facetSettingsPopupTemplate()),e.Utils.isNonEmptyArray(this.enabledSorts)){var t=this.buildSortSection();this.directionSection=this.buildDirectionSection()}return this.facet.options.enableSettingsFacetState&&(this.saveStateSection=this.buildSaveStateSection(),this.clearStateSection=this.buildClearStateSection()),this.hideSection=this.buildHideSection(),this.showSection=this.buildShowSection(),this.handleMouseEventOnButton(t),e.Utils.isNonEmptyArray(this.enabledSorts)?this.settingsPopup.append(t.element,this.directionSection,this.saveStateSection,this.clearStateSection,this.hideSection,this.showSection):this.settingsPopup.append(this.saveStateSection,this.clearStateSection,this.hideSection,this.showSection),this.settingsButton.append(this.settingsIcon),this.settingsButton},i.prototype.reorderValues=function(e){return"custom"==this.activeSort.name&&void 0!=this.facet.options.customSort?this.reorderValuesWithCustomOrder(e):e},i.prototype.loadSavedState=function(){var t=this.facetStateLocalStorage.load(),i=this.facet.queryStateModel.get(this.includedStateAttribute),n=this.facet.queryStateModel.get(this.excludedStateAttribute),o=this.facet.queryStateModel.get(this.operatorStateAttribute);if(!e.Utils.isNullOrUndefined(t)&&e.Utils.isEmptyArray(i)&&e.Utils.isEmptyArray(n)&&!e.Utils.isNonEmptyString(o)){var s={};s[this.includedStateAttribute]=t.included,s[this.excludedStateAttribute]=t.excluded,s[this.operatorStateAttribute]=t.operator,this.facet.queryStateModel.setMultiple(s),this.loadedFromSettings=s}},i.prototype.removeEnabledSortsBasedOnFacetType=function(){if(this.facet.isInstanceOf("FacetRange")){var e=this.facet;e.options.slider&&(this.enabledSorts=[])}},i.prototype.reorderValuesWithCustomOrder=function(t){var i=this,n=t.length,o=e._.map(t,function(t){var o=e._.indexOf(i.facet.options.customSort,t.lookupValue||t.value);return o=-1==o?++n:o,{facetValue:t,index:o}}),s=e._.sortBy(o,"index");return s="ascending"==this.customSortDirection?s:s.reverse(),e._.pluck(s,"facetValue")},i.prototype.buildSortSection=function(){var t=e.$(this.facetSettingsSectionTemplate({_class:"coveo-sort"})),i=e.$(this.facetSettingsSectionIconTemplate()),n=e.$(this.facetSettingsItemsTemplate()),o=this.buildSortSectionItems();return n.append(o),t.append(i,n),{element:t,sortItems:o}},i.prototype.buildSortSectionItems=function(){var t=this;return e._.map(this.enabledSorts,function(i){return e._.contains(t.enabledSortsIgnoreRenderBecauseOfPairs,i)?e.$("<div></div>").hide():e.$(t.facetSettingsItemTemplate({label:e.L10N.format(i.label),title:i.description})).click(function(e){return t.handleClickSortButton(e,i)})})},i.prototype.closePopupAndUpdateSort=function(){this.closePopup(),"custom"!=this.activeSort.name?this.facet.updateSort(this.activeSort.name):(this.facet.updateSort("nosort"),this.customSortDirectionChange&&(this.customSortDirectionChange=!1,this.facet.queryController.executeQuery()))},i.prototype.closePopup=function(){this.settingsPopup.detach()},i.prototype.buildDirectionSection=function(){var i=this,n=e.$(this.facetSettingsSectionTemplate({_class:"coveo-direction"})),o=e.$(this.facetSettingsSectionIconTemplate()),s=e.$(this.facetSettingsItemsTemplate()),r=e.$(this.facetSettingsItemTemplate({label:t.l("Ascending"),title:t.l("Ascending")})).click(function(e){return i.handleDirectionClick(e,"ascending")}),a=e.$(this.facetSettingsItemTemplate({label:t.l("Descending"),title:t.l("Descending")})).click(function(e){return i.handleDirectionClick(e,"descending")});return s.append(r,a),n.append(o,s),this.activeSort.directionToggle?this.selectItem(this.getItems(n).first()):n.addClass("coveo-disabled"),n},i.prototype.buildSaveStateSection=function(){var i=this,n=e.$(this.facetSettingsSectionTemplate({_class:"coveo-save-state"})),o=e.$(this.facetSettingsSectionIconTemplate()),s=e.$(this.facetSettingsItemsTemplate());this.facetStateLocalStorage=new e.LocalStorageUtils("facet-state-"+this.facet.options.uniqueId),this.includedStateAttribute=e.Models.QueryStateModel.getFacetId(this.facet.options.uniqueId),this.excludedStateAttribute=e.Models.QueryStateModel.getFacetId(this.facet.options.uniqueId,!1),this.operatorStateAttribute=e.Models.QueryStateModel.getFacetOperator(this.facet.options.uniqueId);e.$(this.facetSettingsItemTemplate({label:t.l("SaveFacetState"),title:t.l("SaveFacetState")})).fastClick(function(e){return i.handleSaveStateClick(e)}).appendTo(s);return n.append(o,s),n},i.prototype.buildClearStateSection=function(){{var i=this,n=e.$(this.facetSettingsSectionTemplate({_class:"coveo-clear-state"})),o=e.$(this.facetSettingsSectionIconTemplate()),s=e.$(this.facetSettingsItemsTemplate());e.$(this.facetSettingsItemTemplate({label:t.l("ClearFacetState"),title:t.l("ClearFacetState")})).fastClick(function(e){return i.handleClearStateClick(e)}).appendTo(s)
}return n.append(o,s),n},i.prototype.buildHideSection=function(){{var i=this,n=e.$(this.facetSettingsSectionTemplate({_class:"coveo-hide"})),o=e.$(this.facetSettingsSectionIconTemplate()),s=e.$(this.facetSettingsItemsTemplate());e.$(this.facetSettingsItemTemplate({label:t.l("Collapse"),title:t.l("HideFacet")})).fastClick(function(){i.facet.collapseFacet(),i.settingsPopup.detach()}).appendTo(s)}return n.append(o,s),n},i.prototype.buildShowSection=function(){{var i=this,n=e.$(this.facetSettingsSectionTemplate({_class:"coveo-show"})),o=e.$(this.facetSettingsSectionIconTemplate()),s=e.$(this.facetSettingsItemsTemplate());e.$(this.facetSettingsItemTemplate({label:t.l("Expand"),title:t.l("Expand")})).click(function(){i.facet.expandFacet(),i.settingsPopup.detach()}).appendTo(s)}return n.append(o,s),n},i.prototype.handleClickSettingsButtons=function(t,i){var n=this;this.settingsPopup.is(":visible")?this.settingsPopup.detach():(e.JQueryUtils.positionPopup(this.settingsPopup,e.$(t.delegateTarget),e.$(this.facet.root),e.$(this.facet.root),this.getPopupAlignment()),this.hideSection.toggle(!e.$(this.facet.element).hasClass("coveo-collapsed")),this.showSection.toggle(e.$(this.facet.element).hasClass("coveo-collapsed")),this.facet.options.enableSettingsFacetState&&this.clearStateSection.toggle(!e.Utils.isNullOrUndefined(this.facetStateLocalStorage.load())),e._.each(this.enabledSorts,function(e,t){n.activeSort.name.toLowerCase()==e.name.toLowerCase()?n.selectItem(i.sortItems[t]):n.unselectItem(i.sortItems[t])}))},i.prototype.handleClickSortButton=function(t,n){this.activeSort=n,n.directionToggle&&e._.contains(this.enabledSorts,i.availableSorts[this.activeSort.relatedSort])?this.activateDirectionSection():this.disableDirectionSection(),this.selectItem(e.$(t.target)),this.closePopupAndUpdateSort()},i.prototype.handleDirectionClick=function(t,n){e.$(t.target).parent().parent().hasClass("coveo-disabled")||-1!=this.activeSort.name.indexOf(n)||(this.activeSort=i.availableSorts[this.activeSort.relatedSort],this.unselectSection(this.directionSection),this.selectItem(e.$(t.target)),"custom"==this.activeSort.name&&this.customSortDirection!=n&&(this.customSortDirection=n,this.customSortDirectionChange=!0),this.closePopupAndUpdateSort())},i.prototype.handleSaveStateClick=function(){this.facetStateLocalStorage.save({included:this.facet.queryStateModel.get(this.includedStateAttribute),excluded:this.facet.queryStateModel.get(this.excludedStateAttribute),operator:this.facet.queryStateModel.get(this.operatorStateAttribute)}),this.closePopup()},i.prototype.handleClearStateClick=function(){var e=this;this.facetStateLocalStorage.remove(),this.facet.reset(),this.closePopup(),this.facet.triggerNewQuery(function(){return e.facet.usageAnalytics.logSearchEvent(t.AnalyticsActionCauseList.facetClearAll,{facetId:e.facet.options.uniqueId})})},i.prototype.handleMouseEventOnButton=function(t){var i,n=this;this.settingsButton.click(function(e){return n.handleClickSettingsButtons(e,t)}),e.$([this.settingsIcon[0],this.settingsPopup[0]]).mouseleave(function(){return i=setTimeout(function(){n.settingsPopup.detach()},300)}).mouseenter(function(){return clearTimeout(i)})},i.prototype.activateDirectionSection=function(){this.directionSection.removeClass("coveo-disabled"),this.unselectSection(this.directionSection),this.selectItem(this.getItems(this.directionSection).first())},i.prototype.disableDirectionSection=function(){this.directionSection.addClass("coveo-disabled"),this.unselectSection(this.directionSection)},i.prototype.getItems=function(e){return e.find(".coveo-item")},i.prototype.unselectSection=function(e){this.getItems(e).removeClass("coveo-selected")},i.prototype.selectItem=function(e){e.addClass("coveo-selected")},i.prototype.unselectItem=function(e){e.removeClass("coveo-selected")},i.prototype.filterDuplicateForRendering=function(){this.hasDuplicate("alphaascending","alphadescending")&&this.enabledSortsIgnoreRenderBecauseOfPairs.push(i.availableSorts.alphadescending),this.hasDuplicate("computedfieldascending","computedfielddescending")&&this.enabledSortsIgnoreRenderBecauseOfPairs.push(i.availableSorts.computedfielddescending)},i.prototype.getPopupAlignment=function(){var t=e.DeviceUtils.isMobileDevice()?1:2,i=2;return{horizontal:t,vertical:i}},i.prototype.hasDuplicate=function(t,i){var n=e._.filter(this.enabledSorts,function(e){return e.name==t||e.name==i});return void 0!=n&&2==n.length},i.availableSorts={score:{label:t.l("Score"),directionToggle:!1,description:t.l("ScoreDescription"),name:"score"},occurrences:{label:t.l("Occurrences"),directionToggle:!1,description:t.l("OccurrencesDescription"),name:"occurrences"},alphaascending:{label:t.l("Label"),directionToggle:!0,description:t.l("LabelDescription"),name:"alphaascending",relatedSort:"alphadescending"},alphadescending:{label:t.l("Label"),directionToggle:!0,description:t.l("LabelDescription"),name:"alphadescending",relatedSort:"alphaascending"},computedfieldascending:{label:t.l("Value"),directionToggle:!0,description:t.l("ValueDescription"),name:"computedfieldascending",relatedSort:"computedfielddescending"},computedfielddescending:{label:t.l("Value"),directionToggle:!0,description:t.l("ValueDescription"),name:"computedfielddescending",relatedSort:"computedfieldascending"},chisquare:{label:t.l("RelativeFrequency"),directionToggle:!1,description:t.l("RelativeFrequencyDescription"),name:"chisquare"},custom:{label:t.l("Custom"),directionToggle:!0,description:t.l("CustomDescription"),name:"custom",relatedSort:"custom"}},i}();t.FacetSettings=i}(t=e.Ui||(e.Ui={}))}(Coveo||(Coveo={}));var Coveo;!function(e){var t;!function(t){var i=function(){function i(e,t){this.facet=e,this.facetValueElementKlass=t,this.valueList={}}return i.prototype.build=function(){return this.valueContainer=e.$('<ul class="coveo-values"/>'),this.valueContainer},i.prototype.get=function(i){var n;return i instanceof t.FacetValue?n=i.value:(i=e.Utils.anyTypeToString(i),n=i.toLowerCase()),this.ensureFacetValueIsInList(i),this.valueList[n]},i.prototype.select=function(e){var t=this.get(e);return t.select(),t},i.prototype.unselect=function(e){var t=this.get(e);return t.unselect(),t},i.prototype.exclude=function(e){var t=this.get(e);return t.exclude(),t},i.prototype.unExclude=function(e){var t=this.get(e);return t.unexclude(),t},i.prototype.toggleSelect=function(e){var t=this.get(e);return t.facetValue.selected?t.unselect():t.select(),t},i.prototype.toggleExclude=function(e){var t=this.get(e);return t.facetValue.excluded?t.unexclude():t.exclude(),t},i.prototype.rebuild=function(i){var n=this;this.valueContainer.empty();var o=this._getValuesToBuildWith(),s=i;e._.each(o,function(e,t){if(n.facetValueShouldBeRemoved(e))n.facet.values.remove(e.value),s+=1;else if(s>t){var i=new n.facetValueElementKlass(n.facet,e,!0);n.valueList[e.value]=i;var o=i.build().listElement;n.valueContainer.append(o)}}),t.FacetUtils.addNoStateCssClassToFacetValues(this.facet,this.valueContainer),t.FacetUtils.clipCaptionsToAvoidOverflowingTheirContainer(this.facet)},i.prototype._getValuesToBuildWith=function(){return this.facet.facetSettings?this.facet.facetSettings.reorderValues(this.facet.values.getAll()):this.facet.values.getAll()},i.prototype.facetValueShouldBeRemoved=function(e){return!(0!=e.occurrences||0!=e.delta&&void 0!=e.delta||e.selected||e.excluded||this.facet.keepDisplayedValuesNextTime)},i.prototype.ensureFacetValueIsInList=function(e){var i;e instanceof t.FacetValue?(i=this.facet.values.get(e.value),null==i&&(this.facet.values.add(e),i=e)):(i=this.facet.values.get(e),null==i&&(i=t.FacetValue.createFromValue(e),this.facet.values.add(i))),void 0==this.valueList[i.value]?(this.valueList[i.value]=new t.FacetValueElement(this.facet,i,!0),this.valueList[i.value].build()):this.valueList[i.value].facetValue=i},i.prototype.addNoStateCssClassToFacetValues=function(){if(0!=this.facet.values.getSelected().length){var t=this.valueContainer.find("li").not(".coveo-selected");e._.each(t,function(t){e.$(t).addClass("coveo-no-state")})}},i}();t.FacetValuesList=i}(t=e.Ui||(e.Ui={}))}(Coveo||(Coveo={}));var Coveo;!function(e){var t;!function(t){var i=function(){function i(e,t){this.facet=e,this.facetValue=t}return i.prototype.build=function(){this.listElement=e.$('<li class="coveo-value coveo-selectable"/>'),this.listElement.data("value",this.facetValue.value),this.facetValue.excluded||(this.excludeIcon=this._buildExcludeIcon().appendTo(this.listElement)),this.label=e.$("<label/>").appendTo(this.listElement),e.Utils.exists(this.facetValue.computedField)&&(this.computedField=this._buildValueComputedField().appendTo(this.label),this.label.addClass("coveo-with-computed-field"));var t=e.$('<div class="coveo-label"/>').appendTo(this.label);return this.checkbox=this._buildValueCheckbox().appendTo(t),this.stylishCheckbox=this._buildValueStylishCheckbox().appendTo(t),this.facet.options.showIcon&&(this.icon=this._buildValueIcon().appendTo(t)),this.valueCaption=this._buildValueCaption().appendTo(t),this.valueCount=this._buildValueCount().appendTo(t),this._setCssClassOnListValueElement(),this.bindEvent({displayNextTime:!0,pinFacet:this.facet.options.preservePosition}),this},i.prototype.bindEvent=function(t){this.isOmnibox=e.Utils.isNullOrUndefined(t.omniboxObject)?!1:!0,this._handleEventForCheckboxChange(t),this.facetValue.excluded?this._handleEventForExcludedValueElement(t):this._handleEventForValueElement(t)},i.prototype.select=function(){this.facetValue.selected=!0,this.facetValue.excluded=!1,this._setCssClassOnListValueElement()},i.prototype.unselect=function(){this.facetValue.selected=!1,this.facetValue.excluded=!1,this._setCssClassOnListValueElement()},i.prototype.exclude=function(){this.facetValue.selected=!1,this.facetValue.excluded=!0,this._setCssClassOnListValueElement()},i.prototype.unexclude=function(){this.facetValue.selected=!1,this.facetValue.excluded=!1,this._setCssClassOnListValueElement()},i.prototype._buildExcludeIcon=function(){return e.$("<div />").attr("title",t.l("Exclude",this.facet.getValueCaption(this.facetValue))).addClass("coveo-exclude")},i.prototype._buildValueComputedField=function(){var t=this.facetValue.getFormattedComputedField(this.facet.options.computedFieldFormat);return e.Utils.isNonEmptyString(t)?e.$("<span/>").addClass("coveo-computed-field").text(t):e.$([])},i.prototype._buildValueCheckbox=function(){var i=e.$('<input type="checkbox"/>');return i.prop("checked",this.facetValue.selected),i.prop("disabled",this.facetValue.excluded),t.Component.pointElementsToDummyForm(i),i},i.prototype._buildValueStylishCheckbox=function(){var t=e.$("<div/>").addClass("coveo-checkbox");return e.$("<span/>").appendTo(t),t},i.prototype._buildValueIcon=function(){var t=this._getValueIcon();return e.Utils.exists(t)?e.$('<img class="coveo-icon"/>').prop("src",this._getValueIcon()):this._buildValueIconFromSprite()},i.prototype._getValueIcon=function(){return e.Utils.exists(this.facet.options.valueIcon)?this.facet.options.valueIcon(this.facetValue):void 0},i.prototype._buildValueIconFromSprite=function(){return e.$("<div />").addClass("coveo-icon").addClass(this.facet.options.field.substr(1)).addClass(this.facetValue.value)},i.prototype._buildValueCaption=function(){return e.$('<span class="coveo-caption"/>').text(this.facet.getValueCaption(this.facetValue))},i.prototype._buildValueCount=function(){var t=this.facetValue.getFormattedCount();if(e.Utils.isNonEmptyString(t)){var i=e.$("<span/>").addClass("coveo-count").text(t);return i}return e.$([])},i.prototype._handleSelectValue=function(e){var i=this;this.facet.keepDisplayedValuesNextTime=e.displayNextTime&&!this.facet.options.useAnd;var n;this.facetValue.excluded?(n=t.AnalyticsActionCauseList.facetUnexclude,this.facet.unexcludeValue(this.facetValue)):(n=this.facetValue.selected?t.AnalyticsActionCauseList.facetDeselect:t.AnalyticsActionCauseList.facetSelect,this.facet.toggleSelectValue(this.facetValue)),this.isOmnibox&&(n=t.AnalyticsActionCauseList.omniboxFacet),this.facet.triggerNewQuery(function(){return i.facet.usageAnalytics.logSearchEvent(n,i.getAnalyticsFacetMeta())})},i.prototype._handleExcludeClick=function(e){var i=this;this.facet.keepDisplayedValuesNextTime=e.displayNextTime&&!this.facet.options.useAnd,this.facet.toggleExcludeValue(this.facetValue);var n=this.isOmnibox?t.AnalyticsActionCauseList.omniboxFacet:t.AnalyticsActionCauseList.facetExclude;this.facet.triggerNewQuery(function(){return i.facet.usageAnalytics.logSearchEvent(n,i.getAnalyticsFacetMeta())})},i.prototype._handleEventForExcludedValueElement=function(e){var t=this;this.label.fastClick(function(i){e.pinFacet&&t.facet.pinFacetPosition(),e.omniboxObject&&t._omniBoxCloseEvent(e.omniboxObject),t._handleSelectValue(e),i.stopPropagation()})},i.prototype._handleEventForValueElement=function(e){var t=this;this.excludeIcon.fastClick(function(i){e.omniboxObject&&t._omniBoxCloseEvent(e.omniboxObject),t._handleExcludeClick(e),i.stopPropagation()}),this.label.fastClick(function(i){e.pinFacet&&t.facet.pinFacetPosition(),i.preventDefault(),t.checkbox.change()})},i.prototype._handleEventForCheckboxChange=function(t){var i=this;this.checkbox.change(function(){t.omniboxObject&&i._omniBoxCloseEvent(t.omniboxObject),i._handleSelectValue(t),e.DeviceUtils.isMobileDevice()&&e.Defer.defer(function(){e.ModalBox.close(!0),i.facet.facetSearch.completelyDismissSearch()})})},i.prototype._omniBoxCloseEvent=function(e){e.closeOmniBox(),e.clear()},i.prototype._setCssClassOnListValueElement=function(){this.listElement.toggleClass("coveo-selected",this.facetValue.selected),this.listElement.toggleClass("coveo-excluded",this.facetValue.excluded)},i.prototype.getAnalyticsFacetMeta=function(){return{facetId:this.facet.options.uniqueId,facetValue:this.facetValue.value}},i}();t.ValueElement=i}(t=e.Ui||(e.Ui={}))}(Coveo||(Coveo={}));var Coveo;!function(e){var t;!function(t){var i=function(t){function i(i,n,o){var s=this;t.call(this,i,n),this.facet=i,this.facetValue=n,this.keepDisplayedValueNextTime=o,this.firstQuery=!0,e.$(i.root).one(e.Events.QueryEvents.querySuccess,function(){s.firstQuery=!1})}return __extends(i,t),i.prototype.bindEvent=function(){t.prototype.bindEvent.call(this,{displayNextTime:this.keepDisplayedValueNextTime,pinFacet:this.facet.options.preservePosition})},i}(t.ValueElement);t.FacetValueElement=i}(t=e.Ui||(e.Ui={}))}(Coveo||(Coveo={}));var Coveo;!function(e){var t;!function(e){var t=function(e){function t(t,i,n){e.call(this,t,i),this.facet=t,this.facetValue=i,this.eventArg=n}return __extends(t,e),t.prototype.bindEvent=function(){e.prototype.bindEvent.call(this,{displayNextTime:!1,pinFacet:!1,omniboxObject:this.eventArg})},t}(e.ValueElement);e.OmniBoxValueElement=t}(t=e.Ui||(e.Ui={}))}(Coveo||(Coveo={}));var Coveo;!function(e){var t;!function(t){var i=function(){function t(e,t){this.facet=e,this.facetValueElementKlass=t}return t.prototype.build=function(t){var i=this,n=e._.map(t,function(t){return e._.find(i.facet.values.getAll(),function(e){return e.value==t.value})||t});return e._.reduce(e._.map(n,function(e){return new i.facetValueElementKlass(i.facet,e,i.facet.keepDisplayedValuesNextTime).build().listElement}),function(e,t){return e.add(t)})},t}();t.FacetSearchValuesList=i}(t=e.Ui||(e.Ui={}))}(Coveo||(Coveo={}));var Coveo;!function(e){var t;!function(t){var i=function(){function i(e,t){this.facet=e,this.facetValue=t}return i.prototype.build=function(i){var n=this;void 0===i&&(i=!0),e.Assert.exists(this.facetValue);var o=e.DeviceUtils.isMobileDevice()?e.$("<div/>"):e.$("<span/>");o.addClass("coveo-value"),o.toggleClass("coveo-selected",this.facetValue.selected),o.toggleClass("coveo-excluded",this.facetValue.excluded),o.attr("title",this.getBreadcrumbTooltip()),e.$("<span/>").addClass("coveo-caption").text(this.facet.getValueCaption(this.facetValue)).appendTo(o),e.$("<span/>").addClass("coveo-clear").appendTo(o);var s=!1;return o.fastClick(function(){s||(s=!0,n.facetValue.excluded?n.facet.unexcludeValue(n.facetValue.value):n.facet.deselectValue(n.facetValue.value),n.facet.triggerNewQuery(function(){return n.facet.usageAnalytics.logSearchEvent(t.AnalyticsActionCauseList.breadcrumbFacet,{facetId:n.facet.options.uniqueId,facetValue:n.facetValue.value})}))}),o},i.prototype.getBreadcrumbTooltip=function(){var t=[this.facet.getValueCaption(this.facetValue),this.facetValue.getFormattedCount(),this.facetValue.getFormattedComputedField(this.facet.options.computedFieldFormat)];return e._.compact(t).join(" ")},i}();t.BreadcrumbValueElement=i}(t=e.Ui||(e.Ui={}))}(Coveo||(Coveo={}));var Coveo;!function(e){var t;!function(t){var i=function(){function t(t,i,n){this.facet=t,this.facetValues=i,this.breadcrumbValueElementKlass=n,this.setExpandedAndCollapsed(),this.elem=e.$("<div/>").addClass("coveo-facet-breadcrumb");var o=e.DeviceUtils.isMobileDevice()?e.$("<div/>"):e.$("<span/>");o.addClass("coveo-title").text(this.facet.options.title+(e.DeviceUtils.isMobileDevice()?"":":")).appendTo(this.elem),this.valueContainer=e.$("<span/>").addClass("coveo-values").appendTo(this.elem)}return t.prototype.build=function(){return this.buildExpanded(),0!=this.collapsed.length&&this.buildCollapsed(),this.elem},t.prototype.buildExpanded=function(){var t=this;e._.each(this.expanded,function(i,n){0==n||e.DeviceUtils.isMobileDevice()||e.$("<span/>").addClass("coveo-separator").text(", ").appendTo(t.valueContainer),new t.breadcrumbValueElementKlass(t.facet,i).build().appendTo(t.valueContainer)})},t.prototype.buildCollapsed=function(){var t=this,i=e._.filter(this.collapsed,function(e){return e.selected}).length,n=e._.filter(this.collapsed,function(e){return e.excluded}).length;e.Assert.check(i+n==this.collapsed.length);var o=e.$("<div/>").addClass("coveo-value");e.DeviceUtils.isMobileDevice()||e.$("<span/>").addClass("coveo-separator").text(", ").appendTo(o),i>0&&(e.$("<span/>").addClass("coveo-multi-count").text(Globalize.format(i,"n0")).appendTo(o),e.$("<div/>").addClass("coveo-selected").addClass("coveo-multi-icon").appendTo(o)),n>0&&(e.$("<span/>").addClass("coveo-multi-count").text(Globalize.format(n,"n0")).appendTo(o),e.$("<div />").addClass("coveo-excluded").addClass("coveo-multi-icon").appendTo(o));var s=e._.map(this.collapsed,function(e){return new t.breadcrumbValueElementKlass(t.facet,e)}),r=e._.map(s,function(e){return e.getBreadcrumbTooltip()});o.attr("title",r.join("\n")),o.fastClick(function(){var t=[];e._.forEach(s,function(i){e.DeviceUtils.isMobileDevice()||t.push(e.$("<span/>").addClass("coveo-separator").text(", ")[0]),t.push(i.build(!1).get(0))}),e.$(t).insertBefore(o),o.detach()}),this.valueContainer.append(o)},t.prototype.setExpandedAndCollapsed=function(){this.facetValues.length>this.facet.options.numberOfValuesInBreadcrumb?(this.collapsed=e._.rest(this.facetValues,this.facet.options.numberOfValuesInBreadcrumb-1),this.expanded=e._.first(this.facetValues,this.facet.options.numberOfValuesInBreadcrumb-1)):(this.collapsed=[],this.expanded=this.facetValues)},t}();t.BreadcrumbValueList=i}(t=e.Ui||(e.Ui={}))}(Coveo||(Coveo={}));var Coveo;!function(e){var t;!function(t){var i=function(){function i(e,t,i,n){this.facet=e,this.facetValues=t,this.omniboxObject=i,this.omniBoxValueElementKlass=n}return i.prototype.build=function(){var t=this,i=[];return e._.each(this.facetValues,function(e){i.push(t.buildOmniBoxForOneRow(e,t.omniboxObject))}),this.buildFinalOmniBoxElement(i)},i.prototype.buildOmniBoxForOneRow=function(t,i){var n=new this.omniBoxValueElementKlass(this.facet,t,i),o=n.build().listElement,s=i.completeQueryExpression.regex,r=i.completeQueryExpression.word;o.find(".coveo-caption").html(this.highlightOmniBoxMatch(this.facet.getValueCaption(t),s,r));var a=e.$("<div class='coveo-omnibox-selectable coveo-omnibox-facet-value'></div>").append(o);return a.on("keyboardSelect",function(){o.find("input[type=checkbox]").change()}),a},i.prototype.buildFinalOmniBoxElement=function(i){var n=this.buildOmniBoxHeader();if(e.Utils.isEmptyArray(i))return void 0;var o=e.$("<div></div>").append(n,i);return t.FacetUtils.addNoStateCssClassToFacetValues(this.facet,o),o},i.prototype.buildOmniBoxHeader=function(){var t=e.$("<span class='coveo-icon "+this.facet.options.field.substr(1)+"'></span>"),i=this.facet.options.title;return e.$("<div class='coveo-omnibox-facet-header'></div>").append(t,i)},i.prototype.highlightOmniBoxMatch=function(e,t,i){var n=e.search(t),o=n+i.length;return e.slice(0,n)+"<span class='coveo-highlights'>"+e.slice(n,o)+"</span>"+e.slice(o)},i.prototype.omniBoxCloseEvent=function(e){e.closeOmniBox(),e.clear()},i}();t.OmniboxValuesList=i}(t=e.Ui||(e.Ui={}))}(Coveo||(Coveo={}));var Coveo;!function(e){var t;!function(e){var t=function(){function e(){}return e.populateOmniBox="populateOmniBox",e.openOmniBox="openOmniBox",e.closeOmniBox="closeOmniBox",e}();e.OmniBoxEvents=t}(t=e.Events||(e.Events={}))}(Coveo||(Coveo={}));var Coveo;!function(e){var t;!function(t){var i=function(i){function n(o,s,r,a){var l=this;void 0===a&&(a=n.ID),i.call(this,o,a,r),this.element=o,this.options=s,this.keepDisplayedValuesNextTime=!1,this.values=new t.FacetValues,this.firstQuery=!0,this.canFetchMore=!0,this.showingWaitAnimation=!1,this.listenToQueryStateChange=!0,this.options=t.ComponentOptions.initComponentOptions(o,n,s),null!=this.options.valueCaption&&(this.options.availableSorts=e._.filter(this.options.availableSorts,function(e){return!/^alpha.*$/.test(e)})),this._omniboxZIndex=n.omniboxIndex,n.omniboxIndex--,this._checkForComputedFieldAndSort(),this._checkForValueCaptionType(),this._checkForAllowedValuesOption(),this._checkForCustomSort(),this._initFacetQueryController(),this._initQueryEvents(),this._initQueryStateEvents(),this._initComponentStateEvents(),this._initOmniBoxEvents(),this._initBreadCrumbEvents(),this.numberOfValues=this.options.numberOfValues,e.$(window).resize(function(){l.disabled||t.FacetUtils.clipCaptionsToAvoidOverflowingTheirContainer(l)}),this._updateAppearanceDependingOnState(),e.$(this.root).one(e.Events.QueryEvents.querySuccess,function(){l.firstQuery=!1})}return __extends(n,i),n.prototype.createDom=function(){if(this._initBottomAndTopSpacer(),this._buildFacetContent(),this._updateAppearanceDependingOnState(),this.facetSettings&&this.options.enableSettingsFacetState){var t=e._.once(e.$.proxy(this.facetSettings.loadSavedState,this.facetSettings));this.bind.onRoot(e.Events.QueryEvents.newQuery,t)}},n.prototype.selectValue=function(t){e.Assert.exists(t),this.ensureDom(),this.logger.info("Selecting facet value",this.facetValuesList.select(t)),this._facetValueHasChanged()},n.prototype.selectMultipleValues=function(t){var i=this;e.Assert.exists(t),this.ensureDom(),e._.each(t,function(e){i.logger.info("Selecting facet value",i.facetValuesList.select(e))}),this._facetValueHasChanged()},n.prototype.deselectValue=function(t){e.Assert.exists(t),this.ensureDom(),this.logger.info("Deselecting facet value",this.facetValuesList.unselect(t)),this._facetValueHasChanged()},n.prototype.deselectMultipleValues=function(t){var i=this;e.Assert.exists(t),this.ensureDom(),e._.each(t,function(e){i.logger.info("Deselecting facet value",i.facetValuesList.unselect(e))}),this._facetValueHasChanged()},n.prototype.excludeValue=function(t){e.Assert.exists(t),this.ensureDom(),this.logger.info("Excluding facet value",this.facetValuesList.exclude(t)),this._facetValueHasChanged()},n.prototype.excludeMultipleValues=function(t){var i=this;e.Assert.exists(t),this.ensureDom(),e._.each(t,function(e){i.logger.info("Excluding facet value",i.facetValuesList.exclude(e))}),this._facetValueHasChanged()},n.prototype.unexcludeValue=function(t){e.Assert.exists(t),this.ensureDom(),this.logger.info("Unexcluding facet value",this.facetValuesList.unExclude(t)),this._facetValueHasChanged()},n.prototype.unexcludeMultipleValues=function(t){var i=this;e.Assert.exists(t),this.ensureDom(),e._.each(t,function(e){i.logger.info("Unexcluding facet value",i.facetValuesList.unExclude(e))}),this._facetValueHasChanged()},n.prototype.toggleSelectValue=function(t){e.Assert.exists(t),this.ensureDom(),this.logger.info("Toggle select facet value",this.facetValuesList.toggleSelect(t)),this._facetValueHasChanged()},n.prototype.toggleExcludeValue=function(t){e.Assert.exists(t),this.ensureDom(),this.logger.info("Toggle exclude facet value",this.facetValuesList.toggleExclude(t)),this._facetValueHasChanged()},n.prototype.getDisplayedValues=function(){return this.ensureDom(),e._.first(e._.pluck(this.values.getAll(),"value"),this.numberOfValues)},n.prototype.getSelectedValues=function(){return this.ensureDom(),e._.map(this.values.getSelected(),function(e){return e.value})},n.prototype.getExcludedValues=function(){return this.ensureDom(),e._.map(this.values.getExcluded(),function(e){return e.value})},n.prototype.reset=function(){this.ensureDom(),this.values.reset(),this._rebuildValueElements(),this._updateAppearanceDependingOnState(),this._updateQueryStateModel()},n.prototype.switchToAnd=function(){this.ensureDom(),this.logger.info("Switching to AND"),this.options.useAnd=!0,this._rebuildOperatorToggle(),this._updateOperatorQueryStateModel()},n.prototype.getEndpoint=function(){return this.queryController.getEndpoint()},n.prototype.switchToOr=function(){this.ensureDom(),this.logger.info("Switching to OR"),this.options.useAnd=!1,this._rebuildOperatorToggle(),this._updateOperatorQueryStateModel()},n.prototype.updateSort=function(e){var i=this;this.options.sortCriteria!=e&&(this.options.sortCriteria=e,this.triggerNewQuery(function(){return i.usageAnalytics.logSearchEvent(t.AnalyticsActionCauseList.facetSortValues,{facetId:i.options.uniqueId,facetSortBy:e})}))},n.prototype.collapseFacet=function(){this.collapseElement.hide(),this.excludeElement.show(),e.$(this.element).addClass("coveo-collapsed")},n.prototype.expandFacet=function(){this.excludeElement.hide(),this.collapseElement.show(),e.$(this.element).removeClass("coveo-collapsed"),t.FacetUtils.clipCaptionsToAvoidOverflowingTheirContainer(this)},n.prototype.unfadeInactiveValuesInMainList=function(){e.$(this.element).removeClass("coveo-fade")},n.prototype.fadeInactiveValuesInMainList=function(){e.$(this.element).addClass("coveo-fade")},n.prototype.showWaitingAnimation=function(){var t=this;e.Defer.defer(function(){t.showingWaitAnimation||(t.headerElement.find(".coveo-icon").first().css("display","none"),t.headerElement.find(".coveo-wait-animation").css("display",""),t.showingWaitAnimation=!0)})},n.prototype.hideWaitingAnimation=function(){var t=this;e.Defer.defer(function(){t.showingWaitAnimation&&(t.headerElement.find(".coveo-icon").css("display",""),t.headerElement.find(".coveo-wait-animation").css("display","none"),t.showingWaitAnimation=!1)})},n.prototype.processFacetSearchAllResultsSelected=function(i){var n=this,o=[];e._.each(i,function(e){n._ensureFacetValueIsInList(e),o.push(e.value)}),this._updateQueryStateModel(),this.triggerNewQuery(function(){return n.usageAnalytics.logSearchEvent(t.AnalyticsActionCauseList.facetSelectAll,{facetId:n.options.uniqueId})})},n.prototype.pinFacetPosition=function(){this.pinnedViewportPosition=this.element.getBoundingClientRect().top},n.prototype.getValueCaption=function(i){e.Assert.exists(i);var n=i.lookupValue||i.value,o=n;return o=t.FacetUtils.tryToGetTranslatedCaption(n),e.Utils.exists(this.options.valueCaption)&&("object"==typeof this.options.valueCaption&&(o=this.options.valueCaption[n]||o),"function"==typeof this.options.valueCaption&&(this.values.get(n),o=this.options.valueCaption.call(this,this.facetValuesList.get(n).facetValue))),o},n.prototype.enable=function(){i.prototype.enable.call(this)},n.prototype.disable=function(){i.prototype.disable.call(this)},n.prototype.triggerNewQuery=function(t){var i=this;this.queryController.deferExecuteQuery({beforeExecuteQuery:t}),e.Defer.defer(function(){return i.showWaitingAnimation()})},n.prototype._checkForComputedFieldAndSort=function(){-1!=this.options.sortCriteria.toLowerCase().indexOf("computedfield")&&e.Utils.isNullOrUndefined(this.options.computedField)&&this.logger.warn("Sort criteria is specified as ComputedField, but the facet uses no computed field. Facet will always be empty !",this)},n.prototype._checkForValueCaptionType=function(){this.options.valueCaption&&"function"==typeof this.options.valueCaption&&(this.options.enableFacetSearch=!1,this.options.includeInOmniBox=!1,this.logger.warn("Using a function as valueCaption is now deprecated. Use a json key value pair instead. Facet search and omnibox has been disabled for this facet",this))},n.prototype._checkForAllowedValuesOption=function(){void 0!=this.options.allowedValues&&(this.logger.info("Allowed values option set on facet : Disabling more/less",this),this.options.enableMoreLess=!1,this.logger.info("Allowed values options set on facet : Number of values set to lenght of allowed values : "+this.options.allowedValues.length,this),this.options.numberOfValues=this.options.allowedValues.length,this.logger.info("Allowed values options set in facet : Disabling facet search",this),this.options.enableFacetSearch=!1)},n.prototype._checkForCustomSort=function(){void 0==this.options.customSort||e._.contains(this.options.availableSorts,"custom")||this.options.availableSorts.unshift("custom"),"custom"==this.options.availableSorts[0]&&(this.options.sortCriteria="nosort")},n.prototype._initQueryEvents=function(){this.bind.onRoot(e.Events.QueryEvents.duringQuery,this._handleDuringQuery),this.bind.onRoot(e.Events.QueryEvents.buildingQuery,this._handleBuildingQuery),this.bind.onRoot(e.Events.QueryEvents.doneBuildingQuery,this._handleDoneBuildingQuery),this.bind.onRoot(e.Events.QueryEvents.deferredQuerySuccess,this._handleDeferredQuerySuccess)},n.prototype._initQueryStateEvents=function(){this.includedAttributeId=e.Models.QueryStateModel.getFacetId(this.options.uniqueId),this.excludedAttributeId=e.Models.QueryStateModel.getFacetId(this.options.uniqueId,!1),this.operatorAttributeId=e.Models.QueryStateModel.getFacetOperator(this.options.uniqueId),this.lookupValueAttributeId=e.Models.QueryStateModel.getFacetLookupValue(this.options.uniqueId),this.queryStateModel.registerNewAttribute(this.includedAttributeId,[]),this.queryStateModel.registerNewAttribute(this.excludedAttributeId,[]),this.queryStateModel.registerNewAttribute(this.operatorAttributeId,""),this.queryStateModel.registerNewAttribute(this.lookupValueAttributeId,{});var t=this.queryStateModel.getEventName(e.Models.Model.eventTypes.change);this.bind.onRoot(t,this._handleQueryStateChanged)},n.prototype._initComponentStateEvents=function(){this.componentStateId=e.Models.QueryStateModel.getFacetId(this.options.uniqueId),this.componentStateModel.registerComponent(this.componentStateId,this)},n.prototype._initOmniBoxEvents=function(){this.options.includeInOmniBox&&this.bind.onRoot(e.Events.OmniBoxEvents.populateOmniBox,this._handlePopulateOmnibox)},n.prototype._initBreadCrumbEvents=function(){this.options.includeInBreadcrumb&&(this.bind.onRoot(e.Events.BreadcrumbEvents.populateBreadcrumb,this._handlePopulateBreadcrumb),this.bind.onRoot(e.Events.BreadcrumbEvents.clearBreadcrumb,this._handleClearBreadcrumb))},n.prototype._initBottomAndTopSpacer=function(){var t=this,i=e.$(this.options.paddingContainer).children(".coveo-bottomSpace"),n=e.$(this.options.paddingContainer).children(".coveo-topSpace");this.options.preservePosition&&(e.$(this.options.paddingContainer).mouseleave(function(){return t._unpinFacetPosition()}),this.pinnedTopSpace=n,this.pinnedBottomSpace=i,0==this.pinnedTopSpace.length&&(this.pinnedTopSpace=e.$("<div />").addClass("coveo-topSpace").prependTo(this.options.paddingContainer)),0==this.pinnedBottomSpace.length&&(this.pinnedBottomSpace=e.$("<div />").addClass("coveo-bottomSpace").appendTo(this.options.paddingContainer)))},n.prototype._initFacetQueryController=function(){this.facetQueryController=new e.Controllers.FacetQueryController(this)},n.prototype._initFacetValuesList=function(){this.facetValuesList=new t.FacetValuesList(this,t.FacetValueElement),e.$(this.element).append(this.facetValuesList.build())
},n.prototype._initFacetSearch=function(){this.facetSearch=new t.FacetSearch(this,t.FacetSearchValuesList),e.$(this.element).append(this.facetSearch.build())},n.prototype._updateIncludedQueryStateModel=function(){var e={included:this.getSelectedValues(),title:this.includedAttributeId};this.queryStateModel.set(this.includedAttributeId,e.included)},n.prototype._facetValueHasChanged=function(){var t=this;this._updateQueryStateModel(),this._rebuildValueElements(),e.Defer.defer(function(){t._updateAppearanceDependingOnState()})},n.prototype._updateExcludedQueryStateModel=function(){var e={title:this.excludedAttributeId,excluded:this.getExcludedValues()};this.queryStateModel.set(this.excludedAttributeId,e.excluded)},n.prototype._updateOperatorQueryStateModel=function(){if(this.options.allowTogglingOperator){var e="";(0!=this.getSelectedValues().length||0!=this.getExcludedValues().length)&&(e=this.options.useAnd?"and":"or"),this.queryStateModel.set(this.operatorAttributeId,e)}},n.prototype._updateLookupValueQueryStateModel=function(){if(this.options.lookupField){var t={};e._.each(this.values.getSelected().concat(this.values.getExcluded()),function(e){t[e.value]=e.lookupValue}),this.queryStateModel.set(this.lookupValueAttributeId,t)}},n.prototype._handleQueryStateChangedOperator=function(e){"and"==e?this.switchToAnd():"or"==e&&this.switchToOr()},n.prototype._handleQueryStateChangedIncluded=function(t){var i=e._.difference(this.getSelectedValues(),t);e.Utils.isNonEmptyArray(i)&&this.deselectMultipleValues(i),e.Utils.arrayEqual(this.getSelectedValues(),t,!1)||this.selectMultipleValues(t)},n.prototype._handleQueryStateChangedExcluded=function(t){var i=e._.difference(this.getExcludedValues(),t);e.Utils.isNonEmptyArray(i)&&this.unexcludeMultipleValues(i),e.Utils.arrayEqual(this.getExcludedValues(),t,!1)||this.excludeMultipleValues(t)},n.prototype._handleLookupvalueChanged=function(t){var i=this;e._.each(t,function(e,t){i.facetValuesList.get(decodeURIComponent(t)).facetValue.lookupValue=decodeURIComponent(e)})},n.prototype._handleQueryStateChanged=function(t,i){e.Assert.exists(i),this.ensureDom();var n=i.attributes,o=n[this.includedAttributeId],s=n[this.excludedAttributeId],r=n[this.operatorAttributeId],a=n[this.lookupValueAttributeId];this.listenToQueryStateChange&&(e.Utils.isNullOrEmptyString(r)||this._handleQueryStateChangedOperator(r),e.Utils.isNullOrUndefined(o)||this._handleQueryStateChangedIncluded(o),e.Utils.isNullOrUndefined(s)||this._handleQueryStateChangedExcluded(s),e.Utils.isNullOrUndefined(a)||this._handleLookupvalueChanged(a))},n.prototype._handlePopulateOmnibox=function(t,i){e.Assert.exists(i),e.Assert.exists(i.completeQueryExpression),this.canFetchMore?this._handleOmniBoxWithSearchInFacet(i):this._handleOmniBoxWithStaticValue(i)},n.prototype._handleOmniBoxWithStaticValue=function(i){var n=this,o=i.completeQueryExpression.regex,s=(i.completeQueryExpression.word,e._.first(e._.filter(this.getDisplayedValues(),function(e){return o.test(n.getValueCaption(n.facetValuesList.get(e).facetValue))}),this.options.numberOfValuesInOmniBox)),r=e._.map(s,function(e){return n.facetValuesList.get(e).facetValue}),a=new t.OmniboxValuesList(this,r,i,t.OmniBoxValueElement).build();i.rows.push({element:a?a.get(0):void 0,zIndex:this._omniboxZIndex})},n.prototype._handleOmniBoxWithSearchInFacet=function(i){var n=this,o=(i.completeQueryExpression.regex,e.$.Deferred());i.rows.push({deferred:o});var s=this.facetQueryController.recursiveFacetSearch(i.completeQueryExpression.word,this.options.numberOfValuesInOmniBox);s.done(function(s){var r=e._.map(s,function(e){return n.values.get(e.lookupValue)||t.FacetValue.create(e)}),a=new t.OmniboxValuesList(n,r,i,t.OmniBoxValueElement).build();o.resolve({element:a?a.get(0):void 0,zIndex:n._omniboxZIndex})}),s.fail(function(){o.resolve({element:void 0})})},n.prototype._handleDuringQuery=function(){this.ensureDom(),this.keepDisplayedValuesNextTime||this.fadeInactiveValuesInMainList(this.options.facetSearchDelay)},n.prototype._handleBuildingQuery=function(t,i){if(e.Assert.exists(i),e.Assert.exists(i.queryBuilder),this.facetQueryController.prepareForNewQuery(),this.values.hasSelectedOrExcludedValues()){var n=this.facetQueryController.computeOurFilterExpression();this.logger.trace("Putting filter in query",n),i.queryBuilder.advancedExpression.add(n)}},n.prototype._handleDoneBuildingQuery=function(t,i){e.Assert.exists(i),e.Assert.exists(i.queryBuilder);var n=i.queryBuilder;this.facetQueryController.putGroupByIntoQueryBuilder(n)},n.prototype._handleDeferredQuerySuccess=function(t,i){e.Assert.exists(i),this.unfadeInactiveValuesInMainList(),this.hideWaitingAnimation();var n=i.results.groupByResults[this.facetQueryController.lastGroupByRequestIndex];n||(this.keepDisplayedValuesNextTime=!1),this._processNewGroupByResults(n)},n.prototype._handlePopulateBreadcrumb=function(i,n){if(e.Assert.exists(n),this.values.hasSelectedOrExcludedValues()){var o=new t.BreadcrumbValueList(this,this.values.getSelected().concat(this.values.getExcluded()),t.BreadcrumbValueElement).build();n.breadcrumbs.push({element:o.get(0)})}},n.prototype._handleClearBreadcrumb=function(t,i){e.Assert.exists(i),this.reset()},n.prototype._processNewGroupByResults=function(i){this.logger.trace("Displaying group by results",i),void 0!=i&&void 0!=i.values&&(this.nbAvailableValues=i.values.length,this.canFetchMore=this.numberOfValues<this.nbAvailableValues);var n=new t.FacetValues(i);this._updateValues(n),this.numberOfValues>this.nbAvailableValues&&(this.numberOfValues=this.nbAvailableValues),this.values.hasSelectedOrExcludedValues()&&!this.options.useAnd&&this.options.isMultiValueField?this._triggerUpdateDeltaQuery(e._.filter(this.values.getAll(),function(e){return!e.selected&&!e.excluded})):this.values.getSelected().length>0&&!this.options.useAnd&&this.values.updateDeltaWithFilteredFacetValues(new t.FacetValues),this.values.hasSelectedOrExcludedValues()&&!this.options.useAnd&&this.options.isMultiValueField||(this._rebuildValueElements(),this._updateAppearanceDependingOnState(),this._ensurePinnedFacetHasntMoved()),this.keepDisplayedValuesNextTime=!1},n.prototype._updateValues=function(t){e.Assert.exists(t),this.keepDisplayedValuesNextTime?this.values.updateCountsFromNewValues(t):(t.importActiveValuesFromOtherList(this.values),t.sortValuesDependingOnStatus(this.numberOfValues),this.values=t)},n.prototype._ensureFacetValueIsInList=function(t){e.Assert.exists(t),this.values.contains(t.value)||this.values.add(t)},n.prototype._isAnyValueCurrentlyDisplayed=function(){return!this.values.isEmpty()},n.prototype._handleOperatorClick=function(){var e=this;if(this.options.useAnd?this.switchToOr():this.switchToAnd(),0!=this.getSelectedValues().length){var i=this.options.useAnd?"AND":"OR",n=this.options.useAnd?"OR":"AND";this.triggerNewQuery(function(){return e.usageAnalytics.logSearchEvent(t.AnalyticsActionCauseList.facetToggle,{facetId:e.options.uniqueId,facetOperatorBefore:n,facetOperatorAfter:i})})}},n.prototype._handleEraserClick=function(){var e=this;this.reset(),this.triggerNewQuery(function(){return e.usageAnalytics.logSearchEvent(t.AnalyticsActionCauseList.facetClearAll,{facetId:e.options.uniqueId})})},n.prototype._updateQueryStateModel=function(){this.listenToQueryStateChange=!1,this._updateExcludedQueryStateModel(),this._updateIncludedQueryStateModel(),this._updateOperatorQueryStateModel(),this._updateLookupValueQueryStateModel(),this.listenToQueryStateChange=!0},n.prototype._buildFacetContent=function(){this.headerElement=this._buildHeader().appendTo(this.element),this._initFacetValuesList(),this.options.enableFacetSearch&&this._initFacetSearch(),this.options.enableMoreLess&&(this.footerElement=this._buildFooter().appendTo(this.element),this._moreElement=this._buildMore().appendTo(this.footerElement),this._lessElement=this._buildLess().appendTo(this.footerElement))},n.prototype._buildHeader=function(){var t=e.$('<div class="coveo-header"/>');return this._buildIcon().appendTo(t),this._buildWaitAnimation().appendTo(t),this.options.enableSettings&&this._buildSettingsButtons().appendTo(t),this.options.enableCollapse&&(this.collapseElement=this._buildCollapse().appendTo(t),this.excludeElement=this._buildExpand().appendTo(t)),this.operatorElement=this._buildOperatorToggle().appendTo(t),this.operatorElement.fastToggle(this.options.allowTogglingOperator),this._eraserElement=this._buildEraser().appendTo(t),this._buildTitle().appendTo(t),t},n.prototype._buildIcon=function(){var t;return t=this.options.headerIcon?"coveo-icon-custom "+this.options.headerIcon:"coveo-icon "+this.options.field.substr(1),e.$("<div></div>").addClass(t)},n.prototype._buildWaitAnimation=function(){return e.$("<div />").addClass("coveo-wait-animation").css("display","none")},n.prototype._buildCollapse=function(){var i=this,n=e.$("<span></span>").addClass("coveo-icon");return e.$("<div />").attr("title",t.l("Collapse")).addClass("coveo-collapse").append(n).fastClick(function(){i.collapseFacet()})},n.prototype._buildExpand=function(){var i=this,n=e.$("<span></span>").addClass("coveo-icon");return e.$("<div />").attr("title",t.l("Expand")).hide().addClass("coveo-expand").append(n).fastClick(function(){i.expandFacet()})},n.prototype._buildTitle=function(){return e.$('<div class="coveo-title"/>').text(this.options.title)},n.prototype._buildOperatorToggle=function(){var i=this,n=e.$("<span></span>").addClass("coveo-icon");return n.addClass("coveo-"+(this.options.useAnd?"and":"or")),e.$("<div />").attr("title",t.l("SwitchTo",this.options.useAnd?t.l("Or"):t.l("And"))).addClass("coveo-operator").append(n).fastClick(function(){i._handleOperatorClick()})},n.prototype._buildSettingsButtons=function(){return this.facetSettings=new t.FacetSettings(this.options.availableSorts,this),this.facetSettings.build()},n.prototype._rebuildOperatorToggle=function(){var e=this._buildOperatorToggle();this.operatorElement&&this.operatorElement.replaceWith(e),this.operatorElement=e},n.prototype._buildEraser=function(){var i=this,n=e.$("<span></span>").addClass("coveo-icon");return e.$("<div />").attr("title",t.l("Clear",this.options.title)).append(n).addClass("coveo-eraser").fastClick(function(){i._handleEraserClick()})},n.prototype._updateNumberOfValues=function(){this.numberOfValues=Math.max(this.numberOfValues,this.values.getExcluded().length+this.values.getSelected().length),this.numberOfValues=Math.min(this.numberOfValues,this.values.size()),this.numberOfValues=Math.max(this.numberOfValues,this.options.numberOfValues)},n.prototype._rebuildValueElements=function(){this._updateNumberOfValues(),this.facetValuesList.rebuild(this.numberOfValues),this.options.enableMoreLess&&this._updateMoreLess()},n.prototype._updateMoreLess=function(){var e=!1;this.values.getExcluded().length+this.values.getSelected().length<this.numberOfValues&&this.options.numberOfValues<this.numberOfValues?(this._lessElement.show(),e=!0):this._lessElement.hide();var t=this.nbAvailableValues>this.numberOfValues;this._moreElement.toggleClass("coveo-active",t),e||t?this.footerElement.removeClass("coveo-empty"):this.footerElement.addClass("coveo-empty")},n.prototype._buildFooter=function(){return e.$('<div class="coveo-footer"/>')},n.prototype._buildMore=function(){return e.$('<a class="coveo-more">'+t.l("More")+"</a>").fastClick(e.$.proxy(this._handleClickMore,this))},n.prototype._handleClickMore=function(){var e=this.numberOfValues-this.options.numberOfValues,t=Math.floor(e/this.options.pageSize)+1;this.numberOfValues=this.options.numberOfValues+t*this.options.pageSize,this.values.size()>=this.numberOfValues||!this.canFetchMore?this._rebuildValueElements():this._triggerMoreQuery()},n.prototype._triggerMoreQuery=function(){var i=this;this.logger.info("Triggering new facet more query"),this.showWaitingAnimation(),this.facetQueryController.fetchMore().done(function(n){var o=new t.FacetValues(n.groupByResults[0]);n.groupByResults.length>1&&e._.each(n.groupByResults,function(i,n){n>0&&e._.each(i.values,function(e){o.contains(e.value)||o.add(t.FacetValue.createFromGroupByValue(e))})}),o.importActiveValuesFromOtherList(i.values),o.sortValuesDependingOnStatus(i.numberOfValues),i.values=o,i.nbAvailableValues=i.values.size(),i.canFetchMore=i.numberOfValues<i.nbAvailableValues,i.values.hasSelectedOrExcludedValues()&&!i.options.useAnd&&i.options.isMultiValueField?i._triggerUpdateDeltaQuery(e._.filter(i.values.getAll(),function(e){return!e.selected&&!e.excluded})):(i.values.hasSelectedOrExcludedValues()&&!i.options.useAnd?(i.values.updateDeltaWithFilteredFacetValues(new t.FacetValues),i.hideWaitingAnimation()):i.hideWaitingAnimation(),i._rebuildValueElements())}).fail(function(){return i.hideWaitingAnimation()})},n.prototype._triggerUpdateDeltaQuery=function(i){var n=this;this.showWaitingAnimation(),this.facetQueryController.searchInFacetToUpdateDelta(i).done(function(i){var o=new t.FacetValues;e._.each(i.groupByResults,function(i){e._.each(i.values,function(e){o.contains(e.value)||o.add(t.FacetValue.createFromGroupByValue(e))})}),n.values.updateDeltaWithFilteredFacetValues(o),n._rebuildValueElements(),n.hideWaitingAnimation()})},n.prototype._buildLess=function(){return e.$('<a class="coveo-less">'+t.l("Less")+"</a>").hide().fastClick(e.$.proxy(this._handleClickLess,this))},n.prototype._handleClickLess=function(){this._lessElement.hide(),this.numberOfValues=Math.max(this.options.numberOfValues,this.values.getExcluded().length+this.values.getSelected().length),this._moreElement.addClass("coveo-active"),this.values.sortValuesDependingOnStatus(this.numberOfValues),this._rebuildValueElements()},n.prototype._unpinFacetPosition=function(){var e=this;this._isFacetPinned()&&(this.pinnedTopSpace.animate({height:0},"fast",function(){void 0!=e.facetSearch&&e.facetSearch.positionSearchResults()}),this.pinnedBottomSpace.animate({height:0},"fast",function(){void 0!=e.facetSearch&&e.facetSearch.positionSearchResults()}),this.pinnedViewportPosition=void 0)},n.prototype._isFacetPinned=function(){return e.Utils.exists(this.pinnedViewportPosition)},n.prototype._ensurePinnedFacetHasntMoved=function(){var t=this;if(this._isFacetPinned()){e.Assert.exists(this.pinnedViewportPosition),this.pinnedTopSpace.height(0),this.pinnedBottomSpace.height(0);var i=this.options.scrollContainer==document.body?window:this.options.scrollContainer,n=this.element.getBoundingClientRect().top,o=n-this.pinnedViewportPosition;e.$(i).scrollTop(e.$(i).scrollTop()+o),n=this.element.getBoundingClientRect().top,o=n-this.pinnedViewportPosition,0>o?this.pinnedTopSpace.height(-1*o):setTimeout(function(){var n=t.element.getBoundingClientRect().top,o=n-t.pinnedViewportPosition;e.$(i).scrollTop(e.$(i).scrollTop()+o);for(var s=0,r=0;o>0&&r++<100;)s+=100,t.pinnedBottomSpace.height(s),n=t.element.getBoundingClientRect().top,o=n-t.pinnedViewportPosition,e.$(i).scrollTop(e.$(i).scrollTop()+o)},0)}},n.prototype._updateAppearanceDependingOnState=function(){e.$(this.element).toggleClass("coveo-active",this.values.hasSelectedOrExcludedValues()),e.$(this.element).toggleClass("coveo-empty",!this._isAnyValueCurrentlyDisplayed()),e.$(this._eraserElement).fastToggle(this.values.hasSelectedOrExcludedValues())},n.ID="Facet",n.omniboxIndex=50,n.options={title:t.ComponentOptions.buildLocalizedStringOption({defaultValue:"No Title"}),field:t.ComponentOptions.buildFieldOption({required:!0,groupByField:!0}),headerIcon:t.ComponentOptions.buildIconOption(),uniqueId:t.ComponentOptions.buildStringOption({attrName:"data-id",postProcessing:function(e,t){return e||t.field}}),isMultiValueField:t.ComponentOptions.buildBooleanOption({defaultValue:!1}),lookupField:t.ComponentOptions.buildFieldOption(),enableSettings:t.ComponentOptions.buildBooleanOption({defaultValue:!0}),enableSettingsFacetState:t.ComponentOptions.buildBooleanOption({defaultValue:!1}),availableSorts:t.ComponentOptions.buildListOption({defaultValue:["occurrences","score","alphaAscending","alphaDescending"],values:["Occurrences","Score","AlphaAscending","AlphaDescending","ComputedFieldAscending","ComputedFieldDescending","ChiSquare","NoSort"]}),sortCriteria:t.ComponentOptions.buildStringOption({postProcessing:function(e,t){return e||(t.availableSorts.length>0?t.availableSorts[0]:"occurrences")}}),customSort:t.ComponentOptions.buildListOption(),numberOfValues:t.ComponentOptions.buildNumberOption({defaultValue:5}),injectionDepth:t.ComponentOptions.buildNumberOption({defaultValue:1e3}),showIcon:t.ComponentOptions.buildBooleanOption({defaultValue:!1}),useAnd:t.ComponentOptions.buildBooleanOption({defaultValue:!1}),allowTogglingOperator:t.ComponentOptions.buildBooleanOption({defaultValue:!1}),enableFacetSearch:t.ComponentOptions.buildBooleanOption({defaultValue:!0}),facetSearchDelay:t.ComponentOptions.buildNumberOption({defaultValue:100}),facetSearchIgnoreAccents:t.ComponentOptions.buildBooleanOption({defaultValue:!1}),numberOfValuesInFacetSearch:t.ComponentOptions.buildNumberOption({defaultValue:15}),includeInBreadcrumb:t.ComponentOptions.buildBooleanOption({defaultValue:!0}),numberOfValuesInBreadcrumb:t.ComponentOptions.buildNumberOption({defaultFunction:function(){return e.DeviceUtils.isMobileDevice()?3:5}}),includeInOmniBox:t.ComponentOptions.buildBooleanOption({defaultValue:!1,attrName:"data-include-in-omnibox"}),numberOfValuesInOmniBox:t.ComponentOptions.buildNumberOption({defaultFunction:function(){return e.DeviceUtils.isMobileDevice()?3:5},attrName:"data-number-of-values-in-omnibox"}),computedField:t.ComponentOptions.buildFieldOption(),computedFieldOperation:t.ComponentOptions.buildStringOption({defaultValue:"sum"}),computedFieldFormat:t.ComponentOptions.buildStringOption({defaultValue:"c0"}),computedFieldCaption:t.ComponentOptions.buildLocalizedStringOption({defaultValue:t.l("ComputedField")}),preservePosition:t.ComponentOptions.buildBooleanOption({defaultValue:!0}),paddingContainer:t.ComponentOptions.buildSelectorOption({defaultFunction:function(e){return e.parentElement}}),scrollContainer:t.ComponentOptions.buildSelectorOption({defaultFunction:function(){return document.body}}),enableMoreLess:t.ComponentOptions.buildBooleanOption({defaultValue:!0}),pageSize:t.ComponentOptions.buildNumberOption({defaultValue:10}),enableCollapse:t.ComponentOptions.buildBooleanOption({defaultValue:!0}),allowedValues:t.ComponentOptions.buildListOption(),additionalFilter:t.ComponentOptions.buildStringOption()},n}(e.Ui.Component);t.Facet=i,t.CoveoJQuery.registerAutoCreateComponent(i)}(t=e.Ui||(e.Ui={}))}(Coveo||(Coveo={}));var Coveo;!function(e){var t;!function(t){var i=function(){function e(e,t){this.element=e,this.options=t,this.steps=[],this.options.dateField&&(this.options.start=new Date(this.options.start).getTime(),this.options.end=new Date(this.options.end).getTime()),void 0==this.options.rounded&&(this.options.rounded=0),(this.options.steps||this.options.getSteps)&&this.buildSteps(),this.options.graph&&(this.sliderGraph=new a(this)),this.sliderLine=new n(this),this.sliderLine.build().appendTo(this.element),this.options.rangeSlider?(this.sliderRange=new s(this),this.sliderRange.build().appendTo(this.element)):(this.sliderButton=new o(this,1),this.sliderButton.build().addClass("coveo-no-range-button").appendTo(this.element),this.sliderLine.setActiveWidth(this.sliderButton)),this.sliderCaption=new r(this),this.sliderCaption.build().appendTo(this.element)}return e.prototype.onMoving=function(){this.options.rangeSlider?(this.sliderRange.setBoundary(),this.sliderLine.setActiveWidth(this.sliderRange.firstButton,this.sliderRange.secondButton)):this.sliderLine.setActiveWidth(this.sliderButton),this.options.graph&&this.sliderGraph.draw(),this.displayCaption()},e.prototype.initializeState=function(e){void 0===e&&(e=[this.options.start,this.options.end]),this.currentValues=e,this.options.rangeSlider?(this.sliderRange.initializeSliderRangeState(e),this.sliderLine.setActiveWidth(this.sliderRange.firstButton,this.sliderRange.secondButton)):(void 0==e?this.sliderButton.toEnd():this.sliderButton.setValue(e[1]),this.sliderButton.leftBoundary=0,this.sliderButton.rightBoundary=this.element.width(),this.sliderLine.setActiveWidth(this.sliderButton)),this.displayCaption()},e.prototype.getPosition=function(){return this.options.rangeSlider?this.sliderRange.getPosition():[0,this.sliderButton.getPosition()]},e.prototype.getPercentPosition=function(){return this.options.rangeSlider?this.sliderRange.getPercentPosition():[0,this.sliderButton.getPercent()]},e.prototype.getValues=function(){return void 0!=this.currentValues?this.currentValues:this.options.rangeSlider?this.sliderRange.getValue():[this.options.start,this.sliderButton.getValue()]},e.prototype.getCaptionFromValue=function(e){return this.sliderCaption.getCaptionFromValues(e)},e.prototype.getCaption=function(){return this.sliderCaption.getCaption()},e.prototype.setValues=function(e){void 0!=e&&(e[0]=Math.max(e[0],this.options.start),e[1]=Math.min(e[1],this.options.end)),this.currentValues=e,this.options.rangeSlider?(this.sliderRange.setValue(e),this.sliderLine.setActiveWidth(this.sliderRange.firstButton,this.sliderRange.secondButton)):(this.sliderButton.setValue(e[1]),this.sliderLine.setActiveWidth(this.sliderButton)),this.displayCaption()},e.prototype.drawGraph=function(e){this.sliderGraph.draw(e)},e.prototype.displayCaption=function(){void 0!=this.options.valueCaption?this.sliderCaption.setFromString(this.options.valueCaption(this.getValues())):void 0!=this.options.percentCaption?this.sliderCaption.setFromString(this.options.percentCaption(this.getPercentPosition())):void 0!=this.options.displayAsPercent&&void 0!=this.options.displayAsPercent.separator?this.sliderCaption.setAsPercent():this.sliderCaption.setAsValue()},e.prototype.buildSteps=function(){if(this.options.getSteps)this.steps=this.options.getSteps(this.options.start,this.options.end);else for(var e=(this.options.end-this.options.start)/this.options.steps,t=this.options.start;t<=this.options.end;)this.steps.push(t),t+=e},e}();t.Slider=i;var n=function(){function t(e){this.slider=e}return t.prototype.build=function(){return this.backGround=e.$("<div class='coveo-slider-line coveo-background'></div>"),this.activePart=e.$("<div class='coveo-slider-line coveo-active'></div>"),this.backGround.add(this.activePart)},t.prototype.setActiveWidth=function(e,t){if(this.slider.options.rangeSlider){var i=100*(t.getPercent()-e.getPercent());this.activePart.css({width:i+"%",left:100*e.getPercent()+"%",right:100*t.getPercent()+"%"})}else{var i=100*e.getPercent();this.activePart.css({width:i+"%"})}},t}(),o=function(){function t(t,i){this.slider=t,this.which=i,this.eventMouseDown=e.DeviceUtils.isMobileDevice()?"touchstart":"mousedown",this.eventMouseMove=e.DeviceUtils.isMobileDevice()?"touchmove":"mousemove",this.eventMouseUp=e.DeviceUtils.isMobileDevice()?"touchend":"mouseup"}return t.prototype.build=function(){return this.element=e.$("<div class='coveo-slider-button'></div>"),this.bindEvents(),this.element.get(0).CoveoSliderButton=this,this.element},t.prototype.toBeginning=function(){this.element.css({left:"0%"})},t.prototype.toEnd=function(){this.slider.element.width();this.element.css({left:"100%"})},t.prototype.setValue=function(e){var t=this.fromValueToPercent(e);this.element.css("left",Math.round(100*t)+"%")},t.prototype.getPosition=function(){var e=this.element.css("left");return-1!=e.indexOf("%")?parseFloat(e)/100*this.slider.element.width():parseFloat(e)},t.prototype.getPercent=function(e){return void 0===e&&(e=this.getPosition()),0==this.slider.element.width()?0:+(e/this.slider.element.width()).toFixed(2)},t.prototype.getValue=function(){var e=this.getPercent()*(this.slider.options.end-this.slider.options.start)+this.slider.options.start;return e},t.prototype.fromValueToPercent=function(e){return 1-(this.slider.options.end-e)/(this.slider.options.end-this.slider.options.start)},t.prototype.fromPositionToValue=function(e){var t=this.getPercent(e);return this.slider.options.start+t*(this.slider.options.end-this.slider.options.start)},t.prototype.fromValueToPosition=function(e){var t=this.fromValueToPercent(e);return this.slider.element.width()*t},t.prototype.bindEvents=function(){var t=this;e.$(this.element).on(this.eventMouseDown,function(e){t.handleStartSlide(e)});var i=this.slider.options.document||document;e.$(i).on(this.eventMouseMove,function(e){"touchmove"==t.eventMouseMove&&t.isMouseDown&&e.preventDefault(),t.handleMoving(e)}),e.$(i).on(this.eventMouseUp,function(e){t.handleEndSlide(e)})},t.prototype.handleStartSlide=function(t){var i=this.getMousePosition(t);this.isMouseDown=!0,this.startPositionX=i.x,this.lastElementLeft=this.element.css("left"),this.origUserSelect=e.$("body").css("user-select"),this.origCursor=e.$("body").css("cursor"),e.$("body").css("user-select","none"),e.$("body").css("cursor","pointer"),e.$(this.element).addClass("coveo-active"),e.$(this.element).trigger(e.Events.SliderEvents.startSlide,{button:this,slider:this.slider})},t.prototype.handleMoving=function(t){this.isMouseDown&&(this.updatePosition(t),this.slider.onMoving(),this.handleButtonNearEnd(),this.element.trigger(e.Events.SliderEvents.duringSlide,{button:this,slider:this.slider}))},t.prototype.handleEndSlide=function(){this.isMouseDown&&(e.$("body").css("user-select",this.origUserSelect),e.$("body").css("cursor",this.origCursor),e.$(this.element).removeClass("coveo-active"),this.element.trigger(e.Events.SliderEvents.endSlide,{button:this,slider:this.slider})),this.isMouseDown=!1},t.prototype.handleButtonNearEnd=function(){0==this.which&&(void 0==this.origZIndex&&(this.origZIndex=this.element.css("z-index")),this.currentPos>90?this.element.css("z-index",this.origZIndex+1):this.element.css("z-index",this.origZIndex))},t.prototype.getMousePosition=function(e){var t=0,i=0;return"touchmove"==this.eventMouseMove?(t=e.originalEvent.touches[0].pageX,i=e.originalEvent.touches[0].pageY):e.pageX||e.pageY?(t=e.pageX,i=e.pageY):(e.clientX||e.clientY)&&(t=e.clientX+document.body.scrollLeft+document.documentElement.scrollLeft,i=e.clientY+document.body.scrollTop+document.documentElement.scrollTop),{x:t,y:i}},t.prototype.updatePosition=function(e){var t=this.getMousePosition(e),i=t.x-this.startPositionX;if(this.currentPos=parseInt(this.lastElementLeft,10)+i,this.slider.options.steps||this.slider.options.getSteps){var n=this.snapToStep(i);this.currentPos=n.position;var o=n.value}this.currentPos=Math.max(this.leftBoundary,this.currentPos),this.currentPos=Math.min(this.rightBoundary,this.currentPos),this.currentPos=100*this.getPercent(this.currentPos),this.currentPos=Math.min(this.currentPos,100),this.currentPos=Math.max(this.currentPos,0),this.element.css("left",Math.round(this.currentPos)+"%"),this.slider.currentValues[this.which]=this.slider.options.steps||this.slider.options.getSteps?o:this.getValue()},t.prototype.snapToStep=function(){var t=this,i=e._.map(this.slider.steps,function(e,i){return Math.abs(t.currentPos-t.fromValueToPosition(t.slider.steps[i]))}),n=e._.map(this.slider.steps,function(e,i){return Math.abs(t.rightBoundary-t.fromValueToPosition(t.slider.steps[i]))}),o=e._.map(this.slider.steps,function(e,i){return Math.abs(t.leftBoundary-t.fromValueToPosition(t.slider.steps[i]))}),s=e._.min(i),r=e._.min(n),a=e._.min(o),l=this.slider.steps[e._.indexOf(i,s)],u=this.slider.steps[e._.indexOf(n,r)],c=this.slider.steps[e._.indexOf(o,a)];return l=Math.min(l,u),l=Math.max(l,c),{position:this.fromValueToPosition(l),value:l}},t}();t.SliderButton=o;var s=function(){function e(e){this.slider=e,this.firstButton=new o(e,0),this.secondButton=new o(e,1)}return e.prototype.build=function(){var e=this.firstButton.build(),t=this.secondButton.build().addClass("coveo-range-button");return e.add(t)},e.prototype.initializeSliderRangeState=function(e){void 0==e?(this.firstButton.toBeginning(),this.secondButton.toEnd()):(this.firstButton.setValue(e[0]),this.secondButton.setValue(e[1])),this.setBoundary()},e.prototype.setValue=function(e){this.firstButton.setValue(e[0]),this.secondButton.setValue(e[1])},e.prototype.setBoundary=function(){this.firstButton.leftBoundary=0,this.firstButton.rightBoundary=this.secondButton.getPosition(),this.secondButton.leftBoundary=this.firstButton.getPosition(),this.secondButton.rightBoundary=this.slider.element.width()},e.prototype.getPosition=function(){return[this.firstButton.getPosition(),this.secondButton.getPosition()]},e.prototype.getPercentPosition=function(){return[this.firstButton.getPercent(),this.secondButton.getPercent()]},e.prototype.getValue=function(){return[this.firstButton.getValue(),this.secondButton.getValue()]},e}(),r=function(){function t(e){this.slider=e,this.separator="-",this.unitSign="",this.slider.options.displayAsPercent?this.separator=void 0!=this.slider.options.displayAsPercent.separator?this.slider.options.displayAsPercent.separator:this.separator:this.slider.options.displayAsValue&&(this.separator=void 0!=this.slider.options.displayAsValue.separator?this.slider.options.displayAsValue.separator:this.separator,this.unitSign=void 0!=this.slider.options.displayAsValue.unitSign?this.slider.options.displayAsValue.unitSign:this.unitSign)}return t.prototype.build=function(){return this.caption=e.$("<div class='coveo-slider-caption'></div>"),this.caption},t.prototype.getCaption=function(){return this.caption.text()},t.prototype.getCaptionFromValues=function(e){return this.getValueCaption(e)},t.prototype.getCaptionFromValuesAsPercent=function(e){return this.getValueCaption(e)},t.prototype.setAsValue=function(){this.caption.text(this.getValueCaption())},t.prototype.setAsPercent=function(){var e=this.slider.getPercentPosition();this.caption.text([(100*e[0]).toFixed(this.slider.options.rounded),"%",this.separator,(100*e[1]).toFixed(this.slider.options.rounded),"%"].join(" "))},t.prototype.setFromString=function(e){this.caption.text(e)},t.prototype.getValueCaption=function(e){void 0===e&&(e=this.slider.getValues());var t=e[0],i=e[1];if(this.slider.options.dateField){var n=new Date(t),o=new Date(i);n.setHours(0,0,0,0),o.setHours(0,0,0,0),t=Globalize.format(n,this.slider.options.dateFormat||"MMM dd, yyyy"),i=Globalize.format(o,this.slider.options.dateFormat||"MMM dd, yyyy"),this.unitSign=""}else t=t.toFixed(this.slider.options.rounded),i=i.toFixed(this.slider.options.rounded);return[t,this.unitSign,this.separator,i,this.unitSign].join(" ")},t}(),a=function(){function t(t){var i=this;this.slider=t,this.svg=d3.select(t.element.get(0)).append("svg").append("g"),this.x=d3.scale.ordinal(),this.y=d3.scale.linear(),this.slider.options.graph.margin=e.Utils.extendDeep({top:20,right:0,left:0,bottom:20},this.slider.options.graph.margin||{}),this.slider.options.graph.animationDuration=this.slider.options.graph.animationDuration||500,e.$(window).resize(function(){i.draw()}),this.tooltip=e.$("<div></div>").css({display:"none"}).addClass("coveo-slider-tooltip"),this.slider.element.append(this.tooltip),this.slider.options.graph.steps=this.slider.options.graph.steps||10}return t.prototype.draw=function(e){if(void 0===e&&(e=this.oldData),e){var t=this.slider.element.outerWidth(),i=this.slider.element.outerHeight(),n=t-this.slider.options.graph.margin.left-this.slider.options.graph.margin.right,o=i-this.slider.options.graph.margin.top-this.slider.options.graph.margin.bottom;this.applyTransformOnSvg(n,o),this.setXAndYRange(n,o),this.setXAndYDomain(e);var s=this.svg.selectAll(".coveo-bar").data(e),r=this.slider.getValues();this.renderGraphBars(s,n,o,r),this.setGraphBarsTransition(s,o,r),this.oldData=e}},t.prototype.setXAndYRange=function(e,t){this.x.rangeBands([0,e],.2,0),this.y.range([t-this.slider.options.graph.margin.top,0])},t.prototype.setXAndYDomain=function(t){this.padGraphWithEmptyData(t),this.x.domain(e._.map(t,function(e){return e.start})),this.y.domain([0,d3.max(t,function(e){return e.y})])},t.prototype.padGraphWithEmptyData=function(e){var t=e[0].end-e[0].start;0!=t&&(this.padBeginningOfGraphWithEmptyData(e,t),this.padEndOfGraphWithEmptyData(e,t))},t.prototype.padBeginningOfGraphWithEmptyData=function(e,t){if(e[0].start>this.slider.options.start)for(var i=e[0].start-this.slider.options.start,n=Math.round(i/t),o=e[0].start,s=n;s>0;s--)e.unshift({start:o-t,end:o,y:0}),o-=t
},t.prototype.padEndOfGraphWithEmptyData=function(e,t){var i=e.length-1;if(e[i].end<this.slider.options.end)for(var n=this.slider.options.end-e[i].end,o=Math.round(n/t),s=e[i].end,r=0;o>r;r++)e.push({start:s,end:s+t,y:0}),s+=t},t.prototype.applyTransformOnSvg=function(t,i){e.$(this.slider.element).find("svg").attr("width",t).attr("height",i),this.svg.attr("transform","translate("+this.slider.options.graph.margin.left+","+this.slider.options.graph.margin.top+")")},t.prototype.renderGraphBars=function(e,t,i,n){e.enter().append("rect").attr("class",this.getFunctionForClass(n)).attr("width",this.x.rangeBand()).attr("height",this.getFunctionForHeight(i)).attr("x",this.getFunctionForX()).attr("y",this.getFunctionForY()).on("click",this.getFunctionForClick()).on("mouseover",this.getFunctionForMouseOver(i)).on("mouseout",this.getFunctionForMouseOut())},t.prototype.setGraphBarsTransition=function(e,t,i){e.transition().attr("x",this.getFunctionForX()).attr("width",this.x.rangeBand()).attr("class",this.getFunctionForClass(i)).transition().duration(this.slider.options.graph.animationDuration).attr("y",this.getFunctionForY()).attr("height",this.getFunctionForHeight(t))},t.prototype.getBarClass=function(e,t,i){return t.start>=e[0]&&t.end<=e[1]?"coveo-active":e[0]==this.slider.options.start&&0==i?"coveo-active":e[1]==this.slider.options.end&&i==this.slider.options.graph.steps-1?"coveo-active":""},t.prototype.setTooltip=function(e,t){this.tooltip.html("<span class='coveo-caption'>"+this.slider.getCaptionFromValue([e.start,e.end])+"</span><span class='coveo-count'>"+e.y+"</span>"),this.tooltip.css({display:"block",left:this.x(e.start)-.2*this.slider.options.graph.steps,top:this.y(e.y)-t})},t.prototype.getFunctionForX=function(){var e=this;return function(t){return e.x(t.start)}},t.prototype.getFunctionForY=function(){var e=this;return function(t){return e.y(t.y)}},t.prototype.getFunctionForHeight=function(e){var t=this;return function(i){return e-t.y(i.y)}},t.prototype.getFunctionForClass=function(e){var t=this;return function(i,n){return"coveo-bar "+t.getBarClass(e,i,n)}},t.prototype.getFunctionForClick=function(){var t=this;return function(i){t.slider.element.trigger(e.Events.SliderEvents.graphValueSelected,{start:i.start,end:i.end,value:i.y})}},t.prototype.getFunctionForMouseOver=function(e){var t=this;return function(i){d3.event.clientX,d3.event.clientY;t.setTooltip(i,e)}},t.prototype.getFunctionForMouseOut=function(){var e=this;return function(){e.tooltip.css("display","none")}},t}()}(t=e.Ui||(e.Ui={}))}(Coveo||(Coveo={}));var Coveo;!function(e){var t=function(){function t(){}return t.prototype.merge=function(t){return e.$.extend({},this,t)},t.prototype.mergeDeep=function(t){return e.$.extend(!0,{},e.Utils.extendDeep(this,t))},t}();e.Options=t}(Coveo||(Coveo={}));var Coveo;!function(e){var t=function(e){function t(){e.apply(this,arguments),this.now=new Date,this.useTodayYesterdayAndTomorrow=!0,this.useWeekdayIfThisWeek=!0,this.omitYearIfCurrentOne=!0,this.useLongDateFormat=!1,this.includeTimeIfToday=!0,this.includeTimeIfThisWeek=!0,this.alwaysIncludeTime=!1,this.predefinedFormat=void 0}return __extends(t,e),t}(e.Options),i=function(){function i(){}return i.convertFromJsonDateIfNeeded=function(t){return e._.isDate(t)?t:e._.isNumber(t)?new Date(t):e._.isString(t)?new Date(t.replace("@"," ")):void 0},i.keepOnlyDatePart=function(e){return new Date(e.getFullYear(),e.getMonth(),e.getDate())},i.offsetDateByDays=function(e,t){var i=new Date(e.valueOf());return i.setDate(i.getDate()+t),i},i.dateToString=function(n,o){if(e.Utils.isNullOrUndefined(n))return"";if(o=(new t).merge(o),e.Utils.isNullOrUndefined(n))return"";var n=i.keepOnlyDatePart(n),s=i.keepOnlyDatePart(o.now),r=i.offsetDateByDays(s,1),a=i.offsetDateByDays(s,-1),l=Math.abs(e.TimeSpan.fromDates(n,s).getDays())<7;return o.predefinedFormat?Globalize.format(n,o.predefinedFormat):o.useTodayYesterdayAndTomorrow&&n.valueOf()==s.valueOf()?e.Ui.l("Today"):o.useTodayYesterdayAndTomorrow&&n.valueOf()==a.valueOf()?e.Ui.l("Yesterday"):o.useTodayYesterdayAndTomorrow&&n.valueOf()==r.valueOf()?e.Ui.l("Tomorrow"):o.useWeekdayIfThisWeek&&l?n.valueOf()>s.valueOf()?e.Ui.l("Next")+" "+Globalize.format(n,"dddd"):e.Ui.l("Last")+" "+Globalize.format(n,"dddd"):o.omitYearIfCurrentOne&&n.getFullYear()===s.getFullYear()?Globalize.format(n,"M"):o.useLongDateFormat?Globalize.format(n,"D"):Globalize.format(n,"d")},i.timeToString=function(t){return e.Utils.isNullOrUndefined(t)?"":Globalize.format(t,"t")},i.dateTimeToString=function(i,n){if(e.Utils.isNullOrUndefined(i))return"";n=(new t).merge(n);var o=e.DateUtils.keepOnlyDatePart(n.now),s=Math.abs(e.TimeSpan.fromDates(i,o).getDays())<7,r=e.DateUtils.dateToString(i,n),a=e.DateUtils.keepOnlyDatePart(i);return n.alwaysIncludeTime||n.includeTimeIfThisWeek&&s||n.includeTimeIfToday&&a.valueOf()==o.valueOf()?r+", "+e.DateUtils.timeToString(i):r},i.isValid=function(e){return e instanceof Date?!isNaN(e.getTime()):!1},i}();e.DateUtils=i}(Coveo||(Coveo={})),Date.prototype.toISOString||!function(){function e(e){return 10>e?"0"+e:e}Date.prototype.toISOString=function(){return this.getUTCFullYear()+"-"+e(this.getUTCMonth()+1)+"-"+e(this.getUTCDate())+"T"+e(this.getUTCHours())+":"+e(this.getUTCMinutes())+":"+e(this.getUTCSeconds())+"."+(this.getUTCMilliseconds()/1e3).toFixed(3).slice(2,5)+"Z"}}();var Coveo;!function(e){var t;!function(t){var i=function(t){function i(i){var n=this;t.call(this,i),this.facet=i,this.facet.bind.onRoot(e.Events.QueryEvents.querySuccess,function(e,t){return n.handleQuerySuccess(e,t)})}return __extends(i,t),i.prototype.putGroupByIntoQueryBuilder=function(e){this.facet.options.slider&&this.facet.options.slider.graph&&this.putGroupByForGraphIntoQueryBuilder(e),this.facet.options.slider?this.putGroupByForSliderIntoQueryBuilder(e):t.prototype.putGroupByIntoQueryBuilder.call(this,e)},i.prototype._createBasicGroupByRequest=function(i,n){void 0===n&&(n=!0);var o=t.prototype._createBasicGroupByRequest.call(this,null,n);return o.allowedValues=void 0,o=this.facet.options.slider&&this.facet.options.slider.graph?this.buildGroupByQueryForSlider(o):this.facet.options.slider?this.buildGroupByQueryForAutomaticRanges(o):e.Utils.isNonEmptyArray(this.facet.options.ranges)?this.buildGroupByQueryForPredefinedRanges(o):this.facet.values.hasSelectedOrExcludedValues()?this.buildGroupByQueryForSelectedAndExcludedValues(o):this.buildGroupByQueryForAutomaticRanges(o)},i.prototype._createGroupByAllowedValues=function(){return void 0},i.prototype.computeOurFilterExpression=function(i){if(void 0===i&&(i=[this.facet.startOfSlider,this.facet.endOfSlider]),this.facet.options.slider){var n=new e.Ui.ExpressionBuilder;return void 0!=i[0]&&void 0!=i[1]&&(this.facet.options.slider.excludeOuterBounds?this.addFilterExpressionWithOuterBoundsExcluded(i[0],i[1],n):this.addFilterExpressionWithOuterBoundsIncluded(i[0],i[1],n)),n.build()}return t.prototype.computeOurFilterExpression.call(this)},i.prototype.handleQuerySuccess=function(t,i){var n=this;if(this.facet.options.slider&&this.facet.options.slider.graph&&void 0==this.rangeValuesForGraphToUse){this.rangeValuesForGraphToUse=[];var o=i.results.groupByResults[this.graphGroupByQueriesIndex].values;e._.each(o,function(e){var t=e.value.split("..");n.rangeValuesForGraphToUse.push({start:n.facet.options.dateField?n.getISOFormat(t[0].replace("@"," ")):parseInt(t[0],10),end:n.facet.options.dateField?n.getISOFormat(t[1].replace("@"," ")):parseInt(t[1],10)})})}},i.prototype.addFilterExpressionWithOuterBoundsIncluded=function(e,t,i){(e!=this.facet.options.slider.start||t!=this.facet.options.slider.end)&&(this.facet.options.dateField&&(e=this.getFilterDateFormat(e),t=this.getFilterDateFormat(t)),i.addFieldExpression(this.facet.options.field,"==",[e+".."+t]))},i.prototype.addFilterExpressionWithOuterBoundsExcluded=function(e,t,i){var n=this.facet.options.slider.start,o=this.facet.options.slider.end,s=e,r=t;this.facet.options.dateField?(s=this.getFilterDateFormat(e),r=this.getFilterDateFormat(t),n=this.getFilterDateFormat(n),o=this.getFilterDateFormat(o)):(s+="",r+="",n+="",o+=""),s!=n&&r==o?i.addFieldExpression(this.facet.options.field,">=",[s]):s==n&&r!=o?i.addFieldExpression(this.facet.options.field,"<=",[r]):this.addFilterExpressionWithOuterBoundsIncluded(e,t,i)},i.prototype.buildGroupByQueryForSlider=function(e){if(void 0!=this.facet.options.slider.start&&void 0!=this.facet.options.slider.end){var t=this.facet.options.slider.start,i=this.facet.options.slider.end;return(this.facet.options.dateField||this.facet.options.dateField)&&(t=this.getISOFormat(t),i=this.getISOFormat(i)),e.rangeValues=[{start:t,end:i,endInclusive:!0,label:"Slider"}],e}return this.buildGroupByQueryForAutomaticRanges(e)},i.prototype.buildGroupByQueryForAutomaticRanges=function(e){return e.generateAutomaticRanges=!0,e},i.prototype.buildGroupByQueryForPredefinedRanges=function(e){return e.rangeValues=this.facet.options.ranges,e.maximumNumberOfValues=this.facet.options.ranges.length,e},i.prototype.putGroupByForGraphIntoQueryBuilder=function(e){this.graphGroupByQueriesIndex=e.groupByRequests.length;var t=this._createBasicGroupByRequest();if(t.rangeValues){var i=t.rangeValues[0];t.rangeValues=this.createRangeValuesForGraph(i)}var n=this.computeOurFilterExpression(this.facet.getSliderBoundaryForQuery());if(void 0!=n){var o=e.computeCompleteExpressionPartsExcept(n);t.queryOverride=o.withoutConstant,t.constantQueryOverride=o.constant,void 0==t.queryOverride?t.queryOverride=this.facet.options.slider.queryOverride||"@sysuri":t.queryOverride+=" "+this.facet.options.slider.queryOverride}else if(null!=this.facet.options.slider.queryOverride){var s=e.computeCompleteExpression();t.queryOverride=(null!=s?s+" ":"")+this.facet.options.slider.queryOverride}t.sortCriteria="nosort",t.maximumNumberOfValues=this.facet.options.slider.graph.steps,e.groupByRequests.push(t)},i.prototype.putGroupByForSliderIntoQueryBuilder=function(e){this.lastGroupByRequestIndex=e.groupByRequests.length;var t=this._createBasicGroupByRequest();t.maximumNumberOfValues=null!=this.facet.options.slider.graph?this.facet.options.slider.graph.steps||1:1,t.queryOverride=this.facet.options.slider.queryOverride||"@sysuri",t.sortCriteria="nosort",t.generateAutomaticRanges=!0,t.rangeValues=void 0,e.groupByRequests.push(t)},i.prototype.createRangeValuesForGraph=function(e){return void 0==this.facet.options.slider.graph.steps&&(this.facet.options.slider.graph.steps=10),this.facet.options.dateField&&isNaN(this.facet.options.slider.start)&&(this.facet.options.slider.start=new Date(this.facet.options.slider.start).getTime()),this.facet.options.dateField&&isNaN(this.facet.options.slider.end)&&(this.facet.options.slider.end=new Date(this.facet.options.slider.end).getTime()),void 0!=this.rangeValuesForGraphToUse?this.usePrebuiltRange(e):this.buildRange(e)},i.prototype.usePrebuiltRange=function(t){return e._.map(this.rangeValuesForGraphToUse,function(e){return{start:e.start,end:e.end,endInclusive:t.endInclusive,label:t.label}})},i.prototype.buildRange=function(t){var i=this,n=this.facet.options.slider.start,o=(this.facet.options.slider.end,(this.facet.options.slider.end-this.facet.options.slider.start)/this.facet.options.slider.graph.steps);return e._.map(e._.range(0,this.facet.options.slider.graph.steps,1),function(e){var s=n+e*o,r=n+(e+1)*o;return i.facet.options.dateField&&(s=i.getISOFormat(s),r=i.getISOFormat(r)),{endInclusive:t.endInclusive,label:t.label,start:s,end:r}})},i.prototype.buildGroupByQueryForSelectedAndExcludedValues=function(t){var i=this;return t.rangeValues=e._.map(this.facet.values.getAll(),function(e){var t=e.value.split(".."),n=t[0],o=t[1];return i.facet.options.dateField&&(n=i.getISOFormat(n),o=i.getISOFormat(o)),{start:n,end:o,endInclusive:!0,label:e.lookupValue}}),t},i.prototype.getISOFormat=function(t){if(t){var i=new Date(t);return e.DateUtils.isValid(i)||(i=new Date(this.getBrowserCompatibleFormat(t)),e.DateUtils.isValid(i))?i.toISOString():(this.facet.logger.error("Cannot parse this date format.",t,new Date(t)),void 0)}return void 0},i.prototype.getFilterDateFormat=function(e){return e?this.getISOFormat(e).replace("T","@").replace(".000Z","").replace(/-/g,"/"):void 0},i.prototype.getBrowserCompatibleFormat=function(e){return e.replace("@","T").replace(/\//g,"-")},i}(t.FacetQueryController);t.FacetRangeQueryController=i}(t=e.Controllers||(e.Controllers={}))}(Coveo||(Coveo={}));var Coveo;!function(e){var t;!function(e){var t=function(){function e(){}return e.startSlide="startSlide",e.duringSlide="duringSlide",e.endSlide="endSlide",e.graphValueSelected="graphValueSelected",e}();e.SliderEvents=t}(t=e.Events||(e.Events={}))}(Coveo||(Coveo={}));var Coveo;!function(e){var t;!function(e){function t(){return document.implementation.hasFeature("http://www.w3.org/TR/SVG11/feature#BasicStructure","1.1")}e.supportSVG=t}(t=e.FeatureDetectionUtils||(e.FeatureDetectionUtils={}))}(Coveo||(Coveo={}));var Coveo;!function(e){var t;!function(t){var i=function(i){function n(o,s,r){i.call(this,o,t.ComponentOptions.initComponentOptions(o,n,s),r,n.ID),this.element=o,this.isEmpty=!1,this.options.enableFacetSearch=!1,this.options.enableSettings=!1,this.options.includeInOmniBox=!1,this.hasASlider()&&(null==this.options.slider.excludeOuterBounds&&(this.options.slider.excludeOuterBounds=!1),this.options.dateField=this.options.slider.dateField=this.options.slider.dateField||this.options.dateField||!1,this.options.slider.start&&(this.options.slider.start=this.options.slider.dateField?new Date(this.options.slider.start).getTime():parseFloat(this.options.slider.start)),this.options.slider.end&&(this.options.slider.end=this.options.slider.dateField?new Date(this.options.slider.end).getTime():parseFloat(this.options.slider.end)),this.hasAGraph()&&(e.FeatureDetectionUtils.supportSVG()||(this.options.slider.graph=void 0,this.logger.info("Your browser does not support SVG. Cannot add graphic to your facet range",this)),"undefined"==typeof d3&&(this.options.slider.graph=void 0,this.logger.info("Cannot find the required dependencies d3.js. Cannot add graphic to your facet range",this))),this.handleNoresults())}return __extends(n,i),n.prototype.reset=function(){this.hasASlider()?(this.slider.initializeState(),this.updateQueryState(),this.updateFacetStyle()):i.prototype.reset.call(this)},n.prototype.getSelectedValues=function(){return this.hasASlider()?void 0!=this.startOfSlider&&void 0!=this.endOfSlider?[this.startOfSlider.toString(),this.endOfSlider.toString()]:["undefined","undefined"]:i.prototype.getSelectedValues.call(this)},n.prototype.getValueCaption=function(n){var o=i.prototype.getValueCaption.call(this,n);if(e.Utils.exists(this.options.valueCaption)&&"string"==typeof this.options.valueCaption){var s=/^(.*)\.\.(.*)$/.exec(n.value);if(null!=s){var r=t.TemplateHelpers.getHelper(this.options.valueCaption);if(null!=r)o=r.call(this,s[1])+" - "+r.call(this,s[2]);else var a=s[1].match(/^[\+\-]?[0-9]+(\.[0-9]+)?$/)?Number(s[1]):e.DateUtils.convertFromJsonDateIfNeeded(s[1]),l=s[2].match(/^[\+\-]?[0-9]+(\.[0-9]+)?$/)?Number(s[2]):e.DateUtils.convertFromJsonDateIfNeeded(s[2]),o=Globalize.format(a,this.options.valueCaption)+" - "+Globalize.format(l,this.options.valueCaption)}}return o},n.prototype._initFacetValuesList=function(){this.hasASlider()||i.prototype._initFacetValuesList.call(this)},n.prototype._handlePopulateBreadcrumb=function(t,n){var o=this;if(this.hasASlider()){var s=function(){o.sliderIsActive()&&n.breadcrumbs.push({element:o.buildBreadcrumbFacetSlider().get(0),clearAll:function(){return o.reset()}})};this.slider?s():e.$(this.root).one(e.Events.QueryEvents.deferredQuerySuccess,function(){s(),e.$(o.root).trigger(e.Events.BreadcrumbEvents.redrawBreadcrumb)})}else i.prototype._handlePopulateBreadcrumb.call(this,t,n)},n.prototype.getSliderBoundaryForQuery=function(){var e=!1;return this.hasASlider()&&!this.slider?e=!0:this.hasASlider()&&this.slider&&this.sliderIsActive()&&(e=!0),e?this.generateBoundary():void 0},n.prototype.handleNoresults=function(){var t=this;e.$(this.root).on(e.Events.QueryEvents.noResults,function(){t.isEmpty=!0,t._updateAppearanceDependingOnState()}),e.$(this.root).on(e.Events.QueryEvents.newQuery,function(){t.isEmpty=!1})},n.prototype.sliderIsActive=function(){return!(isNaN(this.startOfSlider)||isNaN(this.endOfSlider)||isNaN(this.initialStartOfSlider)||isNaN(this.initialEndOfSlider)||this.startOfSlider==this.initialStartOfSlider&&this.endOfSlider==this.initialEndOfSlider)},n.prototype.buildBreadcrumbFacetSlider=function(){var i=this,n=e.$("<div/>").addClass("coveo-facet-breadcrumb");e.$("<span/>").addClass("coveo-title").text(this.options.title+":").appendTo(n);{var o=e.$("<span/>").addClass("coveo-values").appendTo(n),s=e.$("<span class='coveo-value'>"+this.slider.getCaption()+"</span>").appendTo(o);e.$("<span class='coveo-clear'></span>").appendTo(s)}return s.fastClick(function(){i.reset(),i.triggerNewQuery(function(){return i.usageAnalytics.logSearchEvent(t.AnalyticsActionCauseList.facetClearAll,{facetId:i.options.uniqueId})})}),n},n.prototype.initSlider=function(){this.buildSlider(),this.slider.initializeState([this.startOfSlider,this.endOfSlider]),this.updateFacetStyle()},n.prototype._initQueryStateEvents=function(){var t=this;if(this.options.slider){this.rangeQueryStateAttribute=e.Models.QueryStateModel.getFacetId(this.options.uniqueId)+":range",this.queryStateModel.registerNewAttribute(this.rangeQueryStateAttribute,[void 0,void 0]);var n=this.queryStateModel.getEventName(e.Models.Model.eventTypes.changeOne+this.rangeQueryStateAttribute);this.bind.onRoot(n,function(e,i){t.slider?t.handleRangeQueryStateChanged(e,i):t.setRangeStateSliderStillNotCreated(e,i)})}else i.prototype._initQueryStateEvents.call(this)},n.prototype.handleRangeQueryStateChanged=function(e,t){this.setupSliderIfNeeded(t),this.startOfSlider=void 0==t.value[0]?this.startOfSlider:t.value[0],this.endOfSlider=void 0==t.value[1]?this.endOfSlider:t.value[1],this.slider.setValues([this.startOfSlider,this.endOfSlider]),this.updateFacetStyle()},n.prototype.setRangeStateSliderStillNotCreated=function(e,t){this.rangeFromUrlState=this.copyValues(t.value)},n.prototype.buildSlider=function(){var i=this,n=e.$("<div class='coveo-values coveo-slider-container'></div>");this.hasAGraph()&&n.addClass("coveo-with-graph");var o=e.$("<div></div>");this.slider=new t.Slider(o,e.$.extend({},this.options.slider,{dateField:this.options.dateField})),o.on(e.Events.SliderEvents.endSlide,function(e,t){i.handleEndSlide(e,t)}),o.on(e.Events.SliderEvents.duringSlide,function(e,t){i.handleDuringSlide(e,t)}),this.hasAGraph()&&o.on(e.Events.SliderEvents.graphValueSelected,function(e,t){i.handleGraphValueSelected(e,t)}),n.append(o),e.$(this.element).append(n),this.updateFacetStyle()},n.prototype._initFacetQueryController=function(){this.facetQueryController=new e.Controllers.FacetRangeQueryController(this)},n.prototype._handleBuildingQuery=function(t,n){e.Assert.exists(n),e.Assert.exists(n.queryBuilder);var o=this.getSliderBoundaryForQuery();if(void 0!=o){this.facetQueryController.prepareForNewQuery();var s=this.facetQueryController.computeOurFilterExpression(o);e.Utils.isNonEmptyString(s)&&(this.logger.trace("Putting filter in query",s),n.queryBuilder.advancedExpression.add(s))}else i.prototype._handleBuildingQuery.call(this,t,n)},n.prototype._processNewGroupByResults=function(e){var t=this;this.hasASlider()||(null!=e&&(null!=this.options.ranges||this.keepDisplayedValuesNextTime&&!this.values.hasSelectedOrExcludedValues()||(this.keepDisplayedValuesNextTime=!1,e.values.sort(function(e,i){var n=e.value.split(".."),o=i.value.split("..");return t.options.dateField?Date.parse(n[0])-Date.parse(o[0]):Number(n[0])-Number(o[0])}))),i.prototype._processNewGroupByResults.call(this,e))},n.prototype._handleDeferredQuerySuccess=function(e,t){this.ensureDom(),i.prototype._handleDeferredQuerySuccess.call(this,e,t),this.setupSliderIfNeeded(t);var n=t.results.groupByResults[this.facetQueryController.lastGroupByRequestIndex];(void 0==n||void 0==n.values[0])&&(this.isEmpty=!0,this._updateAppearanceDependingOnState()),this.hasAGraph()&&(this._updateAppearanceDependingOnState(),this.renderToSliderGraph(t)),this._updateAppearanceDependingOnState()},n.prototype._facetValueShouldBeRemoved=function(){return!1},n.prototype._rebuildValueElements=function(){this.hasASlider()||i.prototype._rebuildValueElements.call(this)},n.prototype.handleEndSlide=function(e,n){var o=this,s=n.slider.getValues();this.startOfSlider=s[0],this.endOfSlider=s[1],this.updateQueryState(s)&&(this.updateFacetStyle(),i.prototype.triggerNewQuery.call(this,function(){return o.usageAnalytics.logSearchEvent(t.AnalyticsActionCauseList.facetRangeSlider,{facetId:o.options.uniqueId,facetRangeStart:o.startOfSlider.toString(),facetRangeEnd:o.endOfSlider.toString()})}))},n.prototype.handleDuringSlide=function(e,t){var i=t.slider.getValues();this.startOfSlider=i[0],this.endOfSlider=i[1],this.slider.setValues([this.startOfSlider,this.endOfSlider]),this.updateFacetStyle()},n.prototype.handleGraphValueSelected=function(e,n){var o=this;(this.options.slider.rangeSlider&&this.startOfSlider!=n.start||this.endOfSlider!=n.end)&&(this.options.slider.rangeSlider&&(this.startOfSlider=n.start),this.endOfSlider=n.end,this.slider.setValues([this.startOfSlider,this.endOfSlider]),this.updateQueryState(),i.prototype.triggerNewQuery.call(this,function(){return o.usageAnalytics.logSearchEvent(t.AnalyticsActionCauseList.facetRangeGraph,{facetId:o.options.uniqueId,facetRangeStart:o.startOfSlider.toString(),facetRangeEnd:o.endOfSlider.toString()})}))},n.prototype.updateQueryState=function(e,t){void 0===e&&(e=this.slider.getValues()),void 0===t&&(t=!1);var i=this.copyValues(e),n=e[0]+0,o=e[1]+0,s=this.queryStateModel.get(this.rangeQueryStateAttribute);return null==s||i[0]!=s[0]||i[1]!=s[1]?(i[0]=n,i[1]=o,this.queryStateModel.set(this.rangeQueryStateAttribute,i,{silent:t}),!0):!1},n.prototype.copyValues=function(e){var t=[];return t[0]=e[0]+0,t[1]=e[1]+0,t},n.prototype.updateFacetStyle=function(){this.sliderIsActive()?e.$(this.element).removeClass("coveo-disabled"):e.$(this.element).addClass("coveo-disabled")},n.prototype.renderToSliderGraph=function(t){var i,n=this,o=t.results.groupByResults[this.facetQueryController.graphGroupByQueriesIndex],s=0;o&&(i=e._.map(o.values,function(e){s+=e.numberOfResults;var t=e.value.split("..")[0],i=e.value.split("..")[1];n.options.dateField?(t=new Date(t.split("@")[0]).getTime(),i=new Date(i.split("@")[0]).getTime()):(t=parseFloat(t),i=parseFloat(i));var o=e.numberOfResults;return{start:t,y:o,end:i,isDate:n.options.dateField}})),0==s?(this.isEmpty=!0,this._updateAppearanceDependingOnState()):void 0!=i&&this.slider.drawGraph(i)},n.prototype._updateAppearanceDependingOnState=function(){this.options.slider?(this.isEmpty&&!this.sliderIsActive()?e.$(this.element).addClass("coveo-disabled-empty"):(e.$(this.element).removeClass("coveo-disabled-empty"),e.$(this._eraserElement).fastToggle(this.sliderIsActive())),this.updateFacetStyle()):i.prototype._updateAppearanceDependingOnState.call(this)},n.prototype.generateBoundary=function(){if(this.slider){var e=this.generateBoundaryFromSlider();return void 0==e[0]&&void 0==e[1]?this.generateBoundaryFromState():e}return this.generateBoundaryFromState()},n.prototype.generateBoundaryFromSlider=function(){var e,t;return void 0!=this.startOfSlider&&(e=this.startOfSlider),void 0!=this.endOfSlider&&(t=this.endOfSlider),[e,t]},n.prototype.generateBoundaryFromState=function(){var e,t,i=this.queryStateModel.get(this.rangeQueryStateAttribute)[0];void 0!=i&&(e=i);var n=this.queryStateModel.get(this.rangeQueryStateAttribute)[1];return void 0!=n&&(t=n),e!=this.queryStateModel.getDefault(this.rangeQueryStateAttribute)[0]||t!=this.queryStateModel.getDefault(this.rangeQueryStateAttribute)[1]?[e,t]:[void 0,void 0]},n.prototype.setupSliderIfNeeded=function(t){if(this.ensureDom(),!e.Utils.isNullOrUndefined(this.options.slider)&&e.Utils.isNullOrUndefined(this.slider)){this.alreadySetBoundary()||this.trySetSliderBoundaryFromOptions(),this.alreadySetBoundary()||void 0==t||this.trySetSliderBoundaryFromQueryResult(t),this.trySetSliderBoundaryFromState(),this.setupSliderStateVariables();var i=this.verifySetup();i?this.logger.warn("Unable to initialize slider with current values",this):(this.initSlider(),this.updateQueryState())}},n.prototype.verifySetup=function(){var e=0;return e+=void 0==this.initialStartOfSlider?1:0,e+=isNaN(this.initialStartOfSlider)?1:0,e+=void 0==this.initialEndOfSlider?1:0,e+=isNaN(this.initialEndOfSlider)?1:0},n.prototype.setupSliderStateVariables=function(){isNaN(this.initialStartOfSlider)||isNaN(this.initialEndOfSlider)?this.logger.warn("Cannnot initialize slider with those values : start: "+this.initialStartOfSlider+" end: "+this.initialEndOfSlider):(this.initialStartOfSlider=parseFloat(this.initialStartOfSlider.toString()),this.initialEndOfSlider=parseFloat(this.initialEndOfSlider.toString()),this.startOfSlider=void 0!=this.startOfSlider?parseFloat(this.startOfSlider.toString()):this.initialStartOfSlider,this.endOfSlider=void 0!=this.endOfSlider?parseFloat(this.endOfSlider.toString()):this.initialEndOfSlider,this.options.slider.start=this.initialStartOfSlider,this.options.slider.end=this.initialEndOfSlider,this.queryStateModel.setNewDefault(this.rangeQueryStateAttribute,[this.initialStartOfSlider,this.initialEndOfSlider]))},n.prototype.alreadySetBoundary=function(){return void 0!=this.startOfSlider&&void 0!=this.endOfSlider},n.prototype.trySetSliderBoundaryFromOptions=function(){e.Utils.isNullOrUndefined(this.options.slider.start)||this.setupInitialSliderStateStart(this.options.slider.start),e.Utils.isNullOrUndefined(this.options.slider.end)||this.setupInitialSliderStateEnd(this.options.slider.end)},n.prototype.trySetSliderBoundaryFromState=function(){var e=this.rangeFromUrlState||this.queryStateModel.get(this.rangeQueryStateAttribute);e&&void 0!=e[0]&&void 0!=e[1]&&(this.setupInitialSliderStateStart(e[0]),this.setupInitialSliderStateEnd(e[1]),this.startOfSlider=e[0],this.endOfSlider=e[1])},n.prototype.trySetSliderBoundaryFromQueryResult=function(e){var t=e.results.groupByResults[this.facetQueryController.lastGroupByRequestIndex];t&&t.values.length>0&&(this.setupInitialSliderStateStart(t.values[0].value.split("..")[0]),this.setupInitialSliderStateEnd(t.values[t.values.length-1].value.split("..")[1]))},n.prototype.setupInitialSliderStateStart=function(e){void 0==this.initialStartOfSlider&&(this.initialStartOfSlider=e,this.options.dateField&&isNaN(e)&&(this.initialStartOfSlider=new Date(e.replace("@"," ")).getTime()))},n.prototype.setupInitialSliderStateEnd=function(e){void 0==this.initialEndOfSlider&&(this.initialEndOfSlider=e,this.options.dateField&&isNaN(e)&&(this.initialEndOfSlider=new Date(e.replace("@"," ")).getTime()))},n.prototype.hasASlider=function(){return void 0!=this.options.slider},n.prototype.hasAGraph=function(){return this.hasASlider()&&void 0!=this.options.slider.graph},n.ID="FacetRange",n.parent=t.Facet,n.options={dateField:t.ComponentOptions.buildBooleanOption({defaultValue:!1}),slider:t.ComponentOptions.buildObjectOption({subOptions:{start:t.ComponentOptions.buildStringOption(),end:t.ComponentOptions.buildStringOption(),queryOverride:t.ComponentOptions.buildStringOption(),excludeOuterBounds:t.ComponentOptions.buildBooleanOption(),rounded:t.ComponentOptions.buildNumberOption(),steps:t.ComponentOptions.buildNumberOption(),rangeSlider:t.ComponentOptions.buildBooleanOption({attrName:"data-range-slider"}),displayAsValue:t.ComponentOptions.buildObjectOption({subOptions:{unitSign:t.ComponentOptions.buildStringOption(),separator:t.ComponentOptions.buildStringOption()}}),displayAsPercent:t.ComponentOptions.buildObjectOption({subOptions:{separator:t.ComponentOptions.buildStringOption()}}),dateField:t.ComponentOptions.buildBooleanOption(),graph:t.ComponentOptions.buildObjectOption({subOptions:{steps:t.ComponentOptions.buildNumberOption(),animationDuration:t.ComponentOptions.buildNumberOption(),margin:t.ComponentOptions.buildObjectOption({subOptions:{top:t.ComponentOptions.buildNumberOption(),bottom:t.ComponentOptions.buildNumberOption(),left:t.ComponentOptions.buildNumberOption(),right:t.ComponentOptions.buildNumberOption()}})}})}})},n}(t.Facet);t.FacetRange=i,t.CoveoJQuery.registerAutoCreateComponent(i)}(t=e.Ui||(e.Ui={}))}(Coveo||(Coveo={}));var Coveo;!function(Coveo){var Ui;!function(Ui){var FieldValue=function(_super){function FieldValue(e,t,i,n){var o=this;_super.call(this,e,FieldValue.ID,i),this.element=e,this.options=t,this.result=n,this.options=Ui.ComponentOptions.initComponentOptions(e,FieldValue,t),this.result=this.result||this.resolveResult(),Coveo.Assert.exists(this.result),this.options.field=this.options.field.toLowerCase();var s=Coveo.Utils.getCoveoFieldKey(this.options.field),r=this.result.raw[s];null==r&&(r=this.result[s]),Coveo._.isObject(r)&&(r=null);var a;this.options.splitValues&&r?(a=r.split(";"),a=Coveo._.map(a,function(e){return Coveo.$.trim(e)})):a=[r],Coveo._.each(a,function(e){void 0!=e&&o.renderOneValue(e)})}return __extends(FieldValue,_super),FieldValue.prototype.getHelperOptions=function(){return!this.evaluatedHelperOptions&&Coveo.Utils.isNonEmptyString(this.options.helperOptions)&&(this.evaluatedHelperOptions=eval("("+this.options.helperOptions+")")),this.evaluatedHelperOptions},FieldValue.prototype.renderOneValue=function(e){var t=Coveo.$("<span></span>"),i=e;this.options.helper&&(i=Ui.TemplateHelpers.getHelper(this.options.helper).call(this,e,this.getHelperOptions())),this.options.htmlValue?t.html(i):t.text(i),Coveo.$(this.element).append(t),this.bindEventOnValue(t,e)},FieldValue.prototype.bindEventOnValue=function(e,t){var i=this,n=Coveo.Models.QueryStateModel.getFacetId(this.options.facet),o=this.queryStateModel.get(n),s=this.componentStateModel.get(n),r=Coveo._.filter(s,function(e){return!e.disabled}).length>0;null!=o&&r&&(Coveo.$(e).on("click",function(){Coveo._.contains(o,t.toLowerCase())?i.queryStateModel.set(n,Coveo._.without(o,t.toLowerCase())):i.queryStateModel.set(n,Coveo._.union(o,[t.toLowerCase()])),i.queryController.deferExecuteQuery({beforeExecuteQuery:function(){return i.usageAnalytics.logSearchEvent(Ui.AnalyticsActionCauseList.documentField,{facetId:i.options.facet,facetValue:t.toLowerCase()})}})}),Coveo._.contains(o,t.toLowerCase())&&Coveo.$(e).addClass("coveo-selected"),Coveo.$(e).addClass("coveo-clickable"))},FieldValue.ID="FieldValue",FieldValue.options={field:Ui.ComponentOptions.buildFieldOption(),facet:Ui.ComponentOptions.buildStringOption({postProcessing:function(e,t){return e||t.field}}),htmlValue:Ui.ComponentOptions.buildBooleanOption({defaultValue:!1}),helper:Ui.ComponentOptions.buildStringOption(),helperOptions:Ui.ComponentOptions.buildStringOption(),splitValues:Ui.ComponentOptions.buildBooleanOption({defaultValue:!1})},FieldValue}(Ui.Component);Ui.FieldValue=FieldValue,Ui.CoveoJQuery.registerAutoCreateComponent(FieldValue)}(Ui=Coveo.Ui||(Coveo.Ui={}))}(Coveo||(Coveo={}));var Coveo;!function(e){var t;!function(t){var i=function(i){function o(s,r,a,l){i.call(this,s,n.ID,a),this.element=s,this.options=r,this.options=t.ComponentOptions.initComponentOptions(s,o,r);var u=e.$(this.element).find("tr[data-field]");u.each(function(e,t){new n(t,{},a,l)}),0==e.$(s).find("tr").length&&e.$(s).detach()}return __extends(o,i),o.ID="FieldTable",o.options={},o}(t.Component);t.CoveoJQuery.registerAutoCreateComponent(i);var n=function(i){function n(o,s,r,a){i.call(this,o,n.ID,r),this.element=o,this.options=s,this.result=a,this.options=t.ComponentOptions.initComponentOptions(o,n,s),this.result=a||this.resolveResult();var l=e.Utils.getCoveoFieldKey(this.options.field);if(null!=this.result.raw[l]||null!=this.result[l]){e.$(o).append('<th class ="CoveoCaption">'+this.options.caption.toLocaleString()+"</th>");var u=e.$("<td />").appendTo(o);new t.FieldValue(u[0],this.options,r,a)}else e.$(o).detach()}return __extends(n,i),n.ID="ValueRow",n.options=e._.extend({caption:t.ComponentOptions.buildStringOption({postProcessing:function(e,t){return e||t.field.substr(1)
}})},t.FieldValue.options),n}(t.Component)}(t=e.Ui||(e.Ui={}))}(Coveo||(Coveo={}));var Coveo;!function(e){var t;!function(t){var i=function(i){function n(o,s,r){i.call(this,o,n.ID,r),this.element=o,this.options=s,this.options=t.ComponentOptions.initComponentOptions(o,n,s),e.Assert.check(e.Utils.isCoveoField(this.options.field),this.options.field+" is not a valid field"),e.Assert.exists(this.options.maximumExpandedResults),this.bind.onRoot(e.Events.QueryEvents.buildingQuery,this.handleBuildingQuery),this.bind.onRoot(e.Events.QueryEvents.preprocessResults,this.handlepreprocessResults)}return __extends(n,i),n.resultNodeToQueryResult=function(t){var i=t.result;return i.attachments=e._.map(e._.sortBy(t.children,"score"),n.resultNodeToQueryResult),i.parentResult=null!=t.parent?t.parent.result:null,i},n.findUniqueId=function(e,t){for(var i=0;i<e.length;i++){if(e[i].result.uniqueId==t)return e[i];var o=n.findUniqueId(e[i].children,t);if(null!=o)return o}return null},n.foldWithParent=function(t){var i={score:Number.NEGATIVE_INFINITY,children:[],result:{}};e._.each(t,function(t,o){var s=n.findUniqueId(i.children,t.uniqueId);if(null==t.parentResult||t.parentResult.uniqueId==t.uniqueId)null==s&&(s={result:t,score:o,children:[]},i.children.push(s),s.parent=i);else{null!=s?(s.score=Math.min(o,s.score),s.parent.children=e._.without(s.parent.children,s)):s={result:t,score:o,children:[]};var r=n.findUniqueId(i.children,t.parentResult.uniqueId);null==r&&(r={result:t.parentResult,score:Number.POSITIVE_INFINITY,children:[]},i.children.push(r),r.parent=i),r.children.push(s),s.parent=r;for(var a=r;null!=a&&s.score<a.score;)a.score=s.score,a=a.parent}});var o=n.resultNodeToQueryResult(i);return o.attachments},n.defaultGetResult=function(e){var t=e.childResults||[];t.unshift(e),e.childResults=[],t=n.foldWithParent(t);var i=t.shift();return i.childResults=t,i},n.defaultGetMoreResults=function(e){return n.foldWithParent(e)},n.prototype.handleBuildingQuery=function(t,i){e.Assert.exists(i),this.disabled||(i.queryBuilder.childField=this.options.childField,i.queryBuilder.parentField=this.options.parentField,i.queryBuilder.filterField=this.options.field,i.queryBuilder.filterFieldRange=this.options.range)},n.prototype.handlepreprocessResults=function(t,i){e.Assert.exists(i),e.Assert.check(!i.results._folded,"Two folding component are active at the same time for the same tab. Can't process result !"),i.results._folded=!0;var o=i.results,s=this.options.getResult||n.defaultGetResult;o.results=e._.map(o.results,s),this.addLoadMoreHandler(o.results,i.query)},n.prototype.addLoadMoreHandler=function(t,i){var n=this;return e._.map(t,function(t){return n.options.enableExpand&&!e.Utils.isNullOrUndefined(t.raw[n.options.field.substr(1)])&&(t.moreResults=function(){return n.moreResults(t,i)}),t})},n.prototype.moreResults=function(i,n){var o=this,s=e.$.Deferred(),r=new t.QueryBuilder;r.numberOfResults=this.options.maximumExpandedResults;var a=i.raw[this.options.field.substr(1)];e.Utils.isNonEmptyString(a)&&r.advancedExpression.addFieldExpression(this.options.field,"=",[a]),e.Utils.isNonEmptyString(n.q)&&r.expression.add("("+n.q+") OR @sysuri"),e.Utils.isNonEmptyString(this.options.expandExpression)&&r.constantExpression.add(this.options.expandExpression),null!=this.options.parentField&&(r.parentField=this.options.parentField),null!=this.options.childField&&(r.childField=this.options.childField),this.options.rearrange?this.options.rearrange.putInQueryBuilder(r):(r.sortCriteria=n.sortCriteria,r.sortField=n.sortField);var l=r.build();return this.queryController.getEndpoint().search(l).done(function(t){e.QueryUtils.setIndexAndUidOnQueryResults(l,t,i.queryUid),e.QueryUtils.setStateObjectOnQueryResults(o.queryStateModel.get(),t),o.handlePreprocessMoreResults(t),s.resolve(t.results)}),s},n.prototype.handlePreprocessMoreResults=function(e){var t=this.options.getMoreResults||n.defaultGetMoreResults;e.results=t(e.results)},n.ID="Folding",n.options={field:t.ComponentOptions.buildFieldOption({required:!0}),childField:t.ComponentOptions.buildFieldOption({defaultValue:"@systopparentid"}),parentField:t.ComponentOptions.buildFieldOption({defaultValue:"@syscontainsattachment"}),range:t.ComponentOptions.buildNumberOption({defaultValue:2}),rearrange:t.ComponentOptions.buildCustomOption(function(i){return e.Utils.isNonEmptyString(i)?t.SortCriteria.parse(i):null}),directChildField:t.ComponentOptions.buildFieldOption({defaultValue:"@sysisattachment"}),directParentField:t.ComponentOptions.buildFieldOption({defaultValue:"@syscontainsattachment"}),enableExpand:t.ComponentOptions.buildBooleanOption({defaultValue:!0}),expandExpression:t.ComponentOptions.buildStringOption(),maximumExpandedResults:t.ComponentOptions.buildNumberOption({defaultValue:100})},n}(t.Component);t.Folding=i,e.Ui.CoveoJQuery.registerAutoCreateComponent(i)}(t=e.Ui||(e.Ui={}))}(Coveo||(Coveo={}));var Coveo;!function(e){var t;!function(t){var i=function(i){function n(o,s,r){i.call(this,o,n.ID,r),this.element=o,this.options=s,this.options=t.ComponentOptions.initComponentOptions(o,n,s),e.$(this.root).on(e.Events.QueryEvents.buildingQuery,e.$.proxy(this.handleBuildingQuery,this)),e.$(this.root).on(this.queryStateModel.getEventName(e.Models.Model.eventTypes.changeOne+e.Models.QueryStateModel.attributesEnum.hq),e.$.proxy(this.handleUpdateUi,this))}return __extends(n,i),n.prototype.handleBuildingQuery=function(t,i){e.Assert.exists(i);var n=this.queryStateModel.get(e.Models.QueryStateModel.attributesEnum.hq);e.Utils.isNonEmptyString(n)?i.queryBuilder.advancedExpression.add(n):e.$(this.element).hide()},n.prototype.handleUpdateUi=function(t,i){e.Assert.exists(i);var n=i.value,o=this.queryStateModel.get(e.Models.QueryStateModel.attributesEnum.hd);e.Utils.isNonEmptyString(n)?(this.updatePanel(o),e.$(this.element).show()):e.$(this.element).hide()},n.prototype.updatePanel=function(i){var n=this;e.$(this.element).empty();var o=e.$("<span></span>").text(i),s=e.$("<a/>").attr("href","#").text(t.l("Remove")).addClass("coveo-remove").fastClick(function(){n.usageAnalytics.isContextual=!1,n.clearHiddenQuery()});this.usageAnalytics.isContextual=!0,e.$(this.element).append(o,s)},n.prototype.clearHiddenQuery=function(){var i=this,n=this.queryStateModel.get(e.Models.QueryStateModel.attributesEnum.hd);this.queryStateModel.set(e.Models.QueryStateModel.attributesEnum.hd,""),this.queryStateModel.set(e.Models.QueryStateModel.attributesEnum.hq,""),this.queryController.deferExecuteQuery({beforeExecuteQuery:function(){return i.usageAnalytics.logSearchEvent(t.AnalyticsActionCauseList.contextRemove,{contextName:n})}})},n.ID="HiddenQuery",n.options={},n}(t.Component);t.HiddenQuery=i,t.CoveoJQuery.registerAutoCreateComponent(i)}(t=e.Ui||(e.Ui={}))}(Coveo||(Coveo={}));var Coveo;!function(e){var t;!function(t){var i=function(t){function i(i){var n=this;t.call(this,i),this.facet=i,e.$(this.facet.root).on(e.Events.QueryEvents.querySuccess,function(e,t){void 0!=n.lastGroupByIndexForCountOf&&n.facet.options.useAnd&&(n.lastGroupByForCountOf=t.results.groupByResults[n.lastGroupByIndexForCountOf])}),e.$(this.facet.root).on(e.Events.QueryEvents.buildingQuery,function(){n.lastGroupByIndexForCountOf=void 0})}return __extends(i,t),i.prototype.putGroupByIntoQueryBuilder=function(e){t.prototype.putGroupByIntoQueryBuilder.call(this,e);var i=t.prototype._createBasicGroupByRequest.call(this);i.queryOverride="@sysuri",this.lastGroupByIndexForCountOf=e.groupByRequests.length,e.groupByRequests.push(i)},i}(t.FacetQueryController);t.HierarchicalFacetQueryController=i}(t=e.Controllers||(e.Controllers={}))}(Coveo||(Coveo={}));var Coveo;!function(e){var t;!function(t){var i=function(i){function n(e,t,n){i.call(this,e,t,n),this.facet=e,this.facetValue=t,this.keepDisplayedValueNextTime=n}return __extends(n,i),n.prototype.build=function(){var e=i.prototype.build.call(this);return e.label.append(e.excludeIcon),e},n.prototype.buildXOfYCountText=function(i){var n=this,o=this.facet.facetQueryController,s=e._.find(o.lastGroupByForCountOf.values,function(e){return e.value==n.facetValue.value});if(s){var r=Globalize.format(s.numberOfResults,"n0");return r!=i?i+" "+t.l("Of")+" "+r:i}return i},n}(t.FacetValueElement);t.HierarchicalFacetValueElement=i}(t=e.Ui||(e.Ui={}))}(Coveo||(Coveo={}));var Coveo;!function(e){var t;!function(e){var t=function(e){function t(t,i){e.call(this,t,i),this.facet=t,this.facetValueElementKlass=i}return __extends(t,e),t.prototype._getValuesToBuildWith=function(){return this.hierarchyFacetValues},t}(e.FacetValuesList);e.HierarchicalFacetValuesList=t}(t=e.Ui||(e.Ui={}))}(Coveo||(Coveo={}));var Coveo;!function(e){var t;!function(e){var t=function(e){function t(t,i,n){e.call(this,t,i,n),this.facet=t,this.facetValue=i,this.eventArg=n}return __extends(t,e),t.prototype._handleSelectValue=function(t){this.facet.open(this.facetValue),e.prototype._handleSelectValue.call(this,t)},t.prototype._handleExcludeClick=function(t){this.facet.open(this.facetValue),e.prototype._handleExcludeClick.call(this,t)},t}(e.OmniBoxValueElement);e.OmniboxHierarchicalValueElement=t}(t=e.Ui||(e.Ui={}))}(Coveo||(Coveo={}));var Coveo;!function(e){var t;!function(e){var t=function(t){function i(i,n,o){t.call(this,i,n,o,e.OmniboxHierarchicalValueElement),this.facet=i,this.facetValues=n,this.omniboxObject=o}return __extends(i,t),i}(e.OmniboxValuesList);e.OmniboxHierarchicalValuesList=t}(t=e.Ui||(e.Ui={}))}(Coveo||(Coveo={}));var Coveo;!function(e){var t;!function(e){var t=function(e){function t(t,i){e.call(this,t,i),this.facet=t,this.facetValue=i}return __extends(t,e),t.prototype.build=function(){var t=e.prototype.build.call(this);return t.addClass("coveo-hierarchical-facet-value"),t.find(".coveo-caption").html(this.facetValue.value.split(this.facet.options.delimitingCharacter).join("<span class='coveo-hierarchical-breadcrumb-separator'></span>")),t},t}(e.BreadcrumbValueElement);e.HierarchicalBreadcrumbValueElement=t}(t=e.Ui||(e.Ui={}))}(Coveo||(Coveo={}));var Coveo;!function(e){var t;!function(e){var t=function(t){function i(i,n,o){t.call(this,i,n,e.HierarchicalBreadcrumbValueElement),this.facet=i,this.facetValues=n,this.valueHierarchy=o}return __extends(i,t),i}(e.BreadcrumbValueList);e.HierarchicalBreadcrumbValuesList=t}(t=e.Ui||(e.Ui={}))}(Coveo||(Coveo={}));var Coveo;!function(e){var t;!function(e){var t=function(e){function t(t,i,n){e.call(this,t,i,n),this.facet=t,this.facetValue=i,this.keepDisplayedValueNextTime=n}return __extends(t,e),t.prototype._handleSelectValue=function(t){this.facet.open(this.facetValue),e.prototype._handleSelectValue.call(this,t)},t.prototype._handleExcludeClick=function(t){this.facet.open(this.facetValue),e.prototype._handleExcludeClick.call(this,t)},t}(e.FacetValueElement);e.HierarchicalFacetSearchValueElement=t}(t=e.Ui||(e.Ui={}))}(Coveo||(Coveo={}));var Coveo;!function(e){var t;!function(e){var t=function(t){function i(i){t.call(this,i,e.HierarchicalFacetSearchValueElement),this.facet=i}return __extends(i,t),i}(e.FacetSearchValuesList);e.HierarchicalFacetSearchValuesList=t}(t=e.Ui||(e.Ui={}))}(Coveo||(Coveo={}));var Coveo;!function(e){var t;!function(t){var i=function(i){function n(o,s,r){i.call(this,o,e.$.extend({},s,{numberOfValues:1e4,injectionDepth:1e4}),r,n.ID),this.element=o,this.bindings=r,this.firstPlacement=!0,this.options=t.ComponentOptions.initComponentOptions(o,n,this.options),this.numberOfValuesToShow=this.originalNumberOfValuesToShow=s.numberOfValues||5,this.logger.info("Hierarchy facet : Set number of values very high in order to build hierarchy",this.options.numberOfValues,this)}return __extends(n,i),n.prototype.selectValue=function(e){this.ensureDom(),this.ensureValueHierarchyExists([e]);var t=this.getValueFromHierarchy(e);this.options.useAnd||this.selectChilds(t,t.childs),this.flagParentForSelection(t),i.prototype.selectValue.call(this,e)},n.prototype.selectMultipleValues=function(t){var n=this;this.ensureDom(),this.ensureValueHierarchyExists(t),e._.each(t,function(t){var i=n.getValueFromHierarchy(t);n.flagParentForSelection(i),n.options.useAnd||e._.each(i.childs,function(e){n.logger.info("Selecting facet value",n.facetValuesList.select(e.facetValue))})}),i.prototype.selectMultipleValues.call(this,t)},n.prototype.deselectValue=function(t){var n=this;this.ensureDom(),this.ensureValueHierarchyExists([t]);var o=this.getValueFromHierarchy(t);if(!this.options.useAnd){var s=void 0!=o.childs;if(s){var r=e._.filter(o.childs,function(e){var t=n.getFacetValueFromHierarchy(e.facetValue);return t.selected||t.excluded});r.length==o.childs.length&&this.deselectChilds(o,o.childs)}}this.unflagParentForSelection(o),i.prototype.deselectValue.call(this,t)},n.prototype.excludeValue=function(e){this.ensureDom(),this.ensureValueHierarchyExists([e]);var t=this.getValueFromHierarchy(e);this.options.useAnd?(this.deselectChilds(t,t.childs),this.close(t)):this.excludeChilds(t.childs),this.flagParentForSelection(t),i.prototype.excludeValue.call(this,e)},n.prototype.unexcludeValue=function(e){this.ensureDom(),this.ensureValueHierarchyExists([e]);var t=this.getValueFromHierarchy(e);this.options.useAnd||this.unexcludeChilds(t.childs),this.unflagParentForSelection(t),i.prototype.unexcludeValue.call(this,e)},n.prototype.deselectMultipleValues=function(t){var n=this;this.ensureDom(),this.ensureValueHierarchyExists(t),e._.each(t,function(t){var i=n.getValueFromHierarchy(t);n.unflagParentForSelection(i),n.options.useAnd||e._.each(i.childs,function(e){n.logger.info("Deselecting facet value",n.facetValuesList.unselect(e.facetValue))})}),i.prototype.deselectMultipleValues.call(this,t)},n.prototype.toggleSelectValue=function(e){this.ensureDom(),this.ensureValueHierarchyExists([e]),0==this.getFacetValueFromHierarchy(e).selected?this.selectValue(e):this.deselectValue(e)},n.prototype.toggleExcludeValue=function(e){this.ensureDom(),this.ensureValueHierarchyExists([e]),0==this.getFacetValueFromHierarchy(e).excluded?this.excludeValue(e):this.unexcludeValue(e)},n.prototype.getValueCaption=function(t){var i=this.getSelf(t),n=i;return e.Utils.exists(this.options.valueCaption)&&("object"==typeof this.options.valueCaption&&(n=this.options.valueCaption[i]||n),"function"==typeof this.options.valueCaption&&(n=this.options.valueCaption.call(this,t))),n},n.prototype.getDisplayedValues=function(){return e._.first(e._.pluck(this.values.getAll(),"value"),this.numberOfValuesToShow)},n.prototype.updateSort=function(e){this.firstPlacement=!0,i.prototype.updateSort.call(this,e)},n.prototype.open=function(e){var i=e instanceof t.FacetValue?this.valueHierarchy[e.value]:e;this.facetValuesList.get(i.facetValue).listElement.addClass("coveo-open"),this.showChilds(i.childs),void 0!=i.parent&&this.open(this.valueHierarchy[i.facetValue.value].parent),this.valueHierarchy[i.facetValue.value].keepOpened=!0},n.prototype.close=function(i){var n=this,o=i instanceof t.FacetValue?this.valueHierarchy[i.value]:i;this.facetValuesList.get(o.facetValue).listElement.removeClass("coveo-open"),this.hideChilds(o.childs),e._.each(o.childs,function(e){n.close(n.valueHierarchy[e.facetValue.value])}),this.valueHierarchy[o.facetValue.value].keepOpened=!1},n.prototype.getLevel=function(e){return e.value.split(this.options.delimitingCharacter).length-1},n.prototype.reset=function(){e._.each(this.valueHierarchy,function(e){e.hasChildSelected=!1}),i.prototype.reset.call(this)},n.prototype._isAnyValueCurrentlyDisplayed=function(){return i.prototype._isAnyValueCurrentlyDisplayed.call(this)&&0!=e.$(this.element).find(".coveo-value").length},n.prototype._initFacetSearch=function(){this.facetSearch=new t.FacetSearch(this,t.HierarchicalFacetSearchValuesList),e.$(this.element).append(this.facetSearch.build())},n.prototype._handlePopulateBreadcrumb=function(i,n){if(e.Assert.exists(n),this.values.hasSelectedOrExcludedValues()){var o=new t.HierarchicalBreadcrumbValuesList(this,this.values.getSelected().concat(this.values.getExcluded()),this.valueHierarchy).build();n.breadcrumbs.push({element:o.get(0)})}},n.prototype._handleOmniBoxWithStaticValue=function(i){var n=this,o=i.completeQueryExpression.regex,s=(i.completeQueryExpression.word,e._.first(e._.filter(this.valueHierarchy,function(e){return o.test(n.getValueCaption(e.facetValue))}),this.options.numberOfValuesInOmniBox)),r=e._.map(s,function(e){return n.facetValuesList.get(e.facetValue).facetValue}),a=new t.OmniboxHierarchicalValuesList(this,r,i).build();i.rows.push({element:a?a.get(0):void 0,zIndex:this._omniboxZIndex})},n.prototype._rebuildValueElements=function(){this.createValueHierarchy(),this.setValueListContent(),i.prototype._rebuildValueElements.call(this),this.buildParentChildRelationship(),this.crop()},n.prototype._initFacetValuesList=function(){this.facetValuesList=new t.HierarchicalFacetValuesList(this,t.HierarchicalFacetValueElement),e.$(this.element).append(this.facetValuesList.build())},n.prototype._updateMoreLess=function(){this._moreElement.toggleClass("coveo-active",this.topLevelHierarchy.length>this.numberOfValuesToShow),this.numberOfValuesToShow>this.originalNumberOfValuesToShow?this._lessElement.show():this._lessElement.hide()},n.prototype._handleClickMore=function(){this.numberOfValuesToShow+=this.originalNumberOfValuesToShow,this.numberOfValuesToShow=Math.min(this.numberOfValuesToShow,this.values.size()),this._rebuildValueElements()},n.prototype._handleClickLess=function(){this.numberOfValuesToShow=this.originalNumberOfValuesToShow,this._rebuildValueElements()},n.prototype.setValueListContent=function(){var t=this;this.facetValuesList.hierarchyFacetValues=e._.map(this.valueHierarchy,function(e){return t.values.contains(e.facetValue.value)||(e.facetValue.occurrences=0,t.values.add(e.facetValue)),e.facetValue})},n.prototype.ensureValueHierarchyExists=function(i){var n=this;i[0]&&"string"==typeof i[0]&&(i=e._.map(i,function(e){return t.FacetValue.createFromValue(e)}));var o=!1;e._.each(i,function(e){(void 0==n.valueHierarchy||void 0==n.valueHierarchy[e.value])&&(o=!0)}),o&&this.createValueHierarchy(i)},n.prototype.crop=function(){var t=this,i=e._.partition(this.topLevelHierarchy,function(e){return e.facetValue.selected||e.facetValue.excluded});e._.each(e._.last(i[1],i[1].length-(this.numberOfValuesToShow-i[0].length)),function(e){t.facetValuesList.get(e.facetValue).listElement.hide()})},n.prototype.placeChildsUnderTheirParent=function(t,i){var n=this;e._.each(t.childs.reverse(),function(e){var t=n.facetValuesList.get(e.facetValue).listElement;n.firstPlacement&&t.insertAfter(i)}),t.keepOpened?(this.open(t),this.showChilds(t.childs)):this.hideChilds(t.childs)},n.prototype.addCssClassToParentAndChilds=function(t,i){var n=this;i.addClass("coveo-has-childs"),t.hasChildSelected&&i.addClass("coveo-has-childs-selected");var o=e.$("<div class='coveo-has-childs-toggle'></div>").fastClick(function(){i.hasClass("coveo-open")?n.close(t):n.open(t)});i.prepend(o)},n.prototype.buildParentChildRelationship=function(){var t=this;e._.each(this.valueHierarchy,function(i){var n=t.facetValuesList.get(i.facetValue).listElement;e.Utils.isNonEmptyArray(i.childs)?(t.placeChildsUnderTheirParent(i,n),t.addCssClassToParentAndChilds(i,n)):n.addClass("coveo-no-childs"),n.css("margin-left",t.options.marginByLevel*(i.level-t.options.levelStart))}),this.firstPlacement&&!this.firstQuery?(this.firstPlacement=!1,this.setOriginalPosition()):e._.each(this.originalPosition,function(e,i){var n=t.facetValuesList.get(e.facetValue).listElement;n.parent().children().eq(i).after(n)})},n.prototype.setOriginalPosition=function(){var t=this;this.originalPosition=[],e._.each(this.valueHierarchy,function(e){t.originalPosition[t.facetValuesList.get(e.facetValue).listElement.index()]=e})},n.prototype.createValueHierarchy=function(t){var i=this;if(void 0===t&&(t=this.values.getAll()),this.valueHierarchy=this.valueHierarchy?this.valueHierarchy:{},!this.flatHierarchy||e._.keys(this.flatHierarchy).length<e._.keys(t).length){this.flatHierarchy=e._.map(t,function(e){var t=i.getParent(e),n=e.lookupValue||e.value;return{facetValue:e,level:i.getLevel(e),parent:t,self:n}}),this.setInHierarchy(this.flatHierarchy),e._.each(this.valueHierarchy,function(e){e.facetValue.selected&&i.flagParentForSelection(e)})}else e._.each(this.values.getAll(),function(e){i.valueHierarchy[e.value]&&(i.valueHierarchy[e.value].facetValue=e)})},n.prototype.setInHierarchy=function(t){var i=this,n=e._.filter(t,function(e){var t=void 0==i.options.levelStart||e.level>=i.options.levelStart,n=void 0==i.options.levelEnd||e.level<i.options.levelEnd;return t&&n});e._.each(n,function(t){var o=e._.map(e._.filter(n,function(e){return e.parent==t.self}),function(e){return{facetValue:e.facetValue,level:e.level,keepOpened:!1,hasChildSelected:!1}}),s=e._.find(n,function(e){return e.self==t.parent});i.valueHierarchy[t.facetValue.value]={childs:o,parent:void 0==s?void 0:{facetValue:s.facetValue,level:s.level,keepOpened:!1,hasChildSelected:!1},facetValue:t.facetValue,level:t.level,keepOpened:!1,hasChildSelected:!1}});var o=this.options.levelStart||0;this.topLevelHierarchy=e._.filter(this.valueHierarchy,function(e){return e.level==o})},n.prototype.getParent=function(e){var t=this.getLookupOrValue(e).lastIndexOf(this.options.delimitingCharacter);return-1!=t?this.getLookupOrValue(e).substring(0,t):void 0},n.prototype.getSelf=function(e){var t=this.getParent(e);if(void 0==t)return this.getLookupOrValue(e);var i=this.getLookupOrValue(e).indexOf(t);return this.getLookupOrValue(e).substring(i+t.length+1)},n.prototype.showFacetValue=function(e){this.facetValuesList.get(e.facetValue).listElement.removeClass("coveo-inactive")},n.prototype.hideFacetValue=function(e){this.facetValuesList.get(e.facetValue).listElement.addClass("coveo-inactive")},n.prototype.hideChilds=function(t){var i=this;e._.each(t,function(e){i.hideFacetValue(e)})},n.prototype.showChilds=function(t){var i=this;e._.each(t,function(e){i.showFacetValue(e)})},n.prototype.hideParent=function(e){e&&this.hideFacetValue(e)},n.prototype.showParent=function(e){e&&this.showFacetValue(e)},n.prototype.selectChilds=function(t,i){this.flagParentForSelection(t),this.selectMultipleValues(e._.map(i,function(e){return e.facetValue}))},n.prototype.deselectChilds=function(t,i){t.hasChildSelected=!1,this.deselectMultipleValues(e._.map(i,function(e){return e.facetValue}))},n.prototype.excludeChilds=function(t){this.excludeMultipleValues(e._.map(t,function(e){return e.facetValue}))},n.prototype.unexcludeChilds=function(t){this.unexcludeMultipleValues(e._.map(t,function(e){return e.facetValue}))},n.prototype.selectParent=function(e){void 0!=e&&(this.selectValue(e.facetValue),e.parent&&this.selectParent(this.valueHierarchy[e.parent.facetValue.value]))},n.prototype.deselectParent=function(e){void 0!=e&&this.deselectValue(e.facetValue)},n.prototype.flagParentForSelection=function(e){for(var t=e.parent;t;){var i=this.valueHierarchy[t.facetValue.value];i.hasChildSelected=!0,t=i.parent}},n.prototype.unflagParentForSelection=function(t){for(var i=this,n=t.parent;n;){var o=this.valueHierarchy[n.facetValue.value],s=e._.filter(o.childs,function(e){var n=i.valueHierarchy[e.facetValue.value];return n.facetValue.value!=t.facetValue.value&&(n.facetValue.selected||n.facetValue.excluded||n.hasChildSelected)});0==s.length&&(o.hasChildSelected=!1),n=o.parent}},n.prototype.getValueFromHierarchy=function(e){var i=e instanceof t.FacetValue?e.value:e;return this.valueHierarchy[i]},n.prototype.getFacetValueFromHierarchy=function(e){return this.getValueFromHierarchy(e).facetValue},n.prototype.getLookupOrValue=function(e){return e.lookupValue||e.value},n.ID="HierarchicalFacet",n.options={delimitingCharacter:t.ComponentOptions.buildStringOption({defaultValue:"|"}),levelStart:t.ComponentOptions.buildNumberOption({defaultValue:0}),levelEnd:t.ComponentOptions.buildNumberOption(),marginByLevel:t.ComponentOptions.buildNumberOption({defaultValue:10})},n}(t.Facet);t.HierarchicalFacet=i,t.CoveoJQuery.registerAutoCreateComponent(i)}(t=e.Ui||(e.Ui={}))}(Coveo||(Coveo={}));var Coveo;!function(e){var t;!function(t){var i=function(){function t(){this.logger=new e.Logger(this)}return t.prototype.instantiateToString=function(t){e.Assert.exists(t);var i=this.instantiateToElement(t);return e.$(i).html()},t.prototype.instantiateToElement=function(t){e.Assert.exists(t);var i=e.$("<div></div>"),n=e.$('<div class="coveo-header"></div>').appendTo(i);e.$('<a class="coveo-title"></a>').text(t.title).attr("href",t.clickUri).appendTo(n);var o=i.get(0);return this.logger.trace("Instantiated default result template",o),o},t}();t.DefaultResultTemplate=i}(t=e.Ui||(e.Ui={}))}(Coveo||(Coveo={}));var Coveo;!function(e){var t=function(){function t(){}return t.buildAttributeString=function(t){var i=[];return e._.each(t,function(e,t){void 0!=e&&i.push(t+"="+JSON.stringify(e.toString()))}),i.join(" ")},t}();e.HTMLUtils=t;var i=function(){function e(){}return e.buildAnchor=function(e,i){var n;return i&&i.text?(n=i.text,i.text=void 0):n=e,"<a href='"+e+"'"+t.buildAttributeString(i)+">"+n+"</a>"},e}();e.AnchorUtils=i;var n=function(){function i(){}return i.buildImage=function(e,i){var n="<img ";return n+=e?"src='"+e+"' ":"",n+=t.buildAttributeString(i)+"/>"},i.selectImageFromResult=function(t){return e.$("img[data-coveo-sys-uri-hash='"+t.raw.sysurihash+"']")},i.buildImageWithDirectSrcAttribute=function(e,t){var n=new Image,o=e.getViewAsDatastreamUri(t.uniqueId,"$Thumbnail$",{contentType:"image/png"});n.onload=function(){i.selectImageFromResult(t).attr("src",o)},n.src=o},i.buildImageWithBase64SrcAttribute=function(e,t){e.getRawDataStream(t.uniqueId,"$Thumbnail$").done(function(e){var n=String.fromCharCode.apply(null,new Uint8Array(e));i.selectImageFromResult(t).attr("src","data:image/png;base64, "+btoa(n))}).fail(function(){i.selectImageFromResult(t).remove()})},i.buildImageFromResult=function(t,n,o){var o=o?o:{},s=i.buildImage(void 0,e.$.extend(o,{"data-coveo-sys-uri-hash":t.raw.sysurihash}));return n.isJsonp()||e.DeviceUtils.isIE8or9()?i.buildImageWithDirectSrcAttribute(n,t):i.buildImageWithBase64SrcAttribute(n,t),s},i}();e.ImageUtils=n}(Coveo||(Coveo={}));var Coveo;!function(e){var t=function(){function t(){}return t.splitSemicolonSeparatedListOfEmailAddresses=function(t){var i=t.split(/\s*;\s*/);return e._.filter(i,function(t){return e.Utils.exists(t)&&e.Utils.isNonEmptyString(e.Utils.trim(t))})},t.emailAddressesToHyperlinks=function(i,n,o,s,r){void 0===s&&(s=2),void 0===r&&(r=!1),i=e._.filter(i,function(t){return e.Utils.exists(t)&&e.Utils.isNonEmptyString(e.Utils.trim(t))});var a=e._.map(i,function(i){var s=t.parseEmail(i),a=s[1],l=s[0];if(e.Utils.exists(o)&&a==o&&(l=e.Ui.l("Me")),r){var u=l.split(" ");e.Utils.isNullOrUndefined(u[1])||(l=u[0]+" "+u[1].substring(0,1)+".")}var c=a.indexOf("@")>=0?a.indexOf("@")+1:0,p=a.substr(c);return e.Utils.exists(n)&&p!=n&&(l+=" ("+p+")"),'<a title="'+i+'" href="mailto:'+a+'">'+l+"</a>"}),l=a.length-s,u=l>0?t.buildEmailAddressesAndOthers(e._.last(a,l)):"";return e._.first(a,s).join(", ")+u},t.buildEmailAddressesAndOthers=function(t){return"<span class='coveo-emails-excess-collapsed coveo-active' onclick='Coveo.Ui.TemplateHelpers.getHelper(\"excessEmailToggle\")(this);'> "+e.Ui.l("AndOthers",t.length.toString(),t.length)+"</span><span class='coveo-emails-excess-expanded'> , "+t.join(" , ")+"</span>"},t.parseEmail=function(e){var e,t,i=e.match(/^\s*(.*)\s+<(.*)>$/);return null!=i?(t=i[1],/^".*"|'.*'$/.test(t)&&(t=t.substr(1,t.length-2)),e=i[2]):(t=e,e=e),[t,e]},t}();e.EmailUtils=t}(Coveo||(Coveo={}));var Coveo;!function(e){var t=function(e){function t(){e.apply(this,arguments),this.decimals=0}return __extends(t,e),t}(e.Options),i=function(){function i(){}return i.currencyToString=function(i,n){if(e.Utils.isNullOrUndefined(i))return"";e.Assert.isNumber(i),n=(new t).merge(n);var o=Globalize.culture().numberFormat.currency,s=o.symbol;e.Utils.isNonEmptyString(n.symbol)&&(o.symbol=n.symbol);var r=Globalize.format(i,"c"+n.decimals.toString());return o.symbol=s,r},i}();e.CurrencyUtils=i}(Coveo||(Coveo={}));var Coveo;!function(e){function t(t,i){return e._.isEmpty(i)?t:s({value:t,search:i.toLowerCase()})}var i=function(){function e(e,t,i){this.begin=e,this.size=t,this.replacementSize=i}return e}();e.Hole=i;var n=function(){function t(){}return t.replace=function(n,o,s){var r=new t;if(e.Utils.isNullOrEmptyString(n))return r;var a=n.lastIndexOf(o);if(-1==a)return r.value=n,r;for(var l=[];a>=0;){var u=new i(a,o.length,s.length);l.push(u),n=n.slice(0,a)+s+n.slice(a+o.length),a=n.lastIndexOf(o)}return r.holes=l,r.value=n,r},t.shortenPath=function(n,o){var s=n,r=new t;if(e.Utils.isNullOrEmptyString(s)||s.length<=o)return r.value=s,r;var a=[],l=-1;if(l=e.Utils.stringStartsWith(s,"\\\\")?s.indexOf("\\",l+2):s.indexOf("\\"),-1!=l){for(var u=0,c=s.indexOf("\\",l+1);-1!=c&&s.length-u+t.SHORTEN_END.length>o;)u=c-l-1,c=s.indexOf("\\",c+1);if(u>0){s=s.slice(0,l+1)+t.SHORTEN_END+s.slice(u);var p=new i(l+1,u-t.SHORTEN_END.length,t.SHORTEN_END.length);a.push(p)}}if(s.length>o){var d=s.length-o+t.SHORTEN_END.length,h=s.length-d;s=s.slice(0,h)+t.SHORTEN_END;var p=new i(h,d,t.SHORTEN_END.length);a.push(p)}return r.holes=a,r.value=s,r},t.shortenString=function(n,o,s){var r=n;s=e.Utils.toNotNullString(s);var a=new t;if(e.Utils.isNullOrEmptyString(r)||o<=s.length)return a.value=r,a;if(r.length<=o)return a.value=r,a;var l=r;if(o-=s.length,l=l.slice(0,o)," "!=r.charAt(l.length)){var u=l.lastIndexOf(" ");-1!=u&&l.length-u<t.WORD_SHORTER&&(l=l.slice(0,u))}var c=[];return c[0]=new i(l.length,r.length-l.length,s.length),l+=s,a.value=l,a.holes=c,a},t.shortenUri=function(n,o){var s=new t;if(e.Utils.isNullOrEmptyString(n)||n.length<=o)return s.value=n,s;var r=[],a=n.indexOf("//");if(-1!=a&&(a=n.indexOf("/",a+2)),-1!=a){for(var l=0,u=n.indexOf("/",a+1);-1!=u&&n.length-l+t.SHORTEN_END.length>o;)l=u-a-1,u=n.indexOf("/",u+1);if(l>0){n=n.slice(0,a+1)+t.SHORTEN_END+n.slice(a+1+l);var c=new i(a+1,l,t.SHORTEN_END.length);r.push(c)}}if(n.length>o){var p=n.length-o+t.SHORTEN_END.length,d=n.length-p;n=n.slice(0,d)+t.SHORTEN_END;var c=new i(d,p,t.SHORTEN_END.length);r.push(c)}return s.holes=r,s.value=n,s},t.SHORTEN_END="...",t.WORD_SHORTER=10,t}();e.StringAndHoles=n;var o=function(){function t(){}return t.highlightString=function(e,i,n,o){return t.buildHighlightedString(e,i,n,o)},t.buildHighlightedString=function(t,i,n,o){if(e.Assert.isNotUndefined(i),e.Assert.isNotNull(i),e.Assert.isNonEmptyString(o),e.Utils.isNullOrEmptyString(t))return t;for(var s=0,r=t.length,a="",l=0;l<i.length;l++){var u=i[l],c=u.offset,p=c+u.length;if(null!=n){for(var d=!1,h=0;h<n.length;h++){var f=n[h],m=f.begin,v=m+f.size;if(m>c&&p>=m&&v>p)p=m;else{if(c>=m&&v>p){d=!0;break}if(c>=m&&v>c&&p>=v)c=m+f.replacementSize,p-=f.size-f.replacementSize;else if(m>c&&p>=v)p-=f.size-f.replacementSize;else if(c>=v){var g=f.size-f.replacementSize;c-=g,p-=g}}}if(d||c==p)continue}if(p>r)break;a+=e._.escape(t.slice(s,c)),a+="<span class='"+o+"'",u.dataHighlightGroup&&(a+=" data-highlight-group='"+u.dataHighlightGroup.toString()+"'"),u.dataHighlightGroupTerm&&(a+=" data-highlight-group-term='"+u.dataHighlightGroupTerm+"'"),a+=" >",a+=e._.escape(t.slice(c,p)),a+="</span>",s=p}return s!=r&&(a+=e._.escape(t.slice(s))),a},t}();e.HighlightUtils=o;var s=e._.template('<% var i = 0; var lowercaseValue = value.toLowerCase(); while(i < value.length) { %><% var index = lowercaseValue.indexOf(search, i); if(index != -1) { %><% if(i != index){ %> <span><%- value.substr(i, index) %></span><% } %><span class="coveo-hightlight"><%- value.substr(index, search.length) %></span><% i = index + search.length %></span><% } else { %><span><%- value.substr(i) %></span><% i = value.length; %><% } %><% } %>');e.highlightString=t}(Coveo||(Coveo={}));var Coveo;!function(e){function t(t,i,o,r){var l=(new u).merge(r),c=a(t);return c.find("*").each(function(t,r){var a=e.$(r).text(),u=s(o),c=e._.extend(i||{},u||{});e.$(r).html(e.HighlightUtils.highlightString(a,n(a,c,l),[],l.cssClass))}),c.html()}function i(t,i,o,r){var a=(new u).merge(r),l=s(o),c=e._.extend(i||{},l||{});return e.HighlightUtils.highlightString(t,n(t,c,a),[],a.cssClass)
}function n(t,i,n){var o=[],s=e._.keys(i).sort(r);return e._.each(s,function(s){var a=!1,u=e._.compact([s].concat(i[s]).sort(r));e._.each(u,function(i){var r=e.StringUtils.getHighlights(t,l(i,n),s);void 0!=r&&e.Utils.isNonEmptyArray(r)&&(a=!0,o.push(r))})}),e._.chain(o).flatten().compact().uniq(function(e){return e.offset}).sortBy(function(e){return e.offset}).map(function(t){var n=e._.keys(i),o=e._.indexOf(n,t.dataHighlightGroupTerm)+1;return e._.extend(t,{dataHighlightGroup:o})}).value()}function o(t,i){var n=[];if(i==t.length-1)e._.each(t[i],function(e){n.push(e)});else{var s=o(t,i+1);e._.each(t[i],function(t){e._.each(s,function(e){n.push(t+" "+e)})})}return n}function s(t){return e._.chain(t).map(function(t){var i=e._.map(t,function(e,t){return[t].concat(e)});return e.Utils.isNonEmptyArray(i)?o(i,0):[]}).flatten().object([]).value()}function r(e,t){return e.length-t.length}function a(t){var i=e.$("<div />");return i.get(0).innerHTML=t,i}function l(e,t){var i=e.split(" ").join("\\W+");return new RegExp("([^a-zA-Z]|^)("+i+"(?![a-zA-Z]))",t.regexFlags)}var u=function(e){function t(t,i,n){void 0===t&&(t="coveo-highlight"),void 0===i&&(i=0),void 0===n&&(n="gi"),e.call(this),this.cssClass=t,this.shorten=i,this.regexFlags=n}return __extends(t,e),t}(e.Options);e.highlightStreamHTML=t,e.highlightStreamText=i}(Coveo||(Coveo={}));var Coveo;!function(e){var t;!function(t){function i(){for(var e=arguments.callee.caller,t=e.arguments[0],i=0;void 0!=e&&(void 0==t||void 0==t.uri)&&100>i;)t=e.arguments[0],e=e.caller,i++;return t}t.TemplateHelpers.registerTemplateHelper("javascriptEncode",function(t){return e.Utils.exists(t)?e.StringUtils.javascriptEncode(t):void 0}),t.TemplateHelpers.registerTemplateHelper("shorten",function(t,i,n,o){var s=e.StringAndHoles.shortenString(t,i,"...");return e.Utils.exists(n)?e.HighlightUtils.highlightString(s.value,n,s.holes,o||"highlight"):s.value}),t.TemplateHelpers.registerTemplateHelper("shortenPath",function(t,i,n,o){var s=e.StringAndHoles.shortenPath(t,i);return e.Utils.exists(n)?e.HighlightUtils.highlightString(s.value,n,s.holes,o||"highlight"):s.value}),t.TemplateHelpers.registerTemplateHelper("shortenUri",function(t,i,n,o){var s=e.StringAndHoles.shortenUri(t,i);return e.Utils.exists(n)?e.HighlightUtils.highlightString(s.value,n,s.holes,o||"highlight"):s.value}),t.TemplateHelpers.registerTemplateHelper("highlight",function(t,i,n){return e.Utils.exists(t)?e.Utils.exists(i)?e.HighlightUtils.highlightString(t,i,null,n||"highlight"):t:void 0}),t.TemplateHelpers.registerTemplateHelper("highlightStreamText",function(t,n,o,s){return void 0===n&&(n=i().termsToHighlight),void 0===o&&(o=i().phrasesToHighlight),e.Utils.exists(t)?e.Utils.isNonEmptyArray(e._.keys(n))||e.Utils.isNonEmptyArray(e._.keys(o))?e.highlightStreamText(t,n,o,s):t:void 0}),t.TemplateHelpers.registerTemplateHelper("highlightStreamHTML",function(t,n,o,s){return void 0===n&&(n=i().termsToHighlight),void 0===o&&(o=i().phrasesToHighlight),e.Utils.exists(t)?e.Utils.isNonEmptyArray(n)?e.highlightStreamHTML(t,n,o,s):t:void 0}),t.TemplateHelpers.registerTemplateHelper("number",function(t,i){return e.Utils.exists(t)?e._.isString(i)?e.StringUtils.htmlEncode(Globalize.format(t,i)):e.StringUtils.htmlEncode(t.toString()):void 0}),t.TemplateHelpers.registerTemplateHelper("date",function(t,i){return e.DateUtils.dateToString(e.DateUtils.convertFromJsonDateIfNeeded(t),i)}),t.TemplateHelpers.registerTemplateHelper("time",function(t,i){return e.DateUtils.timeToString(e.DateUtils.convertFromJsonDateIfNeeded(t),i)}),t.TemplateHelpers.registerTemplateHelper("dateTime",function(t,i){return e.DateUtils.dateTimeToString(e.DateUtils.convertFromJsonDateIfNeeded(t),i)}),t.TemplateHelpers.registerTemplateHelper("emailDateTime",function(t,i){var n={};n.includeTimeIfThisWeek=!0;var o=e.$.extend({},n,i);return t?e.DateUtils.dateTimeToString(e.DateUtils.convertFromJsonDateIfNeeded(t),o):void 0}),t.TemplateHelpers.registerTemplateHelper("currency",function(t,i){return e.CurrencyUtils.currencyToString(t,i)}),t.TemplateHelpers.registerTemplateHelper("email",function(t,i,n,o,s){if(void 0===o&&(o=2),void 0===s&&(s=!1),e._.isString(t)){var r=e.EmailUtils.splitSemicolonSeparatedListOfEmailAddresses(t);return e.EmailUtils.emailAddressesToHyperlinks(r,i,n,o,s)}return e._.isArray(t)?e.EmailUtils.emailAddressesToHyperlinks(t,i,n,o,s):void 0}),t.TemplateHelpers.registerTemplateHelper("excessEmailToggle",function(t){return e.$(t).removeClass("coveo-active"),e.$(t).hasClass("coveo-emails-excess-collapsed")?e.$(t).siblings(".coveo-emails-excess-expanded").addClass("coveo-active"):e.$(t).hasClass("coveo-hide-expanded")&&(e.$(t).parent().addClass("coveo-inactive"),e.$(t).parent().siblings(".coveo-emails-excess-collapsed").addClass("coveo-active")),void 0}),t.TemplateHelpers.registerTemplateHelper("anchor",function(t,i){return e.AnchorUtils.buildAnchor(t,i)}),t.TemplateHelpers.registerTemplateHelper("image",function(t,i){return e.ImageUtils.buildImage(t,i)}),t.TemplateHelpers.registerTemplateHelper("thumbnail",function(t,n,o){return void 0===t&&(t=i()),void 0===n&&(n="default"),e.QueryUtils.hasThumbnail(t)?e.ImageUtils.buildImageFromResult(t,e.Rest.SearchEndpoint.endpoints[n],o):void 0}),t.TemplateHelpers.registerTemplateHelper("fromFileTypeToIcon",function(e,n){void 0===e&&(e=i()),void 0===n&&(n={});var o="",s="coveo-icon";if(n.classToUse)s+=" "+n.classToUse;else if(n.fileTypeToUse)s+=" sysfiletype "+n.fileTypeToUse;else{var r=t.FileTypes.get(e);s=r.icon,o=r.caption}return"<span class='"+s+"' title='"+o+"'></span>"}),t.TemplateHelpers.registerTemplateHelper("attrEncode",function(e){return(""+e).replace(/&/g,"&amp;").replace(/'/g,"&apos;").replace(/"/g,"&quot;").replace(/</g,"&lt;").replace(/>/g,"&gt;")}),t.TemplateHelpers.registerTemplateHelper("loadTemplates",function(n,o){void 0===o&&(o=!0);var s,r="",a=i(),l=!1,u=n;return e._.each(n,function(e,t){"default"==e&&(s=t)}),void 0!=s&&(u=e._.omit(n,s)),e._.each(u,function(e,i){l&&o||(l=l||e,r+=t.TemplateHelpers.getHelper("loadTemplate")(i,e,a))}),l||void 0==s||(r+=t.TemplateHelpers.getHelper("loadTemplate")(s,!0,a)),r}),t.TemplateHelpers.registerTemplateHelper("loadTemplate",function(n,o,s){return void 0===o&&(o=!0),e.Utils.isNullOrUndefined(s)&&(s=i()),o?t.TemplateCache.getTemplate(n)(s):""})}(t=e.Ui||(e.Ui={}))}(Coveo||(Coveo={}));var Coveo;!function(e){var t;!function(t){var i=function(i){function n(o,s,r,a){var l=this;void 0===a&&(a=n.ID),i.call(this,o,a,r),this.element=o,this.options=s,this.bindings=r,this.currentlyDisplayedResults=[],this.reachedTheEndOfResults=!1,this.resetList=!0,this.pageChanged=!1,this.options=t.ComponentOptions.initComponentOptions(o,n,s),e.Assert.exists(o),e.Assert.exists(this.options),e.Assert.exists(this.options.resultContainer),e.Assert.exists(this.options.resultTemplate),e.Assert.exists(this.options.waitAnimationContainer),e.Assert.exists(this.options.infiniteScrollContainer),this.showOrHideElementsDependingOnState(!1,!1),e.$(this.root).on(e.Events.QueryEvents.newQuery,e.$.proxy(this.handleNewQuery,this)),e.$(this.root).on(e.Events.QueryEvents.querySuccess,e.$.proxy(this.handleProcessNewQueryResults,this)),e.$(this.root).on(e.Events.QueryEvents.duringQuery,e.$.proxy(this.handleDuringQuery,this)),e.$(this.root).on(e.Events.QueryEvents.queryError,function(){l.hideWaitingAnimation(),e.$(l.options.resultContainer).empty(),l.currentlyDisplayedResults=[]}),this.options.enableInfiniteScroll&&e.$(this.options.infiniteScrollContainer).scroll(function(e){return l.handleScrollOfResultList(e)});var u=this.queryStateModel.getEventName(e.Models.Model.eventTypes.changeOne+e.Models.QueryStateModel.attributesEnum.first);e.$(this.queryStateModel.element).on(u,e.$.proxy(this.handlePageChanged,this))}return __extends(n,i),n.prototype.handlePageChanged=function(){var t=this;e.$(this.root).one(e.Events.QueryEvents.querySuccess,function(){e.$(t.options.infiniteScrollContainer).scrollTop(0)})},n.prototype.handleNewQuery=function(){this.disabled||e.$(this.element).show()},n.prototype.displayMoreResults=function(i){var n=this;return e.Assert.isLargerOrEqualsThan(1,i),e.Assert.check(this.hasPotentiallyMoreResultsToDisplay()),this.isCurrentlyFetchingMoreResults()?(this.logger.warn("Ignoring request to display more results since we're already doing so"),void 0):this.hasPotentiallyMoreResultsToDisplay()?(this.options.showInfiniteScrollWaitingAnimation&&this.showWaitingAnimationForInfiniteScrolling(),this.fetchingMoreResults=this.queryController.fetchMore(i),this.fetchingMoreResults.done(function(o){e.Assert.exists(o),n.usageAnalytics.logCustomEvent(t.AnalyticsActionCauseList.pagerScrolling,{},n.element);var s=o.results;n.reachedTheEndOfResults=i>o.results.length,n._buildResults(o),e._.each(s,function(e){n.currentlyDisplayedResults.push(e)}),e.$(n.element).trigger(e.Events.ResultListEvents.newResultsDisplayed,{})}),this.fetchingMoreResults.always(function(){n.hideWaitingAnimationForInfiniteScrolling(),n.fetchingMoreResults=void 0,e.Defer.defer(function(){return n.handleScrollOfResultList()})}),void 0):(this.logger.warn("Ignoring request to display more results since we know there aren't more to display"),void 0)},n.prototype._triggerNewResultDisplayed=function(t,i){var n={result:t,item:i};e.$(this.element).trigger(e.Events.ResultListEvents.newResultDisplayed,n)},n.prototype._buildResults=function(t){var i=this;e.$.each(t.results,function(t,n){var o=i._instantiateTemplateForResult(n);e.$(o).data("CoveoResult",n),e.$(i.options.resultContainer).append(o),i._autoCreateComponentsInsideResult(o,n),i._triggerNewResultDisplayed(n,o)})},n.prototype._instantiateTemplateForResult=function(i){e.Assert.exists(i);var n=this.options.resultTemplate.instantiateToElement(i);return t.Component.bindResultToElement(n,i),n},n.prototype._autoCreateComponentsInsideResult=function(i,n){e.Assert.exists(i);var o=this.searchInterface.options,s=e.$.extend({},{options:o},this.getBindings(),{result:n});t.CoveoJQuery.automaticallyCreateComponentsInside(i,s)},n.prototype.handleDuringQuery=function(){this.logger.trace("Emptying the result container"),this.currentlyDisplayedResults=[],this.cancelFetchingMoreResultsIfNeeded(),this.showWaitingAnimation(),this.showOrHideElementsDependingOnState(!1,!1)},n.prototype.handleProcessNewQueryResults=function(t,i){if(e.Assert.exists(i),e.Assert.exists(i.results),e.$(this.element).fastToggle(!this.disabled),!this.disabled){var n=i.results;this.logger.trace("Received query results from new query",n),this.hideWaitingAnimation(),this.options.resultContainer.innerHTML="",this.currentlyDisplayedResults=[],this._buildResults(n),this.currentlyDisplayedResults=n.results,this.reachedTheEndOfResults=!1,this.showOrHideElementsDependingOnState(!0,0!=this.currentlyDisplayedResults.length),this.options.enableInfiniteScroll&&n.results.length==i.queryBuilder.numberOfResults&&this.handleScrollOfResultList(),e.DeviceUtils.isMobileDevice()&&void 0!=this.options.mobileScrollContainer&&(this.options.mobileScrollContainer.scrollTop=0),e.$(this.element).trigger(e.Events.ResultListEvents.newResultsDisplayed,{})}},n.prototype.reset=function(){this.hideWaitingAnimation(),e.$(this.options.resultContainer).empty(),this.currentlyDisplayedResults=[]},n.prototype.handleScrollOfResultList=function(e){this.isCurrentlyFetchingMoreResults()||this.isScrollingOfResultListAlmostAtTheBottom()&&this.hasPotentiallyMoreResultsToDisplay()&&this.displayMoreResults(this.options.infiniteScrollPageSize,null!=e)},n.prototype.isCurrentlyFetchingMoreResults=function(){return e.Utils.exists(this.fetchingMoreResults)},n.prototype.isScrollingOfResultListAlmostAtTheBottom=function(){var t;try{t=e.$(this.options.infiniteScrollContainer).get(0)instanceof Window}catch(i){t=!1}return t?this.isScrollAtBottomForWindowElement():this.isScrollAtBottomForHtmlElement()},n.prototype.isScrollAtBottomForWindowElement=function(){var t=e.$(window).height(),i=e.$(window).scrollTop(),n=e.$(document).height();return t/2>n-(t+i)},n.prototype.isScrollAtBottomForHtmlElement=function(){var t=e.$(this.options.infiniteScrollContainer).innerHeight(),i=e.$(this.options.infiniteScrollContainer).get(0).scrollHeight,n=e.$(this.options.infiniteScrollContainer).scrollTop()+t;return t/2>i-n},n.prototype.hasPotentiallyMoreResultsToDisplay=function(){return this.currentlyDisplayedResults.length>0&&!this.reachedTheEndOfResults},n.prototype.cancelFetchingMoreResultsIfNeeded=function(){this.isCurrentlyFetchingMoreResults()&&(this.logger.trace("Cancelling fetching more results"),this.fetchingMoreResults.reject(),this.fetchingMoreResults=void 0)},n.prototype.showOrHideElementsDependingOnState=function(t,i){e.$(this.element).find(".coveo-show-if-query").fastToggle(t),e.$(this.element).find(".coveo-show-if-no-query").fastToggle(!t),e.$(this.element).find(".coveo-show-if-results").fastToggle(t&&i),e.$(this.element).find(".coveo-show-if-no-results").fastToggle(t&&!i)},n.prototype.showWaitingAnimation=function(){switch(this.options.waitAnimation.toLowerCase()){case"fade":e.$(this.options.waitAnimationContainer).addClass("coveo-fade-out");break;case"spinner":e.$(this.options.resultContainer).children().hide(),0==e.$(this.options.waitAnimationContainer).find(".coveo-wait-animation").length&&e.$(this.options.waitAnimationContainer).append('<img src="../image/wait.gif" class="coveo-wait-animation"/>')}},n.prototype.hideWaitingAnimation=function(){switch(this.options.waitAnimation.toLowerCase()){case"fade":e.$(this.options.waitAnimationContainer).removeClass("coveo-fade-out");break;case"spinner":e.$(this.options.waitAnimationContainer).children("img.coveo-wait-animation").detach()}},n.prototype.showWaitingAnimationForInfiniteScrolling=function(){e.$(this.options.waitAnimationContainer).append('<img src="../image/wait.gif" class="coveo-wait-animation"/>')},n.prototype.hideWaitingAnimationForInfiniteScrolling=function(){e.$(this.options.waitAnimationContainer).children("img.coveo-wait-animation").detach()},n.ID="ResultList",n.options={resultContainer:t.ComponentOptions.buildChildHtmlElementOption({defaultFunction:function(t){return e.$("<div/>").appendTo(t).get(0)}}),resultTemplate:t.ComponentOptions.buildTemplateOption({defaultFunction:function(){return new t.DefaultResultTemplate}}),waitAnimation:t.ComponentOptions.buildStringOption({defaultValue:"none"}),waitAnimationContainer:t.ComponentOptions.buildChildHtmlElementOption({postProcessing:function(e,t){return e||t.resultContainer}}),enableInfiniteScroll:t.ComponentOptions.buildBooleanOption({defaultValue:!1}),infiniteScrollPageSize:t.ComponentOptions.buildNumberOption({defaultValue:10}),infiniteScrollContainer:t.ComponentOptions.buildChildHtmlElementOption({defaultFunction:function(t){return e.JQueryUtils.findScrollingParent(t)}}),showInfiniteScrollWaitingAnimation:t.ComponentOptions.buildBooleanOption({defaultValue:!0}),mobileScrollContainer:t.ComponentOptions.buildSelectorOption({defaultFunction:function(){return e.$(".coveo-results-column").get(0)}})},n}(t.Component);t.ResultList=i,t.CoveoJQuery.registerAutoCreateComponent(i)}(t=e.Ui||(e.Ui={}))}(Coveo||(Coveo={}));var Coveo;!function(e){var t;!function(t){var i=function(i){function n(o,s,r,a){void 0===a&&(a=e.Ui.ResultList.ID),i.call(this,o,s,r,n.ID),this.element=o,this.options=s,this.columnResultsArray=[],this.imagesInCurrentRow=[],this.imagesLoaded=0,this.resultIndex=0,this.lastRowHeight=0,this.options=t.ComponentOptions.initComponentOptions(o,n,s),this.lastRowHeight=this.options.heightThreshold,e.$(this.root).on(e.Events.ResultListEvents.newResultsDisplayed,e.$.proxy(this.handleProcessNewResultsDisplayed,this)),this.bindWindowResizeEvent()}return __extends(n,i),n.prototype.getResultsElement=function(){return e.$(this.element).find(".CoveoResult")},n.prototype.getResultsElementImages=function(){return e.$(this.element).find(".CoveoResult img")},n.prototype.getResultsContainerDiv=function(){return e.$(this.element).find("> div")},n.prototype.bindWindowResizeEvent=function(){var t,i=this;e.$(window).on("resize",function(){clearTimeout(t),t=setTimeout(i.retrieveLayoutMethod(),250)})},n.prototype.handleProcessNewResultsDisplayed=function(){this.disabled?e.$(this.element).fadeOut():e.$(this.element).fadeIn(),this.onImageProxy(this.retrieveLayoutMethod())},n.prototype.addTransitionAllToElement=function(t){e._.defer(function(){t.addClass("coveo-transition-all")})},n.prototype.retrieveLayoutMethod=function(){var e=this;if(!this.disabled){if(this.options.layoutType.toLowerCase()==n.columnLayoutTypeStr)return function(){return e.setupColumns()};if(this.options.layoutType.toLowerCase()==n.rowLayoutTypeStr)return function(){return e.setupRows()}}return function(){}},n.prototype.onImageProxy=function(t){var i=(this.getResultsElement().each(function(t,i){0==e.$(i).find("img").length&&e.$(i).detach()}),this.getResultsElementImages()),n=0,o=function(o){e.$(o).height()>0?(null==e.$(o).attr("width")&&null==e.$(o).attr("height")&&(e.$(o).attr("height",e.$(o).height()),e.$(o).attr("width",e.$(o).width())),n++,n==i.length&&t()):(e.$(o).parent().detach(),i=i.not(o),n==i.length&&t())};i.each(function(t,i){this.src&&this.complete||e.$(i).height()>0?o(i):e.$(i).off("load").one("load",function(){o(i)})})},n.prototype.getHorizontalMargin=function(e){return parseInt(e.css("margin-left"))+parseInt(e.css("margin-right"))},n.prototype.getVerticalMargin=function(e){return parseInt(e.css("margin-top"))+parseInt(e.css("margin-bottom"))},n.prototype.setupColumns=function(){var t=this.getResultsContainerDiv().width(),i=this.getResultsElement(),n=this.options.columnWidth,o=this.getHorizontalMargin(i),s=Math.floor(t/(n+o));this.columnResultsArray=[];for(var r=0;s>r;r++)this.columnResultsArray.push(o);this.positionColumns(n,o),e.$(this.element).trigger(e.Events.ImageResultListEvents.imageResultsLayoutComplete,{}),this.options.enableInfiniteScroll&&this.adjustNumberOfResults()},n.prototype.positionColumns=function(t,i){var n=this,o=this.getResultsElement();e._.each(o,function(o){var s=e._.min(n.columnResultsArray),r=e.$.inArray(s,n.columnResultsArray),a=i+r*(t+i);e.$(o).css({left:a+"px",top:s+"px",width:t+"px"}),n.columnResultsArray[r]=s+e.$(o).outerHeight()+i}),this.setResultsContainerHeight(e._.max(this.columnResultsArray)),this.addTransitionAllToElement(o)},n.prototype.setResultsContainerHeight=function(t){e.$(this.element).height(Math.ceil(t)),e.$(this.element).attr("data-height",Math.ceil(t))},n.prototype.setupRows=function(){var t=this.getResultsElement(),i=e.$(this.element).width();this.resultIndex=0;for(var n=0;this.resultIndex<t.length;){this.imagesInCurrentRow=[];var o=this.getCurrentRowHeight(t,i);this.setCurrentRowImagesDimensions(t,o,n),n+=o}this.setResultsContainerHeight(n),e.$(this.element).trigger(e.Events.ImageResultListEvents.imageResultsLayoutComplete,{}),this.addTransitionAllToElement(t),this.options.enableInfiniteScroll&&this.adjustNumberOfResults()},n.prototype.getCurrentRowHeight=function(e,t){for(var i=0,n=null;this.resultIndex<e.length&&(null==n||n>=this.options.heightThreshold);){var o=this.getImageDimensionsFromResult(e.eq(this.resultIndex));null!=o&&(i+=o.width/o.height,n=t/i),this.imagesInCurrentRow.push(this.resultIndex),this.resultIndex++}return n>this.options.heightThreshold&&(n=this.lastRowHeight),this.lastRowHeight=n,n},n.prototype.getImageDimensionsFromResult=function(e){var t=e.find("img"),i=parseInt(t.attr("height")),n=parseInt(t.attr("width"));return{height:i,width:n}},n.prototype.setCurrentRowImagesDimensions=function(t,i,n){var o=this,s=0;e._.each(this.imagesInCurrentRow,function(e){var r=parseInt(t.eq(e).find("img").attr("width")),a=parseInt(t.eq(e).find("img").attr("height")),l=r*i/a,u=o.getHorizontalMargin(t.eq(e)),c=o.getVerticalMargin(t.eq(e));t.eq(e).css({height:Math.round(i-c),width:Math.round(l-u),left:Math.round(s),top:Math.round(n)}),s+=l})},n.prototype.adjustNumberOfResults=function(){var t=Number(e.$(this.element).attr("data-height"));0==e.$.isNumeric(t)&&(t=e.$(this.element).height()),t<e.$(this.options.infiniteScrollContainer).height()&&i.prototype.hasPotentiallyMoreResultsToDisplay.call(this)&&i.prototype.displayMoreResults.call(this,this.options.infiniteScrollPageSize,!1)},n.ID="ImageResultList",n.rowLayoutTypeStr="row",n.columnLayoutTypeStr="column",n.options={layoutType:t.ComponentOptions.buildStringOption({defaultValue:"row",postProcessing:function(e){return e.toLowerCase()}}),heightThreshold:t.ComponentOptions.buildNumberOption({defaultValue:250}),columnWidth:t.ComponentOptions.buildNumberOption({defaultValue:225})},n}(t.ResultList);t.ImageResultList=i,e.Ui.CoveoJQuery.registerAutoCreateComponent(i)}(t=e.Ui||(e.Ui={}))}(Coveo||(Coveo={}));var Coveo;!function(e){var t=function(){function t(){}return t.ajaxBasicAuth=function(i,n,o,s,r,a){e.$.ajax({type:i,timeout:5e3,url:n,beforeSend:function(i){null!=o&&null!=s&&(i.setRequestHeader("Authorization",t.getBasicAuthBase64(o,s)),e.DeviceUtils.isPhonegap()&&i.setRequestHeader("Basic-Auth-Challenge-Client","Phonegap"))}}).fail(function(e){a&&a(e)}).done(function(e){r(e)})},t.getBasicAuthBase64=function(e,t){return"Basic "+btoa(e+":"+t)},t}();e.AjaxUtils=t}(Coveo||(Coveo={}));var Coveo;!function(e){var t;!function(t){var i=function(){function i(i){this.loginPanel=i,this.userInputTemplate=e._.template("<div class='coveo-input-container'>          <span class='coveo-username-icon'></span>          <input class='coveo-username' type='text' placeholder='"+t.l("Username")+"' autocorrect='off' autocapitalize='off' />      </div>"),this.passwordInputTemplate=e._.template("<div class='coveo-input-container'>          <span class='coveo-password-icon'></span>          <input class='coveo-password'  type='password' placeholder='"+t.l("Password")+"' autocorrect='off' autocapitalize='off' />      </div>"),this.containerTemplate=e._.template("<div class='coveo-login-credentials-container'></div>")}return i.prototype.buildDom=function(){var t=this;this.credentialContainer=e.$(this.containerTemplate()),this.loginUser=e.$(this.userInputTemplate()),this.loginUser.keypress(function(e){return t.handleInputKeypress(e)}),this.loginPassword=e.$(this.passwordInputTemplate()),this.loginPassword.keypress(function(e){return t.handleInputKeypress(e)}),this.credentialContainer.append(this.loginUser,this.loginPassword),this.loginPanel.getOrCreateContainer().append(this.credentialContainer),this.loginUser.find("input").val(this.getUser()),this.loginPassword.find("input").val(this.getPassword())},i.prototype.show=function(){this.credentialContainer.show()},i.prototype.getUser=function(){return window.localStorage.getItem(this.getLocalStorageKeyUser())},i.prototype.setUser=function(e){this.loginUser.find("input").val(e),window.localStorage.setItem(this.getLocalStorageKeyUser(),e)},i.prototype.getPassword=function(){return window.localStorage.getItem(this.getLocalStorageKeyPassword())},i.prototype.setPassword=function(e){this.loginPassword.find("input").val(e),window.localStorage.setItem(this.getLocalStorageKeyPassword(),e)},i.prototype.validate=function(){var t=e.$.Deferred();return this.setPassword(this.getPasswordFromInput()),this.setUser(this.getUserFromInput()),t.resolve(!0),t},i.prototype.submit=function(){var t=e.$.Deferred();return this.setPassword(this.getPasswordFromInput()),this.setUser(this.getUserFromInput()),t.resolve(!0),t},i.prototype.getLocalStorageKeyUser=function(){return"coveo-user-"+this.loginPanel.options.id},i.prototype.getLocalStorageKeyPassword=function(){return"coveo-password-"+this.loginPanel.options.id},i.prototype.getPasswordFromInput=function(){return this.loginPassword.find("input").val()},i.prototype.getUserFromInput=function(){return this.loginUser.find("input").val()},i.prototype.handleInputKeypress=function(e){this.loginPanel.isHidden||13!=e.keyCode||this.loginPanel.submit()},i}();t.LoginCredentials=i}(t=e.Ui||(e.Ui={}))}(Coveo||(Coveo={}));var Coveo;!function(e){var t=function(){function t(e,t){this.filename=e,this.flags=t}return t.prototype.done=function(e){return this._success=e,this},t.prototype.fail=function(e){return this._error=e,this},t.prototype.tryAccess=function(){this.tryGetFilesystem()},t.prototype._onGotFileEntry=function(){},t.prototype.tryGetFilesystem=function(){window.requestFileSystem(LocalFileSystem.PERSISTENT,0,e.$.proxy(this._gotFileSystem,this),e.$.proxy(this.onError,this))},t.prototype._gotFileSystem=function(t){t.root.getFile(this.filename,this.flags,e.$.proxy(this._onGotFileEntry,this),e.$.proxy(this.onError,this))},t.prototype.onError=function(e){this._error(e)},t}();e.PhonegapFileAccess=t;var i=function(t){function i(e){t.call(this,e,null)}return __extends(i,t),i.prototype.read=function(){return this.tryAccess(),this},i.prototype._onGotFileEntry=function(e){this.gotFileEntry(e)},i.prototype.gotFileEntry=function(t){t.file(e.$.proxy(this.gotFile,this),e.$.proxy(this._error,this))},i.prototype.gotFile=function(e){var t=this,i=new FileReader;i.onloadend=function(e){t._success&&t._success(e.target.result)},i.readAsText(e)},i}(t);e.PhonegapFileReader=i;var n=function(t){function i(e,i){void 0===i&&(i=!1),t.call(this,e,{create:!0,exclusive:!1}),this.append=i}return __extends(i,t),i.prototype.write=function(e){return this.content=e,this.tryAccess(),this},i.prototype._onGotFileEntry=function(t){t.createWriter(e.$.proxy(this.gotFileWriter,this),e.$.proxy(this._error,this))},i.prototype.gotFileWriter=function(e){var t=this;e.onwriteend=function(e){t._success&&t._success(e)},this.append&&e.seek(e.length),e.write(this.content)},i}(t);e.PhonegapFileWriter=n}(Coveo||(Coveo={}));var Coveo;!function(Coveo){var Ui;!function(Ui){var LoginPageSettings=function(){function LoginPageSettings(e){this.loginPanel=e,this.pageSettingsInputTemplate=Coveo._.template("<div class='coveo-input-container'>          <span class='coveo-page-settings-icon'></span>          <input class='coveo-page-settings' type='text' placeholder='"+Ui.l("PageUrl")+"' autocorrect='off' autocapitalize='off' />    </div>")}return LoginPageSettings.prototype.buildDom=function(){var e=this,t=Coveo.$("<div></div>").addClass("coveo-login-page-settings-container");this.pageSettings=Coveo.$(this.pageSettingsInputTemplate()),this.pageSettings.keypress(function(t){return e.handleInputKeypress(t)}),t.append(this.pageSettings),this.pageSettings.find("input").val(this.getPageSettingsUrl()),this.loginPanel.getOrCreateContainer().append(t)},LoginPageSettings.prototype.getPageSettingsUrl=function(){return window.localStorage.getItem(this.getLocalStorageKeyPageUrl())},LoginPageSettings.prototype.setPageSettingsUrl=function(e){this.pageSettings.find("input").val(e),window.localStorage.setItem(this.getLocalStorageKeyPageUrl(),e)},LoginPageSettings.prototype.submit=function(e){var t=this.pageSettings.find("input").val();this.setPageSettingsUrl(t);var i=Coveo.$.Deferred();return this.tryToWriteFileToDisc(e,i,!0),i},LoginPageSettings.prototype.validate=function(e){var t=Coveo.$.Deferred();return this.getPageSettingsUrl()?this.tryToReadFileFomDisc(e,t,!1):t.reject(),t},LoginPageSettings.prototype.getLocalStorageKeyPageUrl=function(){return"coveo-page-settings-url-"+this.loginPanel.options.id},LoginPageSettings.prototype.handleInputKeypress=function(e){this.loginPanel.isHidden||13!=e.keyCode||this.loginPanel.submit()},LoginPageSettings.prototype.loadFromInterfaceEditorUrl=function(e){var t=document.createElement("a");return t.href=e,"/load"==t.pathname?""!=Coveo.Utils.getQueryStringValue("id",t.search)||-1!=e.indexOf("?id")?e:e+"?id":e+"/load?id"},LoginPageSettings.prototype.tryToWriteFileToDisc=function(e,t,i){var n=this;void 0===i&&(i=!1);var o=this.getPageSettingsUrl();Coveo.AjaxUtils.ajaxBasicAuth("GET",this.loadFromInterfaceEditorUrl(o),this.loginPanel.getUser(),this.loginPanel.getPassword(),function(o){Coveo.DeviceUtils.isPhonegap()?new Coveo.PhonegapFileWriter("SearchPage.html").write(JSON.stringify(o)).done(function(){n.loginPanel.logger.info("Found the page and successfully wrote to disc",n.getPageSettingsUrl()),i&&e.done(function(){n.loginPanel.logger.info("Replacing body content with new search page",n.getPageSettingsUrl()),n.writeDocumentContent(o.body)}),t.resolve()}).fail(function(){n.loginPanel.logger.error("Found the file but unable to write",n.getPageSettingsUrl()),t.reject(Ui.l("ErrorSavingToDevice"))}):(n.loginPanel.logger.info("Found the page",n.getPageSettingsUrl()),i&&n.writeDocumentContent(o.body),t.resolve())},function(){void 0==n.getPageSettingsUrl()||""==n.getPageSettingsUrl()?(n.loginPanel.logger.error("Search page url is empty"),t.reject(Ui.l("PleaseEnterYourSearchPage"))):(n.loginPanel.logger.error("Unable to find the file",n.getPageSettingsUrl()),t.reject(Ui.l("CannotConnectSearchPage")))})},LoginPageSettings.prototype.tryToReadFileFomDisc=function(e,t,i){var n=this;void 0===i&&(i=!1),Coveo.DeviceUtils.isPhonegap()?new Coveo.PhonegapFileReader("SearchPage.html").read().done(function(o){n.loginPanel.logger.info("Found the page on disc",n.getPageSettingsUrl()),i&&e.done(function(){var e=JSON.parse(o).body;n.writeDocumentContent(e)}),n.tryToWriteFileToDisc(Coveo.$.Deferred(),Coveo.$.Deferred(),!1),t.resolve()}).fail(function(){n.getPageSettingsUrl()?(n.loginPanel.logger.info("Unable to find the page on disc",n.getPageSettingsUrl()),n.loginPanel.logger.info("Trying to fetch it with GET request and write to disc"),n.tryToWriteFileToDisc(e,t,!1)):t.reject(Ui.l("ErrorReadingFromDevice"))}):this.tryToWriteFileToDisc(e,t,i)},LoginPageSettings.prototype.writeDocumentContent=function(e){document.body.outerHTML=e,this.appendMissingLoginComponentIfNeeded(),this.configureNewEndpoints(),Ui.TemplateCache.scanAndRegisterTemplates(),this.initNewSearchInterface()},LoginPageSettings.prototype.appendMissingLoginComponentIfNeeded=function(){var e=Coveo.$("."+Ui.Component.computeCssClassNameForType(Ui.Login.ID));if(0==e.length){var t=Coveo.$('<div class="CoveoLogin" data-require-page-settings="true"></div>');this.loginPanel.options.requireLogin?t.attr("data-require-login","true"):t.attr("data-require-login","false"),Coveo.$(".coveo-tab-section").append(t)}else{var i=e.attr("data-require-page-settings");("false"==i||void 0==i)&&e.attr("data-require-page-settings","true")}},LoginPageSettings.prototype.configureNewEndpoints=function(){var scripts=Coveo.$("body").find("script.CoveoEndpoint");Coveo._.each(scripts,function(script){eval(Coveo.$(script).text())})},LoginPageSettings.prototype.initNewSearchInterface=function(){var scripts=Coveo.$("body").find("script.CoveoInit");if(0!=scripts.length)Coveo.InitializeFromPhonegap=!0,Coveo._.each(scripts,function(script){eval(Coveo.$(script).text())});else{var searchInterface=Coveo.$("."+Ui.Component.computeCssClassNameForType(Ui.SearchInterface.ID));0!=searchInterface.length?searchInterface.coveo("init"):Coveo.$("#search").coveo("init")}},LoginPageSettings}();Ui.LoginPageSettings=LoginPageSettings}(Ui=Coveo.Ui||(Coveo.Ui={}))}(Coveo||(Coveo={}));var Coveo;!function(e){var t;!function(t){var i=function(i){function n(o,s,r,a){void 0===a&&(a=n.ID),i.call(this,o,a,r),this.element=o,this.options=s,this.errorMessageTemplate=e._.template("<div class='coveo-login-error-message'></div>"),this.captionTemplate=e._.template("<div class='coveo-login-caption'></div>"),this.tabButtonTemplate=e._.template("<div class='coveo-login-tab'>Login</div>"),this.containerTemplate=e._.template("<div class='coveo-login-form-container'></div>"),this.submitButtonTemplate=e._.template("<button class='coveo-submit'type='submit'><div class='coveo-icon coveo-waiting'></div>"+t.l("GetStarted")+"</button>"),this.combinedTemplate=e._.template("<div class='coveo-login-combined coveo-active'></div>"),this.logoTemplate=e._.template("<div class='coveo-login-logo'></div>"),this.options=t.ComponentOptions.initComponentOptions(o,n,s),e.Assert.exists(this.options.id),e.Assert.exists(e.Rest.SearchEndpoint.endpoints[this.options.id]),this.isHidden=!0,this.options.requireLogin&&(this.credentials=new t.LoginCredentials(this)),this.options.requirePageSettings&&(this.pageSettings=new t.LoginPageSettings(this)),this.loadingAnimation=e.$(this.searchInterface.options.firstLoadingAnimation),this.bind.onRoot(e.Events.QueryEvents.queryError,this.handleQueryError),this.buildTabButton(),this.ensureDom(),this.updateEndpointWithCredentials(),this.resetErrorMessage(),this.hide(),this.validate()
}return __extends(n,i),n.prototype.getPageSettingsUrl=function(){return this.pageSettings?this.pageSettings.getPageSettingsUrl():void 0},n.prototype.setPageSettingsUrl=function(e){this.pageSettings&&this.pageSettings.setPageSettingsUrl(e)},n.prototype.getUser=function(){return this.credentials?this.credentials.getUser():void 0},n.prototype.setUser=function(e){this.credentials&&this.credentials.setUser(e)},n.prototype.getPassword=function(){return this.credentials?this.credentials.getPassword():void 0},n.prototype.setPassword=function(e){this.credentials&&this.credentials.setPassword(e)},n.prototype.setErrorMessage=function(e){this.errorMessage.text(e),this.errorMessage.show(),this.logo.hide()},n.prototype.resetErrorMessage=function(){this.errorMessage.text(""),this.errorMessage.hide(),this.logo.show()},n.prototype.createDom=function(){var t=this;this.logo=e.$(this.logoTemplate()),this.getOrCreateCombined().append(this.logo),this.caption=e.$(this.captionTemplate()),this.options.caption&&this.caption.text(this.options.caption),this.errorMessage=e.$(this.errorMessageTemplate()),this.getOrCreateCombined().append(this.errorMessage),this.getOrCreateContainer().append(this.caption),this.credentials&&this.credentials.buildDom(),this.pageSettings&&this.pageSettings.buildDom(),this.submitButton=e.$(this.submitButtonTemplate()),this.submitButton.fastClick(function(){return t.submit()}),this.getOrCreateContainer().append(this.submitButton)},n.prototype.getOrCreateContainer=function(){return this.container||(this.container=e.$(this.containerTemplate()),this.getOrCreateCombined().append(this.container)),this.container},n.prototype.getOrCreateCombined=function(){return this.combined||(this.combined=e.$(this.combinedTemplate()),e.$(this.root).append(this.combined)),this.combined},n.prototype.hide=function(){this.isHidden=!0,this.getOrCreateCombined().hide()},n.prototype.hideAndExecuteQuery=function(){this.hide(),this.queryController.executeQuery()},n.prototype.validate=function(){this.baseValidationEvent("validate",this.hide)},n.prototype.submit=function(){var e=this,t=function(){e.credentials&&e.updateEndpointWithCredentials(),e.pageSettings||e.hideAndExecuteQuery()};this.baseValidationEvent("submit",t)},n.prototype.isAccessDeniedError=function(e){return 401===e.status||403===e.status},n.prototype.baseValidationEvent=function(t,i){var n=this;e.MobileUtils.hideIOSKeyboard(document.activeElement),this.resetErrorMessage();var o=[],s=e.$.Deferred();this.credentials&&o.push(this.credentials[t](s)),this.pageSettings&&o.push(this.pageSettings[t](s)),e.$.when.apply(this,o).fail(function(t){n.show(),s.reject(!1),n.pageSettings&&e.Utils.isNonEmptyString(n.getPageSettingsUrl())&&n.setErrorMessage(t),n.credentials&&(e.Utils.isNonEmptyString(n.getPassword())||e.Utils.isNonEmptyString(n.getUser()))&&n.setErrorMessage(t)}).always(function(){n.submitButton.removeClass("coveo-waiting")}).done(function(){s.resolve(!0),e.$.proxy(i,n)})},n.prototype.show=function(){this.isHidden=!1,this.ensureDom(),e.MobileUtils.removeToggleClassOnSearchInterface(),this.getOrCreateCombined().show(),e.DeviceUtils.isPhonegap()&&e.$(document).on("backbutton",e.$.proxy(this.handleBackButton,this))},n.prototype.handleBackButton=function(){this.hide(),e.$(document).off("backbutton")},n.prototype.handleQueryError=function(e,i){this.isAccessDeniedError(i.error)&&(this.setErrorMessage(t.l("BadUserPass")),this.show())},n.prototype.updateEndpointWithCredentials=function(){this.credentials&&void 0!=e.Rest.SearchEndpoint.endpoints[this.options.id]&&(e.Rest.SearchEndpoint.endpoints[this.options.id].options.password=this.getPassword(),e.Rest.SearchEndpoint.endpoints[this.options.id].options.username=this.getUser())},n.prototype.buildTabButton=function(){var t=this;e.$(this.element).append(e.$(this.tabButtonTemplate())),e.$(this.element).fastClick(function(){t.show()})},n.ID="Login",n.options={id:t.ComponentOptions.buildStringOption({defaultValue:"default"}),caption:t.ComponentOptions.buildLocalizedStringOption(),autoTriggerQuery:t.ComponentOptions.buildBooleanOption({defaultValue:!0}),requireLogin:t.ComponentOptions.buildBooleanOption({defaultValue:!0}),requirePageSettings:t.ComponentOptions.buildBooleanOption({defaultValue:!1})},n}(t.Component);t.Login=i,t.CoveoJQuery.registerAutoCreateComponent(i)}(t=e.Ui||(e.Ui={}))}(Coveo||(Coveo={}));var Coveo;!function(e){var t;!function(t){var i=function(i){function n(o,s,r){var a=this;i.call(this,o,n.ID,r),this.element=o,this.options=s,this.options=t.ComponentOptions.initComponentOptions(o,n,s),t.Component.pointElementsToDummyForm(e.$(o)),e.$(o).change(function(e){a._handleChange(e)}),e.$(o).keyup(function(e){a._handleKeyUp(e)});var l=e.Models;e.$(this.root).on(e.Events.QueryEvents.buildingQuery,e.$.proxy(this.handleBuildingQuery,this)),e.$(this.root).on(e.Events.QueryEvents.newQuery,e.$.proxy(this._handleNewQuery,this));var u=this.queryStateModel.getEventName(l.Model.eventTypes.changeOne+l.QueryStateModel.attributesEnum.q);e.$(this.queryStateModel.element).on(u,e.$.proxy(this._handleQueryStateChanged,this)),this._clearElement=e.$("<span></span>").addClass("coveo-query-box-clear").hide();e.$("<span></span>").addClass("coveo-icon").appendTo(this._clearElement);if(this._clearElement.fastClick(function(){a.clear(),a._hideClearElement(),a.updateQueryState(),e.DeviceUtils.isMobileDevice()||e.$(a.element).focus(),a.queryController.isStandaloneSearchBox()||a.queryController.deferExecuteQuery({beforeExecuteQuery:function(){return a.usageAnalytics.logSearchEvent(t.AnalyticsActionCauseList.searchboxClear,{})}})}),e.DeviceUtils.isSmallScreenWidth()&&e.$(this.element).focus(function(){e.MobileUtils.removeToggleClassOnSearchInterface()}),e.$(this.element).after(this._clearElement),this.options.autoFocus)try{e.$(this.element).focus()}catch(c){}}return __extends(n,i),n.prototype.clear=function(){e.$(this.element).val(""),this.updateQueryState()},n.prototype.replace=function(t,i){e.$(this.element).val(e.$(this.element).val().replace(t,i)),this.updateQueryState()},n.prototype.replaceCurrentExpression=function(e){this.replace(this.getCurrentQueryExpression(),e),this.updateQueryState()},n.prototype.clearCurrentExpression=function(){this.replace(this.getCurrentQueryExpression(),""),this.updateQueryState()},n.prototype.getCurrentQueryExpression=function(){var t=e.$(this.element).getCursorPosition(),i=e.$(this.element).val(),n=i.length,o=t,s=t;for(" "==i[o]&&o--;o>0&&" "!=i[o];)o--;for(;n>s&&" "!=i[s];)s++;return i.substring(o,s)},n.prototype.insertAt=function(t,i){var n=e.$(this.element).val(),o=[n.slice(0,t),i,n.slice(t)].join("");e.$(this.element).val(o),this.updateQueryState()},n.prototype._handleChange=function(){return this._addClearElement(),this.updateQueryState(),void 0},n.prototype._handleQueryStateChanged=function(t,i){e.Assert.exists(i);var n=i.value;e.$(this.element).val(n),this._addClearElement()},n.prototype._handleKeyUp=function(t){e.Assert.exists(t),this._addClearElement(),13==t.which?(this.logger.debug("Performing query because user pressed Enter"),this.updateQueryState(),this.enterOnSearchBox(),t.stopPropagation(),e.DeviceUtils.isMobileDevice()&&e.$(this.element).blur()):this.options.enableSearchAsYouType&&e.KeyboardUtils.isAllowedKeyForSearchAsYouType(t)&&this.startNewSearchAsYouTypeTimeout()},n.prototype._addClearElement=function(){""==e.$(this.element).val()?this._hideClearElement():this._showClearElement()},n.prototype._hideClearElement=function(){this._clearElement.hide()},n.prototype._showClearElement=function(){this._clearElement.show()},n.prototype.startNewSearchAsYouTypeTimeout=function(){var e=this;this.cancelAnyPendingSearchAsYouTypeTimeout(),this.searchAsYouTypeTimeout=setTimeout(function(){e.triggerNewQuery(function(){return e.usageAnalytics.logSearchAsYouType(t.AnalyticsActionCauseList.searchboxAsYouType,{})},!0)},this.options.searchAsYouTypeDelay)},n.prototype._handleNewQuery=function(){n.queryBoxIsAlreadyAddedToQuery=!1},n.prototype.handleBuildingQuery=function(t,i){e.Assert.exists(i),e.Assert.exists(i.queryBuilder);var o=e.$(this.element).val();this.options.enableWildcards&&(i.queryBuilder.enableWildcards=!0),this.options.enableQuestionMarks&&(i.queryBuilder.enableQuestionMarks=!0),this.options.enableLowercaseOperators&&(i.queryBuilder.enableLowercaseOperators=!0),this.options.enablePartialMatch&&(i.queryBuilder.enablePartialMatch=!0,i.queryBuilder.partialMatchKeywords=this.options.partialMatchKeywords,i.queryBuilder.partialMatchThreshold=this.options.partialMatchThreshold),e.Utils.isNonEmptyString(o)&&!n.queryBoxIsAlreadyAddedToQuery&&(this.options.disableQuerySyntax?i.queryBuilder.expression.add("<@- "+o+" -@>"):i.queryBuilder.expression.add(o),this.logger.trace("Adding query to QueryBuilder",o),n.queryBoxIsAlreadyAddedToQuery=!0)},n.prototype.enterOnSearchBox=function(){var i=this;e.$(this.element).trigger(e.Events.UserActionEvents.enterOnSearchBox),this.triggerNewQuery(function(){return i.usageAnalytics.logSearchEvent(t.AnalyticsActionCauseList.searchboxSubmit,{})},!1)},n.prototype.triggerNewQuery=function(e,t){this.cancelAnyPendingSearchAsYouTypeTimeout(),this.queryController.deferExecuteQuery({beforeExecuteQuery:e,searchAsYouType:t})},n.prototype.updateQueryState=function(){var t=e.$(this.element).val();this.queryStateModel.set(e.Models.QueryStateModel.attributesEnum.q,t)},n.prototype.cancelAnyPendingSearchAsYouTypeTimeout=function(){e.Utils.exists(this.searchAsYouTypeTimeout)&&(clearTimeout(this.searchAsYouTypeTimeout),this.searchAsYouTypeTimeout=void 0)},n.ID="QueryBox",n.options={enableSearchAsYouType:t.ComponentOptions.buildBooleanOption({defaultValue:!1}),searchAsYouTypeDelay:t.ComponentOptions.buildNumberOption({defaultValue:500}),disableQuerySyntax:t.ComponentOptions.buildBooleanOption({defaultValue:!1}),enableWildcards:t.ComponentOptions.buildBooleanOption({defaultValue:!1}),enableQuestionMarks:t.ComponentOptions.buildBooleanOption({defaultValue:!1}),enableLowercaseOperators:t.ComponentOptions.buildBooleanOption({defaultValue:!1}),enablePartialMatch:t.ComponentOptions.buildBooleanOption({defaultValue:!1}),partialMatchKeywords:t.ComponentOptions.buildNumberOption({defaultValue:5}),partialMatchThreshold:t.ComponentOptions.buildStringOption({defaultValue:"50%"}),autoFocus:t.ComponentOptions.buildBooleanOption({defaultValue:!0})},n.queryBoxIsAlreadyAddedToQuery=!1,n}(e.Ui.Component);t.QueryBox=i,e.Ui.CoveoJQuery.registerAutoCreateComponent(i)}(t=e.Ui||(e.Ui={}))}(Coveo||(Coveo={}));var Coveo;!function(e){var t;!function(t){var i=function(i){function n(o,s,r){i.call(this,o,n.ID,r),this.element=o,this.options=s,this.bind.fastClick(e.$(o),this.handleClick),""==e.$.trim(e.$(o).text())&&e.$("<span/>").text(t.l("Search")).addClass("coveo-icon").appendTo(o)}return __extends(n,i),n.prototype.handleClick=function(){var e=this;this.logger.debug("Performing query following button click"),this.queryController.deferExecuteQuery({beforeExecuteQuery:function(){return e.usageAnalytics.logSearchEvent(t.AnalyticsActionCauseList.searchboxSubmit,{})}})},n.ID="SearchButton",n}(t.Component);t.SearchButton=i,t.CoveoJQuery.registerAutoCreateComponent(i)}(t=e.Ui||(e.Ui={}))}(Coveo||(Coveo={}));var Coveo;!function(e){var t;!function(t){var i=function(i){function n(o,s,r){i.call(this,o,n.ID,r),this.element=o,this.options=s,this.options=t.ComponentOptions.initComponentOptions(o,n,s),this.searchButton=new t.SearchButton(e.$("<a/>").appendTo(this.element).get(0),void 0,r);var a=e.$("<div/>").appendTo(this.element),l=this.buildInputTag();l.appendTo(a),this.searchBox=this.options.activateOmniBox?new t.OmniBox(l.get(0),this.options,r):new t.QueryBox(l.get(0),this.options,r)}return __extends(n,i),n.prototype.buildInputTag=function(){var t=this;return e.$('<input type="text" autocapitalize="off" autocorrect="off" />').blur(function(i){t.queryStateModel.set(e.Models.QueryStateModel.attributesEnum.q,e.$(i.target).val())})},n.ID="SearchBox",n.parent=t.OmniBox,n.options={activateOmniBox:t.ComponentOptions.buildBooleanOption({attrName:"data-activate-omnibox",defaultValue:!1,postProcessing:function(t,i){return i.enableSearchAsYouType?(t&&new e.Logger(document).warn("Cannot initialize omnibox and search as you type at the same time : Disabling omnibox functionnality"),!1):t}}),enableSearchAsYouType:t.ComponentOptions.buildBooleanOption({defaultValue:!1}),searchAsYouTypeDelay:t.ComponentOptions.buildNumberOption({defaultValue:500}),disableQuerySyntax:t.ComponentOptions.buildBooleanOption({defaultValue:!1}),enableWildcards:t.ComponentOptions.buildBooleanOption({defaultValue:!1}),enableQuestionMarks:t.ComponentOptions.buildBooleanOption({defaultValue:!1}),enableLowercaseOperators:t.ComponentOptions.buildBooleanOption({defaultValue:!1}),enablePartialMatch:t.ComponentOptions.buildBooleanOption({defaultValue:!1}),partialMatchKeywords:t.ComponentOptions.buildNumberOption({defaultValue:5}),partialMatchThreshold:t.ComponentOptions.buildStringOption({defaultValue:"50%"}),autoFocus:t.ComponentOptions.buildBooleanOption({defaultValue:!0})},n}(e.Ui.Component);t.SearchBox=i,e.Ui.CoveoJQuery.registerAutoCreateComponent(i)}(t=e.Ui||(e.Ui={}))}(Coveo||(Coveo={}));var Coveo;!function(e){var t;!function(t){var i=function(i){function n(o,s,r){var a=this;i.call(this,o,s,r),this.element=o,this.options=s,this.omniBoxHeaderSearchForTemplate=e._.template("<div class='coveo-omnibox-selectable coveo-omnibox-section coveo-omnibox-header'><div class='coveo-text'>"+t.l("SearchFor","<strong><%- data %></strong>")+"</div></div>"),this.omniBoxIsOpen=!1,this.isLoadingData=!1,this.headerIsCurrentlyRendered=!1,this.options=t.ComponentOptions.initComponentOptions(o,n,s),e.$(o).keyup(function(e){return a._handleKeyUp(e)}),this.renderOmniBoxDiv(),this.omniBoxDiv.hide(),this.prepareThrottledCall(),e.$(this.root).fastClick(function(t){a.omniBoxIsOpen&&!e.$.contains(a.omniBoxDiv.get(0),e.$(t.target).get(0))&&a.escapeEvent()});var l=this.queryStateModel.getEventName(e.Models.Model.eventTypes.changeOne+e.Models.QueryStateModel.attributesEnum.q);e.$(this.queryStateModel.element).on(l,e.$.proxy(this._handleQueryStateChanged,this)),e.$(window).on("resize",function(){a.omniBoxIsOpen&&a.setWidthOnOmniBoxDiv()})}return __extends(n,i),n.prototype.close=function(){e.$(this.root).trigger(e.Events.OmniBoxEvents.closeOmniBox),this.omniBoxDiv&&(this.omniBoxDiv.children().remove(),this.omniBoxDiv.hide()),this.clearLastOmniBoxRows(),e.Utils.isNullOrUndefined(this.lastOmniBoxData)||this.rejectAllPendingDeferred(this.lastOmniBoxData),this.resetOmniBoxInternalData(),this.omniBoxIsOpen=!1},n.prototype.open=function(){""!=e.$(this.element).val()?(this.throttledCallForOmniBoxBody(),e.$(this.root).trigger(e.Events.OmniBoxEvents.openOmniBox)):this.escapeEvent()},n.prototype.getDataForOmniboxBody=function(){if(this.addSearchAnimation(),this.isCurrentlyBeingRendered)this.throttledCallForOmniBoxBody();else{var e=this.buildOmniBoxRequestObject(),t=this.requestOmniBoxData(e);this.processNewOmniBoxData(t)}},n.prototype.buildOmniBoxRequestObject=function(){var t=this,i=this.getCurrentQueryExpression(),n={completeQueryExpression:{word:e.$(this.element).val(),regex:this.getRegexToSearch()},currentQueryExpression:{word:i,regex:this.getRegexToSearch(i)},allQueryExpressions:this.getQueryExpressionBreakDown(),cursorPosition:e.$(this.element).getCursorPosition(),clear:function(){t.clear()},clearCurrentExpression:function(){t.clearCurrentExpression()},replace:function(e,i){t.replace(e,i)},replaceCurrentExpression:function(e){t.replaceCurrentExpression(e)},insertAt:function(e,i){t.insertAt(e,i)},closeOmniBox:function(){t.close()}};return n},n.prototype.prepareThrottledCall=function(){this.throttledCallForOmniBoxBody=e.Utils.throttle(this.getDataForOmniboxBody,this.options.omniBoxDelay,void 0,this)},n.prototype.requestOmniBoxData=function(t){e.Assert.exists(t),this.logger.info("Requesting omnibox data to all components");var i=e.$.extend({rows:[]},t);return e.$(this.root).trigger(e.Events.OmniBoxEvents.populateOmniBox,i),i},n.prototype.getQueryExpressionBreakDown=function(){var t=this,i=[],n=e.$(this.element).val().split(" ");return e._.each(n,function(e){i.push({word:e,regex:t.getRegexToSearch(e)})}),i},n.prototype._handleNewQuery=function(e,t){i.prototype._handleNewQuery.call(this,e,t),this.omniBoxIsOpen&&e.stopPropagation()},n.prototype._handleKeyUp=function(i){var n=this;i.stopImmediatePropagation();var o=e.$(this.element).val().length;!e.Utils.isNullOrUndefined(this.lastOmniBoxData)&&!e.Utils.isNullOrUndefined(this.lastNumberOfLettersInOmniBox)&&Math.abs(o-this.lastNumberOfLettersInOmniBox)>this.options.omniBoxChangeLimit&&(this.rejectAllPendingDeferred(this.lastOmniBoxData),this.prepareThrottledCall()),e.KeyboardUtils.keysEqual(i,27)&&this.omniBoxIsOpen?this.escapeEvent():e.KeyboardUtils.keysEqual(i,13)?this.omniBoxIsOpen?this.selectionEvent():(this.escapeEvent(),this.triggerNewQuery(function(){return n.usageAnalytics.logSearchEvent(t.AnalyticsActionCauseList.searchboxSubmit,{})})):e.KeyboardUtils.isArrowKeyPushed(i.keyCode)&&this.omniBoxIsOpen?this.navigationEvent(i):e.KeyboardUtils.isAllowedKeyForOmniBox(i)&&(""==e.$(this.element).val()?this.escapeEvent():this.open())},n.prototype._handleChange=function(e){return e.stopImmediatePropagation(),!1},n.prototype.handleHover=function(e){var t=this.getCorrectTarget(e);t&&this.toggleSelected(t)},n.prototype.bindOmniBoxEvent=function(){this.bindHoverEvent()},n.prototype.bindHoverEvent=function(){var t=this;e.$(this.omniBoxDiv).find(".coveo-omnibox-selectable").hover(function(e){t.handleHover(e)})},n.prototype.escapeEvent=function(){this.clearLastOmniBoxRows(),this.close(),this.removeSearchAnimation()},n.prototype.selectionEvent=function(){var e=this;this.isFirstValueSelected(this.findSelected())?this.triggerNewQuery(function(){return e.usageAnalytics.logSearchEvent(t.AnalyticsActionCauseList.searchboxSubmit,{})}):this.keyBoardSelection()},n.prototype.navigationEvent=function(e){var t=this.findSelected();0==t.length?this.navigationEventWhenNoSelection(e):this.navigationEventWhenSelection(e,t)},n.prototype.navigationEventWhenNoSelection=function(t){e.KeyboardUtils.keysEqual(t,40)&&this.findSelectable().first().addClass("coveo-omnibox-selected")},n.prototype.navigationEventWhenSelection=function(e,t){if(!this.isLoadingData)switch(e.keyCode){case 38:this.isFirstValueSelected(t)||(this.unselectValueInOmnibox(t),this.selectValueBeforeAlreadySelected(t));break;case 40:this.isLastValueSelected(t)||(this.unselectValueInOmnibox(t),this.selectValueAfterAlreadySelected(t))}},n.prototype.keyBoardSelection=function(){this.logger.trace("Selecting facet value because of omnibox selection");var e=this.findSelected();e.trigger("keyboardSelect"),this.escapeEvent()},n.prototype.triggerNewQuery=function(t){this.logger.info("Triggering new query because of omnibox selection"),this.escapeEvent(),this.queryStateModel.set(e.Models.QueryStateModel.attributesEnum.q,e.$(this.element).val()),this.queryController.deferExecuteQuery({beforeExecuteQuery:t})},n.prototype.processNewOmniBoxData=function(e){this.logger.trace("Processing omnibox data"),this.isCurrentlyBeingRendered=!0,this.numberOfPendingQueries=0,this.renderOmniBoxBody(e),this.omniBoxIsOpen=!0},n.prototype.renderHeader=function(){this.buildHeader(),this.setWidthOnOmniBoxDiv(),this.omniBoxDiv.show(),this.findSelectable().first().addClass("coveo-omnibox-selected"),this.headerIsCurrentlyRendered=!0},n.prototype.renderOmniBoxDiv=function(){this.omniBoxDiv=e.$("<div class='coveo-omnibox'></div>"),e.$(this.element).after(this.omniBoxDiv)},n.prototype.setWidthOnOmniBoxDiv=function(){this.omniBoxDiv.width(this.getWidth())},n.prototype.buildHeader=function(){var i=this;void 0!=this.omniBoxHeader&&this.omniBoxHeader.remove(),this.omniBoxHeader=e.$(this.omniBoxHeaderSearchForTemplate({data:e.$(this.element).val()})),this.omniBoxHeader.fastClick(function(){i.triggerNewQuery(function(){return i.usageAnalytics.logSearchEvent(t.AnalyticsActionCauseList.searchboxSubmit,{})})}),this.omniBoxDiv.prepend(this.omniBoxHeader)},n.prototype.renderOmniBoxBody=function(t){var i=this;this.omniBoxRows=[],this.lastOmniBoxData=t,this.lastNumberOfLettersInOmniBox=e.$(this.element).val().length;e._.find(t.rows,function(t){return!e.Utils.isNullOrUndefined(t.element)});e._.each(t.rows,function(t){e.Utils.isNullOrUndefined(t.element)?e.Utils.isNullOrUndefined(t.deferred)||(i.numberOfPendingQueries++,i.renderOmniBoxForOneElementDeferred(t)):i.renderOmniBoxForOneElement(t)}),0==this.numberOfPendingQueries&&this.allDeferredHaveArrived(),setTimeout(function(){i.rejectAllPendingDeferred(t)},this.options.omniBoxTimeout)},n.prototype.rejectAllPendingDeferred=function(t){e._.each(t.rows,function(t){e.Utils.isNullOrUndefined(t.deferred)||"pending"!=t.deferred.state()||t.deferred.reject()})},n.prototype.allDeferredHaveArrived=function(){this.appendOmniBoxSections(),this.resetOmniBoxInternalData(),this.removeSearchAnimation()},n.prototype.clearLastOmniBoxRows=function(){void 0!=this.lastOmniBoxRows&&e._.each(this.lastOmniBoxRows,function(t){e.$(t.element).remove()})},n.prototype.appendOmniBoxSections=function(){if(this.omniBoxRows.length>0&&""!=e.$(this.element).val()){this.renderHeader(),this.clearLastOmniBoxRows(),this.omniBoxRows=e._.sortBy(this.omniBoxRows,function(e){return e.zIndex}).reverse();for(var t=0;t<this.omniBoxRows.length;t++)this.omniBoxDiv.append(this.omniBoxRows[t].element);this.bindOmniBoxEvent(),this.resetOmniBoxInternalData()}else this.close()},n.prototype.resetOmniBoxInternalData=function(){this.lastOmniBoxRows=this.omniBoxRows,this.isCurrentlyBeingRendered=!1,this.headerIsCurrentlyRendered=!1},n.prototype.renderOmniBoxForOneElement=function(t){var i=t.zIndex||-1;e.$(t.element).addClass("coveo-omnibox-section"),this.omniBoxRows.push({zIndex:i,element:t.element})},n.prototype.renderOmniBoxForOneElementDeferred=function(t){var i=this;t.deferred.done(function(t){i.headerIsCurrentlyRendered||void 0==t.element||i.renderHeader(),i.numberOfPendingQueries--,e.Utils.isNullOrUndefined(t.element)||i.renderOmniBoxForOneElement(t),0==i.numberOfPendingQueries&&i.allDeferredHaveArrived()}),t.deferred.fail(function(){i.numberOfPendingQueries--,0==i.numberOfPendingQueries&&i.allDeferredHaveArrived()})},n.prototype.isFirstValueSelected=function(e){return e.get(0)==this.findSelectable().first().get(0)},n.prototype.isLastValueSelected=function(e){return e.get(0)==this.findSelectable().last().get(0)},n.prototype.unselectValueInOmnibox=function(e){e.removeClass("coveo-omnibox-selected")},n.prototype.selectValueBeforeAlreadySelected=function(t){e.$(this.findSelectable().get(this.findPosOfAlreadySelected(t)-1)).addClass("coveo-omnibox-selected")},n.prototype.selectValueAfterAlreadySelected=function(t){e.$(this.findSelectable().get(this.findPosOfAlreadySelected(t)+1)).addClass("coveo-omnibox-selected")},n.prototype.findPosOfAlreadySelected=function(t){var i=-1,n=this.findSelectable();return e._.find(n,function(e){return i++,e==t.get(0)}),i},n.prototype.findSelectable=function(){return this.omniBoxDiv.find(".coveo-omnibox-selectable")},n.prototype.findSelected=function(){return this.findSelectable().closest(".coveo-omnibox-selected")},n.prototype.toggleSelected=function(e){this.omniBoxDiv.find(".coveo-omnibox-selected").removeClass("coveo-omnibox-selected"),e.addClass("coveo-omnibox-selected")},n.prototype.getWidth=function(){var t=e.$(this.element);return t.outerWidth()+this.getSearchButtonWidth()},n.prototype.getSearchButtonWidth=function(){var i=e.$(this.element).closest("."+t.Component.computeCssClassNameForType(t.SearchBox.ID));if(0!=i.length){var n=i.coveo(t.SearchBox);return void 0!=n.searchButton?e.$(n.searchButton.element).outerWidth():0}return 0},n.prototype.getRegexToSearch=function(t){return void 0===t&&(t=e.$(this.element).val()),new RegExp(e.Utils.escapeRegexCharacter(t),"i")},n.prototype.getCorrectTarget=function(t){var i=e.$(t.target);return i.closest(".coveo-omnibox-selectable")},n.prototype.addSearchAnimation=function(){this._hideClearElement(),e.$(this.element).addClass("coveo-loading"),this.isLoadingData=!0},n.prototype.removeSearchAnimation=function(){e.$(this.element).removeClass("coveo-loading"),this._addClearElement(),this.isLoadingData=!1},n.ID="OmniBox",n.options={omniBoxDelay:t.ComponentOptions.buildNumberOption({defaultValue:500}),omniBoxTimeout:t.ComponentOptions.buildNumberOption({defaultValue:2e3}),omniBoxChangeLimit:t.ComponentOptions.buildNumberOption({defaultValue:3}),omniBoxMinimumLetters:t.ComponentOptions.buildNumberOption({defaultValue:1})},n.parent=t.QueryBox,n}(t.QueryBox);t.OmniBox=i,e.Ui.CoveoJQuery.registerAutoCreateComponent(i)}(t=e.Ui||(e.Ui={}))}(Coveo||(Coveo={}));var Coveo;!function(e){var t;!function(t){var i=function(){function t(e,t){this.structure=e,this.onSelect=t}return t.prototype.buildOmniBoxElement=function(t,i){var n;if(0!=t.length){n=e.$("<div></div>");var o=this.buildElementHeader();n.append(o);var s=this.buildRowElements(t,i);e._.each(s,function(e){n.append(e)})}return n},t.prototype.buildElementHeader=function(){return e.$(this.structure.header.template({headerTitle:this.structure.header.title}))},t.prototype.buildRowElements=function(t,i){var n=this,o=[];return e._.each(t,function(t){var s=e.$(n.structure.row({rawValue:t.value,data:e.JQueryUtils.highlightElement(t.value,i.completeQueryExpression.word)}));s.fastClick(function(){n.onSelect.call(n,t.value,i)}),s.on("keyboardSelect",function(){n.onSelect.call(n,t.value,i)}),o.push(s)}),o},t}();t.SuggestionForOmniBox=i}(t=e.Ui||(e.Ui={}))}(Coveo||(Coveo={}));var Coveo;!function(e){var t;!function(t){var i=function(i){function n(o,s,r){i.call(this,o,s,r,n.ID),this.element=o,this.options=s,this.bindings=r,this.options=t.ComponentOptions.initComponentOptions(o,n,s),this.setupOptions(),this.bind.onRoot(e.Events.OmniBoxEvents.populateOmniBox,this.handlePopulateOmniBox)}return __extends(n,i),n.prototype._buildResults=function(i){var n=this;if(this.lastOmniboxRequest){var o=e.$("<div></div>");o.append("<div class='coveo-omnibox-result-list-header'>          <span class='coveo-icon-omnibox-result-list'></span>           <span class='coveo-caption'>"+(this.options.headerTitle||t.l("SuggestedResults"))+"</span>         </div>"),e._.each(i.results,function(t){var i=n._instantiateTemplateForResult(t);e.$(i).data("CoveoResult",t).addClass("coveo-omnibox-selectable").appendTo(o),e.$(i).on("keyboardSelect",function(){n.options.onSelect.call(n,t,e.$(i),n.lastOmniboxRequest.omniboxObject)}),n._autoCreateComponentsInsideResult(i,t),n._triggerNewResultDisplayed(t,i)}),this.lastOmniboxRequest.deferred.resolve({element:o.get(0),zIndex:this.options.omniboxZIndex})}},n.prototype.setupOptions=function(){this.logger.info("Disabling infinite scroll for OmniBoxResultList",this),this.options.enableInfiniteScroll=!1,this.options.onSelect=this.options.onSelect||this.onRowSelection},n.prototype.handlePopulateOmniBox=function(i,n){var o=this,s=e.$.Deferred();n.rows.push({deferred:s}),this.lastOmniboxRequest={omniboxObject:n,deferred:s},this.queryController.executeQuery({beforeExecuteQuery:function(){return o.usageAnalytics.logSearchAsYouType(t.AnalyticsActionCauseList.searchboxSubmit,{})},searchAsYouType:!0})},n.prototype.onRowSelection=function(e){this.usageAnalytics.logClickEvent(t.AnalyticsActionCauseList.documentOpen,{documentTitle:e.title,documentURL:e.clickUri},e,this.root),window.location.href=e.clickUri},n.ID="OmniBoxResultList",n.options={omniboxZIndex:t.ComponentOptions.buildNumberOption(51),headerTitle:t.ComponentOptions.buildStringOption()},n}(t.ResultList);t.OmniBoxResultList=i,t.CoveoJQuery.registerAutoCreateComponent(i)}(t=e.Ui||(e.Ui={}))}(Coveo||(Coveo={}));var Coveo;!function(e){var t;!function(t){var i=function(i){function n(o,s,r){var a=this;i.call(this,o,n.ID,r),this.element=o,this.options=s,this.listenToQueryStateChange=!0,this.needToReset=!0,this.ignoreNextQuerySuccess=!1,this.listItemTemplate=e._.template('<li class="<%= _class %>"></li>'),this.listItemValueTemplate=e._.template("<a><%= listItemValue %></a>"),this.navigationButtonTemplate=e._.template('<li class="<%= _class %>"><a><span title="<%= buttonValue %>"/></a></li>'),this.options=t.ComponentOptions.initComponentOptions(o,n,s),this.currentPage=1,this.bind.onRoot(e.Events.QueryEvents.newQuery,function(){return a.handleNewQuery()}),this.bind.onRoot(e.Events.QueryEvents.buildingQuery,function(e,t){return a.handleBuildingQuery(e,t)}),this.bind.onRoot(e.Events.QueryEvents.querySuccess,function(e,t){return a.handleQuerySuccess(e,t)}),this.bind.onRoot(e.Events.QueryEvents.queryError,function(e,t){return a.handleQueryError(e,t)}),this.bind.onRoot(e.Events.QueryEvents.noResults,function(e,t){return a.handleNoResults(e,t)});var l=this.queryStateModel.getEventName(e.Models.Model.eventTypes.changeOne+e.Models.QueryStateModel.attributesEnum.first);e.$(this.queryStateModel.element).on(l,e.$.proxy(this.handleQueryStateModelChanged,this)),this.list=e.$("<ul></ul>").appendTo(o)}return __extends(n,i),n.prototype.setPage=function(i){e.Assert.exists(i),this.needToReset=!1,this.currentPage=i,this.updateQueryStateModel(this.getFirstResultNumber(this.currentPage)),this.usageAnalytics.logCustomEvent(t.AnalyticsActionCauseList.pagerNumber,{pagerNumber:i},this.element),this.queryController.deferExecuteQuery()},n.prototype.previousPage=function(){this.needToReset=!1,this.currentPage=this.currentPage-1,this.currentPage=Math.max(this.currentPage,1),this.updateQueryStateModel(this.getFirstResultNumber(this.currentPage)),this.usageAnalytics.logCustomEvent(t.AnalyticsActionCauseList.pagerPrevious,{pagerNumber:this.currentPage},this.element),this.queryController.deferExecuteQuery()},n.prototype.nextPage=function(){this.needToReset=!1,this.currentPage=this.currentPage+1,this.currentPage=Math.min(this.currentPage,1e3),this.updateQueryStateModel(this.getFirstResultNumber(this.currentPage)),this.usageAnalytics.logCustomEvent(t.AnalyticsActionCauseList.pagerNext,{pagerNumber:this.currentPage},this.element),this.queryController.deferExecuteQuery()},n.prototype.handleNewQuery=function(){this.needToReset&&(this.currentPage=1,this.updateQueryStateModel(this.getFirstResultNumber(this.currentPage))),this.needToReset=!0},n.prototype.updateQueryStateModel=function(t){this.listenToQueryStateChange=!1,this.queryStateModel.set(e.Models.QueryStateModel.attributesEnum.first,t),this.listenToQueryStateChange=!0},n.prototype.handleQueryError=function(){this.reset()},n.prototype.handleQuerySuccess=function(t,i){var n=this;if(this.reset(),this.ignoreNextQuerySuccess)this.ignoreNextQuerySuccess=!1;else{e.Assert.isNotUndefined(i);var o=i.query.firstResult,s=i.results.totalCount,r=this.computePagerBoundary(o,s);if(this.currentPage=r.currentPage,r.end-r.start>0){for(var a=r.start;a<=r.end;a++){var l=e.$(this.listItemValueTemplate({listItemValue:a}));!function(t){var i=e.$(n.listItemTemplate({_class:t==n.currentPage?"coveo-active":""})).fastClick(function(){return n.handleClickPage(t)});i.append(l).appendTo(n.list)}(a)}this.options.navigationButton&&r.lastResultPage>1&&this.renderNavigationButton(r,this.list)}}},n.prototype.handleNoResults=function(e,t){var i=this.computePagerBoundary(t.results.totalCount,t.results.totalCount).lastResultPage;this.currentPage>i&&(this.ignoreNextQuerySuccess=!0,this.setPage(i))},n.prototype.reset=function(){e.$(this.list).empty()},n.prototype.handleBuildingQuery=function(t,i){e.Assert.exists(i);var n=this.getQueryEventArgs();i.queryBuilder.firstResult=n.first,i.queryBuilder.numberOfResults=n.count},n.prototype.computePagerBoundary=function(e,t){var i=this.queryController.options.resultsPerPage,n=Math.floor(e/i)+1,o=Math.ceil(t/i);o=Math.max(o,1);var s=Math.floor(this.options.numberOfPages/2),r=n-s;r=Math.max(r,1);var a=r+this.options.numberOfPages-1;return a=Math.min(a,o),{start:r,end:a,lastResultPage:o,currentPage:n}},n.prototype.renderNavigationButton=function(i,n){var o=this;if(this.currentPage>1){var s=e.$(this.navigationButtonTemplate({_class:"coveo-previous",buttonValue:t.l("Previous")})).prependTo(n);
s.fastClick(function(){return o.handleClickPrevious()})}if(this.currentPage<i.lastResultPage){var r=e.$(this.navigationButtonTemplate({_class:"coveo-next",buttonValue:t.l("Next")})).appendTo(n);r.fastClick(function(){return o.handleClickNext()})}},n.prototype.handleQueryStateModelChanged=function(t,i){if(this.listenToQueryStateChange){e.Assert.exists(i),this.needToReset=!1;var n=i.value;this.currentPage=this.fromFirstResultsToPageNumber(n)}},n.prototype.handleClickPage=function(t){e.Assert.exists(t),this.setPage(t)},n.prototype.handleClickPrevious=function(){this.previousPage()},n.prototype.handleClickNext=function(){this.nextPage()},n.prototype.fromFirstResultsToPageNumber=function(e){return e/this.queryController.options.resultsPerPage+1},n.prototype.getFirstResultNumber=function(e){return void 0===e&&(e=this.currentPage),(e-1)*this.queryController.options.resultsPerPage},n.prototype.getQueryEventArgs=function(){return{count:this.queryController.options.resultsPerPage,first:this.getFirstResultNumber()}},n.ID="Pager",n.options={numberOfPages:t.ComponentOptions.buildNumberOption({defaultFunction:function(){return e.DeviceUtils.isMobileDevice()?3:10}}),navigationButton:t.ComponentOptions.buildBooleanOption({defaultValue:!0,attrName:"data-show-previous-next"})},n}(t.Component);t.Pager=i,t.CoveoJQuery.registerAutoCreateComponent(i)}(t=e.Ui||(e.Ui={}))}(Coveo||(Coveo={}));var Coveo;!function(e){var t;!function(t){var i=function(){function t(t,i,n){this.boxInputToBuild=t,this.nameOfInput=i,this.type=n,this.inputs={},this.inputTemplate=e._.template("<div class='coveo-choice-container'>        <div class='coveo-section coveo-section-input'>          <input <%= otherAttribute %> class='coveo-<%= label %>' id='coveo-<%= label %>' type='<%= type %>' name='<%= name%>' value='<%= label %>' ></input><span class='coveo-input-icon'></span><label for='coveo-<%= label %>'><%= label %></label>        </div>        <div class='coveo-section coveo-section-tab'><%- tab %></div>      <div class='coveo-section coveo-section-expression'><%- expression %></div>      </div>")}return t.prototype.build=function(){var t=this;return e._.reduce(e._.map(this.boxInputToBuild,function(i){return t.inputs[i.label]=e.$(t.inputTemplate({label:i.label,name:t.nameOfInput,type:t.type,otherAttribute:i.otherAttribute,tab:i.tab,expression:i.expression})),t.inputs[i.label]}),function(e,t){return e.add(t)})},t.prototype.select=function(t){e.Assert.exists(this.inputs[t]),this.inputs[t].find("input").prop("checked",!0),this.inputs[t].find(".coveo-input-icon").addClass("coveo-selected")},t.prototype.unselect=function(t){e.Assert.exists(this.inputs[t]),this.inputs[t].find("input").prop("checked",!1),this.inputs[t].find(".coveo-input-icon").removeClass("coveo-selected")},t.prototype.getSelected=function(){var t=e._.find(this.inputs,function(e){return e.find("input").prop("checked")});return t.find("input").val()},t.prototype.getSelecteds=function(){var t=e._.filter(this.inputs,function(e){return e.find("input").prop("checked")});return e._.map(t,function(e){return e.find("input").val()})},t}();t.PreferencesPanelBoxInput=i;var n=function(e){function t(t,i){e.call(this,t,i,"radio"),this.radioElementToBuild=t,this.name=i}return __extends(t,e),t}(i);t.PreferencesPanelRadioInput=n;var o=function(t){function i(e,i){t.call(this,e,i,"checkbox"),this.checkboxElementToBuild=e,this.name=i}return __extends(i,t),i.prototype.build=function(){var i=t.prototype.build.call(this),n=(i.find("input"),i.find(".coveo-input-icon"));return e._.each(n,function(t){var i=e.$(t).siblings("input"),n=e.$(t);i.change(function(){n.toggleClass("coveo-selected",i.is(":checked"))}),n.fastClick(function(){i.prop("checked",!i.is(":checked")),i.change()})}),i},i}(i);t.PreferencesPanelCheckboxInput=o;var s=function(){function t(t,i){this.textElementToBuild=t,this.name=i,this.inputs={},this.inputTemplate=e._.template("<div class='coveo-choice-container'><input <%= otherAttribute %> class='coveo-<%= label %>' id='coveo-<%= label %>' type='<%= type %>' name='<%= name%>' placeholder='<%= placeholder %>' ></input></div>")}return t.prototype.build=function(){var t=this;return e._.reduce(e._.map(this.textElementToBuild,function(i){return t.inputs[i.label]=e.$(t.inputTemplate({label:i.label,name:t.name,type:"text",otherAttribute:i.otherAttribute,placeholder:i.placeholder||i.label})),t.inputs[i.label]}),function(e,t){return e.add(t)})},t.prototype.getValues=function(){var t=this;return e._.map(this.inputs,function(e,i){return t.getInput(i).val()})},t.prototype.setValue=function(t,i){e.Assert.exists(this.inputs[t]),this.getInput(t).val(i)},t.prototype.reset=function(){e._.each(this.inputs,function(e){e.find("input").val("")})},t.prototype.getInput=function(t){e.Assert.exists(this.inputs[t]);var i=this.inputs[t].find("input");return 0==i.length&&(i=this.inputs[t].find("textarea")),i},t}();t.PreferencesPanelTextInput=s;var r=function(t){function i(){t.apply(this,arguments),this.inputTemplate=e._.template("<div class='coveo-choice-container'><textarea <%= otherAttribute %> class='coveo-<%= label %>' id='coveo-<%= label %>' name='<%= name%>' placeholder='<%= placeholder %>' ></textarea></div>")}return __extends(i,t),i.prototype.build=function(){var t=this;return e._.reduce(e._.map(this.textElementToBuild,function(i){return t.inputs[i.label]=e.$(t.inputTemplate({label:i.label,name:t.name,otherAttribute:i.otherAttribute,placeholder:i.placeholder||i.label})),t.inputs[i.label]}),function(e,t){return e.add(t)})},i}(s);t.PreferencesPanelTextAreaInput=r;var a=function(){function t(e,t,i){this.toBuild=e,this.options=t,this.name=i,this.textInput=new r([{label:e.label,otherAttribute:"readonly"}],i)}return t.prototype.build=function(){var t=this;return this.select=e.$("<select multiple></select>"),e._.each(this.options,function(i){t.select.append(e.$("<option>"+i+"</option>"))}),this.select.change(function(){var i=t.select.val();e.Utils.isNullOrUndefined(i)?t.reset():t.textInput.setValue(t.toBuild.label,i.join(","))}),this.textInput.build().append(this.select)},t.prototype.getValues=function(){return this.textInput.getValues()[0].split(",")},t.prototype.setValues=function(e){this.textInput.setValue(this.toBuild.label,e.join(","))},t.prototype.reset=function(){this.textInput.setValue(this.toBuild.label,"")},t}();t.PreferencePanelMultiSelectInput=a}(t=e.Ui||(e.Ui={}))}(Coveo||(Coveo={}));var Coveo;!function(e){var t;!function(t){var i=function(i){function n(e,o,s){i.call(this,e,n.ID,s),this.element=e,this.options=o,this.options=t.ComponentOptions.initComponentOptions(e,n,o),this.buildCloseButton(),this.buildTitle()}return __extends(n,i),n.prototype.getCssClass=function(){return"coveo-preference-panel"},n.prototype.getMenuItems=function(){var e=this;return[{text:t.l("Preferences"),onOpen:function(){return e.open()},onClose:function(){return e.close()}}]},n.prototype.open=function(){e.$(this.element).addClass("coveo-active")},n.prototype.close=function(){e.$(this.element).removeClass("coveo-active")},n.prototype.save=function(){e.$(this.element).trigger(e.Events.PreferencesPanelEvents.savePreferences),this.queryController.executeQuery()},n.prototype.closeWithoutSave=function(){e.$(this.element).trigger(e.Events.PreferencesPanelEvents.exitPreferencesWithoutSave)},n.prototype.buildCloseButton=function(){var t=this,i=e.$("<div class='coveo-close'><span class='coveo-icon'></span></div>");i.fastClick(function(){t.closeWithoutSave(),t.close()}),e.$(this.element).prepend(i)},n.prototype.buildTitle=function(){var i=e.$("<div class='coveo-title'>"+t.l("Preferences")+"</div>");e.$(this.element).prepend(i)},n.ID="PreferencesPanel",n.options={},n}(t.Component);t.PreferencesPanel=i,t.CoveoJQuery.registerAutoCreateComponent(i)}(t=e.Ui||(e.Ui={}))}(Coveo||(Coveo={}));var Coveo;!function(e){var t;!function(t){var i;!function(t){function i(i,n){e.$(i).fastClick(function(e){e.preventDefault(),n&&n.indexOf("javascript:")<0&&t.openInPhonegap(n)})}function n(e){window.open(e,"_system","location=yes")}t.bindOpenLinkInPhonegap=i,t.openInPhonegap=n}(i=t.PhonegapUtils||(t.PhonegapUtils={}))}(t=e.Ui||(e.Ui={}))}(Coveo||(Coveo={}));var Coveo;!function(e){var t;!function(t){var i=function(i){function n(o,s,r,a){i.call(this,o,n.ID,r),this.element=o,this.options=s,this.result=a,this.options=t.ComponentOptions.initComponentOptions(o,n,s);var l=a.raw.sysparents;l?this.renderParentsXml(o,l):this.renderUri(o,a),e.DeviceUtils.isPhonegap()&&t.PhonegapUtils.bindOpenLinkInPhonegap(o,this.uri)}return __extends(n,i),n.prototype.renderParentsXml=function(t,i){for(var n=e.$.parseXML(i),o=n.getElementsByTagName("parent"),s=[],r=[],a=0;a<o.length;a++){if(a>0){var l=this.buildSeperator();r.push(l),t.appendChild(l)}var u=o.item(a),c=this.buildHtmlToken(u.getAttribute("name"),u.getAttribute("uri"));s.push(c),t.appendChild(c)}if(s.length>1){var p=this.buildEllipsis();t.insertBefore(p,r[0]);var d=this.buildSeperator();t.insertBefore(d,p);for(var h=0,f=[],a=0;a<s.length;a++)f[a]=s[a].offsetWidth,h+=f[a];var m=r[0].offsetWidth,v=p.offsetWidth,g=t.offsetWidth;if(h>=g){h+=v+m;for(var y=[],a=1;a<s.length&&h>=g;)t.removeChild(s[a]),t.removeChild(r[a-1]),a>1&&y.push(r[a-1]),y.push(s[a]),h-=f[a]+m,a++;p.onclick=function(){for(var e=0;e<y.length;e++)t.insertBefore(y[e],p);t.removeChild(p)}}else t.removeChild(p),t.removeChild(d)}},n.prototype.renderUri=function(t,i){this.uri=i.clickUri;var n;n=-1==i.printableUri.indexOf("\\")?e.StringAndHoles.shortenUri(i.printableUri,e.$(t).width()/7):e.StringAndHoles.shortenPath(i.printableUri,e.$(t).width()/7);var o=e.HighlightUtils.highlightString(n.value,i.printableUriHighlights,n.holes,"coveo-highlight"),s=e.$("<a>").attr("title",i.printableUri).addClass("coveo-printable-uri").html(o);e.DeviceUtils.isPhonegap()||s.attr("href",i.clickUri),s.appendTo(t)},n.prototype.buildSeperator=function(){var e=document.createElement("span");return e.innerText=">",e.className="coveo-printable-uri-separator",e},n.prototype.buildEllipsis=function(){var e=document.createElement("span");return e.innerText="...",e.className="coveo-printable-uri",e},n.prototype.buildHtmlToken=function(t,i){var n=t.charAt(0).toUpperCase()+t.slice(1),o=document.createElement("a");return e.DeviceUtils.isPhonegap()||(o.href=i),this.uri=i,o.className="coveo-printable-uri",o.innerText=n,o},n.ID="PrintableUri",n.options={},n}(t.Component);t.PrintableUri=i,t.CoveoJQuery.registerAutoCreateComponent(i)}(t=e.Ui||(e.Ui={}))}(Coveo||(Coveo={}));var Coveo;!function(e){var t;!function(t){var i=function(i){function n(o,s,r){var a=this;i.call(this,o,n.ID,r),this.element=o,this.options=s,this.options=t.ComponentOptions.initComponentOptions(o,n,s),e.$(this.root).on(e.Events.QueryEvents.querySuccess,e.$.proxy(this.handleQuerySuccess,this)),e.$(this.root).on(e.Events.QueryEvents.queryError,function(){e.$(a.element).hide()}),e.$(this.element).hide(),this.textContainer=e.$("<span />").appendTo(this.element)}return __extends(n,i),n.prototype.handleQuerySuccess=function(i,n){if(!this.disabled){e.Assert.exists(n);var o=t.l("Duration",this.formatQueryDuration(n.results.duration))+"\n"+t.l("IndexDuration",this.formatQueryDuration(n.results.indexDuration))+"\n"+t.l("ProxyDuration",this.formatQueryDuration(n.results.proxyDuration))+"\n"+t.l("ClientDuration",this.formatQueryDuration(n.results.clientDuration));this.textContainer.text(this.formatQueryDuration(n.results.duration)),e.$(this.element).attr("title",o),e.$(this.element).show()}},n.prototype.formatQueryDuration=function(e){if(void 0==e)return t.l("Unavailable");var i=Math.max(e/1e3,.01);return t.l("Seconds",Globalize.format(i,"n2"),i)},n.ID="QueryDuration",n.options={},n}(t.Component);t.QueryDuration=i,t.CoveoJQuery.registerAutoCreateComponent(i)}(t=e.Ui||(e.Ui={}))}(Coveo||(Coveo={}));var Coveo;!function(e){var t;!function(t){var i=function(i){function n(o,s,r){var a=this;i.call(this,o,n.ID,r),this.element=o,this.options=s,this.options=t.ComponentOptions.initComponentOptions(o,n,s),e.$(this.root).on(e.Events.QueryEvents.querySuccess,e.$.proxy(this.handleQuerySuccess,this)),e.$(this.root).on(e.Events.QueryEvents.queryError,function(){e.$(a.element).hide()}),e.$(this.element).hide(),this.textContainer=e.$("<span />").appendTo(this.element)}return __extends(n,i),n.prototype.handleQuerySuccess=function(i,n){if(!this.disabled)if(e.Assert.exists(n),e.$(this.element).show(),n.results.results.length>0){var o=Globalize.format(n.query.firstResult+1,"n0"),s=Globalize.format(n.query.firstResult+n.results.results.length,"n0"),r=Globalize.format(n.results.totalCount,"n0");this.textContainer.html(t.l("ShowingResultsOf",'<span class="coveo-highlight">'+o+"</span>",'<span class ="coveo-highlight">'+s+"</span>",'<span class ="coveo-highlight">'+r+"</span>",n.results.results.length))}else if(null!=n.results.exception&&null!=n.results.exception.code){var a=("QueryException"+n.results.exception.code).toLocaleString();this.textContainer.html(t.l("QueryException",a))}else this.textContainer.html(t.l("QueryDidntMatchAnyDocuments"))},n.ID="QuerySummary",n.options={},n}(t.Component);t.QuerySummary=i,t.CoveoJQuery.registerAutoCreateComponent(i)}(t=e.Ui||(e.Ui={}))}(Coveo||(Coveo={}));var Coveo;!function(e){var t=function(){function t(){}return t.buildMailToString=function(e){var i=e.to?"mailto:"+encodeURIComponent(e.to):"mailto:",n=t.buildMailToParametersString(e.subject,e.cc,e.bcc,e.body,i);return n&&(i+="?"+n),i},t.buildMailToParametersString=function(e,i,n,o,s){var r=[];if(e&&r.push(t.buildMailToParameter("subject",e)),i&&r.push(t.buildMailToParameter("cc",i)),n&&r.push(t.buildMailToParameter("bcc",n)),o){var a=t.getShortenBody(o,s+"?"+r.join("&"));a&&r.push(t.buildMailToParameter("body",a))}return r.join("&")},t.getShortenBody=function(i,n){var o=i;if(n.length<e.Ui.MailTo.maxLength){var s=e.Ui.MailTo.maxLength-n.length-"&body=".length;o=t.shortenString(i,s)}return o},t.buildMailToParameter=function(e,t){return t?encodeURIComponent(e)+"="+encodeURIComponent(t):""},t.shortenString=function(t,i,n){void 0===n&&(n=!1);var o=n?encodeURIComponent(e.Ui.MailTo.shortenBodyIndicator):e.Ui.MailTo.shortenBodyIndicator;i-=e.Ui.MailTo.shortenBodyIndicator.length;var s=t.length>i?!0:!1,r=t.substring(0,i);return r+=s?o:""},t.appendShortenBodyToMailToString=function(e,i){var n=t.getShortenBody(i,e);return e.indexOf("?")>=0?e+"&body="+n:e+"?body="+n},t.removeCurrentUserEmailFromString=function(t,i){return i&&t?e._.filter(i.split(";"),function(e){return-1==e.indexOf(t)}).join(";"):i},t.buildReplyMailToFromResult=function(t,i){return new e.Ui.MailTo({currentUserEmail:i,originalFrom:t.raw.sysfrom,to:t.raw.sysfrom,subject:t.raw.sysconversationsubject})},t.buildReplyAllMailToFromResult=function(t,i){return new e.Ui.MailTo({currentUserEmail:i,originalFrom:t.raw.sysfrom,to:t.raw.sysfrom+";"+t.raw.systo,subject:t.raw.sysconversationsubject,cc:t.raw.syscc})},t.buildForwardMailToFromResult=function(t,i){return new e.Ui.MailTo({currentUserEmail:i,originalFrom:t.raw.sysfrom,subject:t.raw.sysconversationsubject})},t.encodeMailToBody=function(t){var i=t.split("\n");return e._.each(i,function(e,t){i[t]=encodeURIComponent(i[t])}),i.join(e.Ui.MailTo.enter)},t}();e.EmailActionsUtils=t}(Coveo||(Coveo={}));var Coveo;!function(e){var t;!function(t){var i=function(t){function i(){t.apply(this,arguments),this.currentUserEmail="",this.originalFrom="",this.to="",this.subject="",this.cc="",this.bcc="",this.body="",this.bodyIsHTML=e.DeviceUtils.isPhonegap()}return __extends(i,t),i}(e.Options);t.DefaultMailToOptions=i;var n=function(){function n(n){this.options=n,this.bodyHeader="",this.options=(new i).merge(n),this.removeCurrentUserFromParameters(),e.DeviceUtils.isPhonegap()&&this.setRecipientsArrays(),this.options.originalFrom&&(this.bodyHeader=this.options.bodyIsHTML?"<p><br/><br/><br/>"+t.l("From")+": "+this.options.originalFrom+"<hr></p>":"\n\n\n"+t.l("From")+": "+this.options.originalFrom+"\n_________________________________\n")}return n.prototype.removeCurrentUserFromParameters=function(){this.options.to=e.EmailActionsUtils.removeCurrentUserEmailFromString(this.options.currentUserEmail,this.options.to),this.options.cc=e.EmailActionsUtils.removeCurrentUserEmailFromString(this.options.currentUserEmail,this.options.cc),this.options.bcc=e.EmailActionsUtils.removeCurrentUserEmailFromString(this.options.currentUserEmail,this.options.bcc)},n.prototype.setRecipientsArrays=function(){this.toArray=this.options.to?this.options.to.split(";"):[],this.ccArray=this.options.cc?this.options.cc.split(";"):[],this.bccArray=this.options.bcc?this.options.bcc.split(";"):[]},n.prototype.open=function(){if(e.DeviceUtils.isPhonegap()){var t=this.options.bodyIsHTML?this.body:e.EmailActionsUtils.shortenString(this.body,n.phonegapMaxLength);window.plugin.email.open(this.getEmailOpenerObject(t))}else this.ensureValueIsSet(),window.location.href=this.value},n.prototype.getEmailOpenerObject=function(e){var t={to:this.toArray,cc:this.ccArray,bcc:this.bccArray,subject:this.options.subject,body:e,isHtml:this.options.bodyIsHTML};return console.log(t),t},n.prototype.ensureValueIsSet=function(){this.value?this.valueBodyIsSet()||this.setValueBody():this.setValue()},n.prototype.setValue=function(){this.value=e.EmailActionsUtils.buildMailToString(this.options),this.value&&!this.valueBodyIsSet()&&this.setValueBody()},n.prototype.setValueBody=function(){this.value=e.EmailActionsUtils.appendShortenBodyToMailToString(this.value,this.body)},n.prototype.setMailToBodyFromText=function(t){void 0===t&&(t=""),this.body=t,e.DeviceUtils.isPhonegap()||(this.body=e.EmailActionsUtils.encodeMailToBody(this.body))},n.prototype.valueBodyIsSet=function(){return this.value.indexOf("body=")>=0},n.prototype.bodyIsSet=function(){return this.body?!0:!1},n.enter="%0D%0A",n.shortenBodyIndicator="\r\n\r\n...",n.maxLength=1e3,n.phonegapMaxLength=15e3,n}();t.MailTo=n}(t=e.Ui||(e.Ui={}))}(Coveo||(Coveo={}));var Coveo;!function(e){var t;!function(t){var i=function(i){function n(e,o,s,r){i.call(this,e,n.ID,s),this.element=e,this.options=o,this.result=r,this.options=t.ComponentOptions.initComponentOptions(e,n,o),this.result=r||this.resolveResult(),this.createAndAppendEmailActions(),this.appendWaitingAnimation()}return __extends(n,i),n.prototype.createAndAppendEmailActions=function(){this.options.reply&&(this.reply=new t.EmailAction(e.$(document.createElement("div"))[0],this,{type:t.EmailAction.reply,currentUserEmail:this.options.currentUserEmail},this.getBindings(),this.result),e.$(this.element).append(this.reply.element)),this.options.replyAll&&(this.replyAll=new t.EmailAction(e.$(document.createElement("div"))[0],this,{type:t.EmailAction.replyAll,currentUserEmail:this.options.currentUserEmail},this.getBindings(),this.result),e.$(this.element).append(this.replyAll.element)),this.options.forward&&(this.forward=new t.EmailAction(e.$(document.createElement("div"))[0],this,{type:t.EmailAction.forward,currentUserEmail:this.options.currentUserEmail},this.getBindings(),this.result),e.$(this.element).append(this.forward.element))},n.prototype.appendWaitingAnimation=function(){this.loadingAnimation=e.JQueryUtils.getBasicLoadingDots().hide(),e.$(this.element).append(this.loadingAnimation)},n.ID="EmailActions",n.options={currentUserEmail:t.ComponentOptions.buildStringOption({defaultValue:""}),reply:t.ComponentOptions.buildBooleanOption({defaultValue:!0}),replyAll:t.ComponentOptions.buildBooleanOption({defaultValue:!0}),forward:t.ComponentOptions.buildBooleanOption({defaultValue:!0})},n}(e.Ui.Component);t.EmailActions=i,e.Ui.CoveoJQuery.registerAutoCreateComponent(i)}(t=e.Ui||(e.Ui={}))}(Coveo||(Coveo={}));var Coveo;!function(e){var t;!function(t){var i=function(i){function n(o,s,r,a,l){var u=this;i.call(this,o,n.ID,a),this.element=o,this.actions=s,this.options=r,this.result=l,this.options=t.ComponentOptions.initComponentOptions(o,t.EmailActions,r),this.result=l||this.resolveResult(),this.setMailToFromResult(),e.$(this.element).fastClick(function(){u.showWaitingAnimation(),u.mailTo.bodyIsSet()?u.openMailTo():u.appendBodyToMailTo(function(){return u.openMailTo()})})}return __extends(n,i),n.prototype.showWaitingAnimation=function(){this.actions.loadingAnimation.show()},n.prototype.hideWaitingAnimation=function(){this.actions.loadingAnimation.hide()},n.prototype.setMailToFromResult=function(){switch(this.options.type){case n.reply:this.mailTo=e.EmailActionsUtils.buildReplyMailToFromResult(this.result,this.options.currentUserEmail),e.$(this.element).append(t.l("Reply"));break;case n.replyAll:this.mailTo=e.EmailActionsUtils.buildReplyAllMailToFromResult(this.result,this.options.currentUserEmail),e.$(this.element).append(t.l("ReplyAll"));break;case n.forward:e.$(this.element).append(t.l("Forward")),this.mailTo=e.EmailActionsUtils.buildForwardMailToFromResult(this.result,this.options.currentUserEmail);break;default:this.mailTo=new t.MailTo({})}},n.prototype.appendBodyToMailTo=function(t){var i=this;if(e.DeviceUtils.isPhonegap()){var n,o=this.queryController.getEndpoint();n=e.DeviceUtils.isAndroid()?o.getDocumentText(this.result.uniqueId).done(function(e){i.doneRetrieveBody(e,t)}):o.getDocumentHtml(this.result.uniqueId).done(function(e){i.doneRetrieveBody(e.getElementsByTagName("body")[0].innerHTML,t)}),n.fail(function(){i.doneRetrieveBody("",t)})}else this.queryController.getEndpoint().getDocumentText(this.result.uniqueId).done(function(e){return i.doneRetrieveBody(e,t)}).fail(function(){return i.doneRetrieveBody("",t)})},n.prototype.doneRetrieveBody=function(e,t){var i=e.content?e.content:e;this.mailTo.setMailToBodyFromText(i),t(e)},n.prototype.openMailTo=function(){this.mailTo.open(),this.hideWaitingAnimation()},n.ID="EmailAction",n.options={type:t.ComponentOptions.buildStringOption({defaultValue:"forward"}),currentUserEmail:t.ComponentOptions.buildStringOption({defaultValue:""})},n.forward="forward",n.reply="reply",n.replyAll="replyAll",n}(e.Ui.Component);t.EmailAction=i}(t=e.Ui||(e.Ui={}))}(Coveo||(Coveo={}));var Coveo;!function(e){var t;!function(t){var i="CoveoHighlight",n=function(n){function o(i,s,r,a){n.call(this,i,o.ID,r),this.element=i,this.options=s,this.result=a,this.options=t.ComponentOptions.initComponentOptions(i,o,s),this.result=a||this.resolveResult(),e.Assert.exists(this.result)}return __extends(o,n),o.prototype.createDom=function(){this.header=this.buildHeader().appendTo(e.$(this.element)),this.iframe=this.buildIFrame().appendTo(e.$(this.element))},o.prototype.open=function(){var i=this;this.ensureDom(),this.usageAnalytics.logClickEvent(t.AnalyticsActionCauseList.documentQuickView,{documentTitle:this.result.title,documentURL:this.result.clickUri},this.result,this.queryController.element);var n=(new Date).getTime(),o=this.iframe.find("iframe")[0];o.src="about:blank";var s=this.queryController.getEndpoint(),r={query:this.queryStateModel.get(e.Models.QueryStateModel.attributesEnum.q),requestedOutputSize:this.options.maximumDocumentSize};s.getDocumentHtml(this.result.uniqueId,r).done(function(e){null!=o.contentDocument&&(i.renderHTMLDocument(o,e),i.triggerQuickviewLoaded(n))}).fail(function(t,r){null!=o.contentDocument&&(0!=r.status?(i.renderErrorReport(o),i.triggerQuickviewLoaded(n)):(o.onload=function(){i.triggerQuickviewLoaded(n)},o.src=s.getViewAsHtmlUri(i.result.uniqueId,i.queryStateModel.get(e.Models.QueryStateModel.attributesEnum.q))))})},o.prototype.renderHTMLDocument=function(t,i){var n=this;t.onload=function(){n.onReceivingMessage(t.contentWindow)},this.writeToIFrame(t,i),this.wrapPreElementsInIframe(t),e.DeviceUtils.isMobileDevice()&&this.bindOpenIframeLinksInPhonegap(t)},o.prototype.renderErrorReport=function(e){var i="<html><body style='font-family: Arimo, \"Helvetica Neue\", Helvetica, Arial, sans-serif; -webkit-text-size-adjust: none;'>"+t.l("OopsError")+"</body></html>";this.writeToIFrame(e,i)},o.prototype.writeToIFrame=function(e,t){var i=t;"object"==typeof t&&(i=t.getElementsByTagName("html")[0].outerHTML),e.contentWindow.document.open(),e.contentWindow.document.write(i),e.contentWindow.document.close()},o.prototype.bindOpenIframeLinksInPhonegap=function(i){try{var n=e.$(i.contentWindow.document).find("a");e._.each(n,function(e){var i=e.href;e.href="javascript:",t.PhonegapUtils.bindOpenLinkInPhonegap(e,i)})}catch(o){}},o.prototype.wrapPreElementsInIframe=function(t){var i=this;try{var n=document.createElement("style");n.type="text/css";var o='html pre { white-space: pre-wrap; white-space: -moz-pre-wrap; white-space: -pre-wrap; white-space: -o-pre-wrap; word-wrap: break-word;} body, html {Arimo, "Helvetica Neue", Helvetica, Arial, sans-serif; -webkit-text-size-adjust: none; margin:0; padding:0; transform-origin:0 0; -ms-transform-origin:0 0; -webkit-transform-origin:0 0;} * { max-width: 100%; -webkit-text-size-adjust: none; -webkit-box-sizing: border-box; -moz-box-sizing: border-box; box-sizing: border-box;} html body {height: auto; width: auto;}';n.styleSheet?n.styleSheet.cssText=o:n.appendChild(document.createTextNode(o));var s=t.contentWindow.document.head;if(s.appendChild(n),e.DeviceUtils.isMobileDevice()&&this.options.allowedZoom){e.DeviceUtils.isIos()&&e.$(t.contentWindow.document.body).css({"-ms-transform":"translate3d(0,0,0)","-webkit-transform":"translate3d(0,0,0)",transform:"translate3d(0,0,0)"});var r=e.DeviceUtils.isIos()?this.iframe.get(0):t,a=t.contentWindow.document.body,l=e.DeviceUtils.isIos()?this.iframe.get(0):t.contentWindow.document.body,u=e.DeviceUtils.isIos()?t:t.contentWindow.document.body,c={frameElement:r,bodyElement:a,scaleElement:u,scrollElement:l,maxWidth:0,maxHeight:0,scale:1,scroll:{left:0,top:0},initialState:void 0};e.$(l).on("touchstart",function(e){i.handleTouchStart(e,c)}).on("touchmove",function(e){i.handleTouchMove(e,c)}).on("touchend",function(e){i.handleTouchEnd(e,c)}),this.iframeSizeCalculation(t),this.calculateBoundaries(c),e.$(window).on("orientationchange",function(){i.iframeSizeCalculation(t),i.calculateBoundaries(c),e.$(c.scrollElement).animate({scrollLeft:0,scrollTop:0},0)})}}catch(p){}},o.prototype.handleTouchStart=function(t,i){var n=this,o=e._.map(t.originalEvent.touches,function(e){return n.mouseEventToPoint(e,i.scrollElement)});i.initialState={scale:i.scale,touches:o,centerClient:{x:this.getMeanValue(o,"x"),y:this.getMeanValue(o,"y")},scroll:{left:i.scroll.left,top:i.scroll.top},distance:2==o.length?this.distance(o[0],o[1]):0}},o.prototype.handleTouchMove=function(t,i){var n=this,o=e._.map(t.originalEvent.touches,function(e){return n.mouseEventToPoint(e,i.scrollElement)});if(null!=i.initialState){if(2===o.length){var s=this.distance(o[0],o[1]);i.scale=Math.max(this.options.minimumZoom,Math.min(this.options.maximumZoom,s/i.initialState.distance*i.initialState.scale))}return this.calculateScroll(i,o),this.updateScaleScroll(i),t.preventDefault(),!1}},o.prototype.handleTouchEnd=function(t,i){t.originalEvent.touches;this.updateScaleScroll(i),e.DeviceUtils.isIos()&&this.overlaps.css({"-ms-transform":"scale("+i.scale+","+i.scale+") translate(0, 0)","-webkit-transform":"scale("+i.scale+","+i.scale+") translate(0, 0)",transform:"scale("+i.scale+","+i.scale+") translate(0, 0)","transform-origin":"0 0","-ms-transform-origin":"0 0","-webkit-transform-origin":"0 0"}),i.initialState=null},o.prototype.iframeSizeCalculation=function(t){var i=e.$(t.contentWindow.document.body).width(),n=e.$(t.contentWindow.document.body).height();e.$(t.contentWindow.document.body).width(i),e.$(t.contentWindow.document.body).height(n),e.DeviceUtils.isMobileDevice()&&this.resizeIframe(),e.DeviceUtils.isIos()&&(this.overlaps&&this.overlaps.remove(),this.overlaps=e.$("<div />").css({top:0,left:0,width:Math.max(window.innerWidth,i),height:Math.max(window.innerHeight,n),position:"absolute"}).appendTo(this.iframe),this.overlaps.fastClick(function(i){var n=e.$(t).offset();e.$(t.contentWindow.document.elementFromPoint(i.clientX-n.left,i.clientY-n.top)).fastClick()}),e.$(this.iframe).css({position:"relative"}))},o.prototype.getMeanValue=function(t,i){return 1==t.length?t[0][i]:e._.reduce(t,function(e,t){return e[i]+t[i]})/t.length},o.prototype.mouseEventToPoint=function(t,i){var n=e.$(i).offset();return{x:t.clientX-n.left,y:t.clientY-n.top}},o.prototype.distance=function(e,t){return Math.ceil(Math.sqrt(Math.pow(e.x-t.x,2)+Math.pow(e.y-t.y,2)))},o.prototype.calculateBoundaries=function(e){e.maxWidth=e.bodyElement.scrollWidth,e.maxHeight=e.bodyElement.scrollHeight},o.prototype.calculateScroll=function(t,i){var n=(t.initialState.scroll.left+t.initialState.centerClient.x)/t.initialState.scale*t.scale-this.getMeanValue(i,"x"),o=(t.initialState.scroll.top+t.initialState.centerClient.y)/t.initialState.scale*t.scale-this.getMeanValue(i,"y"),s=t.maxWidth*t.scale-e.$(t.frameElement).width(),r=t.maxHeight*t.scale-e.$(t.frameElement).width();t.scroll={left:Math.max(0,Math.min(s,n)),top:Math.max(0,Math.min(r,o))}},o.prototype.updateScaleScroll=function(t){var i="scale("+t.scale+","+t.scale+") translate("+-1*t.scroll.left/t.scale+"px, "+-1*t.scroll.top/t.scale+"px)";e.$(t.scaleElement).css({"-ms-transform":i,"-webkit-transform":i,transform:i,"transform-origin":"0 0","-ms-transform-origin":"0 0","-webkit-transform-origin":"0 0"})},o.prototype.triggerQuickviewLoaded=function(t){var i=(new Date).getTime(),n={duration:i-t};e.$(this.element).trigger(e.Events.UserActionEvents.quickViewLoaded,n)},o.prototype.onReceivingMessage=function(t){var n=this;this.header.empty();var o={};this.keywordsState=[];var s=e.$(t.document.body).find("[id^="+i+"]");0==s.length&&this.header.css("min-height",0);for(var r=0;r<s.length;r++){var a=s[r],l=a.id.substr(i.length+1).match(/^([0-9]+)\.([0-9]+)\.([0-9]+)$/);if(null!=l){var u=l[1],c=l[2];o[u]?o[u].count=Math.max(o[u].count,Number(c)):o[u]={text:a.innerHTML,count:1,index:u}}}for(var p=e._.keys(o),r=0;r<p.length;r++){var u=p[r],d=o[u],h=e.$(t.document.body).find('[id^="'+i+":"+u+'.1"]')[0],f=h.style.backgroundColor;this.keywordsState.push({word:d,color:f,currentIndex:0,index:Number(d.index)})}e.$.each(this.keywordsState,function(e,i){n.header.append(n.buildWordButton(i,t))})},o.prototype.buildWordButton=function(t,i){var n=this,o=e.$("<span/>").addClass("coveo-term");return o.append(e.$("<span/>").addClass("coveo-term-left-arrow").append(e.$("<span/>").addClass("coveo-term-left-arrow-icon")).click(function(){n.navigate(t,!0,i)})),o.append(e.$("<span/>").addClass("coveo-term-name").text(t.word.text).click(function(){n.navigate(t,!1,i)})),o.append(e.$("<span/>").addClass("coveo-term-right-arrow").append(e.$("<span/>").addClass("coveo-term-right-arrow-icon")).click(function(){n.navigate(t,!1,i)})),o.css("background-color",t.color),o},o.prototype.navigate=function(t,n,o){var s,r=t.currentIndex;s=n?1>=r?t.word.count:r-1:r==t.word.count?1:r+1;var a=e.$(o.document.body),l=a.find('[id^="'+i+":"+t.word.index+"."+s+'"]')[0],u=e.$(l).offset(),c=a.get(0);a.stop(!0).animate({scrollLeft:u.left-c.clientWidth/2+e.$(l).width()/2,scrollTop:u.top-c.clientHeight/2+e.$(l).height()/2}),this.iframe.stop(!0).animate({scrollLeft:u.left-this.iframe.width()/2+e.$(l).width()/2,scrollTop:u.top-this.iframe.height()/2+e.$(l).height()/2});var p=a.find('[id^="'+i+":"+t.word.index+"."+r+'"]')[0];null!=p&&(p.style.border=""),l.style.border="1px dotted #333",t.currentIndex=s},o.prototype.buildHeader=function(){return e.$("<div/>").addClass("coveo-quickview-header")},o.prototype.buildIFrame=function(){return e.$('<div class="coveo-iframeWrapper"><iframe/></div>')},o.prototype.resizeIframe=function(){var i=e._.reduce(e.$(".coveo-modalBox .coveo-title, .coveo-modalBox .coveo-quick-view-header, .coveo-modalBox ."+t.Component.computeCssClassNameForType(t.EmailAction.ID)),function(t,i){return t+e.$(i).height()},0)+20;e.$(this.iframe).height(e.$(".coveo-modalBox .coveo-body").height()-i)},o.ID="QuickViewDocument",o.options={maximumDocumentSize:t.ComponentOptions.buildNumberOption({defaultValue:0}),allowedZoom:t.ComponentOptions.buildBooleanOption({defaultValue:!0}),minimumZoom:t.ComponentOptions.buildNumberOption({defaultValue:.5}),maximumZoom:t.ComponentOptions.buildNumberOption({defaultValue:4})},o
}(t.Component);t.QuickViewDocument=n,t.CoveoJQuery.registerAutoCreateComponent(n)}(t=e.Ui||(e.Ui={}))}(Coveo||(Coveo={}));var Coveo;!function(e){var t;!function(t){var i=function(i){function n(o,s,r,a){var l=this;i.call(this,o,n.ID,r),this.element=o,this.options=s,this.result=a,this.options=t.ComponentOptions.initComponentOptions(o,n,s),null==this.options.contentTemplate?e.$(this.root).one(e.Events.ResultListEvents.newResultsDisplayed,function(){l.dialogBoxContent=e.$(l.element).children().detach(),l.createLinkAndAppendItToDom(a)}):this.element.innerHTML.match(/^\s*$/)&&this.createLinkAndAppendItToDom(a),this.bindClick(a)}return __extends(n,i),n.prototype.open=function(){var e=this.prepareOpenQuickViewObject();this.createModalBox(e),this.bindQuickViewEvents(e),this.animateAndOpen()},n.prototype.close=function(){this.modalbox.close(),e.DeviceUtils.isAndroid()&&e.DeviceUtils.isPhonegap()&&e.$(document).off("backbutton")},n.prototype.createLinkAndAppendItToDom=function(t){("undefined"==typeof t.hasHtmlVersion||t.hasHtmlVersion)&&(this.link=e.$(n.quickViewLinkTemplate()),e.$(this.element).append(this.link))},n.prototype.bindClick=function(t){"undefined"==typeof t.hasHtmlVersion||t.hasHtmlVersion?e.$(this.element).fastClick(e.$.proxy(this.open,this)):e.$(this.element).css("display","none")},n.prototype.bindQuickViewEvents=function(t){var i=this;e.DeviceUtils.isAndroid()&&e.DeviceUtils.isPhonegap()&&e.$(document).on("backbutton",function(){i.close()}),e.$(this.modalbox.wrapper.children(".coveo-title")).fastClick(function(){return i.close()}),e.$(window).on("resize orientationchange",t.resizeHandler),this.modalbox.content.on(e.Events.UserActionEvents.quickViewLoaded,function(){e.$(t.loadingAnimation).remove()})},n.prototype.animateAndOpen=function(){var i=this,n=this.modalbox.wrapper.css("animation-duration");if(n){var o=/^(.+)(ms|s)$/.exec(n),s=Number(o[1])*("s"==o[2]?1e3:1);setTimeout(function(){e.$(i.modalbox.modalBox.find("."+t.Component.computeCssClassNameForType(t.QuickViewDocument.ID))).coveo("open"),i.resizeIFrame()},s)}else e.$(this.modalbox.modalBox.find("."+t.Component.computeCssClassNameForType(t.QuickViewDocument.ID))).coveo("open"),this.resizeIFrame()},n.prototype.createModalBox=function(i){var n=this;i.content&&(this.dialogBoxContent=i.content);var o=e.$("<div/>").append(this.dialogBoxContent);this.options.title&&o.prepend(e.$('<div class="coveo-title" />').html(this.options.title)),this.modalbox=e.ModalBox.open(o,{overlayClose:!0,title:e.JQueryUtils.getPopUpCloseButton(t.l("Close"),t.l("QuickView")),className:"coveo-quick-view",validation:function(){return e.$(window).off("resize orientationchange",i.resizeHandler),n.modalbox=null,!0}})},n.prototype.prepareOpenQuickViewObject=function(){var e=this,t=function(){e.resizeIFrame()},i=this.options.loadingAnimation;return{resizeHandler:t,loadingAnimation:i,content:void 0!=this.options.contentTemplate?this.prepareQuickViewContent(i):void 0}},n.prototype.prepareQuickViewContent=function(i){var n=e.$(this.options.contentTemplate.instantiateToElement(this.result)),o=this.searchInterface.options,s=e.$.extend({},{options:o},this.getBindings(),{result:this.result});return t.CoveoJQuery.automaticallyCreateComponentsInside(n.get(0),s),0!=n.find("."+t.Component.computeCssClassNameForType(t.QuickViewDocument.ID)).length&&this.options.showLoadingAnimation&&n.prepend(i),n},n.prototype.resizeIFrame=function(){var e=this.modalbox.content.find("."+t.Component.computeCssClassNameForType(t.QuickViewDocument.ID)).find("iframe");if(0!=e.length){var i=this.modalbox.content.get(0).scrollHeight-this.modalbox.content.outerHeight(),n=this.modalbox.content.get(0).scrollWidth-this.modalbox.content.outerWidth();i>0?e.height(e.height()-i):e.css("height",""),n>0?e.width(e.width()-n-5):e.css("width","")}},n.ID="QuickView",n.quickViewLinkTemplate=e._.template("<div class='coveo-icon-for-quickview'>"+t.l("QuickView")+"</div>"),n.options={title:t.ComponentOptions.buildStringOption(),showLoadingAnimation:t.ComponentOptions.buildBooleanOption({defaultValue:!0}),contentTemplate:t.ComponentOptions.buildTemplateOption({selectorAttr:"data-template-selector",idAttr:"data-template-id"}),loadingAnimation:t.ComponentOptions.buildOption(11,function(i){var n=e.$(i).attr("data-loading-animation-selector");if(null!=n){var o=e.$(n);if(0!=o.length)return o.remove().get(0)}var s=e.$(i).attr("data-loading-animation-template-id");if(null!=s){var r=t.ComponentOptions.loadResultTemplateFromId(s);if(r)return r.instantiateToElement({})}return e.JQueryUtils.getBasicLoadingAnimation().get(0)})},n}(t.Component);t.QuickView=i,t.CoveoJQuery.registerAutoCreateComponent(i)}(t=e.Ui||(e.Ui={}))}(Coveo||(Coveo={}));var Coveo;!function(e){var t;!function(t){var i=function(i){function n(o,s,r,a,l){void 0===l&&(l=0),i.call(this,o,n.ID,r),this.element=o,this.options=s,this.bindings=r,this.attachmentLevel=l,this.options=t.ComponentOptions.initComponentOptions(o,n,s),this.attachments=a.attachments,e.Utils.isNonEmptyArray(this.attachments)&&this.renderAttachments()}return __extends(n,i),n.prototype.renderAttachments=function(){var t=this;e._.each(this.attachments,function(i){var o=t.attachmentLevel>0?t.options.subResultTemplate.instantiateToElement(i):t.options.resultTemplate.instantiateToElement(i);if(t.autoCreateComponentsInsideResult(o,e.$.extend({},i,{attachments:[]})),e.$(t.element).append(o),t.attachmentHasSubAttachment(i)&&t.attachmentLevel<t.options.maximumAttachmentLevel){var s=e.$("<div></div>");e.$(o).append(s),new n(s.get(0),t.options,t.bindings,i,t.attachmentLevel+1)}})},n.prototype.attachmentHasSubAttachment=function(t){return e.Utils.isNonEmptyArray(t.attachments)?!0:e.Utils.isNonEmptyArray(t.childResults)?(t.attachments=t.childResults,!0):!1},n.prototype.autoCreateComponentsInsideResult=function(i,o){e.Assert.exists(i);var s=this.searchInterface.options,r=e.$.extend({},{options:s},this.getBindings(),{result:o});t.CoveoJQuery.automaticallyCreateComponentsInside(i,r,[n.ID])},n.ID="ResultAttachments",n.options={resultTemplate:t.ComponentOptions.buildTemplateOption({defaultFunction:function(){return new t.DefaultResultTemplate}}),subResultTemplate:t.ComponentOptions.buildTemplateOption({postProcessing:function(e,t){return null!=e?e:t.resultTemplate}}),maximumAttachmentLevel:t.ComponentOptions.buildNumberOption({defaultValue:5})},n}(t.Component);t.ResultAttachments=i,t.CoveoJQuery.registerAutoCreateComponent(i)}(t=e.Ui||(e.Ui={}))}(Coveo||(Coveo={}));var Coveo;!function(e){var t;!function(t){var i=function(i){function n(o,s,r,a){i.call(this,o,n.ID,r),this.element=o,this.options=s,this.result=a,this.showingMoreResults=!1,this.options=t.ComponentOptions.initComponentOptions(this.element,n,s),e.Assert.exists(a),this.buildElements(),this.displayThoseResults(this.result.childResults),this.updateElementVisibility(),0!=this.result.childResults.length||this.result.moreResults||e.$(this.element).hide()}return __extends(n,i),n.prototype.showMoreResults=function(){var t=this;e.Assert.exists(this.result.moreResults),this.cancelAnyPendingShowMore(),this.moreResultsDeferred=this.result.moreResults(),this.waitAnimation=e.JQueryUtils.getBasicLoadingDots().appendTo(this.results),this.updateElementVisibility(),this.moreResultsDeferred.done(function(e){t.showingMoreResults=!0,t.displayThoseResults(e),t.updateElementVisibility(e.length)}),this.moreResultsDeferred.always(function(){t.moreResultsDeferred=void 0,t.waitAnimation.detach(),t.waitAnimation=void 0})},n.prototype.showLessResults=function(){this.cancelAnyPendingShowMore(),this.showingMoreResults=!1,this.displayThoseResults(this.result.childResults),this.updateElementVisibility(),this.scrollToResultElement()},n.prototype.buildElements=function(){this.buildHeader(),this.buildResults(),this.buildFooter()},n.prototype.buildHeader=function(){var t=e.$("<div/>").addClass("coveo-folding-header").appendTo(this.element);void 0!=this.options.normalCaption&&void 0!=this.options.expandedCaption&&(this.normalCaption=e.$("<div/>").addClass("coveo-folding-header-caption").text(this.options.normalCaption).appendTo(t),this.expandedCaption=e.$("<div/>").addClass("coveo-folding-header-caption").text(this.options.expandedCaption).appendTo(t)),this.onlyOneMessageCaption=e.$("<div/>").addClass("coveo-folding-header-caption").text(this.options.oneResultCaption).appendTo(t)},n.prototype.buildResults=function(){this.results=e.$("<div/>").addClass("coveo-folding-results").appendTo(this.element)},n.prototype.buildFooter=function(){var t=this,i=e.$("<div/>").addClass("coveo-folding-footer").appendTo(this.element.parentElement);if(this.result.moreResults){this.showMore=e.$("<div/>").addClass("coveo-folding-footer-section-for-less").appendTo(i).fastClick(function(){return t.showMoreResults()}),this.showLess=e.$("<div/>").addClass("coveo-folding-footer-section-for-more").appendTo(i).fastClick(function(){return t.showLessResults()});var n=e.$("<div><span class='coveo-folding-footer-icon'></span></div>").addClass("coveo-more"),o=e.$("<div><span class='coveo-folding-footer-icon'></span></div>").addClass("coveo-less"),s=e.$("<a/>").addClass("coveo-folding-show-more").text(this.options.moreCaption),r=e.$("<a/>").addClass("coveo-folding-show-less").text(this.options.lessCaption);this.showMore.append(s),this.showLess.append(r),this.showMore.append(n),this.showLess.append(o)}},n.prototype.updateElementVisibility=function(t){this.normalCaption&&this.normalCaption.fastToggle(!this.showingMoreResults&&this.result.childResults.length>0),this.expandedCaption&&this.expandedCaption.fastToggle(this.showingMoreResults),this.onlyOneMessageCaption.fastToggle(t&&1==t),this.showMore&&(this.showMore.fastToggle(!this.showingMoreResults&&!e.Utils.exists(this.moreResultsDeferred)),this.showLess.fastToggle(this.showingMoreResults)),e.$(this.element).find(".coveo-show-if-normal").fastToggle(!this.showingMoreResults),e.$(this.element).find(".coveo-show-if-expanded").fastToggle(this.showingMoreResults)},n.prototype.scrollToResultElement=function(){var i=e.$(this.element).closest(".CoveoResult").offset(),n=e.$(this.root).find("."+t.Component.computeCssClassNameForType(t.ResultList.ID)),o=!1;if(0!=n.length){var s=n.coveo(),r=s.options.mobileScrollContainer||s.options.infiniteScrollContainer,a=r.scrollHeight>e.$(r).height();a&&(o=!0,e.$(r).animate({scrollTop:r.scrollTop+i.top-(e.DeviceUtils.isMobileDevice()?50:0)}))}i.top<e.$(window).scrollTop()&&!o&&e.$("html, body").animate({scrollTop:i.top})},n.prototype.displayThoseResults=function(t){var i=this;this.results.empty(),e._.each(t,function(e){i.renderChildResult(e)})},n.prototype.renderChildResult=function(t){var i=e.$(this.options.resultTemplate.instantiateToElement(t)).addClass("coveo-child-result").appendTo(this.results);i.toggleClass("coveo-normal-child-result",!this.showingMoreResults),i.toggleClass("coveo-expanded-child-result",this.showingMoreResults),this.autoCreateComponentsInsideResult(i.get(0),t)},n.prototype.autoCreateComponentsInsideResult=function(i,n){e.Assert.exists(i);var o=this.searchInterface.options,s=e.$.extend({},{options:o},this.getBindings(),{result:n});t.CoveoJQuery.automaticallyCreateComponentsInside(i,s)},n.prototype.cancelAnyPendingShowMore=function(){this.moreResultsDeferred&&this.moreResultsDeferred.reject(),e.Assert.doesNotExists(this.moreResultsDeferred),e.Assert.doesNotExists(this.waitAnimation)},n.ID="ResultFolding",n.options={resultTemplate:t.ComponentOptions.buildTemplateOption({defaultFunction:function(){return new t.DefaultResultTemplate}}),normalCaption:t.ComponentOptions.buildLocalizedStringOption(),expandedCaption:t.ComponentOptions.buildLocalizedStringOption(),moreCaption:t.ComponentOptions.buildLocalizedStringOption({postProcessing:function(e){return e||t.l("ShowMore")}}),lessCaption:t.ComponentOptions.buildLocalizedStringOption({postProcessing:function(e){return e||t.l("ShowLess")}}),oneResultCaption:t.ComponentOptions.buildLocalizedStringOption({postProcessing:function(e){return e||t.l("DisplayingTheOnlyMessage")}})},n}(t.Component);t.ResultFolding=i,e.Ui.CoveoJQuery.registerAutoCreateComponent(i)}(t=e.Ui||(e.Ui={}))}(Coveo||(Coveo={}));var Coveo;!function(e){var t;!function(e){function t(e){void 0===e&&(e=navigator);var t;return t=-1!=e.appVersion.indexOf("Win")?0:-1!=e.appVersion.indexOf("Mac")?1:-1!=e.appVersion.indexOf("X11")?2:-1!=e.appVersion.indexOf("Linux")?3:4}!function(e){e[e.WINDOWS=0]="WINDOWS",e[e.MACOSX=1]="MACOSX",e[e.UNIX=2]="UNIX",e[e.LINUX=3]="LINUX",e[e.UNKNOWN=4]="UNKNOWN"}(e.NAME||(e.NAME={}));e.NAME;e.get=t}(t=e.OSUtils||(e.OSUtils={}))}(Coveo||(Coveo={}));var Coveo;!function(e){var t;!function(t){var i=function(i){function n(o,s,r,a,l){i.call(this,o,n.ID,r),this.element=o,this.options=s,this.result=a,this.os=l,this.options=t.ComponentOptions.initComponentOptions(o,n,s),this.options=e.$.extend({},this.options,this.componentOptionsModel.get(e.Models.ComponentOptionsModel.attributesEnum.resultLink)),this.result=a||this.resolveResult(),e.Assert.exists(this.componentOptionsModel),e.Assert.exists(this.result),e.$(o).on("mousedown touchend",e.$.proxy(this.logOpenDocument,this)),this.bindOnClickIfNotUndefined()||this.bindOpenQuickViewIfNotUndefined()||this.setHrefIfNotAlready()||this.openLinkThatIsNotAnAnchor()}return __extends(n,i),n.prototype.bindOnClickIfNotUndefined=function(){var t=this;return void 0!=this.options.onClick?(e.$(this.element).fastClick(function(e){t.options.onClick.call(t,e,t.result)}),!0):!1},n.prototype.bindOpenQuickViewIfNotUndefined=function(){var t=this;return this.options.openQuickview?(e.$(this.element).fastClick(function(i){i.preventDefault();var n=e.$(t.element).parent().find(".CoveoQuickView .coveo-icon-for-quickview");0==n.length&&(n=e.$(t.element).closest(".CoveoQuickView .coveo-icon-for-quickview")),n.fastClick()}),!0):!1},n.prototype.openLinkThatIsNotAnAnchor=function(){var i=this;e.DeviceUtils.isPhonegap()?t.PhonegapUtils.bindOpenLinkInPhonegap(this.element,this.getResultUri()):this.elementIsAnAnchor()||e.$(this.element).fastClick(function(){i.options.alwaysOpenInNewWindow?i.options.openInOutlook&&i.hasOutlookField()?window.location.href=i.getResultUri():window.open(i.getResultUri(),"_blank"):window.location.href=i.getResultUri()})},n.prototype.setHrefIfNotAlready=function(){if(e.DeviceUtils.isPhonegap()&&this.elementIsAnAnchor()){var i=e.$(this.element).attr("href");return(void 0==i||""==i)&&(i=this.getResultUri()),e.$(this.element).removeAttr("href"),e.$(this.element).removeAttr("target"),t.PhonegapUtils.bindOpenLinkInPhonegap(this.element,i),!0}return this.elementIsAnAnchor()&&!e.Utils.isNonEmptyString(e.$(this.element).attr("href"))?(e.$(this.element).attr("href",this.getResultUri()),!this.options.alwaysOpenInNewWindow||this.options.openInOutlook&&this.hasOutlookField()||e.$(this.element).attr("target","_blank"),!0):!1},n.prototype.bindPhonegapClick=function(){e.DeviceUtils.isPhonegap()&&t.PhonegapUtils.bindOpenLinkInPhonegap(this.element,this.getResultUri())},n.prototype.logOpenDocument=function(){this.usageAnalytics.logClickEvent(t.AnalyticsActionCauseList.documentOpen,{documentURL:this.result.clickUri,documentTitle:this.result.title},this.result,this.root)},n.prototype.getResultUri=function(){return void 0==this.options.field&&this.options.openInOutlook&&this.setField(),void 0!=this.options.field?this.result.raw[e.Utils.getCoveoFieldKey(this.options.field)]:this.result.clickUri},n.prototype.elementIsAnAnchor=function(){return"A"==this.element.tagName},n.prototype.setField=function(){var t=e.Utils.exists(this.os)?this.os:e.OSUtils.get();1==t&&this.hasOutlookField()?this.options.field="@sysoutlookformacuri":0==t&&this.hasOutlookField()&&(this.options.field="@sysoutlookuri")},n.prototype.hasOutlookField=function(){var t=e.Utils.exists(this.os)?this.os:e.OSUtils.get();return 1==t&&void 0!=this.result.raw.sysoutlookformacuri?!0:0==t&&void 0!=this.result.raw.sysoutlookuri?!0:!1},n.ID="ResultLink",n.options={field:t.ComponentOptions.buildFieldOption(),openInOutlook:t.ComponentOptions.buildBooleanOption({defaultValue:!1}),openQuickview:t.ComponentOptions.buildBooleanOption({defaultValue:!1}),alwaysOpenInNewWindow:t.ComponentOptions.buildBooleanOption({defaultValue:!1})},n}(t.Component);t.ResultLink=i,t.CoveoJQuery.registerAutoCreateComponent(i)}(t=e.Ui||(e.Ui={}))}(Coveo||(Coveo={}));var Coveo;!function(e){var t;!function(t){var i=function(i){function n(o,s,r){var a=this;i.call(this,o,n.ID,r),this.element=o,this.options=s,this.bindings=r,this.options=t.ComponentOptions.initComponentOptions(o,n,s),this.preferencePanel=e.$(this.element).parents("."+t.Component.computeCssClassNameForType(t.PreferencesPanel.ID)),this.preferencePanelLocalStorage=new e.LocalStorageUtils(n.ID),this.mergeLocalPreferencesWithStaticPreferences(),this.bindPreferencePanelEvent(),this.bindBreadcrumbEvent(),this.bindQueryEvent(),e.$(this.root).one(e.Events.InitializationEvents.afterComponentsInitialization,function(){a.createDom()});var l=this.queryStateModel.getEventName(e.Models.Model.eventTypes.changeOne+e.Models.QueryStateModel.attributesEnum.t);e.$(this.root).one(l,function(){a.fromPreferencesToCheckboxInput()})}return __extends(n,i),n.prototype.createDom=function(){this.buildTitle(),this.buildCheckboxesInput(),this.options.showAdvancedFilters&&this.buildAdvancedFilters()},n.prototype.save=function(){this.fromCheckboxInputToPreferences();var t=e._.omit(this.preferences,"tab");this.logger.info("Saving preferences",t),this.preferencePanelLocalStorage.save(t)},n.prototype.exitWithoutSave=function(){this.fromPreferencesToCheckboxInput()},n.prototype.bindPreferencePanelEvent=function(){var t=this;this.bind.on(this.preferencePanel,e.Events.PreferencesPanelEvents.savePreferences,function(){return t.save()}),this.bind.on(this.preferencePanel,e.Events.PreferencesPanelEvents.exitPreferencesWithoutSave,function(){return t.exitWithoutSave()})},n.prototype.bindBreadcrumbEvent=function(){this.options.includeInBreadcrumb&&(this.bind.onRoot(e.Events.BreadcrumbEvents.populateBreadcrumb,e.$.proxy(this.handlePopulateBreadcrumb,this)),this.bind.onRoot(e.Events.BreadcrumbEvents.clearBreadcrumb,e.$.proxy(this.handleClearBreadcrumb,this)))},n.prototype.bindQueryEvent=function(){this.bind.onRoot(e.Events.QueryEvents.buildingQuery,e.$.proxy(this.handleBuildingQuery,this))},n.prototype.handleBuildingQuery=function(t,i){e._.each(this.getActiveFilters(),function(e){i.queryBuilder.advancedExpression.add(e.expression)})},n.prototype.handlePopulateBreadcrumb=function(i,n){var o=this.getActiveFilters();if(e.Utils.isNonEmptyArray(o)){var s=e.$("<div/>").addClass("coveo-results-filter-preferences-breadcrumb");e.$("<span/>").addClass("coveo-title").text(t.l("FiltersInYourPreferences")+":").appendTo(s);for(var r=e.$("<span/>").addClass("coveo-values").appendTo(s),a=0;a<o.length;a++)0!=a&&e.$("<span/>").addClass("coveo-separator").text(", ").appendTo(r),this.buildBreadcrumb(o[a]).appendTo(r);n.breadcrumbs.push({element:s.get(0)})}},n.prototype.handleClearBreadcrumb=function(){e._.each(this.getActiveFilters(),function(e){e.selected=!1}),this.fromPreferencesToCheckboxInput()},n.prototype.buildTitle=function(){e.$(this.element).append(e.$("<div class='coveo-title'>"+t.l("ResultsFilteringExpression")+"</div>"))},n.prototype.buildAdvancedFilters=function(){var i=this;this.advancedFilters=e.$("<div>"+t.l("Create")+"</div>").addClass("coveo-advanced-filters"),this.buildAdvancedFilterInput(),this.buildAdvancedFilterFormValidate(),this.advancedFiltersBuilder=e.$("<div class='coveo-advanced-filters-builder'></div>"),this.advancedFiltersBuilder.append(this.advancedFilterFormValidate),this.advancedFilters.fastClick(function(){return i.openAdvancedFilterSectionOrSaveFilters()});var n=e.$("<a href='http://onlinehelp.coveo.com/en/ces/7.0/user/user_help.htm' target='_blank' class='coveo-online-help'>?</a>");e.$(this.element).find(".coveo-title").first().after(n,this.advancedFilters),e.$(this.element).append(this.advancedFiltersBuilder)},n.prototype.buildAdvancedFilterInput=function(){this.advancedFiltersTextInputCaption=new t.PreferencesPanelTextAreaInput([{label:t.l("Caption"),placeholder:t.l("EnterExpressionName"),otherAttribute:"required"}],n.ID+"-advanced-caption"),this.advancedFiltersTextInputExpression=new t.PreferencesPanelTextAreaInput([{label:t.l("Expression"),placeholder:t.l("EnterExpressionToFilterWith"),otherAttribute:"required"}],n.ID+"-advanced-expression"),this.advancedFiltersTabSelect=new t.PreferencePanelMultiSelectInput({label:t.l("Tab"),placeholder:t.l("SelectTab")},this.getAllTabs(),n.ID+"-multiselect")},n.prototype.buildAdvancedFilterFormValidate=function(){var t=this;this.advancedFilterFormValidate=e.$("<form></form>");var i=e.$("<input type='submit' />"),n=e.$("<span class='coveo-save'></span>"),o=e.$("<span class='coveo-close'></span>"),s=e.$("<div class='coveo-choice-container coveo-close-and-save'></div>").append(n,o);this.advancedFilterFormValidate.append(this.advancedFiltersTextInputCaption.build().addClass("coveo-caption"),this.advancedFiltersTabSelect.build().addClass("coveo-tab"),this.advancedFiltersTextInputExpression.build().addClass("coveo-expression"),s,i),n.fastClick(function(){i.click()}),o.fastClick(function(){t.advancedFiltersBuilder.toggleClass("coveo-active")}),this.advancedFilterFormValidate.find("textarea").keyup(function(e){13==e.keyCode&&i.click()}),this.advancedFilterFormValidate.submit(function(e){t.validateAndSaveAdvancedFilter(e)})},n.prototype.getAdvancedFiltersTextInputToBuild=function(){return[{label:t.l("Caption"),otherAttribute:"required"},{label:t.l("Expression"),otherAttribute:"required"}]},n.prototype.getAllTabs=function(){var i=t.Component.getComponentRef("Tab");if(i){var n=e.$(this.root).find("."+t.Component.computeCssClassNameForType(i.ID));return e._.map(n,function(t){var i=e.$(t).coveo();return i.options.uniqueId})}},n.prototype.getPreferencesBoxInputToBuild=function(){return e._.map(this.preferences,function(e){return{label:e.caption,tab:e.tab,expression:e.expression}})},n.prototype.buildCheckboxesInput=function(){var i=this;void 0!=this.preferenceContainer&&this.preferenceContainer.remove();var o=this.getPreferencesBoxInputToBuild();e.Utils.isNonEmptyArray(o)&&(this.preferencePanelCheckboxInput=new t.PreferencesPanelCheckboxInput(o,n.ID),this.preferenceContainer=e.$("<div class='coveo-choices-container'></div>"),this.preferenceContainer.append(this.preferencePanelCheckboxInput.build()),this.preferenceContainer.find(".coveo-choice-container").append("<div class='coveo-section coveo-section-edit-delete'></div>"),e.$(this.element).append(this.preferenceContainer),this.buildEditAdvancedFilter(),this.buildDeleteAdvancedFilter(),this.fromPreferencesToCheckboxInput(),this.preferenceContainer.find("input").change(function(t){i.save();var n=i.preferences[e.$(t.target).val()];i.fromFilterToAnalyticsEvent(n,n.selected?"selected":"unselected"),i.queryController.executeQuery()}))},n.prototype.buildDeleteAdvancedFilter=function(){var t=this;e._.each(this.preferences,function(i){if(i.custom){var n=e.$("<span class='coveo-delete'><span class='coveo-icon'></span></span>"),o=t.getFilterElementByCaption(i.caption),s=o.closest(".coveo-section").siblings(".coveo-section-edit-delete");n.appendTo(s),n.fastClick(function(){t.confirmDelete(i,o)})}})},n.prototype.buildEditAdvancedFilter=function(){var t=this;e._.each(this.preferences,function(i){if(i.custom){var n=e.$("<span class='coveo-edit'><span class='coveo-icon'></span></span>"),o=t.getFilterElementByCaption(i.caption),s=o.closest(".coveo-section").siblings(".coveo-section-edit-delete");n.appendTo(s),n.fastClick(function(){t.editElement(i,o)})}})},n.prototype.buildBreadcrumb=function(t){var i=this,n=e.$("<span/>").addClass("coveo-value");return e.$("<span/>").addClass("coveo-caption").text(t.caption).appendTo(n),e.$("<span/>").addClass("coveo-clear").appendTo(n),n.fastClick(function(){t.selected=!1,i.fromFilterToAnalyticsEvent(t,"cleared from breadcrumb"),i.fromPreferencesToCheckboxInput(),i.queryController.executeQuery()}),n},n.prototype.confirmDelete=function(e,i){confirm(t.l("AreYouSureDeleteFilter",e.caption,e.expression))&&(this.deleteFilterPreference(e,i),this.fromFilterToAnalyticsEvent(e,"deleted"),this.queryController.executeQuery())},n.prototype.editElement=function(e,t){var i=this.preferences[e.caption].caption,n=this.preferences[e.caption].tab,o=this.preferences[e.caption].expression;this.deleteFilterPreference(e,t),this.openAdvancedFilterSectionOrSaveFilters(),this.populateEditSection({tab:n,caption:i,expression:o}),this.advancedFiltersBuilder.find("input[type=text]").first().focus()},n.prototype.populateEditSection=function(e){void 0===e&&(e={tab:[""],caption:"",expression:""}),this.advancedFiltersTextInputCaption.setValue(t.l("Caption"),e.caption),this.advancedFiltersTextInputExpression.setValue(t.l("Expression"),e.expression),this.advancedFiltersTabSelect.setValues(e.tab)},n.prototype.deleteFilterPreference=function(e,t){this.preferencePanelLocalStorage.remove(e.caption),delete this.preferences[e.caption],t.closest(".coveo-choice-container").remove()},n.prototype.openAdvancedFilterSectionOrSaveFilters=function(){this.advancedFiltersBuilder.hasClass("coveo-active")?this.advancedFilterFormValidate.find("input[type=submit]").click():(this.populateEditSection(),this.advancedFiltersBuilder.toggleClass("coveo-active"))},n.prototype.validateAndSaveAdvancedFilter=function(t){t.preventDefault(),this.advancedFiltersBuilder.removeClass("coveo-active");var i=this.advancedFiltersTextInputCaption.getValues()[0],n=this.advancedFiltersTextInputExpression.getValues()[0],o=this.advancedFiltersTabSelect.getValues();this.preferences[i]={caption:i,custom:!0,expression:n,tab:o,selected:!0},this.buildCheckboxesInput(),this.save(),this.queryStateModel.set(e.Models.QueryStateModel.attributesEnum.t,this.getActiveTab()),this.advancedFiltersTextInputCaption.reset(),this.advancedFiltersTextInputExpression.reset(),this.advancedFiltersTabSelect.reset(),this.advancedFiltersBuilder.appendTo(this.element),this.fromFilterToAnalyticsEvent(this.preferences[i],"saved"),this.queryController.executeQuery()},n.prototype.fromPreferencesToCheckboxInput=function(){var t=this;e._.each(this.getActiveFilters(),function(e){t.preferencePanelCheckboxInput.select(e.caption)}),e._.each(this.getInactiveFilters(),function(e){t.preferencePanelCheckboxInput.unselect(e.caption)})},n.prototype.fromCheckboxInputToPreferences=function(){var t=this.preferencePanelCheckboxInput.getSelecteds();e._.each(this.preferences,function(i){i.selected=e._.contains(t,i.caption)?!0:!1})},n.prototype.getActiveFilters=function(){var t=this,i=this.getActiveTab();return e._.filter(this.preferences,function(e){return e.selected&&t.filterIsInActiveTab(e,i)})},n.prototype.getInactiveFilters=function(){var t=this,i=this.getActiveTab();return e._.filter(this.preferences,function(e){return!e.selected||!t.filterIsInActiveTab(e,i)})},n.prototype.getActiveTab=function(){return this.queryStateModel.get(e.Models.QueryStateModel.attributesEnum.t)},n.prototype.filterIsInActiveTab=function(t,i){return t.tab=e._.compact(t.tab),e._.contains(t.tab,i)||e.Utils.isEmptyArray(t.tab)},n.prototype.getFilterElementByCaption=function(e){return this.preferenceContainer.find("input[value='"+e+"']").parent()},n.prototype.fromResultsFilterOptionToResultsPreferenceInterface=function(t){void 0===t&&(t=this.options.filters);var i={};return e._.each(this.options.filters,function(e,t){i[t]={expression:e.expression,tab:e.tab,selected:!1,custom:!1,caption:t}}),i},n.prototype.mergeLocalPreferencesWithStaticPreferences=function(){var t=this.fromResultsFilterOptionToResultsPreferenceInterface(),i=this.preferencePanelLocalStorage.load(),n=e._.filter(i,function(i){var n=i.custom,o=e._.find(t,function(e){return e.caption==i.caption});return n||void 0!=o}),o={};e._.each(n,function(e){o[e.caption]={expression:e.expression,tab:e.tab,selected:e.selected,custom:e.custom,caption:e.caption}}),this.preferences=e.$.extend(!0,{},t,o)},n.prototype.fromFilterToAnalyticsEvent=function(e,i){this.usageAnalytics.logSearchEvent(t.AnalyticsActionCauseList.customfiltersChange,{customFilterName:e.caption,customFilterExpression:e.expression,customFilterType:i})},n.ID="ResultsFiltersPreferences",n.options={includeInBreadcrumb:t.ComponentOptions.buildBooleanOption({defaultValue:!0}),showAdvancedFilters:t.ComponentOptions.buildBooleanOption({defaultValue:!0})},n}(t.Component);t.ResultsFiltersPreferences=i,t.CoveoJQuery.registerAutoCreateComponent(i)}(t=e.Ui||(e.Ui={}))}(Coveo||(Coveo={}));var Coveo;!function(e){var t;!function(t){var i=function(i){function n(o,s,r){var a=this;i.call(this,o,n.ID,r),this.element=o,this.options=s,this.bindings=r,this.options=t.ComponentOptions.initComponentOptions(o,n,s),this.preferencePanel=e.$(this.element).parents("."+t.Component.computeCssClassNameForType(t.PreferencesPanel.ID)),this.preferencePanelLocalStorage=new e.LocalStorageUtils(n.ID),e.Assert.exists(this.componentOptionsModel),e.Assert.exists(window.localStorage),e.Assert.isLargerOrEqualsThan(1,this.preferencePanel.length),this.preferences=this.preferencePanelLocalStorage.load()||{},t.ComponentOptions.initComponentOptions(this.element,n,this.preferences),this.updateComponentOptionsModel(),this.bind.on(this.preferencePanel,e.Events.PreferencesPanelEvents.savePreferences,function(){return a.save()}),this.bind.on(this.preferencePanel,e.Events.PreferencesPanelEvents.exitPreferencesWithoutSave,function(){return a.exitWithoutSave()}),this.buildTitle(),this.buildCheckboxesInput()}return __extends(n,i),n.prototype.save=function(){this.fromCheckboxInputToPreferences(),this.logger.info("Saving preferences",this.preferences),this.preferencePanelLocalStorage.save(this.preferences),this.updateComponentOptionsModel()},n.prototype.exitWithoutSave=function(){this.fromPreferencesToCheckboxInput()},n.prototype.updateComponentOptionsModel=function(){this.componentOptionsModel.set(e.Models.ComponentOptionsModel.attributesEnum.resultLink,this.preferences)},n.prototype.buildTitle=function(){e.$(this.element).append(e.$("<div class='coveo-title'>"+t.l("LinkOpeningSettings")+"</div>"))},n.prototype.buildCheckboxesInput=function(){var i=this;this.preferencePanelCheckboxInput=new t.PreferencesPanelCheckboxInput([{label:t.l("OpenInOutlookWhenPossible")},{label:t.l("AlwaysOpenInNewWindow")}],n.ID);var o=e.$("<div class='coveo-choices-container'></div>");o.append(this.preferencePanelCheckboxInput.build()),o.find("input").change(function(e){i.fromPreferenceChangeEventToUsageAnalyticsLog(e),i.save(),i.queryController.executeQuery()}),e.$(this.element).append(o),this.fromPreferencesToCheckboxInput()},n.prototype.fromCheckboxInputToPreferences=function(){var i=this.preferencePanelCheckboxInput.getSelecteds();this.preferences={openInOutlook:!1,alwaysOpenInNewWindow:!1},e._.contains(i,t.l("OpenInOutlookWhenPossible"))&&(this.preferences.openInOutlook=!0),e._.contains(i,t.l("AlwaysOpenInNewWindow"))&&(this.preferences.alwaysOpenInNewWindow=!0)},n.prototype.fromPreferencesToCheckboxInput=function(){this.preferences.openInOutlook&&this.preferencePanelCheckboxInput.select(t.l("OpenInOutlookWhenPossible")),this.preferences.alwaysOpenInNewWindow&&this.preferencePanelCheckboxInput.select(t.l("AlwaysOpenInNewWindow"))},n.prototype.fromPreferenceChangeEventToUsageAnalyticsLog=function(i){var n=e.$(i.target).is(":checked")?"selected":"unselected",o=e.$(i.target).val();this.usageAnalytics.logSearchEvent(t.AnalyticsActionCauseList.preferencesChange,{preferenceName:o,preferenceType:n})},n.ID="ResultsPreferences",n.options={showOpenInOutlook:t.ComponentOptions.buildBooleanOption({defaultValue:!0}),loadBooleanFromAttribute:t.ComponentOptions.buildBooleanOption({defaultValue:!0})},n}(t.Component);t.ResultsPreferences=i,t.CoveoJQuery.registerAutoCreateComponent(i)}(t=e.Ui||(e.Ui={}))}(Coveo||(Coveo={}));var Coveo;!function(e){var t;!function(t){var i=function(i){function n(o,s,r,a,l){i.call(this,o,n.ID,r),this.element=o,this.options=s,this.result=a,this.os=l,this.options=t.ComponentOptions.initComponentOptions(o,n,s),this.options=e.$.extend({},this.options),this.result=a||this.resolveResult(),e.Assert.exists(this.componentOptionsModel),e.Assert.exists(this.result),this.options.field||this.logger.error("You must specify a field to the ResultTagging component"),this.tags=this.result.raw[e.Utils.getCoveoFieldKey(this.options.field)]||[],this.tagZone=e.$("<div></div>").addClass("coveo-tag-zone").appendTo(e.$(o)),e.$(o).append(this.buildTagIcon()),this.autoCompleteZone=e.$("<div></div>").addClass("coveo-auto-complete-zone").appendTo(e.$(o)),e.$(this.autoCompleteZone).append(this.buildTextBox()),e.$(this.autoCompleteZone).append(this.buildAddIcon()),e.$(this.autoCompleteZone).append(this.buildClearIcon()),this.buildExistingTags()
}return __extends(n,i),n.prototype.buildExistingTags=function(){var t=this;this.tags&&e._.each(this.tags,function(i){e.$(t.tagZone).append(t.buildTagValue(i))})},n.prototype.buildTagIcon=function(){var i=this,n=e.$("<div></div>").addClass("coveo-add-tag"),o=e.$("<span></span>").text(t.l("EnterTag")).addClass("coveo-add-tag-text");return n.append(e.$("<span></span>").addClass("coveo-add-tag-icon").fastClick(function(){return setTimeout(e.$.proxy(i.focusOnTextBox,i),20)})),n.append(o),n.attr("title",t.l("EnterTag")),n},n.prototype.focusOnTextBox=function(){this.textBox.focus()},n.prototype.buildTagValue=function(t){var i=this,n=e.$("<div></div>").addClass("coveo-tag");this.buildShortenedTagWithTitle(t).appendTo(n);var o=e.$("<span></span>").addClass("coveo-delete-icon").appendTo(n);return o.fastClick(function(){return i.doRemoveTag(n,t.toLowerCase())}),n},n.prototype.buildShortenedTagWithTitle=function(t){var i=e.StringUtils.removeMiddle(t,16,"..."),n=e.$("<a></a>").text(i).attr("title",t).attr("href","javascript:void;");return this.bindFacetEventOnValue(n,t),n},n.prototype.buildTextBox=function(){var i=this;return this.textBox=e.$("<input/>").attr("type","text").addClass("coveo-add-tag-textbox").attr("placeholder",t.l("EnterTag")),this.autoCompletePopup=e.$("<div></div>").addClass(n.AUTO_COMPLETE_CLASS).appendTo(e.$(this.autoCompleteZone)),this.manageAutocompleteAutoHide(),this.textBox.keyup(function(t){38==t.keyCode||40==t.keyCode||13==t.keyCode?i.manageUpDownEnter(t.keyCode):e.KeyboardUtils.isArrowKeyPushed(t.keyCode)||i.populateSuggestions(),e.$(i.element).removeClass("coveo-error")}),this.textBox.fastClick(function(){i.populateSuggestions()}),this.textBox},n.prototype.buildAddIcon=function(){var t=this;return e.$("<div></div>").addClass("coveo-add-tag-tick-icon").append(e.$("<span></span>")).fastClick(function(){return t.doAddTag()})},n.prototype.buildClearIcon=function(){var t=this;return e.$("<div></div>").addClass("coveo-clear-icon").append(e.$("<span></span>")).fastClick(function(){return t.textBox.val("")})},n.prototype.bindFacetEventOnValue=function(i,n){var o=this,s=e.Models.QueryStateModel.getFacetId(this.options.field),r=this.queryStateModel.get(s),a=this.componentStateModel.get(s),l=e._.filter(a,function(e){return!e.disabled}).length>0;null!=r&&l&&(e.$(i).on("click",function(){e._.contains(r,n)?o.queryStateModel.set(s,e._.without(r,n)):o.queryStateModel.set(s,e._.union(r,[n])),o.queryController.deferExecuteQuery({beforeExecuteQuery:function(){return o.usageAnalytics.logSearchEvent(t.AnalyticsActionCauseList.documentTag,{facetId:o.options.field,facetValue:n})}})}),e._.contains(r,n)&&e.$(i).addClass("coveo-selected"),e.$(i).addClass("coveo-clickable"))},n.prototype.clearPopup=function(){this.autoCompletePopup.hide(),this.autoCompletePopup.empty()},n.prototype.showPopup=function(){this.autoCompletePopup.show()},n.prototype.populateSuggestions=function(){var t=this;this.autoCompletePopup.width(this.textBox.innerWidth());{var i=this.queryController.getEndpoint(),n=this.textBox.val(),o={field:this.options.field,ignoreAccents:!0,sortCriteria:"occurences",maximumNumberOfValues:this.options.suggestBoxSize,queryOverride:"@sysuri",pattern:this.buildRegEx(n),patternType:"RegularExpression"};i.listFieldValues(o).done(function(i){t.clearPopup(),e._.each(i,function(e){t.autoCompletePopup.append(t.buildSelectableValue(e.lookupValue))}),t.showPopup()})}},n.prototype.manageAutocompleteAutoHide=function(){var t,i=this;this.textBox.on("mouseover",function(){window.clearTimeout(t)}),this.autoCompletePopup.mouseout(function(o){e.$(o.target).hasClass(n.AUTO_COMPLETE_CLASS)&&(t=window.setTimeout(e.$.proxy(i.clearPopup,i),i.options.autoCompleteTimer))}),this.autoCompletePopup.mouseenter(function(){window.clearTimeout(t)}),e.$(this.element).mouseenter(function(){i.clearPopup(),e.$(i.element).addClass("coveo-opened")}),e.$(this.element).closest(".CoveoResult").mouseleave(function(){i.clearPopup(),""==i.textBox.val()&&e.$(i.element).removeClass("coveo-opened")}),e.$(this.element).closest(".CoveoResult").focusout(function(t){""!=i.textBox.val()&&e.$(t.target).closest(".CoveoResult")!=e.$(i.element).closest(".CoveoResult")&&e.$(i.element).addClass("coveo-error")}),e.$(this.element).closest(".CoveoResult").focusin(function(){e.$(i.element).removeClass("coveo-error")})},n.prototype.buildRegEx=function(t){var i=this;return"(?=.*"+t+")"+e._.map(this.tags,function(e){return i.buildTermToExclude(e)}).join("")+".*"},n.prototype.buildTermToExclude=function(e){return"(?!^"+e+"$)"},n.prototype.manageUpDownEnter=function(t){var i=e.$(this.element).find(".coveo-selectable");if(13==t)return this.doAddTag(),void 0;if(i.length>0){var n=this.computeNextIndex(t,i);n=Math.max(0,n),n=Math.min(i.length-1,n);var o=e.$(i.get(n));o.addClass("coveo-selected"),this.textBox.val(o.text())}},n.prototype.computeNextIndex=function(t,i){var n=0;return e._.each(i,function(i,o){e.$(i).hasClass("coveo-selected")&&(38==t?n=o-1:40==t&&(n=o+1),e.$(i).removeClass("coveo-selected"))}),n},n.prototype.buildSelectableValue=function(t){var i=this,n=e.$("<div></div>").append(this.buildShortenedTagWithTitle(t));return n.addClass("coveo-selectable"),n.fastClick(function(){i.doAddTagWithValue(t)}),n},n.prototype.doRemoveTag=function(t,i){var n=this,o={fieldName:this.options.field,fieldValue:i,doAdd:!1,uniqueId:this.result.uniqueId},s=this.queryController.getEndpoint().tagDocument(o);s.done(function(){n.tags.splice(e.$.inArray(i,n.tags),1),t.remove()})},n.prototype.doAddTagWithValue=function(t){var i=this;e._.each(t.split(","),function(e){i.doAddSingleTagValue(e)})},n.prototype.doAddSingleTagValue=function(t){var i=this;if(this.clearPopup(),e.$.inArray(t,this.tags)>-1)return e.$(this.element).addClass("coveo-error"),void 0;this.tags.push(t);var n={fieldName:this.options.field,fieldValue:t,doAdd:!0,uniqueId:this.result.uniqueId},o=this.queryController.getEndpoint().tagDocument(n);o.done(function(){i.tagZone.append(i.buildTagValue(t)),i.textBox.val(""),e.$(i.element).removeClass("coveo-error")}).fail(function(){i.tags=e._.without(i.tags,e._.findWhere(i.tags,t))})},n.prototype.doAddTag=function(){var e=this.textBox.val().toLowerCase().trim();this.doAddTagWithValue(e)},n.ID="ResultTagging",n.options={field:t.ComponentOptions.buildStringOption(),suggestBoxSize:t.ComponentOptions.buildNumberOption({defaultValue:5}),autoCompleteTimer:t.ComponentOptions.buildNumberOption({defaultValue:2e3})},n.AUTO_COMPLETE_CLASS="coveo-auto-complete",n}(t.Component);t.ResultTagging=i,t.CoveoJQuery.registerAutoCreateComponent(i)}(t=e.Ui||(e.Ui={}))}(Coveo||(Coveo={}));var Coveo;!function(e){var t;!function(t){var i=function(i){function n(o,s,r){i.call(this,o,n.ID,r),this.element=o,this.options=s,this.options=t.ComponentOptions.initComponentOptions(o,n,s),e.$(this.root).on(e.Events.InitializationEvents.afterInitialization,e.$.proxy(this.init,this))}return __extends(n,i),n.prototype.init=function(){var t=this;this.menu=this.buildMenu(),e.$("<span/>").addClass("coveo-settings-icon").appendTo(this.element),e.$(this.element).fastClick(function(){t.toggleMenu()}),this.settingsButton=e.$(this.element);var i;e.$([this.settingsButton[0],this.menu[0]]).mouseleave(function(){i=setTimeout(function(){t.menu.detach()},t.options.menuDelay)}).mouseenter(function(){clearTimeout(i)})},n.prototype.buildMenu=function(){var t=e.$("<div/>").addClass("coveo-advanced-menu"),i=e._.map(this.options.includeInMenu,function(t){return e.$(t).coveo()});return t.append(this.buildSection(i)),t},n.prototype.buildSection=function(t){var i=this,n=e._.map(t,function(n){var o=e._.filter(t,function(t){return!e.Utils.objectEqual(t,n)});if(void 0!=n){var s=e.$("<div/>").addClass("coveo-section").addClass(n.getCssClass());e.$("<div/>").addClass("coveo-icon").appendTo(s);var r=e.$("<div>").addClass("coveo-items").appendTo(s);e._.each(n.getMenuItems(),function(t){var s=e._.filter(n.getMenuItems(),function(e){return e.text!=t.text});r.append(i.buildLine(t.text,t.onOpen,o,s))})}return s});return e._.reduce(n,function(e,t){return e.add(t)},e.$())},n.prototype.buildLine=function(t,i,n,o){var s=this,r=o.concat(e._.compact(e._.flatten(e._.map(n,function(e){return e?e.getMenuItems():void 0}),!0)));return e.$("<div/>").addClass("coveo-item").text(t).fastClick(function(){s.menu.detach(),i(),e._.invoke(r,"onClose")})},n.prototype.toggleMenu=function(){this.menu.is(":visible")?this.menu.detach():e.JQueryUtils.positionPopup(this.menu,e.$(this.element),e.$(this.root),e.$(this.root),this.getPopupPositioning())},n.prototype.getPopupPositioning=function(){return{horizontal:4,vertical:2,verticalOffset:8}},n.ID="Settings",n.options={includeInMenu:t.ComponentOptions.buildListOption({defaultValue:[]}),menuDelay:t.ComponentOptions.buildNumberOption({defaultValue:300})},n}(t.Component);t.Settings=i,t.CoveoJQuery.registerAutoCreateComponent(i)}(t=e.Ui||(e.Ui={}))}(Coveo||(Coveo={}));var Coveo;!function(e){var t;!function(t){var i=function(i){function n(t,o,s){i.call(this,t,n.ID,s),this.element=t,this.options=o,this.dialogBoxContent=this.buildContent(),e.$(t).append(this.dialogBoxContent),e.$(this.root).on(e.Events.QueryEvents.querySuccess,e.$.proxy(this.handleProcessNewQueryResults,this))}return __extends(n,i),n.prototype.open=function(){e.$("."+t.Component.computeMemberNameForType(n.ID)).height(137)},n.prototype.close=function(){e.$(this.element).height(0)},n.prototype.getCssClass=function(){return"coveo-share-query"},n.prototype.getMenuItems=function(){var e=this;return[{text:t.l("ShareQuery"),onOpen:function(){return e.open()},onClose:function(){return e.close()}}]},n.prototype.handleProcessNewQueryResults=function(t,i){e.Assert.exists(i),e.Assert.exists(i.results);var n=i.query;this.linkToThisQuery.val(window.location.href),this.completeQuery.val(e.$.trim(this.outputIfNotNull(n.q)+" "+this.outputIfNotNull(n.aq)+" "+this.outputIfNotNull(n.cq))),this.logger.trace("Received query results from new query",n)},n.prototype.outputIfNotNull=function(e){return e?"("+e+")":""},n.prototype.buildContent=function(){var i=this,n=e.$("<div/>").addClass("coveo-query-summary-info");n.append(e.$("<span/>").addClass("coveo-query-summary-info-title").text(t.l("ShareQuery")));var o=e.$("<div/>").addClass("coveo-query-summary-info-close").append("<span/>");o.fastClick(function(){return i.close()}),n.append(o);var s=e.$("<div/>").addClass("coveo-query-summary-info-boxes");return this.linkToThisQuery=e.$("<input/>").attr("type","text").addClass("coveo-query-summary-info-input"),this.linkToThisQuery.fastClick(function(){return i.linkToThisQuery.select()}),this.completeQuery=e.$("<input/>").attr("type","text").addClass("coveo-query-summary-info-input"),s.append(this.buildTextBoxWithLabel(t.l("Link")+":",this.linkToThisQuery)),s.append(this.buildTextBoxWithLabel(t.l("CompleteQuery")+":",this.completeQuery)),s.appendTo(n),t.Component.pointElementsToDummyForm(n),n},n.prototype.buildTextBoxWithLabel=function(t,i){var n=e.$("<span/>").addClass("coveo-query-summary-info-label").text(t);return e.$("<div/>").append(n).append(i)},n.create=function(t,i,o){return e.Assert.exists(t),new n(t,i,o)},n.ID="ShareQuery",n.options={},n}(t.Component);t.ShareQuery=i,t.CoveoJQuery.registerAutoCreateComponent(i)}(t=e.Ui||(e.Ui={}))}(Coveo||(Coveo={}));var Coveo;!function(e){var t;!function(t){var i=function(i){function n(o,s,r){i.call(this,o,n.ID,r),this.element=o,this.options=s,this.options=t.ComponentOptions.initComponentOptions(o,n,s),e.Assert.isLargerOrEqualsThan(1,this.options.sortCriteria.length);var a=this.queryStateModel.getEventName(e.Models.Model.eventTypes.changeOne)+e.Models.QueryStateModel.attributesEnum.sort;e.$(this.root).on(a,e.$.proxy(this.handleQueryStateChanged,this)),e.$(this.root).on(e.Events.QueryEvents.buildingQuery,e.$.proxy(this.handleBuildingQuery,this)),this.bind.fastClick(e.$(this.element),this.handleClick),this.isToggle()&&e.$(this.element).append('<span class="coveo-icon" />'),this.updateAppearance()}return __extends(n,i),n.prototype.select=function(t,i){if(void 0===i&&(i=!1),t)this.currentCriteria=e._.find(this.options.sortCriteria,function(e){return e.direction==t});else if(e.Utils.exists(this.currentCriteria)){var n=e._.indexOf(this.options.sortCriteria,this.currentCriteria);e.Assert.check(n>=0),this.currentCriteria=this.options.sortCriteria[(n+1)%this.options.sortCriteria.length]}else this.currentCriteria=this.options.sortCriteria[0];this.queryStateModel.set(e.Models.QueryStateModel.attributesEnum.sort,this.currentCriteria.toString(),{silent:i})},n.prototype.disable=function(){e.$(this.element).addClass("coveo-tab-disabled"),i.prototype.disable.call(this)},n.prototype.enable=function(){e.$(this.element).removeClass("coveo-tab-disabled"),i.prototype.enable.call(this)},n.prototype.getCurrentCriteria=function(){return this.currentCriteria},n.prototype.handleQueryStateChanged=function(){var i=this.queryStateModel.get(e.Models.QueryStateModel.attributesEnum.sort);if(e.Utils.isNonEmptyString(i)){var n=t.SortCriteria.parse(i);this.currentCriteria=e._.find(this.options.sortCriteria,function(e){return n.equals(e)})}else this.currentCriteria=null;this.updateAppearance()},n.prototype.handleBuildingQuery=function(t,i){e.Assert.exists(i);var n=this.queryStateModel.get(e.Models.QueryStateModel.attributesEnum.sort);(n==e.Models.QueryStateModel.defaultAttributes.sort||this.isSelected())&&this.currentCriteria&&this.currentCriteria.putInQueryBuilder(i.queryBuilder)},n.prototype.handleClick=function(){var e=this,i=this.currentCriteria;this.select(),i!=this.currentCriteria&&this.queryController.deferExecuteQuery({beforeExecuteQuery:function(){return e.usageAnalytics.logSearchEvent(t.AnalyticsActionCauseList.resultsSort,{resultsSortBy:e.currentCriteria.sort+e.currentCriteria.direction})}})},n.prototype.isToggle=function(){return this.options.sortCriteria.length>1},n.prototype.isSelected=function(){return e.Utils.exists(this.currentCriteria)},n.prototype.updateAppearance=function(){if(e.$(this.element).toggleClass("coveo-selected",this.isSelected()),this.isToggle()){var t=this.currentCriteria?this.currentCriteria.direction:this.options.sortCriteria[0].direction;e.$(this.element).toggleClass("coveo-ascending","ascending"==t)}},n.prototype.match=function(t){return e._.any(this.options.sortCriteria,function(e){return t==e.toString()})},n.ID="Sort",n.options={sortCriteria:t.ComponentOptions.buildCustomListOption(function(i){return e._.map(i,function(e){return t.SortCriteria.parse(e)})})},n}(t.Component);t.Sort=i,t.CoveoJQuery.registerAutoCreateComponent(i)}(t=e.Ui||(e.Ui={}))}(Coveo||(Coveo={}));var Coveo;!function(e){var t;!function(t){var i=function(i){function n(o,s,r){i.call(this,o,t.ComponentOptions.initComponentOptions(o,n,s),r,n.ID),this.element=o,this.options=s,e.$(this.element).hide(),this.options.includeDemoSection&&this.buildAllDemo(),this.submit()}return __extends(n,i),n.prototype.getOrCreateContainerForDemo=function(){return this.demoContainer||(this.demoContainer=e.$("<div class='coveo-demo-section-container'></div>"),e.$(this.root).append(this.demoContainer)),this.demoContainer},n.prototype.buildAllDemo=function(){this.buildNewToCoveoSection(),this.buildDemoSection(),this.hideDemoSection()},n.prototype.buildDemoSection=function(){var i=this;this.demoCoveoSection=e.$("<div class='coveo-demo-section'></div>"),this.hideDemoSection();var n=e.$("<div class='coveo-demo-section-back-to-login'><span class='coveo-demo-section-arrow-backward'></span>"+t.l("GoBack")+"</div>");n.fastClick(function(){i.hideDemoSection()});var o=e.$("<div class='coveo-demo-section-logo'></div>"),s=e.$("<div class='coveo-demo-section-explanation'>"+t.l("AppIntro")+"</div>"),r=e.$("<button class='coveo-demo-section-try-it'>"+t.l("TryDemo")+"</button>");r.fastClick(function(){window.location.href="demo.html"});var a=e.$("<button class='coveo-demo-section-contact'>"+t.l("ContactUs")+"</button>");a.fastClick(function(){window.open("http://www.coveo.com/company/contact-us","_system")}),this.demoCoveoSection.append(n,o,s,r,a),this.getOrCreateContainerForDemo().append(this.demoCoveoSection)},n.prototype.buildNewToCoveoSection=function(){var i=this;this.newToCoveoSection=e.$("<div class='coveo-new-to-coveo-section'><h2>"+t.l("NewToCoveo")+"</h2><h3>"+t.l("LetUsHelpGetStarted")+"</h3><span class='coveo-demo-section-arrow-forward'></span></div>"),this.newToCoveoSection.fastClick(function(){return i.showDemoSection()}),this.getOrCreateCombined().append(this.newToCoveoSection)},n.prototype.showDemoSection=function(){this.getOrCreateContainerForDemo().addClass("coveo-active"),this.getOrCreateCombined().removeClass("coveo-active")},n.prototype.hideDemoSection=function(){this.getOrCreateContainerForDemo().removeClass("coveo-active"),this.getOrCreateCombined().addClass("coveo-active")},n.ID="StandaloneLogin",n.options={requirePageSettings:t.ComponentOptions.buildBooleanOption({defaultValue:!0}),includeDemoSection:t.ComponentOptions.buildBooleanOption({defaultValue:!0})},n}(t.Login);t.StandaloneLogin=i,t.CoveoJQuery.registerAutoCreateComponent(i)}(t=e.Ui||(e.Ui={}))}(Coveo||(Coveo={}));var Coveo;!function(e){var t;!function(t){var i=function(){function i(i,n,o){this.searchInterface=i,this.result=o,this.element=n.instantiateToElement(o),e.$(this.element).data("CoveoResult",o),t.Component.bindResultToElement(this.element,o)}return i.prototype.initialize=function(){var i=this.searchInterface.options,n=e.$.extend({},{options:i},this.searchInterface.getBindings(),{result:this.result});t.CoveoJQuery.automaticallyCreateComponentsInside(this.element,n)},i}();t.StandaloneResult=i}(t=e.Ui||(e.Ui={}))}(Coveo||(Coveo={}));var Coveo;!function(e){var t;!function(t){var i=function(i){function n(o,s,r){i.call(this,o,n.ID,r),this.options=s,this.menuIsOpen=!1,this.menuItemsContainerTemplate=e._.template("<div class='coveo-menu-item-container'></div>"),this.activeMenuItemTemplate=e._.template("<a class='coveo-menu-item-active'><%= itemIcon %><%= caption %><%= showMoreIcon %> </a>"),this.activeMenuItemIconTemplate=e._.template("<span class='coveo-icon <%= _class %>'></span>"),this.activeMenuItemCaptionTemplate=e._.template("<span class='coveo-caption'><%= text %></span>"),this.options=t.ComponentOptions.initComponentOptions(o,n,s),this.initQueryStateEvents(),this.initMiscEvents()}return __extends(n,i),n.prototype.open=function(){this.renderMenu(),this.menuItemsContainer.css("min-width",this.activeMenuItemDisplay.outerWidth()),this.menuItemsContainer.show(),this.activeMenuItemDisplay.addClass("coveo-menu-open"),this.menuIsOpen=!0},n.prototype.close=function(){this.menuItemsContainer.hide(),this.activeMenuItemDisplay.removeClass("coveo-menu-open"),this.menuIsOpen=!1},n.prototype.handleClick=function(e){this.targetIsAMenuItem(e)?this.handleClickOnMenuItem(e):this.handleClickOnMenu()},n.prototype.handleClickOnMenuItem=function(e){var i=t.Component.get(this.getCorrectTarget(e).get(0),t.TabGroup);this.selectMenuItem(this.getItemInMenuById(i.getId())),this.close(),this.queryController.deferExecuteQuery()},n.prototype.handleClickOnMenu=function(){this.menuIsOpen?this.close():this.open()},n.prototype.handleMouseLeave=function(){this.close()},n.prototype.handleAfterInitialization=function(){this.initMenuItems();var t=this.queryStateModel.get(e.Models.QueryStateModel.attributesEnum.tg);this.selectMenuItem(this.getItemInMenuById(t))},n.prototype.handleQueryStateChange=function(t,i){e.Assert.exists(i),this.selectMenuItem(this.getItemInMenuById(i.value))},n.prototype.initMenuItems=function(){var i=this;this.menuItemsContainer=e.$(this.menuItemsContainerTemplate()).hide(),this.activeMenuItemDisplay=e.$("<div></div>"),e.$(this.element).append(this.activeMenuItemDisplay,this.menuItemsContainer),this.menuItems=e._.map(e.$(this.element).find("."+t.Component.computeCssClassNameForType(t.TabGroup.ID)),function(t){return i.menuItemsContainer.append(t),{tabGroup:e.$(t).coveo(),element:e.$(t)}})},n.prototype.initQueryStateEvents=function(){var t=this.queryStateModel.getEventName(e.Models.Model.eventTypes.changeOne+e.Models.QueryStateModel.attributesEnum.tg);e.$(this.root).on(t,e.$.proxy(this.handleQueryStateChange,this))},n.prototype.initMiscEvents=function(){var t=this;e.$(this.root).on(e.Events.InitializationEvents.afterInitialization,function(){return t.handleAfterInitialization()}),e.$(this.element).fastClick(function(e){t.handleClick(e)}),e.$(this.element).mouseleave(function(e){setTimeout(function(){t.handleMouseLeave(e)},t.options.menuDelay)})},n.prototype.renderDisplayActiveMenuItem=function(){this.activeMenuItemDisplay.empty(),this.activeMenuItemDisplay.html(this.activeMenuItemTemplate({itemIcon:this.activeMenuItemIconTemplate({_class:this.activeMenuItem.tabGroup.getIcon()}),caption:this.activeMenuItemCaptionTemplate({text:this.activeMenuItem.tabGroup.getTitle()}),showMoreIcon:this.activeMenuItemIconTemplate({_class:"coveo-show-more"})}))},n.prototype.renderMenu=function(){e._.each(this.getInactiveMenuItems(),function(e){e.element.show()}),this.activeMenuItem.element.hide()},n.prototype.selectMenuItem=function(e){void 0!=this.menuItems&&(void 0==e&&(e=this.menuItems[0]),this.activeMenuItem=e,this.activeMenuItem.tabGroup.select(),this.renderDisplayActiveMenuItem())},n.prototype.getItemInMenuById=function(t){return e._.find(this.menuItems,function(e){return e.tabGroup.getId()==t})},n.prototype.getItemInMenuByElement=function(t){return e._.find(this.menuItems,function(i){return e.Utils.objectEqual(t,i.element)})},n.prototype.getInactiveMenuItems=function(){var t=this;return e._.reject(this.menuItems,function(i){return e.Utils.objectEqual(i,t.activeMenuItem)})},n.prototype.getItemMenuClass=function(){return t.Component.computeCssClassNameForType(t.TabGroup.ID)},n.prototype.getCorrectTarget=function(t){return e.$(t.target).parent().hasClass(this.getItemMenuClass())?e.$(t.target).parent():e.$(t.target)},n.prototype.targetIsAMenuItem=function(e){return this.getCorrectTarget(e).hasClass(this.getItemMenuClass())},n.ID="TabGroupMenu",n.options={menuDelay:t.ComponentOptions.buildNumberOption({defaultValue:300})},n}(t.Component);t.TabGroupMenu=i,e.Ui.CoveoJQuery.registerAutoCreateComponent(i)}(t=e.Ui||(e.Ui={}))}(Coveo||(Coveo={}));var Coveo;!function(e){var t;!function(t){var i=function(i){function n(o,s,r){i.call(this,o,n.ID,r),this.options=s,this.isSelected=!1,this.iconTemplate=e._.template("<span class='coveo-icon <%= _class %>'></span>"),this.options=t.ComponentOptions.initComponentOptions(o,n,s),this.title=e.$(this.element).text(),this.initQueryEvents(),this.initQueryStateEvents(),e.$(this.element).prepend(this.iconTemplate({_class:this.options.icon}))}return __extends(n,i),n.prototype.select=function(){this.actionOnSelect(),this.updateQueryStateModel()},n.prototype.getTitle=function(){return this.title},n.prototype.getIcon=function(){return this.options.icon},n.prototype.getId=function(){return this.options.id},n.prototype.actionOnSelect=function(){this.hideTabsNotInThisGroup(),this.isSelected=!0},n.prototype.actionOnUnSelect=function(){this.isSelected=!1},n.prototype.updateQueryStateModel=function(){this.queryStateModel.set(e.Models.QueryStateModel.attributesEnum.tg,this.options.id)},n.prototype.initQueryEvents=function(){e.$(this.root).on(e.Events.QueryEvents.buildingQuery,e.$.proxy(this.handleBuildingQueryEvents,this))},n.prototype.initQueryStateEvents=function(){var t=this.queryStateModel.getEventName(e.Models.Model.eventTypes.changeOne+e.Models.QueryStateModel.attributesEnum.tg);e.$(this.root).on(t,e.$.proxy(this.handleQueryStateChange,this))},n.prototype.handleBuildingQueryEvents=function(t,i){e.Assert.exists(i),this.isSelected&&e.Utils.isNonEmptyString(this.options.expression)&&i.queryBuilder.advancedExpression.add(this.options.expression)},n.prototype.handleQueryStateChange=function(t,i){e.Assert.exists(i),i.value==this.options.id?this.actionOnSelect():this.actionOnUnSelect()},n.prototype.hideTabsNotInThisGroup=function(){var t=this,i=this.getAllTabs();e._.each(i,function(e){t.isElementIncludedInTabGroup(e.element)?e.enable():e.disable()})},n.prototype.getAllVisibleTab=function(){return e._.filter(this.getAllTabs(),function(t){return e.$(t.element).is(":visible")})},n.prototype.getAllTabs=function(){return this.searchInterface.components(t.Tab.ID)},n.prototype.isElementIncludedInTabGroup=function(t){var i=e.$(t).attr("data-tab-group");return void 0==i||e._.contains(i.split(","),this.options.id)},n.ID="TabGroup",n.options={id:t.ComponentOptions.buildStringOption(),icon:t.ComponentOptions.buildIconOption(),expression:t.ComponentOptions.buildStringOption()},n}(t.Component);t.TabGroup=i,e.Ui.CoveoJQuery.registerAutoCreateComponent(i)}(t=e.Ui||(e.Ui={}))}(Coveo||(Coveo={}));var Coveo;!function(e){var t;!function(t){var i=function(i){function n(o,s,r){var a=this;i.call(this,o,n.ID,r),this.element=o,this.options=s,this.options=t.ComponentOptions.initComponentOptions(o,n,s),e.Assert.exists(o),e.Assert.exists(this.options),this.classToToggle=this.options.toggleClass,this.target=this.options.target,this.activateGlass=this.options.activateGlass,this.activateGlass&&this.buildGlass(),e.$(o).fastClick(function(){return a.handleClick()}),"A"==o.tagName&&e.$(o).attr("href","javascript:");var l=this.queryStateModel.getEventName(e.Models.Model.eventTypes.changeOne+e.Models.QueryStateModel.attributesEnum.t);this.bind.onRoot(l,this.handleTabChanged)}return __extends(n,i),n.prototype.handleClick=function(){e.$("."+this.target).hasClass(this.classToToggle)?this.removeToggleClass():this.addToggleClass()},n.prototype.handleTabChanged=function(){this.removeToggleClass()},n.prototype.addToggleClass=function(){e.MobileUtils.addToggleClassOnSearchInterface(this.classToToggle.substr(6),e.DeviceUtils.isPhonegap())},n.prototype.removeToggleClass=function(){e.MobileUtils.removeToggleClassOnSearchInterface(e.DeviceUtils.isPhonegap())},n.prototype.getGlass=function(){return e.$(".coveo-glass")},n.prototype.buildGlass=function(){if(0==this.getGlass().length){var i=e.$("<div></div>").addClass("coveo-glass");i.fastClick(function(){e.MobileUtils.removeToggleClassOnSearchInterface()});var n=e.$("."+t.Component.computeCssClassNameForType(t.SearchInterface.ID));e.$(n).append(i)}},n.ID="ToggleButton",n.options={toggleClass:t.ComponentOptions.buildStringOption(),target:t.ComponentOptions.buildStringOption(),activateGlass:t.ComponentOptions.buildBooleanOption({defaultValue:!0})},n}(t.Component);t.ToggleButton=i,t.CoveoJQuery.registerAutoCreateComponent(i)}(t=e.Ui||(e.Ui={}))}(Coveo||(Coveo={}));var Coveo;!function(e){var t;!function(t){var i=function(i){function n(o,s,r){i.call(this,o,n.ID,r),this.options=s,this.topAnalyticsElementHeaderTemplate=e._.template("<div class='coveo-top-analytics-suggestion-header'>        <span class='coveo-icon-top-analytics'></span>         <span class='coveo-caption'><%= headerTitle %></span>       </div>"),this.topAnalyticsElementRowTemplate=e._.template("<div class='coveo-omnibox-selectable coveo-top-analytics-suggestion-row'>         <%= data %>       </div>"),null==this.options.omniboxSuggestionOptions&&(this.options.omniboxSuggestionOptions={}),t.ComponentOptions.initComponentOptions(o,n,this.options.omniboxSuggestionOptions),this.options.omniboxSuggestionOptions.onSelect=this.options.omniboxSuggestionOptions.onSelect||this.onRowSelection;var a={header:{template:this.topAnalyticsElementHeaderTemplate,title:this.options.omniboxSuggestionOptions.headerTitle},row:this.topAnalyticsElementRowTemplate};this.suggestionForOmniBox=new t.SuggestionForOmniBox(a,e.$.proxy(this.options.omniboxSuggestionOptions.onSelect,this)),e.$(this.root).on(e.Events.OmniBoxEvents.populateOmniBox,e.$.proxy(this.handlePopulateOmnibox,this))}return __extends(n,i),n.prototype.handlePopulateOmnibox=function(t,i){var n=this;if(e.Assert.exists(i),!this.disabled){var o=e.$.Deferred(),s=this.usageAnalytics.getTopQueries({pageSize:this.options.omniboxSuggestionOptions.numberOfSuggestions,queryText:i.completeQueryExpression.word});s.done(function(t){var s=e._.map(t,function(e){return{value:e}}),r=n.suggestionForOmniBox.buildOmniBoxElement(s,i);o.resolve({element:void 0==r?void 0:r.get(0),zIndex:n.options.omniboxSuggestionOptions.omniboxZIndex})}),s.fail(function(){n.resolveWithUndefined(o)}),i.rows.push({deferred:o})}},n.prototype.onRowSelection=function(i,n){var o=this;n.clear(),n.closeOmniBox(),this.queryStateModel.set(e.Models.QueryStateModel.attributesEnum.q,i),this.queryController.deferExecuteQuery({beforeExecuteQuery:function(){return o.usageAnalytics.logSearchEvent(t.AnalyticsActionCauseList.omniboxAnalytics,{})}})},n.prototype.resolveWithUndefined=function(e){e.resolve({element:void 0})},n.ID="TopAnalyticsSuggestions",n.options={omniboxZIndex:t.ComponentOptions.buildNumberOption({defaultValue:52}),headerTitle:t.ComponentOptions.buildLocalizedStringOption({defaultValue:t.l("SuggestedQueries")}),numberOfSuggestions:t.ComponentOptions.buildNumberOption({defaultValue:5})},n}(e.Ui.Component);t.TopAnalyticsSuggestions=i,e.Ui.CoveoJQuery.registerAutoCreateComponent(i)}(t=e.Ui||(e.Ui={}))}(Coveo||(Coveo={}));var Coveo;!function(e){var t;!function(t){var i=function(i){function n(o,s,r){i.call(this,o,n.ID,r),this.options=s,this.topFieldElementHeaderTemplate=e._.template("<div class='coveo-top-field-suggestion-header'>        <span class='coveo-icon-top-field'></span>         <span class='coveo-caption'><%= headerTitle %></span>       </div>"),this.topFieldElementRowTemplate=e._.template("<div class='coveo-omnibox-selectable coveo-top-field-suggestion-row'>         <%= data %>       </div>"),this.options=t.ComponentOptions.initComponentOptions(o,n,s),e.Assert.check(e.Utils.isCoveoField(this.options.field),this.options.field+" is not a valid field"),this.options.onSelect=this.options.onSelect||this.onRowSelection;var a={header:{template:this.topFieldElementHeaderTemplate,title:this.options.headerTitle},row:this.topFieldElementRowTemplate};this.suggestionForOmniBox=new t.SuggestionForOmniBox(a,e.$.proxy(this.options.onSelect,this)),e.$(this.root).on(e.Events.OmniBoxEvents.populateOmniBox,e.$.proxy(this.handlePopulateOmniBox,this))}return __extends(n,i),n.prototype.handlePopulateOmniBox=function(t,i){var n=this;if(e.Assert.exists(i),!this.disabled){var o=i.completeQueryExpression.word,s=e.$.Deferred(),r=this.queryController.getEndpoint().listFieldValues(this.buildListFieldValueRequest(o));r.done(function(e){var t=n.suggestionForOmniBox.buildOmniBoxElement(e,i);s.resolve({element:void 0==t?void 0:t.get(0),zIndex:n.options.omniboxZIndex})}),r.fail(function(){n.resolveWithUndefined(s)}),i.rows.push({deferred:s})}},n.prototype.resolveWithUndefined=function(e){e.resolve({element:void 0})},n.prototype.onRowSelection=function(i,n){var o=this;n.clear(),n.closeOmniBox(),this.queryStateModel.set(e.Models.QueryStateModel.attributesEnum.q,i),this.queryController.deferExecuteQuery({beforeExecuteQuery:function(){return o.usageAnalytics.logSearchEvent(t.AnalyticsActionCauseList.omniboxField,{})}})},n.prototype.buildListFieldValueRequest=function(e){return{field:this.options.field,ignoreAccents:!0,sortCriteria:"occurrences",maximumNumberOfValues:this.options.numberOfSuggestions,patternType:"Wildcards",pattern:"*"+e+"*",queryOverride:this.options.queryOverride}},n.ID="TopFieldSuggestions",n.options={field:t.ComponentOptions.buildFieldOption({required:!0}),queryOverride:t.ComponentOptions.buildStringOption({defaultValue:""}),omniboxZIndex:t.ComponentOptions.buildNumberOption({defaultValue:51}),headerTitle:t.ComponentOptions.buildLocalizedStringOption({defaultValue:t.l("SuggestedResults")}),numberOfSuggestions:t.ComponentOptions.buildNumberOption({defaultValue:5})},n}(e.Ui.Component);t.TopFieldSuggestions=i,e.Ui.CoveoJQuery.registerAutoCreateComponent(i)}(t=e.Ui||(e.Ui={}))}(Coveo||(Coveo={}));
Coveo.Logger.disable();